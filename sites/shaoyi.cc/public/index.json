[{"content":"é¡¹ç›®æ‰“åŒ…åˆ°Maven ç§æœ é…ç½®Maven é…ç½®ç§æœä»“åº“çš„ç”¨æˆ·å’Œå¯†ç \nåœ¨mavenå®‰è£…ç›®å½• /conf/setting.xml ä¸­çš„serversä¸‹æ·»åŠ  \u0026lt;servers\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;nexus-snapshots\u0026lt;/id\u0026gt; \u0026lt;username\u0026gt;admin\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;123456\u0026lt;/password\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;nexus-releases\u0026lt;/id\u0026gt; \u0026lt;username\u0026gt;admin\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;123456\u0026lt;/password\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;/servers\u0026gt; åœ¨éœ€è¦æ‰“åŒ…çš„mavenæ¨¡å—ä¸­ï¼Œé…ç½®pomæ–‡ä»¶å†…å®¹ åœ¨mavenå·¥ç¨‹çš„pom.xmlé…ç½®éƒ¨ç½²çš„ä»“åº“ï¼Œæ³¨æ„pom.xmlå’Œsetting.xmlä¸­çš„idå±æ€§è¦ä¸€è‡´\n\u0026lt;!-- å‘å¸ƒmavenç§æœ --\u0026gt; \u0026lt;distributionManagement\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;nexus-snapshots\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;shishiyi-framework-SNAPSHOTS\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://127.0.0.1:30010/repository/3rd-part/\u0026lt;/url\u0026gt; // ç§æœä»“åº“å¯¹åº”çš„url \u0026lt;/repository\u0026gt; \u0026lt;snapshotRepository\u0026gt; \u0026lt;id\u0026gt;nexus-repository\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;shishiyi-framework-REPOSITORY\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;http://127.0.0.1:30010/repository/3rd-part/\u0026lt;/url\u0026gt; \u0026lt;/snapshotRepository\u0026gt; \u0026lt;/distributionManagement\u0026gt; ä½¿ç”¨deployå‘½ä»¤ä¸Šä¼  mvn source:jar deploy -Dmaven.test.skip=true\né¡¹ç›®è·å–ç§æœä»“åº“ä¸­çš„åŒ… åœ¨é¡¹ç›®æ ¹éƒ¨çš„pomæ–‡ä»¶ä¸­æ·»åŠ ä¸‹åˆ—å†…å®¹\n\u0026lt;!-- è¿œç¨‹nexusä»“åº“ --\u0026gt; \u0026lt;repositories\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;nexus-snapshots\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;http://127.0.0.1:30010/repository/3rd-part/\u0026lt;/url\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;nexus-repository\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;http://127.0.0.1:30010/repository/3rd-part/\u0026lt;/url\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;/repositories\u0026gt; \u0026lt;pluginRepositories\u0026gt; \u0026lt;pluginRepository\u0026gt; \u0026lt;id\u0026gt;nexus-snapshots\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;http://127.0.0.1:30010/repository/3rd-part/\u0026lt;/url\u0026gt; \u0026lt;/pluginRepository\u0026gt; \u0026lt;pluginRepository\u0026gt; \u0026lt;id\u0026gt;nexus-repository\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;http://127.0.0.1:30010/repository/3rd-part/\u0026lt;/url\u0026gt; \u0026lt;/pluginRepository\u0026gt; \u0026lt;/pluginRepositories\u0026gt; ","permalink":"http://shaoyi.cc/posts/blog/maven%E7%A7%81%E6%9C%8D/maven-%E7%A7%81%E6%9C%8D/","summary":"é¡¹ç›®æ‰“åŒ…åˆ°Maven ç§æœ é…ç½®Maven é…ç½®ç§æœä»“åº“çš„ç”¨æˆ·å’Œå¯†ç  åœ¨mavenå®‰è£…ç›®å½• /conf/setting.xml ä¸­çš„serversä¸‹æ·»åŠ  \u0026lt;servers\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;nexus-snapshots\u0026lt;/id\u0026gt; \u0026lt;username\u0026gt;admin\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;123456\u0026lt;/password\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;nexus-releases\u0026lt;/id\u0026gt; \u0026lt;username\u0026gt;admin\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;123456\u0026lt;/password\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;/servers\u0026gt; åœ¨éœ€è¦æ‰“","title":"Maven ç§æœ"},{"content":"Jenkinsæ„å»º å‰ç«¯æ„å»º åˆ›å»ºä¸€ä¸ªã€è‡ªç”±é£æ ¼ã€‘çš„ä»»åŠ¡ ç‚¹å‡»ã€æºç ç®¡ç†ã€‘ å¡«å†™ï¼ˆé€‰æ‹©ï¼‰é¡¹ç›®ä»“åº“çš„åœ°å€å’Œç”¨æˆ·\næŒ‡å®šè¦æ„å»ºçš„ç‰ˆæœ¬ï¼Œå³é¡¹ç›®ä»“åº“çš„è¿œç¨‹ç‰ˆæœ¬å·\né€‰æ‹©nodejsç‰ˆæœ¬ å¦‚æœæ²¡æœ‰é€‰é¡¹ï¼Œè¯´æ˜å½“å‰jenkins æ²¡æœ‰å®‰è£…\nå¡«å†™æ„å»ºçš„å‘½ä»¤ è¿™ä¸ªå‘½ä»¤å–å†³äºå…·ä½“å·¥ç¨‹ï¼Œå’Œæœ¬åœ°ç¬¬ä¸€æ¬¡æ‰§è¡Œå‘½ä»¤åŸºæœ¬ä¸€è‡´\nä¾‹å¦‚ï¼šnode -v \u0026amp;\u0026amp; npm install -g yarn@1.22.19 \u0026amp;\u0026amp; yarn -v \u0026amp;\u0026amp; yarn install \u0026ndash;pure-lockfile \u0026amp;\u0026amp; yarn run build \u0026amp;\u0026amp; cd dist \u0026amp;\u0026amp; tar -zcvf dist.tar.gz *\nä¸Šè¿°ä¾‹å­æ„æ€å¤§è‡´ä¸ºï¼Œè·å–é¡¹ç›®ä¾èµ–ï¼Œå¹¶æ‰“åŒ…æ„å»ºï¼Œç„¶åæŠŠæ‰“å¥½çš„åŒ…å‹ç¼©\nä¼ è¾“æ‰“åŒ…çš„æ–‡ä»¶åˆ°æŒ‡å®šæœåŠ¡å™¨ ã€SSH Serverã€‘ï¼šé€‰æ‹©è¦ä¼ è¾“æ–‡ä»¶çš„æœåŠ¡å™¨\nTransfers\nã€Source filesã€‘ï¼šå†™ä½ è¦ä¼ è¾“çš„æ–‡ä»¶è·¯å¾„ ã€Remove prefixã€‘ï¼šè¦å»æ‰çš„å‰ç¼€ï¼Œä¸å†™è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•ç»“æ„å°†å’ŒSource fileså†™çš„ä¸€è‡´ ã€Remote directoryã€‘ï¼šå†™ä½ è¦éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨çš„é‚£ä¸ªç›®å½•åœ°å€ä¸‹ï¼Œä¸å†™å°±æ˜¯SSH Serversé…ç½®é‡Œé»˜è®¤è¿œç¨‹ç›®å½• ã€Exec commandã€‘ï¼šä¼ è¾“å®Œäº†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå›¾ä¸­ä¾‹å­æ˜¯ è¿›å…¥ç›®å½•,è§£å‹ç¼©,è§£å‹ç¼©å®Œæˆååˆ é™¤å‹ç¼©åŒ…ä¸‰ä¸ªå‘½ä»¤ åç«¯æ„å»º åˆ›å»ºmavenä»»åŠ¡ ä»»åŠ¡çš„å…¨å±€è®¾ç½® æŒ‡å®šjdkç‰ˆæœ¬ ç‚¹å‡»ã€æºç ç®¡ç†ã€‘ å¡«å†™ï¼ˆé€‰æ‹©ï¼‰é¡¹ç›®ä»“åº“çš„åœ°å€å’Œç”¨æˆ·\næŒ‡å®šè¦æ„å»ºçš„ç‰ˆæœ¬ï¼Œå³é¡¹ç›®ä»“åº“çš„è¿œç¨‹ç‰ˆæœ¬å·\næ„å»ºæ—¶ï¼ŒæŒ‡å®špomæ–‡ä»¶ è·³è¿‡æµ‹è¯•æ„å»ºï¼ˆéå¿…é¡»ï¼‰ è®¾ç½®åªç”¨æ„å»ºæˆåŠŸçš„åŒ… ä¼ è¾“æ‰“åŒ…çš„æ–‡ä»¶åˆ°æŒ‡å®šæœåŠ¡å™¨ ã€SSH Serverã€‘ï¼šé€‰æ‹©è¦ä¼ è¾“æ–‡ä»¶çš„æœåŠ¡å™¨\nTransfers\nã€Source filesã€‘ï¼šå†™ä½ è¦ä¼ è¾“çš„æ–‡ä»¶è·¯å¾„ ã€Remove prefixã€‘ï¼šè¦å»æ‰çš„å‰ç¼€ï¼Œä¸å†™è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•ç»“æ„å°†å’ŒSource fileså†™çš„ä¸€è‡´ ã€Remote directoryã€‘ï¼šå†™ä½ è¦éƒ¨ç½²åœ¨è¿œç¨‹æœåŠ¡å™¨çš„é‚£ä¸ªç›®å½•åœ°å€ä¸‹ï¼Œä¸å†™å°±æ˜¯SSH Serversé…ç½®é‡Œé»˜è®¤è¿œç¨‹ç›®å½• ã€Exec commandã€‘ï¼šä¼ è¾“å®Œäº†è¦æ‰§è¡Œçš„å‘½ä»¤ Jenkinsè‡ªåŠ¨åŒ–æ„å»ºï¼ˆé’©å­ï¼‰ è®¾ç½®è§¦å‘è‡ªåŠ¨åŒ–æ„å»ºçš„æ¡ä»¶ ä¸‹å›¾æ¡†ä¸­éƒ¨åˆ†ä¸ºè§¦å‘è‡ªåŠ¨æ„å»ºçš„æ¡ä»¶ï¼Œæœ¬ä¾‹å­è§¦å‘æ¡ä»¶çš„ä¸ºã€æäº¤äº‹ä»¶ã€‘\nè®¾ç½®åˆ†æ”¯è¿‡æ»¤ æœ¬ä¾‹æ²¡æœ‰åšé™åˆ¶\nGitLabè®¾ç½® å¤åˆ¶URL\nç‚¹å‡»GenerateæŒ‰é’®ï¼Œtokenå°±ä¼šè‡ªåŠ¨ç”ŸæˆSecret token\nURLå’ŒSecret tokenï¼Œè®¾ç½®åœ¨å¯¹åº”çš„ä»“åº“ä¸­ æµ‹è¯• GitLabé¡µé¢æç¤ºä¸‹å›¾å†…å®¹ï¼Œåˆ™æˆåŠŸè§¦å‘Jenkinsæ„å»ºä»»åŠ¡ Jenkinsæ„å»ºå†å²å·²æœ‰è®°å½• é¡¹ç›®é…ç½®ç§æœ ä»“åº“setting.xmlæ–‡ä»¶é…ç½®ç§æœç”¨æˆ·å¯†ç  ç”±äºjenkinsæ˜¯dockeréƒ¨ç½²çš„ï¼Œä¼šç‰µæ‰¯åˆ°ä¸€ä¸ªè®¿é—®åœ°å€\nå¦‚æœæ˜¯æœ¬åœ°è·å–ç§æœåŒ…ï¼Œåˆ™éœ€è¦åœ¨é¡¹ç›®çš„æ ¹éƒ¨pom.xml é…ç½®ç§æœåœ°å€ æ³¨ï¼šidè¦å’Œsetting.xmlæ–‡ä»¶ä¸­ä¸€è‡´\nå¦‚æœæ˜¯Jenkinsæ„å»ºï¼Œåˆ™éœ€è¦æŠŠé¡¹ç›®çš„æ ¹éƒ¨pom.xml æ”¹æˆä¸‹å›¾ä¸­çš„ip\n","permalink":"http://shaoyi.cc/posts/blog/jenkins%E6%9E%84%E5%BB%BA/jenkins-%E6%9E%84%E5%BB%BA/","summary":"Jenkinsæ„å»º å‰ç«¯æ„å»º åˆ›å»ºä¸€ä¸ªã€è‡ªç”±é£æ ¼ã€‘çš„ä»»åŠ¡ ç‚¹å‡»ã€æºç ç®¡ç†ã€‘ å¡«å†™ï¼ˆé€‰æ‹©ï¼‰é¡¹ç›®ä»“åº“çš„åœ°å€å’Œç”¨æˆ· æŒ‡å®šè¦æ„å»ºçš„ç‰ˆæœ¬ï¼Œå³é¡¹ç›®ä»“åº“çš„è¿œç¨‹ç‰ˆæœ¬å·","title":"Jenkinséƒ¨ç½²"},{"content":"å…³äºæˆ‘\n","permalink":"http://shaoyi.cc/about/","summary":"å…³äºæˆ‘","title":"ğŸ™‹ğŸ»â€â™‚ï¸å…³äº"},{"content":"Dockerå®‰è£…æ­¥éª¤ å®‰è£…Docker å®‰è£…\nå¸®åŠ©æ–‡æ¡£ï¼š\n# yumå®‰è£…gccç›¸å…³ç¯å¢ƒï¼ˆéœ€è¦ç¡®ä¿ è™šæ‹Ÿæœºå¯ä»¥ä¸Šå¤–ç½‘ ï¼‰ yum -y install gcc yum -y install gcc-c++ #1ã€å¸è½½æ—§çš„Dockerç‰ˆæœ¬ yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine #2ã€éœ€è¦çš„å®‰è£…åŒ… yum install -y yum-utils #æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼• yum makecache fast #3ã€è®¾ç½®é•œåƒçš„ä»“åº“ yum-config-manager \\ --add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo #é»˜è®¤æ˜¯å›½å¤–çš„é•œåƒï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ yum-config-manager \\ --add-repo \\ http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo #é˜¿é‡Œäº‘çš„é•œåƒåœ°å€å®‰è£…(æ¨èä½¿ç”¨å›½å†…çš„é•œåƒ) #4ã€å®‰è£…Docker docker-ce ç¤¾åŒºç‰ˆ ee ä¼ä¸šç‰ˆ yum install docker-ce docker-ce-cli containerd.io #5ã€å¯ç”¨Docker systemctl start docker #6ã€æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ docker version #7ã€hello-world docker run hello-world #8ã€æŸ¥çœ‹ä¸€ä¸‹ ä¸‹è½½çš„è¿™ä¸ªhello-worldé•œåƒ [root@shishiyi /]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE hello-world latest bf756fb1ae65 8 months ago 13.3kB äº†è§£ï¼šå¦‚ä½•å¸è½½Docker\n#1ã€å¸è½½dockerçš„ä¾èµ– yum remove docker-ce docker-ce-cli containerd.io #2ã€åˆ é™¤èµ„æº rm -rf /var/lib/docker #\t/var/lib/docker ä¸ºdockerçš„é»˜è®¤å·¥ä½œè·¯å¾„ é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ 1ã€æ‰¾åˆ°é˜¿é‡Œäº‘çš„ã€å®¹å™¨é•œåƒæœåŠ¡ã€‘â€”â€”\u0026gt;ã€é•œåƒä¸­å¿ƒã€‘â€”â€”\u0026gt;ã€é•œåƒåŠ é€Ÿå™¨ã€‘\n2ã€é€‰æ‹©å¯¹åº”çš„ç³»ç»Ÿé…ç½®ä½¿ç”¨\nsudo mkdir -p /etc/docker\t#åˆ›å»ºç›®å½•å¹¶åœ¨ç›®å½•ä¸‹åŠ å…¥é•œåƒé…ç½® sudo tee /etc/docker/daemon.json \u0026lt;\u0026lt;-\u0026#39;EOF\u0026#39;\t{ \u0026#34;registry-mirrors\u0026#34;: [\u0026#34;https://rksuvr7q.mirror.aliyuncs.com\u0026#34;] } EOF sudo systemctl daemon-reload\t#é‡å¯é•œåƒ sudo systemctl restart docker\t#é‡å¯Docker Dockerå¸¸ç”¨å‘½ä»¤ å¸®åŠ©å‘½ä»¤ docker version\t#æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬ä¿¡æ¯ docker info\t#æ˜¾ç¤ºdockerçš„ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡ docker å‘½ä»¤ --help #å¸®åŠ©å‘½ä»¤ å¸®åŠ©æ–‡æ¡£é“¾æ¥ï¼šhttps://docs.docker.com/reference/\né•œåƒå‘½ä»¤ docker images æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°çš„ä¸»æœºä¸Šçš„é•œåƒ\n[root@shishiyi ~]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE hello-world latest bf756fb1ae65 8 months ago 13.3kB #è§£é‡Š REPOSITORY é•œåƒçš„ä»“åº“æºï¼ˆå³åå­—ï¼‰ TAG\té•œåƒçš„æ ‡ç­¾ IMAGE ID\té•œåƒçš„id CREATED é•œåƒçš„åˆ›å»ºæ—¶é—´ SIZE\té•œåƒçš„å¤§å° #å¯é€‰é¡¹ -a, --all # åˆ—å‡ºæ‰€æœ‰é•œåƒ -q, --quiet # åªæ˜¾ç¤ºé•œåƒçš„id docker search\tæœç´¢é•œåƒ\n[root@shishiyi ~]# docker search mysql NAME DESCRIPTION STARS OFFICIAL AUTOMATED mysql MySQL is a widely used, open-source relationâ€¦ 9918 [OK] mariadb MariaDB is a community-developed fork of MySâ€¦ 3629 [OK] #å¯é€‰é¡¹ æœç´¢è¿‡æ»¤ --filter=STARS=3000\t#è¡¨ç¤ºæœç´¢å‡ºæ¥çš„é•œåƒä¸ºSTARSå¤§äº3000çš„ [root@shishiyi ~]# docker search mysql --filter=STARS=3000 NAME DESCRIPTION STARS OFFICIAL AUTOMATED mysql MySQL is a widely used, open-source relationâ€¦ 9918 [OK] mariadb MariaDB is a community-developed fork of MySâ€¦ 3629 [OK] [root@shishiyi ~]# docker search mysql --filter=STARS=4000 NAME DESCRIPTION STARS OFFICIAL AUTOMATED mysql MySQL is a widely used, open-source relationâ€¦ 9918 [OK] docker pull\tä¸‹è½½é•œåƒ\n#ä¸‹è½½é•œåƒ docker pull é•œåƒåç§°:[tag] [root@shishiyi ~]# docker pull mysql Using default tag: latest\t#å¦‚æœä¸å†™tag,å³ç‰ˆæœ¬å·ï¼Œé»˜è®¤å°±æ˜¯latest latest: Pulling from library/mysql bf5952930446: Pull complete #åˆ†å±‚ä¸‹è½½ï¼Œdocker imagesçš„æ ¸å¿ƒ è”åˆæ–‡ä»¶ç³»ç»Ÿ 8254623a9871: Pull complete 938e3e06dac4: Pull complete ea28ebf28884: Pull complete f3cef38785c2: Pull complete 894f9792565a: Pull complete 1d8a57523420: Pull complete 6c676912929f: Pull complete ff39fdb566b4: Pull complete fff872988aba: Pull complete 4d34e365ae68: Pull complete 7886ee20621e: Pull complete Digest: sha256:c358e72e100ab493a0304bda35e6f239db2ec8c9bb836d8a427ac34307d074ed\t#ç­¾å Status: Downloaded newer image for mysql:latest\tdocker.io/library/mysql:latest\t#çœŸå®åœ°å€ #ç­‰ä»·äºå®ƒ docker pull mysql docker pull docker.io/library/mysql:latest #æŒ‡å®šç‰ˆæœ¬ä¸‹è½½ [root@shishiyi ~]# docker pull mysql:5.7 5.7: Pulling from library/mysql bf5952930446: Already exists 8254623a9871: Already exists 938e3e06dac4: Already exists ea28ebf28884: Already exists f3cef38785c2: Already exists 894f9792565a: Already exists 1d8a57523420: Already exists 5f09bf1d31c1: Pull complete 1b6ff254abe7: Pull complete 74310a0bf42d: Pull complete d398726627fd: Pull complete Digest: sha256:da58f943b94721d46e87d5de208dc07302a8b13e638cd1d24285d222376d6d84 Status: Downloaded newer image for mysql:5.7 docker.io/library/mysql:5.7 docker rmi åˆ é™¤é•œåƒ\n[root@shishiyi ~]# docker rmi -f é•œåƒid\t#åˆ é™¤æŒ‡å®šé•œåƒ [root@shishiyi ~]# docker rmi -f é•œåƒid é•œåƒid é•œåƒid é•œåƒid\t#åˆ é™¤å¤šä¸ªé•œåƒid\t[root@shishiyi ~]# docker rmi -f $(docker images -aq)\t#åˆ é™¤å…¨éƒ¨é•œåƒ å®¹å™¨å‘½ä»¤ æœ‰é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼ŒLinuxä¸‹è½½ä¸€ä¸ªcentosæµ‹è¯•\ndocker pull centos æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨\ndocker run [å¯é€‰å‚æ•°] image # å‚æ•°è¯´æ˜ --name=\u0026#34;Name\u0026#34;\tå®¹å™¨åå­— ï¼Œç”¨æ¥åŒºåˆ†å®¹å™¨ -d\tåå°æ–¹å¼è¿è¡Œ -it\tä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹ -p(å°å†™)\tæŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼Œä¾‹å¦‚ -p 8080:8080 -p ip:ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£ -p ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£ï¼ˆå¸¸ç”¨ï¼‰ -p å®¹å™¨ç«¯å£ å®¹å™¨ç«¯å£ -P(å¤§å†™) éšæœºæŒ‡å®šç«¯å£ #æµ‹è¯•ï¼Œå¯åŠ¨è¿›å…¥å®¹å™¨ [root@shishiyi ~]# docker run -it centos /bin/bash [root@17e6da9a3c45 /]# ls\t#æŸ¥çœ‹å®¹å™¨å†…çš„centos,åŸºç¡€ç‰ˆï¼Œå¾ˆå¤šå‘½ä»¤ä¸å®Œå–„çš„ bin etc lib\tlost+found mnt proc run srv tmp var dev home lib64 media opt root sbin sys usr åˆ—å‡ºæ‰€æœ‰è¿è¡Œçš„å®¹å™¨\n#docker ps å‘½ä»¤ åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ -a\t#åˆ—å‡ºè¿è¡Œè¿‡å’Œæ­£åœ¨è¿è¡Œçš„å®¹å™¨ -n=? #åˆ—å‡ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ -q\t#åªæ˜¾ç¤ºå®¹å™¨çš„ç¼–å· [root@shishiyi ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES [root@shishiyi ~]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 17e6da9a3c45 centos \u0026#34;/bin/bash\u0026#34; 3 minutes ago Exited (127) 46 seconds ago relaxed_babbage f8decff51b25 bf756fb1ae65 \u0026#34;/hello\u0026#34; 18 hours ago Exited (0) 18 hours ago boring_curran é€€å‡ºå®¹å™¨\nexit # é€€å‡ºå®¹å™¨å¹¶åœæ­¢ Ctrl + P + Q #é€€å‡ºå®¹å™¨ä¸”ä¸åœæ­¢ åˆ é™¤å®¹å™¨\ndocker rm å®¹å™¨id\t#åˆ é™¤æŒ‡å®šå®¹å™¨ï¼Œä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¦‚æœå¼ºåˆ¶åˆ é™¤ rm -f docker rm -f $(docker ps -aq)\t#åˆ é™¤æ‰€æœ‰å®¹å™¨ docker ps -a -q|xargs docker rm\t#åˆ é™¤æ‰€æœ‰å®¹å™¨ å¯åŠ¨å’Œåœæ­¢å®¹å™¨\ndocker start å®¹å™¨id\t#å¯åŠ¨æŒ‡å®šå®¹å™¨ docker restart å®¹å™¨id\t#é‡å¯æŒ‡å®šå®¹å™¨ docker stop å®¹å™¨id\t#åœæ­¢å½“å‰æ­£åœ¨è¿è¡ŒæŒ‡å®šå®¹å™¨ docker kill å®¹å™¨id\t#å¼ºåˆ¶åœæ­¢å½“å‰æŒ‡å®šå®¹å™¨ å…¶å®ƒå¸¸ç”¨å‘½ä»¤ æŸ¥çœ‹æ—¥å¿—\n#å‘½ä»¤ docker logs -f -t --tail å®¹å™¨id #[root@shishiyi /]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS 5c97ab1298f8 centos \u0026#34;/bin/bash\u0026#34; 6 minutes ago Up 6 minutes #ä¾‹å¦‚ -tf\t#æ˜¾ç¤ºæ—¥å¿— --tail number\t#è¦æ˜¯æ˜¾ç¤ºçš„æ—¥å¿—æ¡æ•° [root@shishiyi ~]# docker logs -tf --tail 10 5c97ab1298f8 æŸ¥çœ‹å®¹å™¨ä¸­è¿›ç¨‹ä¿¡æ¯\n# å‘½ä»¤ docker top å®¹å™¨id #ä¾‹å¦‚ [root@shishiyi /]# docker top 5c97ab1298f8 UID PID PPID C STIME TTY TIME root 16042 16018 0 15:27 pts/0 00:00:00 æŸ¥çœ‹é•œåƒçš„å…ƒæ•°æ®\n#å‘½ä»¤ docker inspect å®¹å™¨id #æµ‹è¯• [root@shishiyi /]# docker inspect 5c97ab1298f8 [ { \u0026#34;Id\u0026#34;: \u0026#34;5c97ab1298f8820d95e8cda27ea9156e5c249ad2d90ade5d7a3d064401bf8ecb\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2020-09-01T07:27:36.571377434Z\u0026#34;, \u0026#34;Path\u0026#34;: \u0026#34;/bin/bash\u0026#34;, \u0026#34;Args\u0026#34;: [], \u0026#34;State\u0026#34;: { \u0026#34;Status\u0026#34;: \u0026#34;running\u0026#34;, \u0026#34;Running\u0026#34;: true, \u0026#34;Paused\u0026#34;: false, \u0026#34;Restarting\u0026#34;: false, \u0026#34;OOMKilled\u0026#34;: false, \u0026#34;Dead\u0026#34;: false, \u0026#34;Pid\u0026#34;: 16042, \u0026#34;ExitCode\u0026#34;: 0, \u0026#34;Error\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;StartedAt\u0026#34;: \u0026#34;2020-09-01T07:27:36.940479781Z\u0026#34;, \u0026#34;FinishedAt\u0026#34;: \u0026#34;0001-01-01T00:00:00Z\u0026#34; }, \u0026#34;Image\u0026#34;: \u0026#34;sha256:0d120b6ccaa8c5e149176798b3501d4dd1885f961922497cd0abef155c869566\u0026#34;, \u0026#34;ResolvConfPath\u0026#34;: \u0026#34;/var/lib/docker/containers/5c97ab1298f8820d95e8cda27ea9156e5c249ad2d90ade5d7a3d064401bf8ecb/resolv.conf\u0026#34;, \u0026#34;HostnamePath\u0026#34;: \u0026#34;/var/lib/docker/containers/5c97ab1298f8820d95e8cda27ea9156e5c249ad2d90ade5d7a3d064401bf8ecb/hostname\u0026#34;, \u0026#34;HostsPath\u0026#34;: \u0026#34;/var/lib/docker/containers/5c97ab1298f8820d95e8cda27ea9156e5c249ad2d90ade5d7a3d064401bf8ecb/hosts\u0026#34;, \u0026#34;LogPath\u0026#34;: \u0026#34;/var/lib/docker/containers/5c97ab1298f8820d95e8cda27ea9156e5c249ad2d90ade5d7a3d064401bf8ecb/5c97ab1298f8820d95e8cda27ea9156e5c249ad2d90ade5d7a3d064401bf8ecb-json.log\u0026#34;, \u0026#34;Name\u0026#34;: \u0026#34;/nifty_margulis\u0026#34;, \u0026#34;RestartCount\u0026#34;: 0, \u0026#34;Driver\u0026#34;: \u0026#34;overlay2\u0026#34;, \u0026#34;Platform\u0026#34;: \u0026#34;linux\u0026#34;, \u0026#34;MountLabel\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;ProcessLabel\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;AppArmorProfile\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;ExecIDs\u0026#34;: null, \u0026#34;HostConfig\u0026#34;: { \u0026#34;Binds\u0026#34;: null, \u0026#34;ContainerIDFile\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;LogConfig\u0026#34;: { \u0026#34;Type\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;Config\u0026#34;: {} }, \u0026#34;NetworkMode\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;PortBindings\u0026#34;: {}, \u0026#34;RestartPolicy\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;no\u0026#34;, \u0026#34;MaximumRetryCount\u0026#34;: 0 }, \u0026#34;AutoRemove\u0026#34;: false, \u0026#34;VolumeDriver\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;VolumesFrom\u0026#34;: null, \u0026#34;CapAdd\u0026#34;: null, \u0026#34;CapDrop\u0026#34;: null, \u0026#34;Capabilities\u0026#34;: null, \u0026#34;Dns\u0026#34;: [], \u0026#34;DnsOptions\u0026#34;: [], \u0026#34;DnsSearch\u0026#34;: [], \u0026#34;ExtraHosts\u0026#34;: null, \u0026#34;GroupAdd\u0026#34;: null, \u0026#34;IpcMode\u0026#34;: \u0026#34;private\u0026#34;, \u0026#34;Cgroup\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Links\u0026#34;: null, \u0026#34;OomScoreAdj\u0026#34;: 0, \u0026#34;PidMode\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Privileged\u0026#34;: false, \u0026#34;PublishAllPorts\u0026#34;: false, \u0026#34;ReadonlyRootfs\u0026#34;: false, \u0026#34;SecurityOpt\u0026#34;: null, \u0026#34;UTSMode\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;UsernsMode\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;ShmSize\u0026#34;: 67108864, \u0026#34;Runtime\u0026#34;: \u0026#34;runc\u0026#34;, \u0026#34;ConsoleSize\u0026#34;: [ 0, 0 ], \u0026#34;Isolation\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;CpuShares\u0026#34;: 0, \u0026#34;Memory\u0026#34;: 0, \u0026#34;NanoCpus\u0026#34;: 0, \u0026#34;CgroupParent\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;BlkioWeight\u0026#34;: 0, \u0026#34;BlkioWeightDevice\u0026#34;: [], \u0026#34;BlkioDeviceReadBps\u0026#34;: null, \u0026#34;BlkioDeviceWriteBps\u0026#34;: null, \u0026#34;BlkioDeviceReadIOps\u0026#34;: null, \u0026#34;BlkioDeviceWriteIOps\u0026#34;: null, \u0026#34;CpuPeriod\u0026#34;: 0, \u0026#34;CpuQuota\u0026#34;: 0, \u0026#34;CpuRealtimePeriod\u0026#34;: 0, \u0026#34;CpuRealtimeRuntime\u0026#34;: 0, \u0026#34;CpusetCpus\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;CpusetMems\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Devices\u0026#34;: [], \u0026#34;DeviceCgroupRules\u0026#34;: null, \u0026#34;DeviceRequests\u0026#34;: null, \u0026#34;KernelMemory\u0026#34;: 0, \u0026#34;KernelMemoryTCP\u0026#34;: 0, \u0026#34;MemoryReservation\u0026#34;: 0, \u0026#34;MemorySwap\u0026#34;: 0, \u0026#34;MemorySwappiness\u0026#34;: null, \u0026#34;OomKillDisable\u0026#34;: false, \u0026#34;PidsLimit\u0026#34;: null, \u0026#34;Ulimits\u0026#34;: null, \u0026#34;CpuCount\u0026#34;: 0, \u0026#34;CpuPercent\u0026#34;: 0, \u0026#34;IOMaximumIOps\u0026#34;: 0, \u0026#34;IOMaximumBandwidth\u0026#34;: 0, \u0026#34;MaskedPaths\u0026#34;: [ \u0026#34;/proc/asound\u0026#34;, \u0026#34;/proc/acpi\u0026#34;, \u0026#34;/proc/kcore\u0026#34;, \u0026#34;/proc/keys\u0026#34;, \u0026#34;/proc/latency_stats\u0026#34;, \u0026#34;/proc/timer_list\u0026#34;, \u0026#34;/proc/timer_stats\u0026#34;, \u0026#34;/proc/sched_debug\u0026#34;, \u0026#34;/proc/scsi\u0026#34;, \u0026#34;/sys/firmware\u0026#34; ], \u0026#34;ReadonlyPaths\u0026#34;: [ \u0026#34;/proc/bus\u0026#34;, \u0026#34;/proc/fs\u0026#34;, \u0026#34;/proc/irq\u0026#34;, \u0026#34;/proc/sys\u0026#34;, \u0026#34;/proc/sysrq-trigger\u0026#34; ] }, \u0026#34;GraphDriver\u0026#34;: { \u0026#34;Data\u0026#34;: { \u0026#34;LowerDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/59787dd31a270bf3606b8f7960f91eb54aaf5926b0c940b32bc7488ac4a91edc-init/diff:/var/lib/docker/overlay2/cfd05b0bbde49a9a0c58c89767084e493d0b018ef3c1bc0220a022015610b97a/diff\u0026#34;, \u0026#34;MergedDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/59787dd31a270bf3606b8f7960f91eb54aaf5926b0c940b32bc7488ac4a91edc/merged\u0026#34;, \u0026#34;UpperDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/59787dd31a270bf3606b8f7960f91eb54aaf5926b0c940b32bc7488ac4a91edc/diff\u0026#34;, \u0026#34;WorkDir\u0026#34;: \u0026#34;/var/lib/docker/overlay2/59787dd31a270bf3606b8f7960f91eb54aaf5926b0c940b32bc7488ac4a91edc/work\u0026#34; }, \u0026#34;Name\u0026#34;: \u0026#34;overlay2\u0026#34; }, \u0026#34;Mounts\u0026#34;: [], \u0026#34;Config\u0026#34;: { \u0026#34;Hostname\u0026#34;: \u0026#34;5c97ab1298f8\u0026#34;, \u0026#34;Domainname\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;User\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;AttachStdin\u0026#34;: true, \u0026#34;AttachStdout\u0026#34;: true, \u0026#34;AttachStderr\u0026#34;: true, \u0026#34;Tty\u0026#34;: true, \u0026#34;OpenStdin\u0026#34;: true, \u0026#34;StdinOnce\u0026#34;: true, \u0026#34;Env\u0026#34;: [ \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34; ], \u0026#34;Cmd\u0026#34;: [ \u0026#34;/bin/bash\u0026#34; ], \u0026#34;Image\u0026#34;: \u0026#34;centos\u0026#34;, \u0026#34;Volumes\u0026#34;: null, \u0026#34;WorkingDir\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Entrypoint\u0026#34;: null, \u0026#34;OnBuild\u0026#34;: null, \u0026#34;Labels\u0026#34;: { \u0026#34;org.label-schema.build-date\u0026#34;: \u0026#34;20200809\u0026#34;, \u0026#34;org.label-schema.license\u0026#34;: \u0026#34;GPLv2\u0026#34;, \u0026#34;org.label-schema.name\u0026#34;: \u0026#34;CentOS Base Image\u0026#34;, \u0026#34;org.label-schema.schema-version\u0026#34;: \u0026#34;1.0\u0026#34;, \u0026#34;org.label-schema.vendor\u0026#34;: \u0026#34;CentOS\u0026#34; } }, \u0026#34;NetworkSettings\u0026#34;: { \u0026#34;Bridge\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;SandboxID\u0026#34;: \u0026#34;24dac8793fce9c49029e6f472af4e01bc23c25af31fbc8d16ce60075ad9b8b33\u0026#34;, \u0026#34;HairpinMode\u0026#34;: false, \u0026#34;LinkLocalIPv6Address\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;LinkLocalIPv6PrefixLen\u0026#34;: 0, \u0026#34;Ports\u0026#34;: {}, \u0026#34;SandboxKey\u0026#34;: \u0026#34;/var/run/docker/netns/24dac8793fce\u0026#34;, \u0026#34;SecondaryIPAddresses\u0026#34;: null, \u0026#34;SecondaryIPv6Addresses\u0026#34;: null, \u0026#34;EndpointID\u0026#34;: \u0026#34;51415885283d49663fb7ca11668b55ad10d433dbe170e5a0699f05f77bd5b5df\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.17.0.1\u0026#34;, \u0026#34;GlobalIPv6Address\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;GlobalIPv6PrefixLen\u0026#34;: 0, \u0026#34;IPAddress\u0026#34;: \u0026#34;172.17.0.2\u0026#34;, \u0026#34;IPPrefixLen\u0026#34;: 16, \u0026#34;IPv6Gateway\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:11:00:02\u0026#34;, \u0026#34;Networks\u0026#34;: { \u0026#34;bridge\u0026#34;: { \u0026#34;IPAMConfig\u0026#34;: null, \u0026#34;Links\u0026#34;: null, \u0026#34;Aliases\u0026#34;: null, \u0026#34;NetworkID\u0026#34;: \u0026#34;927dcbdbe869574ba0ba3e6e0bf4012f1b67fe1f2d1f4846d8da44c96afe0d2f\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;51415885283d49663fb7ca11668b55ad10d433dbe170e5a0699f05f77bd5b5df\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;172.17.0.1\u0026#34;, \u0026#34;IPAddress\u0026#34;: \u0026#34;172.17.0.2\u0026#34;, \u0026#34;IPPrefixLen\u0026#34;: 16, \u0026#34;IPv6Gateway\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;GlobalIPv6Address\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;GlobalIPv6PrefixLen\u0026#34;: 0, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:ac:11:00:02\u0026#34;, \u0026#34;DriverOpts\u0026#34;: null } } } } ] è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨\n#å‘½ä»¤ docker exec -it å®¹å™¨id bashShell #æµ‹è¯• [root@shishiyi /]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS 5c97ab1298f8 centos \u0026#34;/bin/bash\u0026#34; 10 minutes ago Up 10 minutes [root@shishiyi /]# docker exec -it 5c97ab1298f8 /bin/bash [root@5c97ab1298f8 /]# ls bin dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var #æ–¹å¼äºŒ #å‘½ä»¤ docker attach å®¹å™¨id #æµ‹è¯• [root@shishiyi /]# docker attach 5c97ab1298f8 æ­£åœ¨æ‰§è¡Œçš„ä»£ç ....... #docker exec æ˜¯è¿›å…¥å®¹å™¨åé‡æ–°å¼€å¯ä¸€ä¸ªç»ˆç«¯ï¼Œå¯ä»¥åœ¨å®¹å™¨é‡Œæ“ä½œ #docker attach æ˜¯è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯ç”¨æ–°çš„è¿›ç¨‹ï¼ ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š\n#å‘½ä»¤ docker cp å®¹å™¨id:å®¹å™¨å†…è·¯å¾„ ç›®çš„çš„ä¸»æœºè·¯å¾„ commité•œåƒ docker commit\tæäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„å‰¯æœ¬ #å‘½ä»¤å’ŒgitåŸç†ç±»ä¼¼ docker commit -m=\u0026#34;æäº¤çš„æè¿°ä¿¡æ¯\u0026#34; -a=\u0026#34;ä½œè€…\u0026#34; å®¹å™¨id ç›®æ ‡é•œåƒåç§°:[TAG] å®æˆ˜æµ‹è¯•\n#1ã€å¯åŠ¨ä¸€ä¸ªé»˜è®¤çš„tomcatå®¹å™¨ #2ã€å‘ç°é»˜è®¤tomcatå®¹å™¨æ˜¯æ²¡æœ‰webappsåº”ç”¨çš„ï¼Œ é•œåƒçš„åŸå› ï¼Œå®˜æ–¹çš„é•œåƒé»˜è®¤webappsä¸‹é¢æ˜¯æ²¡æœ‰æ–‡ä»¶çš„ #3ã€è‡ªå·±æ‹·è´åŸºæœ¬æ–‡ä»¶åˆ°webappsä¸‹ #4ã€ç„¶åå°†ä¸Šè¿°æ“ä½œåçš„tomcatå®¹å™¨æäº¤ä¸ºä¸€ä¸ªé•œåƒï¼ä¹‹åä¾¿å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–°å»ºçš„é•œåƒåˆ›å»ºå®¹å™¨ å®¹å™¨æ•°æ®å· æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤æ¥æŒ‚è½½ -v\ndocker run -it -v ä¸»æœºç›®å½•:å®¹å™¨å†…çš„ç›®å½• #å¯åŠ¨èµ·æ¥æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡docker inspect å®¹å™¨id æ¥æŸ¥çœ‹æŒ‚è½½çš„ç›®å½• å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½ #åŒ¿åæŒ‚è½½ -v å®¹å™¨å†…è·¯å¾„ #-våé¢åªå†™äº†å®¹å™¨å†…çš„è·¯å¾„ï¼Œæ²¡æœ‰å†™ä¸»æœºè·¯å¾„ï¼Œè¿™ç§å°±æ˜¯åŒ¿åæŒ‚è½½ #å…·åæŒ‚è½½ -v å·å:å®¹å™¨å†…è·¯å¾„ #-våé¢åªå†™äº†ä¸€ä¸ªåå­—ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ä¸»æœºç›®å½•ï¼Œç„¶ååŠ ä¸Šå®¹å™¨å†…è·¯å¾„ï¼Œè¿™ç§å°±æ˜¯å…·åæŒ‚è½½ æ‰€æœ‰çš„dockerå®¹å™¨å†…çš„å·ï¼Œæ²¡æœ‰æŒ‡å®šç›®å½•çš„æƒ…å†µä¸‹éƒ½æ˜¯åœ¨/var/lib/docker/volumes/xxxx/_data\næˆ‘ä»¬é€šè¿‡å…·åæŒ‚è½½å¯ä»¥æ–¹ä¾¿æ‰¾åˆ°æˆ‘ä»¬çš„ä¸€ä¸ªå·ï¼Œå¤§å¤šæ•°æƒ…å†µæ˜¯ä½¿ç”¨å…·åæŒ‚è½½\n#å¦‚ä½•ç¡®å®šæ˜¯å…·åæŒ‚è½½è¿˜æ˜¯åŒ¿åæŒ‚è½½ï¼Œè¿˜æ˜¯æŒ‡å®šè·¯å¾„æŒ‚è½½ -v å®¹å™¨å†…è·¯å¾„\t#åŒ¿åæŒ‚è½½ -v å·å:å®¹å™¨å†…è·¯å¾„\t#å…·åæŒ‚è½½ -v /å®¿ä¸»æœºè·¯å¾„:å®¹å™¨å†…è·¯å¾„ #æŒ‡å®šè·¯å¾„æŒ‚è½½ æ‹“å±•\n#\té€šè¿‡ -v å®¹å™¨å†…è·¯å¾„ï¼šro rw æ”¹å˜è¯»å†™æƒé™ ro\treadonly\t#åªè¯» rw\treadwrite\t#å¯è¯»å¯å†™ #\tä¸€æ—¦è¿™ä¸ªè®¾ç½®äº†å®¹å™¨æƒé™ï¼Œå®¹å™¨å¯¹æˆ‘ä»¬æŒ‚è½½å‡ºæ¥çš„å†…å®¹å°±æœ‰äº†é™å®šï¼ docker run -d -P --name nginx01 -v juming-nginx:/etc/nginx:ro nginx docker run -d -P --name nginx01 -v juming-nginx:/etc/nginx:rw nginx #ro åªè¦çœ‹åˆ°roå°±è¯´æ˜è¿™ä¸ªè·¯å¾„åªèƒ½é€šè¿‡å®¿ä¸»æœºæ¥æ“ä½œï¼Œå®¹å™¨å†…éƒ¨æ˜¯æ— æ³•æ“ä½œï¼ DockerFileæ„å»ºé•œåƒ DockerFileæŒ‡ä»¤ FROM\t#\tåŸºç¡€é•œåƒï¼Œä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹æ„å»º MAINEAINER\t#\té•œåƒæ˜¯è°å†™çš„ï¼Œå§“å+é‚®ç®±ï¼Œè­¬å¦‚ shishiyi\u0026lt;shaoyi.o@qq.com\u0026gt; RUN\t#\té•œåƒæ„å»ºçš„æ—¶å€™éœ€è¦è¿è¡Œçš„å‘½ä»¤ ADD\t#\tæ·»åŠ æ–‡ä»¶ WORKDIR\t#\té•œåƒçš„å·¥ä½œç›®å½• VOLUME\t#\tæŒ‚è½½çš„ç›®å½• EXPOSE #\té•œåƒæš´éœ²çš„ç«¯å£ CMD\t# æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œåœ¨ç”¨runå‘½ä»¤å¯åŠ¨å®¹å™¨è¿½åŠ å‘½ä»¤ä¼šè¢«æ›¿æ¢æ‰ ENTRYPOINT\t#\tæŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨runå‘½ä»¤å¯åŠ¨å®¹å™¨è¿½åŠ å‘½ä»¤ ONBUILD\t#\tå½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿ DockerFile è¿™ä¸ªæ—¶å€™å°±ä¼šè¿è¡Œ ONBUILD çš„æŒ‡ä»¤ã€‚è§¦å‘å‘½ä»¤ COPY\t#\tç±»ä¼¼ADDï¼Œå°†æˆ‘ä»¬æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­ ENV\t#\tæ„å»ºçš„æ—¶å€™è®¾ç½®ç¯å¢ƒå˜é‡ LABEL\t#\tè®¾ç½®é•œåƒçš„æ ‡ç­¾ å®æˆ˜æµ‹è¯•DockerFileæŒ‡ä»¤ # 1ã€ç¼–å†™ä¸€ä¸ªè‡ªå·±çš„centosçš„DockerFileæ–‡ä»¶ [root@shishiyi mydockerfile]# cat mydockerfile-centos FROM centos MAINTAINER shishiyi\u0026lt;shaoyi.0@qq.com\u0026gt; ENV MYPATH /usr/local WORKDIR $MYPATH RUN yum -y install vim RUN yum -y install net-tools EXPOSE 80 CMD echo $MYPATH CMD echo \u0026#34;----end----\u0026#34; CMD /bin/bash # 2ã€é€šè¿‡è‡ªå·±å†™çš„dockerfileæ–‡ä»¶æ„å»ºé•œåƒ #å‘½ä»¤: docker build -f dockerfileæ–‡ä»¶è·¯å¾„ -t é•œåƒå:[tag] . #å‘½ä»¤ç»“å°¾ä¸€å®šè¦åŠ ç©ºæ ¼å’Œç‚¹ [root@shishiyi mydockerfile]# docker build -f mydockerfile-centos -t mycentos:0.1 . ......(ä¸­é—´çœç•¥) Successfully built 09aaf2b838b6 Successfully tagged mycentos:0.1 å¯¹æ¯” åŸç”Ÿçš„centos\né€šè¿‡è‡ªå·±å†™çš„DockerFileæ–‡ä»¶æ„å»ºé•œåƒçš„centos\n# å¯ä»¥é€šè¿‡å‘½ä»¤åˆ—å‡ºä¸€ä¸ªé•œåƒæ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œå³dockerfileçš„å‘½ä»¤ #å‘½ä»¤ï¼š docker history é•œåƒid CMDå’ŒENTRYPOINTçš„åŒºåˆ«\nCMD #è¿™ä¸ªæ˜¯æŒ‡å®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœåœ¨docker runååŠ äº†å‘½ä»¤åˆ™ä¼šè¦†ç›–CMDæŒ‡ä»¤ ENTRYPOINT #è¿™ä¸ªä¹Ÿæ˜¯å®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½¿ç”¨docker run å‘½ä»¤å¯åŠ¨åŒ…å«ENTRYPOINTçš„å®¹å™¨ï¼ŒæŒ‡å®šä¼šä½œä¸ºå‚æ•°ä¼ é€’ #å¦‚æœç¡®å®æœ‰éœ€è¦ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œå®¹å™¨æ—¶é€šè¿‡docker run --entrypoint è¦†ç›–ENTRYPOINTæŒ‡ä»¤ å®æˆ˜æµ‹è¯•ä¸¤è€…åŒºåˆ«\næµ‹è¯•CMD\n#\t1ã€ ç¼–å†™dockerfileæ–‡ä»¶ [root@shishiyi mydockerfile]# vim mydockerfile-centos-cmdtest FROM centos CMD [\u0026#34;ls\u0026#34;,\u0026#34;-a\u0026#34;] #\t2ã€æ„å»ºé•œåƒ [root@shishiyi mydockerfile]# docker build -f mydockerfile-centos-cmdtest -t centos-cmd-test:0.1 . Sending build context to Docker daemon 3.072kB Step 1/2 : FROM centos ---\u0026gt; 0d120b6ccaa8 Step 2/2 : CMD [\u0026#34;ls\u0026#34;,\u0026#34;-a\u0026#34;] ---\u0026gt; Running in d7ee5073447a Removing intermediate container d7ee5073447a ---\u0026gt; adc267054d89 Successfully built adc267054d89 Successfully tagged centos-cmd-test:0.1 #\t3ã€å¯åŠ¨å®¹å™¨ï¼Œå‘ç°ls -aå‘½ä»¤ç”Ÿæ•ˆäº† [root@shishiyi mydockerfile]# docker run centos-cmd-test:0.1 . .. .dockerenv bin dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var #æƒ³è¿½åŠ ä¸€ä¸ªå‘½ä»¤ -l å˜æˆls -al [root@shishiyi mydockerfile]# docker run centos-cmd-test:0.1 -l docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused \u0026#34;exec: \\\u0026#34;-l\\\u0026#34;: executable file not found in $PATH\u0026#34;: unknown. #CMDæƒ…å†µä¸‹ -lå´æŠŠCMD[\u0026#34;ls\u0026#34;, \u0026#34;-a\u0026#34;]æŒ‡ä»¤æ›¿æ¢äº†ï¼Œå¯¼è‡´ä¸æ˜¯å‘½ä»¤æŠ¥é”™ æµ‹è¯•ENTRYPOINTæŒ‡ä»¤\n# ç¼–å†™dockerfileæ–‡ä»¶ [root@shishiyi mydockerfile]# vim mydockerfile-centos-entrypointtest FROM centos ENTRYPOINT [\u0026#34;ls\u0026#34;,\u0026#34;-a\u0026#34;] # æ„å»ºé•œåƒ [root@shishiyi mydockerfile]# docker build -f mydockerfile-centos-entrypointtest -t centos-entrypoint-test:0.1 . Sending build context to Docker daemon 4.096kB Step 1/2 : FROM centos ---\u0026gt; 0d120b6ccaa8 Step 2/2 : ENTRYPOINT [\u0026#34;ls\u0026#34;,\u0026#34;-a\u0026#34;] ---\u0026gt; Running in 936e7ec1e16c Removing intermediate container 936e7ec1e16c ---\u0026gt; 68dbcdfd80a6 Successfully built 68dbcdfd80a6 Successfully tagged centos-entrypoint-test:0.1 # å¯åŠ¨å®¹å™¨ [root@shishiyi mydockerfile]# docker run centos-entrypoint-test:0.1 . .. .dockerenv bin dev etc home lib lib64 lost+found media mnt opt proc root run sbin srv sys tmp usr var #å¯åŠ¨å®¹å™¨è¿½åŠ ä¸€ä¸ªå‘½ä»¤ -l ,å‘ç°ç›´æ¥æ‹¼æ¥åœ¨äº†ENTRYPOINT [\u0026#34;ls\u0026#34;,\u0026#34;-a\u0026#34;]æŒ‡ä»¤åé¢ [root@shishiyi mydockerfile]# docker run centos-entrypoint-test:0.1 -l total 56 drwxr-xr-x 1 root root 4096 Sep 8 04:03 . drwxr-xr-x 1 root root 4096 Sep 8 04:03 .. -rwxr-xr-x 1 root root 0 Sep 8 04:03 .dockerenv lrwxrwxrwx 1 root root 7 May 11 2019 bin -\u0026gt; usr/bin drwxr-xr-x 5 root root 340 Sep 8 04:03 dev drwxr-xr-x 1 root root 4096 Sep 8 04:03 etc drwxr-xr-x 2 root root 4096 May 11 2019 home lrwxrwxrwx 1 root root 7 May 11 2019 lib -\u0026gt; usr/lib lrwxrwxrwx 1 root root 9 May 11 2019 lib64 -\u0026gt; usr/lib64 drwx------ 2 root root 4096 Aug 9 21:40 lost+found drwxr-xr-x 2 root root 4096 May 11 2019 media drwxr-xr-x 2 root root 4096 May 11 2019 mnt drwxr-xr-x 2 root root 4096 May 11 2019 opt dr-xr-xr-x 94 root root 0 Sep 8 04:03 proc dr-xr-x--- 2 root root 4096 Aug 9 21:40 root drwxr-xr-x 11 root root 4096 Aug 9 21:40 run lrwxrwxrwx 1 root root 8 May 11 2019 sbin -\u0026gt; usr/sbin drwxr-xr-x 2 root root 4096 May 11 2019 srv dr-xr-xr-x 13 root root 0 Sep 8 04:03 sys drwxrwxrwt 7 root root 4096 Aug 9 21:40 tmp drwxr-xr-x 12 root root 4096 Aug 9 21:40 usr drwxr-xr-x 20 root root 4096 Aug 9 21:40 var å‘å¸ƒé•œåƒ åˆ°DockerHub\nåœ¨dockerhubå®˜ç½‘æ³¨å†Œä¸€ä¸ªè´¦å·\ndockerhubå®˜ç½‘ï¼šhttps://hub.docker.com/\nç™»å½•dockerhubè´¦å·\n[root@shishiyi mydockerfile]# docker login --help Usage:\tdocker login [OPTIONS] [SERVER] Log in to a Docker registry. If no server is specified, the default is defined by the daemon. Options: -p, --password string Password --password-stdin Take the password from stdin -u, --username string Username [root@shishiyi mydockerfile]# docker login -u shishiyi Password: WARNING! Your password will be stored unencrypted in /root/.docker/config.json. Configure a credential helper to remove this warning. See https://docs.docker.com/engine/reference/commandline/login/#credentials-store Login Succeeded ç™»å½•å®Œæ¯•åå°±å¯ä»¥æäº¤è‡ªå·±çš„é•œåƒäº†\n# æ¨é€é•œåƒçš„è§„èŒƒæ˜¯ï¼š docker push æ³¨å†Œç”¨æˆ·å/é•œåƒå:tag # æ¨é€é•œåƒå°½é‡å¸¦ä¸Šç‰ˆæœ¬å· [root@shishiyi mydockerfile]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE centos-entrypoint-test 0.1 68dbcdfd80a6 3 hours ago 215MB centos-cmd-test 0.1 adc267054d89 3 hours ago 215MB mycentos 0.1 09aaf2b838b6 4 hours ago 287MB centos latest 0d120b6ccaa8 4 weeks ago 215MB [root@shishiyi mydockerfile]# docker push shishiyi/mycentos:0.1 The push refers to repository [docker.io/shishiyi/mycentos] An image does not exist locally with the tag: shishiyi/mycentos #å‘ç°ç›´æ¥è¿™æ ·æ¨é€æ˜¯ä¸è¡Œçš„ï¼Œ çœ‹é”™è¯¯An image does not exist locally with the tag: shishiyi/mycentos, #æœ¬åœ°æ²¡æœ‰tagæ˜¯shishiyi/mycentosçš„é•œåƒ. #è§£å†³åŠæ³•ï¼Œå¢åŠ ä¸€ä¸ªtag [root@shishiyi mydockerfile]# docker tag mycentos:0.1 shishiyi/mycentos:0.1 [root@shishiyi mydockerfile]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE centos-entrypoint-test 0.1 68dbcdfd80a6 3 hours ago 215MB centos-cmd-test 0.1 adc267054d89 4 hours ago 215MB shishiyi/mycentos 0.1 09aaf2b838b6 4 hours ago 287MB mycentos 0.1 09aaf2b838b6 4 hours ago 287MB centos latest 0d120b6ccaa8 4 weeks ago 215MB ç„¶åå†æ¨é€å³å¯ï¼Œè®°å¾—å¸¦ä¸Šç‰ˆæœ¬å·ï¼\nDockerç½‘ç»œï¼ˆå®¹å™¨äº’è”) \u0026ndash;link(å·²è¿‡æ—¶) å®¹å™¨ä¹‹é—´æ˜¯å¦å¯ä»¥é€šè¿‡åå­—pingé€š\nå¯åŠ¨ä¸¤ä¸ªå®¹å™¨åï¼Œå‘ç°ç›´æ¥é€šè¿‡åå­—å¹¶ä¸èƒ½pingé€š\n#å¯ä»¥ä½¿ç”¨ --linkå‘½ä»¤æ¥è§£å†³ [root@shishiyi home]# docker run -d -P --name tomcat03 --link tomcat02 tomcat d5e88ace3eb8793c00e3441440347c2cbe52784e8771b6882edb47671631eb5f [root@shishiyi home]# docker exec -it tomcat03 ping tomcat02 PING tomcat02 (172.17.0.3) 56(84) bytes of data. 64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.092 ms 64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.067 ms 64 bytes from tomcat02 (172.17.0.3): icmp_seq=3 ttl=64 time=0.068 ms 64 bytes from tomcat02 (172.17.0.3): icmp_seq=4 ttl=64 time=0.072 ms #ä½†æ˜¯ä¸èƒ½åå‘pingé€š [root@shishiyi home]# docker exec -it tomcat02 ping tomcat03 ping: tomcat03: Name or service not known å…¶å®è¿™ä¸ªtomcat03ä¹‹æ‰€ä»¥èƒ½pingé€štomcat02ï¼Œæœ¬è´¨æ˜¯å› ä¸ºåœ¨tomcat03æœ¬åœ°é…ç½®hostsæ–‡ä»¶\n#æŸ¥çœ‹tomcat03çš„hostsæ–‡ä»¶ [root@shishiyi home]# docker exec -it tomcat03 cat /etc/hosts 127.0.0.1\tlocalhost ::1\tlocalhost ip6-localhost ip6-loopback fe00::0\tip6-localnet ff00::0\tip6-mcastprefix ff02::1\tip6-allnodes ff02::2\tip6-allrouters 172.17.0.3\ttomcat02 639797bb5b9b 172.17.0.4\td5e88ace3eb8 \u0026ndash;linkå‘½ä»¤å°±æ˜¯åœ¨hostsæ–‡ä»¶ä¸­æ·»åŠ äº†ä¸€è¡Œ 172.17.0.3\ttomcat02 639797bb5b9b\nè‡ªå®šä¹‰ç½‘ç»œ [root@shishiyi /]# docker network ls NETWORK ID NAME DRIVER SCOPE b975ebb49b23 bridge bridge local fd952cfe82a0 host host local 50c346e922df none null local ç½‘ç»œæ¨¡å¼\nbridgeï¼šæ¡¥æ¥docker (é»˜è®¤çš„ï¼Œè‡ªå·±åˆ›å»ºä¹Ÿæ˜¯ä½¿ç”¨bridge æ¨¡å¼) host ï¼šå’Œå®¿ä¸»æœºå…±ç”¨ç½‘ç»œ none ï¼šä¸é…ç½®ç½‘ç»œ dockeré»˜è®¤ä½¿ç”¨bridge æ¨¡å¼å³docker0ï¼Œä½†æ˜¯docker0 ä¸æ”¯æŒå®¹å™¨ä¹‹é—´ é€šè¿‡åå­—ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€‰æ‹©å¦ä¸€ç§æ–¹å¼å³è‡ªå®šä¹‰ç½‘ç»œ\n#åˆ›å»ºè‡ªå·±çš„ç½‘ç»œ #\t--driver bridge é€‰æ‹©ç½‘ç»œæ¨¡å¼(ä¸å†™é»˜è®¤ä¸ºbridge) #\t--subnet 192.168.0.0/16 å­ç½‘çš„è·¯æ®µ 192.168.0.0/16è¡¨ç¤ºä»192.168.0.2åˆ°192.168.255.255 #\t--gateway 192.168.0.1\tç½‘å…³åœ°å€å³è·¯ç”± [root@shishiyi /]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynetwork 8ecbbe2766eca4f95f19cc37f731bccaa305b440834abdce4006fe6ef3e5fecb [root@shishiyi /]# docker network ls NETWORK ID NAME DRIVER SCOPE b975ebb49b23 bridge bridge local fd952cfe82a0 host host local 8ecbbe2766ec mynetwork bridge local 50c346e922df none null local è‡ªå·±å®šä¹‰çš„ç½‘ç»œå°±é…ç½®å¥½äº†ï¼\n#\tåˆ›å»ºå®¹å™¨æ—¶æŒ‡å®šè‡ªå·±å†™çš„ç½‘å…³ [root@shishiyi /]# docker run -d -P --name tomcat-net-01 --net mynetwork tomcat b39086a191ca5da74eb88fce3bd27ccb5039ea36569ffc4a766b18075ea83cba [root@shishiyi /]# docker run -d -P --name tomcat-net-02 --net mynetwork tomcat 2c48396a0e18213eb913701d98d494546fa4ca7ce1ce316f04b4e7ac45d2aae7 #\tå†æ¬¡æŸ¥çœ‹è‡ªå·±é…ç½®çš„ç½‘å…³ [root@shishiyi /]# docker network inspect mynetwork [ { \u0026#34;Name\u0026#34;: \u0026#34;mynetwork\u0026#34;, \u0026#34;Id\u0026#34;: \u0026#34;8ecbbe2766eca4f95f19cc37f731bccaa305b440834abdce4006fe6ef3e5fecb\u0026#34;, \u0026#34;Created\u0026#34;: \u0026#34;2020-09-08T16:56:59.25870749+08:00\u0026#34;, \u0026#34;Scope\u0026#34;: \u0026#34;local\u0026#34;, \u0026#34;Driver\u0026#34;: \u0026#34;bridge\u0026#34;, \u0026#34;EnableIPv6\u0026#34;: false, \u0026#34;IPAM\u0026#34;: { \u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;, \u0026#34;Options\u0026#34;: {}, \u0026#34;Config\u0026#34;: [ { \u0026#34;Subnet\u0026#34;: \u0026#34;192.168.0.0/16\u0026#34;, \u0026#34;Gateway\u0026#34;: \u0026#34;192.168.0.1\u0026#34; } ] }, \u0026#34;Internal\u0026#34;: false, \u0026#34;Attachable\u0026#34;: false, \u0026#34;Ingress\u0026#34;: false, \u0026#34;ConfigFrom\u0026#34;: { \u0026#34;Network\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;ConfigOnly\u0026#34;: false, \u0026#34;Containers\u0026#34;: { \u0026#34;2c48396a0e18213eb913701d98d494546fa4ca7ce1ce316f04b4e7ac45d2aae7\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;tomcat-net-02\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;7dcfa2ec9c4dc735aed6625791989ea78e8598d0a27d4540d5ef4ef9e0bfe84c\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:c0:a8:00:03\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;192.168.0.3/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; }, \u0026#34;b39086a191ca5da74eb88fce3bd27ccb5039ea36569ffc4a766b18075ea83cba\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;tomcat-net-01\u0026#34;, \u0026#34;EndpointID\u0026#34;: \u0026#34;b988b92f99d56c415e7550c94179cd095ddd75ccb8bd7fb11454d213be6bbcab\u0026#34;, \u0026#34;MacAddress\u0026#34;: \u0026#34;02:42:c0:a8:00:02\u0026#34;, \u0026#34;IPv4Address\u0026#34;: \u0026#34;192.168.0.2/16\u0026#34;, \u0026#34;IPv6Address\u0026#34;: \u0026#34;\u0026#34; } }, \u0026#34;Options\u0026#34;: {}, \u0026#34;Labels\u0026#34;: {} } ] #\tå†æ¬¡é€šè¿‡ipå»pingè¿æ¥ [root@shishiyi /]# docker exec -it tomcat-net-01 ping 192.168.0.3 PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data. 64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.073 ms 64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.062 ms 64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.076 ms #\tä½¿ç”¨äº†è‡ªå·±å†™çš„ç½‘å…³ï¼Œæˆ‘ä»¬å‘ç°å¯ä»¥ç›´æ¥é€šè¿‡åå­—pingé€š [root@shishiyi /]# docker exec -it tomcat-net-01 ping tomcat-net-02 PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data. 64 bytes from tomcat-net-02.mynetwork (192.168.0.3): icmp_seq=1 ttl=64 time=0.060 ms 64 bytes from tomcat-net-02.mynetwork (192.168.0.3): icmp_seq=2 ttl=64 time=0.065 ms ^C --- tomcat-net-02 ping statistics --- ç»“è®ºï¼šæˆ‘ä»¬è‡ªå®šä¹‰çš„ç½‘ç»œdockerå·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤å¥½äº†å¯¹åº”çš„å…³ç³»ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œçš„æ–¹å¼\nå¥½å¤„ï¼š\nä¸åŒçš„é›†ç¾¤ä½¿ç”¨ä¸åŒçš„ç½‘ç»œï¼Œä¿è¯äº†é›†ç¾¤çš„å®‰å…¨å’Œå¥åº·\nç½‘ç»œè¿é€š æ€ä¹ˆåŠåˆ°ä¸åŒçš„ç½‘å…³ä¸‹çš„å®¹å™¨ä¹‹é—´ç›¸äº’è¿é€š\n#\tæµ‹è¯•æ‰“é€šdocker0ç½‘ç»œä¸‹çš„tomcat01 #\tè¿é€šä¹‹åå°±æ˜¯å°†tomcat01æ”¾åˆ°äº†mynetworkç½‘ç»œä¸‹ # å…·ä½“å‘½ä»¤ä¸ºï¼šdocker network connect mynetwork tomcat01 #\tç›¸å½“äºä¸€ä¸ªå®¹å™¨æœ‰äº†ä¸¤ä¸ªipåœ°å€ #\tinspectå‘½ä»¤æŸ¥çœ‹è‡ªå®šä¹‰ç½‘ç»œé…ç½®ï¼Œå‘ç°ç¡®å®šæ·»åŠ äº†å…¶å®ƒç½‘ç»œä¸‹çš„å®¹å™¨è¿›æ¥ ","permalink":"http://shaoyi.cc/posts/blog/docker/docker/","summary":"Dockerå®‰è£…æ­¥éª¤ å®‰è£…Docker å®‰è£… å¸®åŠ©æ–‡æ¡£ï¼š # yumå®‰è£…gccç›¸å…³ç¯å¢ƒï¼ˆéœ€è¦ç¡®ä¿ è™šæ‹Ÿæœºå¯ä»¥ä¸Šå¤–ç½‘ ï¼‰ yum -y install gcc yum -y install gcc-c++ #1ã€å¸è½½æ—§çš„Doc","title":"Docker å®¹å™¨"},{"content":"Docker å®‰è£…RabbitMQ è¿™é‡Œæ³¨æ„è·å–é•œåƒçš„æ—¶å€™è¦è·å–managementç‰ˆæœ¬çš„ï¼Œä¸è¦è·å–lastç‰ˆæœ¬çš„ï¼Œmanagementç‰ˆæœ¬çš„æ‰å¸¦æœ‰ç®¡ç†ç•Œé¢ã€‚\næŸ¥è¯¢é•œåƒ\n#æœç´¢RabbitMQé•œåƒ [root@shishiyi /]# docker search rabbitmq:management å¾—åˆ°ä¸‹åˆ—ç»“æœ\nä¸‹è½½é•œåƒ\n#ä¸‹è½½RabbitMQé•œåƒ [root@shishiyi /]# docker pull rabbitmq:management å‡ºç°å¦‚ä¸‹ç»“æœ\nè¿è¡Œé•œåƒ\n#è¿è¡ŒRabbitMQé•œåƒ [root@shishiyi /]# docker run -d -p 5672:5672 -p 15672:15672 --name rabbitmq rabbitmq:management è®¿é—®ç®¡ç†ç•Œé¢\nåœ°å€ä¸º æœåŠ¡å™¨ip:15672 ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯guest\nJavaæ–¹å¼å®ç°RabbitMQ 1ã€helloword ç”Ÿäº§è€…\nimport com.rabbitmq.client.Channel; import com.rabbitmq.client.Connection; import com.rabbitmq.client.ConnectionFactory; import java.io.IOException; import java.util.concurrent.TimeoutException; public class Provider { public static void main(String[] args) throws IOException, TimeoutException { //åˆ›å»ºmqçš„è¿æ¥å·¥å‚ ConnectionFactory connectionFactory = new ConnectionFactory(); //è®¾ç½®è¿æ¥çš„æœåŠ¡å™¨IP connectionFactory.setHost(\u0026#34;æœåŠ¡å™¨ip\u0026#34;); //è®¾ç½®ç«¯å£å· connectionFactory.setPort(5672); //è®¾ç½®è¿æ¥çš„è™šæ‹Ÿä¸»æœºï¼ˆç±»ä¼¼æ•°æ®åº“ä¸­çš„åº“ï¼‰ connectionFactory.setVirtualHost(\u0026#34;/ems\u0026#34;); //è®¾ç½®ç”¨æˆ·å connectionFactory.setUsername(\u0026#34;ems\u0026#34;); //è®¾ç½®å¯†ç  connectionFactory.setPassword(\u0026#34;123\u0026#34;); //è·å–è¿æ¥ Connection connection = connectionFactory.newConnection(); //è·å–è¿æ¥çš„é€šé“ Channel channel = connection.createChannel(); //é€šé“ç»‘å®šæ¶ˆæ¯é˜Ÿåˆ— //å‚æ•°1ï¼šé˜Ÿåˆ—åç§°ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º //å‚æ•°2ï¼šæ˜¯å¦æŒä¹…é˜Ÿåˆ— //å‚æ•°3ï¼šæ˜¯å¦ç‹¬å é˜Ÿåˆ— //å‚æ•°4ï¼š æ˜¯å¦æ¶ˆè´¹å®Œæ¯•åˆ é™¤é˜Ÿåˆ— //å‚æ•°5ï¼šé¢å¤–é™„åŠ å‚æ•° channel.queueDeclare(\u0026#34;hello\u0026#34;,false,false,false,null); //å‘å¸ƒæ¶ˆæ¯ //å‚æ•°1ï¼šäº¤æ¢æœºï¼›å‚æ•°2ï¼šé˜Ÿåˆ—åç§°ï¼›å‚æ•°3ï¼šä¼ é€’æ¶ˆæ¯çš„é¢å¤–è®¾ç½®ï¼›å‚æ•°4ï¼šæ¶ˆæ¯å†…å®¹ channel.basicPublish(\u0026#34;\u0026#34;,\u0026#34;hello\u0026#34;,null,\u0026#34;hello rabbitmq\u0026#34;.getBytes()); //å…³é—­èµ„æº channel.close(); connection.close(); } } æ¶ˆè´¹è€…\nimport com.rabbitmq.client.*; import java.io.IOException; import java.util.concurrent.TimeoutException; public class Consumer { public static void main(String[] args) throws IOException, TimeoutException { ConnectionFactory connectionFactory = new ConnectionFactory(); connectionFactory.setHost(\u0026#34;æœåŠ¡å™¨ip\u0026#34;); connectionFactory.setPort(5672); connectionFactory.setVirtualHost(\u0026#34;/ems\u0026#34;); connectionFactory.setUsername(\u0026#34;ems\u0026#34;); connectionFactory.setPassword(\u0026#34;123\u0026#34;); Connection connection = connectionFactory.newConnection(); Channel channel = connection.createChannel(); channel.queueDeclare(\u0026#34;hello\u0026#34;,false,false,false,null); //å‚æ•°1ï¼šé˜Ÿåˆ—åç§°ï¼Œå‚æ•°2ï¼šå¼€å§‹æ¶ˆæ¯çš„è‡ªåŠ¨ç¡®è®¤æœºåˆ¶ï¼Œå‚æ•°3ï¼šæ¶ˆè´¹æ—¶çš„å›è°ƒæ¥å£ channel.basicConsume(\u0026#34;hello\u0026#34;,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;æ¶ˆè´¹çš„å†…å®¹ï¼š\u0026#34;+new String(body)); } }); } } æå–å…¬å…±éƒ¨åˆ†ï¼Œåˆ›å»ºå·¥å…·ç±» RabbitMQUtils\nimport com.rabbitmq.client.Channel; import com.rabbitmq.client.Connection; import com.rabbitmq.client.ConnectionFactory; import java.io.IOException; import java.util.concurrent.TimeoutException; public class RabbitMQUtils { private static ConnectionFactory connectionFactory = null; static { connectionFactory = new ConnectionFactory(); connectionFactory.setHost(\u0026#34;æœåŠ¡å™¨ip\u0026#34;); connectionFactory.setPort(5672); connectionFactory.setVirtualHost(\u0026#34;/ems\u0026#34;); connectionFactory.setUsername(\u0026#34;ems\u0026#34;); connectionFactory.setPassword(\u0026#34;123\u0026#34;); } //è·å–è¿æ¥ public static Connection getConnection(){ try { Connection connection = connectionFactory.newConnection(); return connection; } catch (IOException e) { e.printStackTrace(); } catch (TimeoutException e) { e.printStackTrace(); } return null; } //å…³é—­èµ„æº public static void clone(Channel channel , Connection connection){ try { if (null !=channel) channel.close(); if (null != connection) connection.close(); } catch (IOException e) { e.printStackTrace(); } catch (TimeoutException e) { e.printStackTrace(); } } } 2ã€Work queues ç”Ÿäº§è€…\npackage com.shishiyi.work; import com.rabbitmq.client.Channel; import com.rabbitmq.client.Connection; import com.shishiyi.utils.RabbitMQUtils; import java.io.IOException; public class Provider { public static void main(String[] args) throws IOException { Connection connection = RabbitMQUtils.getConnection(); Channel channel = connection.createChannel(); channel.queueDeclare(\u0026#34;work\u0026#34;,false,false,false,null); for (int i = 0; i \u0026lt; 10 ; i++) { channel.basicPublish(\u0026#34;\u0026#34;,\u0026#34;work\u0026#34;,null,\u0026#34;work queue\u0026#34;.getBytes()); } RabbitMQUtils.clone(channel,connection); } } æ¶ˆè´¹è€…1\nConnection connection = RabbitMQUtils.getConnection(); Channel channel = connection.createChannel(); channel.queueDeclare(\u0026#34;work\u0026#34;,false,false,false,null); channel.basicConsume(\u0026#34;work\u0026#34;,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;work æ¶ˆè´¹è€…1ï¼š\u0026#34;+new String(body)); } }); æ¶ˆè´¹è€…2\nConnection connection = RabbitMQUtils.getConnection(); Channel channel = connection.createChannel(); channel.basicConsume(\u0026#34;work\u0026#34;,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;work æ¶ˆè´¹è€…2ï¼š\u0026#34;+new String(body)); } }); 3ã€fanout ç”Ÿäº§è€…\n//å°†é€šé“å£°æ˜ä¸ºäº¤æ¢æœº //å‚æ•°1ï¼šäº¤æ¢æœºåç§°ï¼›å‚æ•°2ï¼šäº¤æ¢æœºç±»å‹ fanoutä¸ºå¹¿æ’­ç±»å‹ channel.exchangeDeclare(\u0026#34;logs\u0026#34;,\u0026#34;fanout\u0026#34;); //å‘é€æ¶ˆæ¯ channel.basicPublish(\u0026#34;logs\u0026#34;,\u0026#34;\u0026#34;,null,\u0026#34;fanout type message\u0026#34;.getBytes()); RabbitMQUtils.clone(channel,connection); æ¶ˆè´¹è€…ä¸€\n//é€šé“å£°æ˜ä¸ºäº¤æ¢æœº channel.exchangeDeclare(\u0026#34;logs\u0026#34;,\u0026#34;fanout\u0026#34;); //ä¸´æ—¶çš„é˜Ÿåˆ— String queue = channel.queueDeclare().getQueue(); //é€šé“ç»‘å®šä¸´æ—¶é˜Ÿåˆ—å’Œäº¤æ¢æœº channel.queueBind(queue,\u0026#34;logs\u0026#34;,\u0026#34;\u0026#34;); channel.basicConsume(queue,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;fanout1====\u0026gt;\u0026#34;+new String(body)); } }); æ¶ˆè´¹è€…äºŒ\n//é€šé“å£°æ˜ä¸ºäº¤æ¢æœº channel.exchangeDeclare(\u0026#34;logs\u0026#34;,\u0026#34;fanout\u0026#34;); //ä¸´æ—¶é˜Ÿåˆ— String queue = channel.queueDeclare().getQueue(); //é€šé“ç»‘å®šä¸´æ—¶é˜Ÿåˆ—å’Œäº¤æ¢æœº channel.queueBind(queue,\u0026#34;logs\u0026#34;,\u0026#34;\u0026#34;); channel.basicConsume(queue,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;fanout2====\u0026gt;\u0026#34;+new String(body)); } }); 4ã€direct ç”Ÿäº§è€…\nchannel.exchangeDeclare(\u0026#34;direct_logs\u0026#34;,\u0026#34;direct\u0026#34;); String routingKey = \u0026#34;info\u0026#34;; channel.basicPublish(\u0026#34;direct_logs\u0026#34;,routingKey,null,(\u0026#34;directå‘é€äº†ä¸€æ¡routingKeyä¸º\u0026#34;+routingKey+\u0026#34;çš„æ¶ˆæ¯\u0026#34;).getBytes()); æ¶ˆè´¹è€…ä¸€\nchannel.exchangeDeclare(\u0026#34;direct_logs\u0026#34;,\u0026#34;direct\u0026#34;); String queue = channel.queueDeclare().getQueue(); channel.queueBind(queue,\u0026#34;direct_logs\u0026#34;,\u0026#34;error\u0026#34;); channel.basicConsume(queue,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;directæ¶ˆè´¹è€…1: \u0026#34;+new String(body)); } }); æ¶ˆè´¹è€…äºŒ\nchannel.exchangeDeclare(\u0026#34;direct_logs\u0026#34;,\u0026#34;direct\u0026#34;); String queue = channel.queueDeclare().getQueue(); channel.queueBind(queue,\u0026#34;direct_logs\u0026#34;,\u0026#34;info\u0026#34;); channel.queueBind(queue,\u0026#34;direct_logs\u0026#34;,\u0026#34;error\u0026#34;); channel.basicConsume(queue,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;directæ¶ˆè´¹è€…2ï¼š\u0026#34;+new String(body)); } }); 5ã€topic *ç¬¦å·å¯ä»¥ä»£æ›¿ä¸€ä¸ªå•è¯ã€‚ ï¼ƒç¬¦å·å¯ä»¥æ›¿ä»£é›¶ä¸ªæˆ–å¤šä¸ªå•è¯ã€‚ ç”Ÿäº§è€…\nchannel.exchangeDeclare(\u0026#34;topic_logs\u0026#34;,\u0026#34;topic\u0026#34;); String routingKey = \u0026#34;user.find.save\u0026#34;; channel.basicPublish(\u0026#34;topic_logs\u0026#34;,routingKey,null,(\u0026#34;å‘é€äº†ä¸€æ¡routingKeyä¸º\u0026#34;+routingKey+\u0026#34;çš„æ¶ˆæ¯\u0026#34;).getBytes()); æ¶ˆè´¹è€…ä¸€\nchannel.exchangeDeclare(\u0026#34;topic_logs\u0026#34;,\u0026#34;topic\u0026#34;); String queue = channel.queueDeclare().getQueue(); String routingKey = \u0026#34;user.*\u0026#34;; channel.queueBind(queue,\u0026#34;topic_logs\u0026#34;,routingKey); channel.basicConsume(queue,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;topicæ¶ˆè´¹è€…1ï¼š\u0026#34;+new String(body)); } }); æ¶ˆè´¹è€…äºŒ\nchannel.exchangeDeclare(\u0026#34;topic_logs\u0026#34;,\u0026#34;topic\u0026#34;); String queue = channel.queueDeclare().getQueue(); String routingKey = \u0026#34;user.#\u0026#34;; channel.queueBind(queue,\u0026#34;topic_logs\u0026#34;,routingKey); channel.basicConsume(queue,true,new DefaultConsumer(channel){ @Override public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException { System.out.println(\u0026#34;topicæ¶ˆè´¹è€…2ï¼š\u0026#34;+new String(body)); } }); Springbootå®ç°æ–¹å¼ æ¶ˆè´¹è€…æ–¹ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºçš„æ–¹å¼ ç¯å¢ƒ \u0026lt;!--åˆ›å»ºSpringbootå·¥ç¨‹ï¼Œå¯¼å…¥Mavenä¾èµ–-â€”â€”\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ç¼–å†™application.ymlæ–‡ä»¶\nspring: application: name: rabbitmq_springboot rabbitmq: host: æœåŠ¡å™¨ip port: 5672 username: ems #ç”¨æˆ·å password: 123 #å¯†ç  virtual-host: /ems\t#è™šæ‹Ÿæœºåç§° 1ã€helloword ç”Ÿäº§è€…\n@Autowired private RabbitTemplate rabbitTemplate; @Test public void test() { rabbitTemplate.convertAndSend(\u0026#34;hello\u0026#34;,\u0026#34;hello world\u0026#34;); } æ¶ˆè´¹è€…\nimport org.springframework.amqp.rabbit.annotation.Queue; import org.springframework.amqp.rabbit.annotation.RabbitHandler; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component @RabbitListener(queuesToDeclare = @Queue(\u0026#34;hello\u0026#34;)) public class Consumer_hello { @RabbitHandler public void receive(String message){ System.out.println(\u0026#34;æ¶ˆè´¹çš„å†…å®¹ï¼š\u0026#34;+message); } } 2ã€Work queues ç”Ÿäº§è€…\n@Autowired private RabbitTemplate rabbitTemplate; @Test public void work(){ for (int i = 0; i \u0026lt; 10; i++) { rabbitTemplate.convertAndSend(\u0026#34;work\u0026#34;,\u0026#34; work \u0026#34;+i); } } æ¶ˆè´¹è€…\nimport org.springframework.amqp.rabbit.annotation.Queue; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class Consumer_Work { @RabbitListener(queuesToDeclare = @Queue(\u0026#34;work\u0026#34;)) public void receive1(String messages){ System.out.println(\u0026#34;workæ¶ˆè´¹è€…1:\u0026#34;+messages); } @RabbitListener(queuesToDeclare = @Queue(\u0026#34;work\u0026#34;)) public void receive2(String messages){ System.out.println(\u0026#34;workæ¶ˆè´¹è€…2:\u0026#34;+messages); } } 3ã€fanout ç”Ÿäº§è€…\n@Autowired private RabbitTemplate rabbitTemplate; @Test public void fanout(){ rabbitTemplate.convertAndSend(\u0026#34;fanout_logs\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;fanoutå‘çš„æ¶ˆæ¯\u0026#34;); } æ¶ˆè´¹è€…\nimport org.springframework.amqp.rabbit.annotation.Exchange; import org.springframework.amqp.rabbit.annotation.Queue; import org.springframework.amqp.rabbit.annotation.QueueBinding; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class Consumer_Fanout { @RabbitListener(bindings = { @QueueBinding( value = @Queue, //åˆ›å»ºä¸´æ—¶é˜Ÿåˆ— exchange = @Exchange(value = \u0026#34;logs_fanout\u0026#34;,type = \u0026#34;fanout\u0026#34;) //è‡ªå®šä¹‰äº¤æ¢æœºåç§°å’Œç±»å‹ï¼Œå¹¶ç»‘å®šäº¤æ¢æœº )}) public void receive1(String messages){ System.out.println(\u0026#34;fanoutæ¶ˆè´¹è€…1:\u0026#34;+messages); } @RabbitListener(bindings = { @QueueBinding( value = @Queue, //åˆ›å»ºä¸´æ—¶é˜Ÿåˆ— exchange = @Exchange(value = \u0026#34;logs_fanout\u0026#34;,type = \u0026#34;fanout\u0026#34;) //è‡ªå®šä¹‰äº¤æ¢æœºåç§°å’Œç±»å‹ï¼Œå¹¶ç»‘å®šäº¤æ¢æœº )}) public void receive2(String messages){ System.out.println(\u0026#34;fanoutæ¶ˆè´¹è€…2:\u0026#34;+messages); } } 4ã€direct ç”Ÿäº§è€…\n@Autowired private RabbitTemplate rabbitTemplate; @Test public void route(){ String routingKey = \u0026#34;info\u0026#34;; rabbitTemplate.convertAndSend(\u0026#34;route_logs\u0026#34;,routingKey,\u0026#34;infoçš„æ¶ˆæ¯\u0026#34;); } æ¶ˆè´¹è€…\nimport org.springframework.amqp.rabbit.annotation.Exchange; import org.springframework.amqp.rabbit.annotation.Queue; import org.springframework.amqp.rabbit.annotation.QueueBinding; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class Consumer_Route { @RabbitListener( bindings = @QueueBinding( value = @Queue,\t//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ— exchange = @Exchange(value = \u0026#34;route_logs\u0026#34;,type = \u0026#34;direct\u0026#34;),\t//è‡ªå®šä¹‰äº¤æ¢æœºåç§°å’Œç±»å‹ï¼Œå¹¶ç»‘å®šäº¤æ¢æœº key = {\u0026#34;error\u0026#34;}\t//è®¾ç½®è·¯ç”± ) ) public void receive1(String messages){ System.out.println(\u0026#34;Routeæ¶ˆè´¹è€…1: \u0026#34;+messages); } @RabbitListener( bindings = @QueueBinding( value = @Queue,\t//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ— exchange = @Exchange(value = \u0026#34;route_logs\u0026#34;,type = \u0026#34;direct\u0026#34;),\t//è‡ªå®šä¹‰äº¤æ¢æœºåç§°å’Œç±»å‹ï¼Œå¹¶ç»‘å®šäº¤æ¢æœº key = {\u0026#34;info\u0026#34;,\u0026#34;error\u0026#34;}\t//è®¾ç½®è·¯ç”± ) ) public void receive2(String messages){ System.out.println(\u0026#34;Routeæ¶ˆè´¹è€…2: \u0026#34;+messages); } } 5ã€topic ç”Ÿäº§è€…\n@Autowired private RabbitTemplate rabbitTemplate; @Test public void topic(){ String routingKey = \u0026#34;user.find\u0026#34;; rabbitTemplate.convertAndSend(\u0026#34;topic_logs\u0026#34;,routingKey,\u0026#34;topicå‘é€çš„æ¶ˆæ¯\u0026#34;); } æ¶ˆè´¹è€…\nimport org.springframework.amqp.rabbit.annotation.Exchange; import org.springframework.amqp.rabbit.annotation.Queue; import org.springframework.amqp.rabbit.annotation.QueueBinding; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class Consumer_Topic { @RabbitListener( bindings = { @QueueBinding( value = @Queue,\t//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ— exchange = @Exchange(value = \u0026#34;topic_logs\u0026#34;,type = \u0026#34;topic\u0026#34;),\t//è‡ªå®šä¹‰äº¤æ¢æœºåç§°å’Œç±»å‹ï¼Œå¹¶ç»‘å®šäº¤æ¢æœº key = {\u0026#34;user.#\u0026#34;} ) } ) public void receive1(String messages){ System.out.println(\u0026#34;topicæ¶ˆè´¹è€…1: \u0026#34;+messages); } @RabbitListener(bindings = @QueueBinding( value = @Queue,\t//åˆ›å»ºä¸´æ—¶é˜Ÿåˆ— exchange = @Exchange(value = \u0026#34;topic_logs\u0026#34;,type = \u0026#34;topic\u0026#34;),\t//è‡ªå®šä¹‰äº¤æ¢æœºåç§°å’Œç±»å‹ï¼Œå¹¶ç»‘å®šäº¤æ¢æœº key = {\u0026#34;user.*\u0026#34;} )) public void receive2(String messages){ System.out.println(\u0026#34;topicæ¶ˆè´¹è€…2: \u0026#34;+messages); } } ç”Ÿäº§è€…æ–¹ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºçš„æ–¹å¼ 1ã€fanout ç”Ÿäº§è€…æ–¹ åœ¨pom.xmlæ–‡ä»¶å¯¼å…¥Mavenä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½®application.ymlæ–‡ä»¶\nserver: port: 8001 spring: application: name: rabbitmq_springboot_fanout_provider rabbitmq: host: æœåŠ¡å™¨ip port: 5672 #rabbitmqç«¯å£å· username: shishiyi\t#ç”¨æˆ·å password: 123\t#å¯†ç  virtual-host: /shishiyi\t#è™šæ‹Ÿæœºåç§° ç¼–å†™é…ç½®ç±»\nimport org.springframework.amqp.core.*; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class ConfigRabbitmqFanout { //åˆ›å»ºä¸‰ä¸ªé˜Ÿåˆ—åˆ†åˆ«ä¸ºfanoutQueue1ï¼ŒfanoutQueue2ï¼ŒfanoutQueue3 @Bean public Queue fanoutQueue1(){ return QueueBuilder.durable(\u0026#34;fanoutQueue1\u0026#34;).build(); } @Bean public Queue fanoutQueue2(){ return QueueBuilder.durable(\u0026#34;fanoutQueue2\u0026#34;).build(); } @Bean public Queue fanoutQueue3(){ return QueueBuilder.durable(\u0026#34;fanoutQueue3\u0026#34;).build(); } //åˆ›å»ºfanoutç±»å‹çš„äº¤æ¢æœº @Bean public FanoutExchange fanoutExchange(){ return ExchangeBuilder.fanoutExchange(\u0026#34;fanoutExchange\u0026#34;).build(); } //æŠŠä¸‰ä¸ªé˜Ÿåˆ—åˆ†åˆ«å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding bindingExchange1(){ return BindingBuilder.bind(fanoutQueue1()).to(fanoutExchange()); } @Bean public Binding bindingExchange2(){ return BindingBuilder.bind(fanoutQueue2()).to(fanoutExchange()); } @Bean public Binding bindingExchange3(){ return BindingBuilder.bind(fanoutQueue3()).to(fanoutExchange()); } } ç¼–å†™ç”Ÿäº§è€…çš„æ¥å£ï¼Œå‘é€æ¶ˆæ¯\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class FanoutController { @Autowired private RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/sendFanout\u0026#34;) public void sendMessages(){ rabbitTemplate.convertAndSend(\u0026#34;fanoutExchange\u0026#34;,\u0026#34;\u0026#34;,\u0026#34;fanoutç±»å‹å‘é€çš„æ¶ˆæ¯\u0026#34;); } } å¯åŠ¨é¡¹ç›®ï¼Œè°ƒç”¨æ¥å£\næ£€æŸ¥rabbitMqç®¡ç†é¡µï¼Œæ¶ˆæ¯å·²ç»å‘é€æˆåŠŸ\næ¶ˆè´¹è€…æ–¹ åœ¨pom.xmlæ–‡ä»¶å¯¼å…¥Mavenä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½®application.ymlæ–‡ä»¶\nserver: port: 7001 spring: application: name: rabbitmq_springboot_fanout_consumer rabbitmq: host: æœåŠ¡å™¨ip port: 5672 #rabbitmqç«¯å£å· username: shishiyi\t#ç”¨æˆ·å password: 123\t#å¯†ç  virtual-host: /shishiyi\t#è™šæ‹Ÿæœºåç§° ç¼–å†™ç›‘å¬ç±»\nimport org.springframework.amqp.core.Message; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class FanoutReceiver { //ç›‘å¬å¯¹åº”çš„é˜Ÿåˆ—åç§° @RabbitListener(queues = \u0026#34;fanoutQueue1\u0026#34;) public void fanout1(Message message){ System.out.println(\u0026#34;fanoutQueue1 æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } @RabbitListener(queues = \u0026#34;fanoutQueue2\u0026#34;) public void fanout2(Message message){ System.out.println(\u0026#34;fanoutQueue2 æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } @RabbitListener(queues = \u0026#34;fanoutQueue3\u0026#34;) public void fanout3(Message message){ System.out.println(\u0026#34;fanoutQueue3 æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } } å¯åŠ¨é¡¹ç›®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°\n2ã€direct ç”Ÿäº§è€…æ–¹ pom.xmlæ–‡ä»¶\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; application.ymlæ–‡ä»¶\nserver: port: 8002 spring: application: name: rabbitmq_springboot_direct_provider rabbitmq: host: æœåŠ¡ip port: 5672 username: shishiyi password: 123 virtual-host: /shishiyi ç¼–å†™é…ç½®ç±»\nimport org.springframework.amqp.core.*; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class ConfigRabbitmqDirect { @Bean public Queue directQueue1(){ return QueueBuilder.durable(\u0026#34;directQueue1\u0026#34;).build(); } @Bean public Queue directQueue2(){ return QueueBuilder.durable(\u0026#34;directQueue2\u0026#34;).build(); } @Bean public DirectExchange directExchange(){ return ExchangeBuilder.directExchange(\u0026#34;directExchange\u0026#34;).build(); } //ç»‘å®šå¯¹åº”çš„é˜Ÿåˆ—ï¼Œä»¥åŠè·¯ç”±key @Bean public Binding bindingExchangeQueue1(){ return BindingBuilder.bind(directQueue1()).to(directExchange()).with(\u0026#34;info\u0026#34;); } @Bean public Binding bindingExchangeQueue2(){ return BindingBuilder.bind(directQueue2()).to(directExchange()).with(\u0026#34;error\u0026#34;); } } ç¼–å†™ç”Ÿäº§è€…çš„æ¥å£ï¼Œå‘é€æ¶ˆæ¯\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class DirectController { @Autowired private RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/sendDirect\u0026#34;) public void sendMessages(){\t//è·¯ç”±keyå€¼ä¸ºinfo rabbitTemplate.convertAndSend(\u0026#34;directExchange\u0026#34;,\u0026#34;info\u0026#34;,\u0026#34;è¿™æ˜¯directç±»å‹,è·¯ç”±ä¸ºinfoçš„æ¶ˆæ¯\u0026#34;); } } å¯åŠ¨é¡¹ç›®ï¼Œè°ƒç”¨æ¥å£\næŸ¥çœ‹rabbitmqæ§åˆ¶å°ï¼Œç”±äºå‘é€æ¶ˆæ¯æ–¹æ³•æ˜¯å¾€è·¯ç”±keyå€¼ä¸ºinfoé˜Ÿåˆ—å‘é€ï¼Œæ‰€ä»¥åªæœ‰è·¯ç”±keyä¸ºinfoçš„directQueue1é˜Ÿåˆ—å¯ä»¥æ¥æ”¶åˆ°ï¼Œè€Œè·¯ç”±keyå€¼ä¸ºerrorçš„directQueue2é˜Ÿåˆ—æ¥å—ä¸åˆ°æ¶ˆæ¯\næ¶ˆè´¹è€…æ–¹ pom.xmlæ–‡ä»¶\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; application.ymlæ–‡ä»¶\nserver: port: 7002 spring: application: name: rabbitmq_springboot_direct_consumer rabbitmq: host: æœåŠ¡å™¨ip port: 5672 #rabbitmqç«¯å£å· username: shishiyi\t#ç”¨æˆ·å password: 123\t#å¯†ç  virtual-host: /shishiyi\t#è™šæ‹Ÿæœºåç§° ç¼–å†™ç›‘å¬ç±»\nimport org.springframework.amqp.core.Message; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class DirectReceiver { @RabbitListener(queues = \u0026#34;directQueue1\u0026#34;) public void directQueue1(Message message){ System.out.println(\u0026#34;directQueue1 æ¶ˆè´¹è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } @RabbitListener(queues = \u0026#34;directQueue2\u0026#34;) public void directQueue2(Message message){ System.out.println(\u0026#34;directQueue2 æ¶ˆè´¹è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } } å¯åŠ¨é¡¹ç›®ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ï¼Œç”±äºåªæœ‰directQueue1é‡Œæœ‰æ¶ˆæ¯ï¼Œæ‰€ä»¥æ¶ˆè´¹è€…åªèƒ½çœ‹åˆ°è¿™ä¸ªé˜Ÿåˆ—æ¶ˆæ¯\n3ã€topic ç”Ÿäº§è€… ç¼–å†™pom.xmlæ–‡ä»¶ï¼Œå¯¼å…¥Mavenä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½®æ–‡ä»¶application.yml\nserver: port: 8003 spring: application: name: rabbitmq_springboot_topic_provider rabbitmq: host: æœåŠ¡å™¨ip port: 5672 username: shishiyi\t#ç”¨æˆ·å password: 123\t#å¯†ç  virtual-host: /shishiyi\t#è™šæ‹Ÿæœºåç§° ç¼–å†™é…ç½®ç±»\nimport org.springframework.amqp.core.*; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class ConfigRabbitmqTopic { @Bean public Queue topicQueue1(){ return QueueBuilder.durable(\u0026#34;topicQueue1\u0026#34;).build(); } @Bean public Queue topicQueue2(){ return QueueBuilder.durable(\u0026#34;topicQueue2\u0026#34;).build(); } @Bean public Queue topicQueue3(){ return QueueBuilder.durable(\u0026#34;topicQueue3\u0026#34;).build(); } @Bean public TopicExchange topicExchange(){ return ExchangeBuilder.topicExchange(\u0026#34;topicExchange\u0026#34;).build(); } //ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœºï¼Œä»¥åŠç»‘å®šäº†ä¸åŒçš„è·¯ç”±keyå€¼ @Bean public Binding bindingExchangeQueue1(){ return BindingBuilder.bind(topicQueue1()).to(topicExchange()).with(\u0026#34;user.#\u0026#34;); } @Bean public Binding bindingExchangeQueue2(){ return BindingBuilder.bind(topicQueue2()).to(topicExchange()).with(\u0026#34;user.save\u0026#34;); } @Bean public Binding bindingExchangeQueue3(){ return BindingBuilder.bind(topicQueue2()).to(topicExchange()).with(\u0026#34;user\u0026#34;); } } ç¼–å†™æ¥å£\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicController { @Autowired public RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/sendTopic\u0026#34;) public void sendMessage(){ //è·¯ç”±keyä¸ºuser.save rabbitTemplate.convertAndSend(\u0026#34;topicExchange\u0026#34;,\u0026#34;user.save\u0026#34;,\u0026#34;è¿™æ˜¯topicç±»å‹ï¼Œè·¯ç”±ä¸ºuser.saveçš„æ¶ˆæ¯\u0026#34;); } } å¯åŠ¨é¡¹ç›®ï¼Œè°ƒç”¨æ¥å£\næŸ¥çœ‹rabbitmqæ§åˆ¶å°ï¼Œç”±äºå‘é€æ¶ˆæ¯çš„æ–¹æ³• è·¯ç”±keyå€¼ä¸ºuser.saveï¼Œæ‰€ä»¥åªæœ‰è·¯ç”±keyä¸ºuser.#çš„topicQueue1çš„é˜Ÿåˆ—å’Œè·¯ç”±keyå€¼ä¸ºuser.saveçš„topicQueue2é˜Ÿåˆ—å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè€Œè·¯ç”±keyå€¼ä¸ºuserçš„topicQueue3é˜Ÿåˆ—åˆ™æ”¶ä¸åˆ°æ¶ˆæ¯\næ¶ˆè´¹è€…æ–¹ pom.xmlæ–‡ä»¶\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; application.ymlæ–‡ä»¶\nserver: port: 7003 spring: application: name: rabbitmq_springboot_topic_consumer rabbitmq: host: æœåŠ¡å™¨ip port: 5672 username: shishiyi password: 123 virtual-host: /shishiyi ç¼–å†™ç›‘å¬ç±»ï¼Œè·å–æ¶ˆæ¯\nimport org.springframework.amqp.core.Message; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class TopicReceiver { @RabbitListener(queues = \u0026#34;topicQueue1\u0026#34;) public void topicQueue1(Message message){ System.out.println(\u0026#34;topicQueue1 æ¶ˆè´¹è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } @RabbitListener(queues = \u0026#34;topicQueue2\u0026#34;) public void topicQueue2(Message message){ System.out.println(\u0026#34;topicQueue2 æ¶ˆè´¹è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } @RabbitListener(queues = \u0026#34;topicQueue3\u0026#34;) public void topicQueue3(Message message){ System.out.println(\u0026#34;topicQueue3 æ¶ˆè´¹è€…æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+message); } } å¯åŠ¨é¡¹ç›®ï¼Œåœ¨æ§åˆ¶å°æŸ¥çœ‹æ‰“å°ä¿¡æ¯ï¼Œç”±äºåªæœ‰é˜Ÿåˆ—topicQueue1ï¼ŒtopicQueue2é‡Œæœ‰æ¶ˆæ¯ï¼Œæ‰€ä»¥æ¶ˆè´¹è€…åªèƒ½çœ‹åˆ°è¿™ä¸¤ä¸ªé˜Ÿåˆ—æ¶ˆæ¯\nRabbitMQçš„é«˜çº§ç‰¹æ€§ ç”Ÿäº§è€…æ–¹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ åœ¨ä½¿ç”¨RabbitMQçš„æ—¶å€™ï¼Œä½œä¸ºæ¶ˆæ¯å‘é€æ–¹å¸Œæœ›æœç»ä»»ä½•æ¶ˆæ¯ä¸¢å¤±æˆ–è€…æŠ•é€’å¤±è´¥åœºæ™¯ã€‚RabbitMQ ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§æ–¹å¼ç”¨æ¥æ§åˆ¶æ¶ˆæ¯çš„æŠ•é€’å¯é æ€§æ¨¡å¼ã€‚\nconfirm ç¡®è®¤æ¨¡å¼ return é€€å›æ¨¡å¼ RabbitMQå¤§ä½“æµç¨‹è·¯å¾„ï¼š\næ¶ˆæ¯ä»æ¶ˆè´¹è€…(Producer) åˆ° äº¤æ¢æœº(exchange) åˆ™ä¼šè°ƒç”¨ä¸€ä¸ªå›è°ƒæ–¹æ³•setConfirmCallback()\nâ€‹\tæ–¹æ³•å‚æ•°ï¼š correlationData ç›¸å…³ä¿¡æ¯ã€ack æ˜¯å¦å‘é€æˆåŠŸã€cause å¤±è´¥åŸå› \næ¶ˆæ¯ä»äº¤æ¢æœº(exchange)åˆ° é˜Ÿåˆ—(queue) åˆ™ä¼šè°ƒç”¨ä¸€ä¸ªå›è°ƒæ–¹æ³•setReturnCallback()\nâ€‹\tæ–¹æ³•å‚æ•°ï¼š messageæ¶ˆæ¯å†…å®¹ã€ replyCodeå›åº”ç ã€replyTextå›åº”æ¶ˆæ¯ã€exchangeäº¤æ¢æœºã€routingKeyè·¯ç”±keyå€¼\nç¼–å†™é…ç½®æ–‡ä»¶application.yml\nserver: port: 8004 spring: application: name: rabbitmq_springboot_provider rabbitmq: host: æœåŠ¡å™¨ip port: 5672 username: shishiyi password: 123 virtual-host: /shishiyi #æ¶ˆæ¯ç¡®è®¤é…ç½®é¡¹ #ç¡®è®¤æ¶ˆæ¯å·²å‘é€åˆ°äº¤æ¢æœº(Exchange) publisher-confirm-type: correlated #ç¡®è®¤æ¶ˆæ¯å·²å‘é€åˆ°é˜Ÿåˆ—(Queue) publisher-returns: true ç¼–å†™é…ç½®ç±»\nimport org.springframework.amqp.core.*; import org.springframework.amqp.rabbit.connection.ConnectionFactory; import org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class RabbitmqConfig { @Bean public RabbitTemplate createRabbitTemplate(ConnectionFactory connectionFactory){ RabbitTemplate rabbitTemplate = new RabbitTemplate(); rabbitTemplate.setConnectionFactory(connectionFactory); /** * ä»æ¶ˆè´¹è€…(Producer) åˆ° äº¤æ¢æœº(exchange) åˆ™ä¼šè¢«è°ƒç”¨ */ rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -\u0026gt; { System.out.println(\u0026#34;ConfirmCallback ç›¸å…³æ•°æ®: \u0026#34;+correlationData); System.out.println(\u0026#34;ConfirmCallback ç¡®è®¤æƒ…å†µ: \u0026#34;+ack); System.out.println(\u0026#34;ConfirmCallback åŸå› : \u0026#34;+cause); }); //è®¾ç½®å¼€å¯Mandatory,æ‰èƒ½è§¦å‘å›è°ƒå‡½æ•°,æ— è®ºæ¶ˆæ¯æ¨é€ç»“æœæ€ä¹ˆæ ·éƒ½å¼ºåˆ¶è°ƒç”¨å›è°ƒå‡½æ•° rabbitTemplate.setMandatory(true); /** * ä»äº¤æ¢æœº(exchange)åˆ° é˜Ÿåˆ—(queue) åˆ™ä¼šè¢«è°ƒç”¨ */ rabbitTemplate.setReturnCallback((message, replyCode, replyText, exchange, routingKey) -\u0026gt; { System.out.println(\u0026#34;ReturnCallback æ¶ˆæ¯å†…å®¹: \u0026#34;+message); System.out.println(\u0026#34;ReturnCallback å›åº”ç : \u0026#34;+replyCode); System.out.println(\u0026#34;ReturnCallback å›åº”æ¶ˆæ¯: \u0026#34;+replyText); System.out.println(\u0026#34;ReturnCallback äº¤æ¢æœº: \u0026#34;+exchange); System.out.println(\u0026#34;ReturnCallback è·¯ç”±keyå€¼: \u0026#34;+routingKey); }); return rabbitTemplate; } @Bean public Queue queue(){ return QueueBuilder.durable(\u0026#34;topic_queue\u0026#34;).build(); } @Bean public TopicExchange topicExchange(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange\u0026#34;).build(); } @Bean public Binding binding(){ return BindingBuilder.bind(queue()).to(topicExchange()).with(\u0026#34;yes.#\u0026#34;); } } ç¼–å†™æ¥å£\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicController { @Autowired private RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/send\u0026#34;) public void sendMessage(){ rabbitTemplate.convertAndSend(\u0026#34;topic_exchange\u0026#34;,\u0026#34;yes\u0026#34;,\u0026#34;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#34;); } } å¯åŠ¨æµ‹è¯•ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯\næ ¹æ®RabbitMQå¤§ä½“æµç¨‹è·¯å¾„ï¼Œä»ç”Ÿäº§è€…è§’åº¦ï¼Œåšå¦‚ä¸‹æµ‹è¯•ï¼š\n1ã€å¦‚æœå‘é€çš„äº¤æ¢æœºæ²¡æœ‰è¿›è¡Œé…ç½®ï¼Œå³ä¸å­˜åœ¨\n//äº¤æ¢æœºä¸ºexchange1111ï¼Œæ²¡æœ‰è¿›è¡Œé…ç½® @GetMapping(\u0026#34;/send\u0026#34;) public void sendMessage(){ rabbitTemplate.convertAndSend(\u0026#34;exchange1111\u0026#34;,\u0026#34;yes\u0026#34;,\u0026#34;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#34;); } å¯åŠ¨æµ‹è¯•ï¼Œè°ƒç”¨æ¥å£ï¼ŒæŸ¥çœ‹æ§åˆ¶å°\nConfirmCallback ç›¸å…³æ•°æ®: null ConfirmCallback ç¡®è®¤æƒ…å†µ: false ConfirmCallback åŸå› : channel error; protocol method: #method\u0026lt;channel.close\u0026gt;(reply-code=404, reply-text=NOT_FOUND - no exchange \u0026#39;exchange1111\u0026#39; in vhost \u0026#39;/shishiyi\u0026#39;, class-id=60, method-id=40) 2ã€å¦‚æœäº¤æ¢æœºé…ç½®äº†ï¼Œä½†æ˜¯æ²¡æœ‰ç»‘å®šé˜Ÿåˆ—\n//é…ç½®äº¤æ¢æœºï¼Œä½†ä¸ç»‘å®šé˜Ÿåˆ— @Bean public TopicExchange exchange2(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange_test\u0026#34;).build(); } //ç»™æ²¡æœ‰ç»‘å®šçš„äº¤æ¢æœºå‘é€æ¶ˆæ¯ @GetMapping(\u0026#34;/send\u0026#34;) public void sendMessage(){ rabbitTemplate.convertAndSend(\u0026#34;topic_exchange_test\u0026#34;,\u0026#34;yes\u0026#34;,\u0026#34;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#34;); } å¯åŠ¨æµ‹è¯•ï¼Œè°ƒç”¨æ¥å£ï¼ŒæŸ¥çœ‹æ§åˆ¶å°\nReturnCallback æ¶ˆæ¯å†…å®¹: (Body:\u0026#39;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#39; MessageProperties [headers={}, contentType=text/plain, contentEncoding=UTF-8, contentLength=0, receivedDeliveryMode=PERSISTENT, priority=0, deliveryTag=0]) ReturnCallback å›åº”ç : 312 ReturnCallback å›åº”æ¶ˆæ¯: NO_ROUTE ReturnCallback äº¤æ¢æœº: topic_exchange_test ReturnCallback è·¯ç”±keyå€¼: yes ConfirmCallback ç›¸å…³æ•°æ®: null ConfirmCallback ç¡®è®¤æƒ…å†µ: true ConfirmCallback åŸå› : null æ¶ˆè´¹è€…æ–¹æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ è¿™é‡Œæ˜¯æŠŠæ¶ˆæ¯çš„è‡ªåŠ¨ç¡®è®¤æœºåˆ¶ï¼Œæ”¹ä¸ºæ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯ï¼Œå³æŠŠ AcknowledgeMode.NONE æ”¹ä¸º AcknowledgeMode.MANUAL\né…ç½®æ–‡ä»¶application.yml\nserver: port: 7004 spring: application: name: rabbitmq_springboot_consumer rabbitmq: host: æœåŠ¡å™¨ip port: 5672 username: shishiyi password: 123 virtual-host: /shishiyi ç¼–å†™å¼€å¯æ‰‹åŠ¨ç¡®è®¤ï¼Œä»¥åŠè‡ªå®šä¹‰ç›‘å¬ç±»\nimport com.shishiyi.listener.AckListener; import org.springframework.amqp.core.AcknowledgeMode; import org.springframework.amqp.rabbit.connection.ConnectionFactory; import org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class MessageListenerConfig { @Autowired private AckListener ackListener; @Autowired private ConnectionFactory connectionFactory; @Bean public SimpleMessageListenerContainer simpleMessageListenerContainer(){ SimpleMessageListenerContainer simpleMessageListenerContainer = new SimpleMessageListenerContainer(connectionFactory); //æ¶ˆè´¹è€…æ”¹ä¸ºæ‰‹åŠ¨ç¡®è®¤ï¼Œé»˜è®¤ä¸ºè‡ªåŠ¨ç¡®è®¤ simpleMessageListenerContainer.setAcknowledgeMode(AcknowledgeMode.MANUAL); //è®¾ç½®é˜Ÿåˆ—ï¼Œå‚æ•°å¯ä»¥è®¾ç½®å¤šä¸ªé˜Ÿåˆ—åç§° simpleMessageListenerContainer.setQueueNames(\u0026#34;topic_queue\u0026#34;); //è®¾ç½®è‡ªå®šä¹‰çš„ç›‘å¬ç±» simpleMessageListenerContainer.setMessageListener(ackListener); return simpleMessageListenerContainer; } } import com.rabbitmq.client.Channel; import org.springframework.amqp.core.Message; import org.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener; import org.springframework.stereotype.Component; import java.io.IOException; @Component public class AckListener implements ChannelAwareMessageListener { @Override public void onMessage(Message message, Channel channel) throws Exception { long deliveryTag = message.getMessageProperties().getDeliveryTag(); try { //åˆ¤æ–­é˜Ÿåˆ—ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒé˜Ÿåˆ—ï¼Œæ¥æ‰§è¡Œä¸åŒçš„ä¸šåŠ¡å†…å®¹ if (\u0026#34;topic_queue\u0026#34;.equals(message.getMessageProperties().getConsumerQueue())){ //è½¬æ¢æ¶ˆæ¯ System.out.println(new String(message.getBody())); //å¤„ç†ä¸šåŠ¡ System.out.println(\u0026#34;å¤„ç†ä¸šåŠ¡.........\u0026#34;); } //æ‰‹åŠ¨ç¡®è®¤ï¼Œç­¾æ”¶æ¶ˆæ¯ channel.basicAck(deliveryTag,true); } catch (IOException e) { /** * é’ˆå¯¹å¤šä¸ªæ¶ˆæ¯ * ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦åº”ç”¨äºå¤šæ¶ˆæ¯ * ç¬¬ä¸‰ä¸ªå‚æ•°requeueï¼šæ˜¯å¦é‡å›é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯true,åˆ™é‡æ–°å›åˆ°é˜Ÿåˆ—ï¼Œç„¶åé‡æ–°å‘ç»™æ¶ˆè´¹è€…ï¼Œå¦è€…åˆ™ä¸¢å¼ƒæˆ–è€…è¿›å…¥æ­»ä¿¡é˜Ÿåˆ— */ channel.basicNack(deliveryTag,true,false); //é’ˆå¯¹å•ä¸ªæ¶ˆæ¯ï¼Œç¬¬äºŒä¸ªå‚æ•°requeueï¼šæ˜¯å¦é‡å›é˜Ÿåˆ— //channel.basicReject(deliveryTag,true); } } } å¦‚æœæ‰§è¡Œä¸šåŠ¡å‡ºé”™ï¼Œåˆ™å¯ä»¥æ‹’ç»æ¶ˆæ¯ï¼Œå¯¹æ­¤æ–¹æ³•æœ‰channel.basicReject(deliveryTag, true) å’Œ channel.basicNack(deliveryTag, false, true) ä¸¤ç§æ–¹å¼å¤„ç†\nchannel.basicReject(deliveryTag, true)ï¼š æ‹’ç»æ¶ˆè´¹å½“å‰æ¶ˆæ¯ï¼Œå¦‚æœç¬¬äºŒå‚æ•°ä¼ å…¥trueï¼Œå°±æ˜¯å°†æ•°æ®é‡æ–°ä¸¢å›é˜Ÿåˆ—é‡Œï¼Œé‚£ä¹ˆä¸‹æ¬¡è¿˜ä¼šæ¶ˆè´¹è¿™æ¶ˆæ¯ã€‚è®¾ç½®falseï¼Œ\nå°±æ˜¯å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘å·²ç»çŸ¥é“è¿™æ¡æ¶ˆæ¯æ•°æ®äº†ï¼Œå› ä¸ºä¸€äº›åŸå› æ‹’ç»å®ƒï¼Œè€Œä¸”æœåŠ¡å™¨ä¹ŸæŠŠè¿™ä¸ªæ¶ˆæ¯ä¸¢æ‰å°±è¡Œã€‚ ä¸‹æ¬¡ä¸æƒ³å†æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯äº†ã€‚ä½¿ç”¨æ‹’ç»åé‡æ–°å…¥åˆ—è¿™\nä¸ªç¡®è®¤æ¨¡å¼è¦è°¨æ…ï¼Œå› ä¸ºä¸€èˆ¬éƒ½æ˜¯å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œcatchå¼‚å¸¸å†æ‹’ç»å…¥åˆ—ï¼Œé€‰æ‹©æ˜¯å¦é‡å…¥åˆ—ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´ä¸€äº›æ¯æ¬¡éƒ½è¢«ä½ é‡å…¥åˆ—çš„æ¶ˆæ¯ä¸€ç›´æ¶ˆè´¹-å…¥\nåˆ—-æ¶ˆè´¹-å…¥åˆ—è¿™æ ·å¾ªç¯ï¼Œä¼šå¯¼è‡´æ¶ˆæ¯ç§¯å‹ã€‚\nchannel.basicNack(deliveryTag, false, true)ï¼š ç¬¬ä¸€ä¸ªå‚æ•°ä¾ç„¶æ˜¯å½“å‰æ¶ˆæ¯åˆ°çš„æ•°æ®çš„å”¯ä¸€idï¼›\nç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡æ˜¯å¦é’ˆå¯¹å¤šæ¡æ¶ˆæ¯ï¼›å¦‚æœæ˜¯trueï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€æ¬¡æ€§é’ˆå¯¹å½“å‰é€šé“çš„æ¶ˆæ¯çš„tagIDå°äºå½“å‰è¿™æ¡æ¶ˆæ¯çš„ï¼Œéƒ½æ‹’ç»ç¡®è®¤ã€‚\nç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æŒ‡æ˜¯å¦é‡æ–°å…¥åˆ—ï¼Œä¹Ÿå°±æ˜¯æŒ‡ä¸ç¡®è®¤çš„æ¶ˆæ¯æ˜¯å¦é‡æ–°ä¸¢å›åˆ°é˜Ÿåˆ—é‡Œé¢å»ã€‚\nåŒæ ·ä½¿ç”¨ä¸ç¡®è®¤åé‡æ–°å…¥åˆ—è¿™ä¸ªç¡®è®¤æ¨¡å¼è¦è°¨æ…ï¼Œå› ä¸ºè¿™é‡Œä¹Ÿå¯èƒ½å› ä¸ºè€ƒè™‘ä¸å‘¨å‡ºç°æ¶ˆæ¯ä¸€ç›´è¢«é‡æ–°ä¸¢å›å»çš„æƒ…å†µï¼Œå¯¼è‡´ç§¯å‹ã€‚\næ¶ˆè´¹ç«¯é™æµ ä¸ºé˜²æ­¢å¤§é‡æ¶ˆæ¯å…¨éƒ¨ç»™åˆ°æ¶ˆè´¹ç«¯ç³»ç»Ÿï¼Œå¯ä»¥å¯¹æ¶ˆè´¹ç«¯åšä¸€ä¸ªé™æµæ“ä½œ\nå¼€å¯æ–¹å¼çš„å‰æä¸€å®šæ˜¯æ¶ˆè´¹ç«¯æ”¹ä¸ºæ‰‹åŠ¨ç¡®è®¤ä¿¡æ¯ï¼Œå¦åˆ™å°±ä¸æˆåŠŸ\nSimpleMessageListenerContainer simpleMessageListenerContainer = new SimpleMessageListenerContainer(connectionFactory); //æ¶ˆè´¹è€…æ”¹ä¸ºæ‰‹åŠ¨ç¡®è®¤ï¼Œé»˜è®¤ä¸ºè‡ªåŠ¨ç¡®è®¤ simpleMessageListenerContainer.setAcknowledgeMode(AcknowledgeMode.MANUAL); //å¯¹æ¶ˆè´¹ç«¯è¿›è¡Œä¸€ä¸ªé™æµè®¾ç½®ï¼Œä¸€æ¬¡å…è®¸å¤šå°‘æ¶ˆæ¯è¿›å…¥ simpleMessageListenerContainer.setPrefetchCount(1); TTLï¼šæ¶ˆæ¯è¿‡æœŸæ—¶é—´ 1ã€é˜Ÿåˆ—å†…æ¶ˆæ¯ç»Ÿä¸€è¿‡æœŸ @Bean public Queue queue(){\t//åªéœ€è¦åœ¨é…ç½®é˜Ÿåˆ—æ—¶ï¼Œè®¾ç½®ä¸€ä¸‹ttl(int ttl)æ–¹æ³•ï¼Œå‚æ•°ä¸ºå¤šå°‘æ¯«ç§’åæ¶ˆæ¯è¿‡æœŸ return QueueBuilder.durable(\u0026#34;topic_queue\u0026#34;).ttl(5000).build(); } 2ã€æ¶ˆæ¯å•ç‹¬è¿‡æœŸ å•ç‹¬ä¸ºæŸæ¡æ¶ˆæ¯è®¾ç½®è¿‡æœŸå±æ€§ï¼Œå¯ä»¥é€šè¿‡å‘å¸ƒæ¶ˆæ¯çš„convertAndSend()é‡è½½æ–¹æ³•ä¸­ï¼ŒMessagePostProcessoræ¶ˆæ¯å‘å¸ƒå¤„ç†å™¨æ¥è®¾ç½®è¿‡æœŸå±æ€§\né€šè¿‡æºç å¯ä»¥å‘ç°ï¼ŒMessagePostProcessoræ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œè€Œæ¥å£çš„æ–¹æ³•æœ‰ä¸€ä¸ªMessageç±»å‹çš„å‚æ•°ï¼Œä»¥æ­¤ä¾¿å¯ä»¥è®¾ç½®æ¶ˆæ¯å±æ€§äº†\n//å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œå•ç‹¬è®¾ç½®ä¸€ä¸‹æ¶ˆæ¯è¿‡æœŸæ—¶é—´ public void sendMessage(){ rabbitTemplate.convertAndSend(\u0026#34;topic_exchange\u0026#34;,\u0026#34;yes\u0026#34;,\u0026#34;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#34;,message -\u0026gt; { message.getMessageProperties().setExpiration(\u0026#34;5000\u0026#34;); return message; }); } ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“é˜Ÿåˆ—ä¸­æœ‰å¤šæ¡æ¶ˆæ¯ï¼Œæœ‰è¿‡æœŸæ—¶é—´çš„æ¶ˆæ¯ä¸ä¼šåœ¨è¾¾åˆ°æ—¶é—´åä»é˜Ÿåˆ—ä¸­è‡ªåŠ¨æ¶ˆå¤±ï¼Œè€Œæ˜¯åªæœ‰æ¶ˆæ¯åœ¨é˜Ÿåˆ—é¡¶ç«¯æ—¶ï¼Œæ‰ä¼šåˆ¤æ–­å…¶å¦è¿‡æœŸäº†\nè€Œå¦‚æœåŒæ—¶è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´å’Œæ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼Œåˆ™ä»¥æ—¶é—´çŸ­çš„ä¸ºå‡†\næ­»ä¿¡é˜Ÿåˆ— Rabbitmqçš„æ­»ä¿¡é˜Ÿåˆ—ï¼Œå…¶å®æŒ‡çš„æ­»ä¿¡äº¤æ¢æœº(DLX)ï¼Œä½†è™½ç„¶åç§°æ˜¯è¿™ä¹ˆä¸€ä¸ªå«æ³•ï¼Œä½†æ˜¯æ­»ä¿¡äº¤æ¢æœºä¹Ÿæ˜¯ä¸€ä¸ªæ­£å¸¸çš„äº¤æ¢æœºï¼Œå’Œä¸€èˆ¬çš„äº¤æ¢æœºæ˜¯æ²¡æœ‰åŒºåˆ«çš„\nè€Œè¿›å…¥æ­»ä¿¡äº¤æ¢æœºçš„æ¶ˆæ¯ï¼Œå¤§è‡´æœ‰ä¸‰ç§æƒ…å†µï¼š\n1ã€æ¶ˆæ¯TTLè¿‡æœŸ ç”Ÿäº§æ–¹çš„é…ç½®ç±»\nimport org.springframework.amqp.core.*; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class RabbitmqConfig { //å£°æ˜æ­£å¸¸é˜Ÿåˆ— @Bean public Queue queue(){ return QueueBuilder.durable(\u0026#34;topic_queue\u0026#34;) //æ­£å¸¸é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœºç»‘å®š .deadLetterExchange(\u0026#34;topic_exchange_dlx\u0026#34;) //å’Œæ­»ä¿¡äº¤æ¢æœºçš„è·¯ç”±keyç»‘å®šï¼Œå‘ç»™å“ªä¸ªæ­»ä¿¡é˜Ÿåˆ— .deadLetterRoutingKey(\u0026#34;no.msg\u0026#34;) //è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´ï¼Œ3ç§’åè¿‡æœŸ .ttl(3000) .build(); } //å£°æ˜æ­£å¸¸äº¤æ¢æœº @Bean public TopicExchange exchange(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange\u0026#34;).build(); } //æ­£å¸¸çš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding(){ return BindingBuilder.bind(queue()).to(exchange()).with(\u0026#34;yes.#\u0026#34;); } //å£°æ˜æ­»ä¿¡é˜Ÿåˆ— @Bean public Queue queue_dlx(){ return QueueBuilder.durable(\u0026#34;topic_queue_dlx\u0026#34;).build(); } //å£°æ˜æ­»ä¿¡äº¤æ¢æœº @Bean public TopicExchange exchange_dlx(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange_dlx\u0026#34;).build(); } //æ­»ä¿¡çš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding_dlx(){ return BindingBuilder.bind(queue_dlx()).to(exchange_dlx()).with(\u0026#34;no.#\u0026#34;); } } ç¼–å†™æ¥å£\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicController { @Autowired private RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/send\u0026#34;) public void sendMessage(){ rabbitTemplate.convertAndSend(\u0026#34;topic_exchange\u0026#34;,\u0026#34;yes.msg\u0026#34;,\u0026#34;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#34;); } } å¯åŠ¨æµ‹è¯•ï¼Œè°ƒç”¨æ¥å£å‘é€æ¶ˆæ¯ï¼Œä¸æ¶ˆè´¹æ¶ˆæ¯ï¼Œ3ç§’åæŸ¥çœ‹rabbitmqç®¡ç†é¡µé¢ï¼Œæ¶ˆæ¯å·²è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—\n2ã€é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ ç”Ÿäº§æ–¹çš„é…ç½®ç±»\nimport org.springframework.amqp.core.*; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class RabbitmqConfig { //å£°æ˜æ­£å¸¸é˜Ÿåˆ— @Bean public Queue queue(){ return QueueBuilder.durable(\u0026#34;topic_queue\u0026#34;) //æ­£å¸¸é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœºç»‘å®š .deadLetterExchange(\u0026#34;topic_exchange_dlx\u0026#34;) //å’Œæ­»ä¿¡äº¤æ¢æœºçš„è·¯ç”±keyç»‘å®šï¼Œå‘ç»™å“ªä¸ªæ­»ä¿¡é˜Ÿåˆ— .deadLetterRoutingKey(\u0026#34;no.msg\u0026#34;) //æŒ‡å®šé˜Ÿåˆ—æœ€å¤§æ¥å—é•¿åº¦(æœ€å¤§æ¥å—æ¶ˆæ¯æ•°) .maxLength(5) .build(); } //å£°æ˜æ­£å¸¸äº¤æ¢æœº @Bean public TopicExchange exchange(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange\u0026#34;).build(); } //æ­£å¸¸çš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding(){ return BindingBuilder.bind(queue()).to(exchange()).with(\u0026#34;yes.#\u0026#34;); } //å£°æ˜æ­»ä¿¡é˜Ÿåˆ— @Bean public Queue queue_dlx(){ return QueueBuilder.durable(\u0026#34;topic_queue_dlx\u0026#34;).build(); } //å£°æ˜æ­»ä¿¡äº¤æ¢æœº @Bean public TopicExchange exchange_dlx(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange_dlx\u0026#34;).build(); } //æ­»ä¿¡çš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding_dlx(){ return BindingBuilder.bind(queue_dlx()).to(exchange_dlx()).with(\u0026#34;no.#\u0026#34;); } } ç¼–å†™æ¥å£\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicController { @Autowired private RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/send\u0026#34;) public void sendMessage(){ //å‘é€10æ¡ä¿¡æ¯ for (int i = 0; i \u0026lt; 10; i++) { rabbitTemplate.convertAndSend(\u0026#34;topic_exchange\u0026#34;,\u0026#34;yes.msg\u0026#34;,\u0026#34;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#34;); } } } å¯åŠ¨æµ‹è¯•ï¼Œè°ƒç”¨æ¥å£å‘é€æ¶ˆæ¯ï¼Œä¸æ¶ˆè´¹æ¶ˆæ¯ï¼ŒæŸ¥çœ‹rabbitmqç®¡ç†é¡µé¢ï¼Œç”±äºè®¾ç½®é˜Ÿåˆ—æœ€å¤§é•¿åº¦ä¸º5ï¼Œæ‰€ä»¥æœ‰5æ¡æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—\n3ã€æ¶ˆæ¯è¢«æ‹’ç» ç¼–å†™ç”Ÿäº§æ–¹é…ç½®ç±»\nimport org.springframework.amqp.core.*; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class RabbitmqConfig { //å£°æ˜æ­£å¸¸é˜Ÿåˆ— @Bean public Queue queue(){ return QueueBuilder.durable(\u0026#34;topic_queue\u0026#34;) //æ­£å¸¸é˜Ÿåˆ—å’Œæ­»ä¿¡äº¤æ¢æœºç»‘å®š .deadLetterExchange(\u0026#34;topic_exchange_dlx\u0026#34;) //å’Œæ­»ä¿¡äº¤æ¢æœºçš„è·¯ç”±keyç»‘å®šï¼Œå‘ç»™å“ªä¸ªæ­»ä¿¡é˜Ÿåˆ— .deadLetterRoutingKey(\u0026#34;no.msg\u0026#34;) .build(); } //å£°æ˜æ­£å¸¸äº¤æ¢æœº @Bean public TopicExchange exchange(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange\u0026#34;).build(); } //æ­£å¸¸çš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding(){ return BindingBuilder.bind(queue()).to(exchange()).with(\u0026#34;yes.#\u0026#34;); } //å£°æ˜æ­»ä¿¡é˜Ÿåˆ— @Bean public Queue queue_dlx(){ return QueueBuilder.durable(\u0026#34;topic_queue_dlx\u0026#34;).build(); } //å£°æ˜æ­»ä¿¡äº¤æ¢æœº @Bean public TopicExchange exchange_dlx(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange_dlx\u0026#34;).build(); } //æ­»ä¿¡çš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding_dlx(){ return BindingBuilder.bind(queue_dlx()).to(exchange_dlx()).with(\u0026#34;no.#\u0026#34;); } } ç¼–å†™æ¥å£\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicController { @Autowired private RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/send\u0026#34;) public void sendMessage(){ rabbitTemplate.convertAndSend(\u0026#34;topic_exchange\u0026#34;,\u0026#34;yes.msg\u0026#34;,\u0026#34;å‘å¸ƒäº†ä¸€æ¡æ¶ˆæ¯\u0026#34;); } } ç¼–å†™ å¼€å¯æ‰‹åŠ¨ç¡®è®¤ï¼Œä»¥åŠè‡ªå®šä¹‰ç›‘å¬ç±»\nimport com.shishiyi.listener.AckListener; import org.springframework.amqp.core.AcknowledgeMode; import org.springframework.amqp.rabbit.connection.ConnectionFactory; import org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class MessageListenerConfig { @Autowired private AckListener ackListener; @Autowired private ConnectionFactory connectionFactory; @Bean public SimpleMessageListenerContainer simpleMessageListenerContainer(){ SimpleMessageListenerContainer simpleMessageListenerContainer = new SimpleMessageListenerContainer(connectionFactory); //æ¶ˆè´¹è€…æ”¹ä¸ºæ‰‹åŠ¨ç¡®è®¤ï¼Œé»˜è®¤ä¸ºè‡ªåŠ¨ç¡®è®¤ simpleMessageListenerContainer.setAcknowledgeMode(AcknowledgeMode.MANUAL); //è®¾ç½®é˜Ÿåˆ—ï¼Œå‚æ•°å¯ä»¥è®¾ç½®å¤šä¸ªé˜Ÿåˆ—åç§° simpleMessageListenerContainer.setQueueNames(\u0026#34;topic_queue\u0026#34;); //è®¾ç½®è‡ªå®šä¹‰çš„ç›‘å¬ç±» simpleMessageListenerContainer.setMessageListener(ackListener); return simpleMessageListenerContainer; } } æ‰§è¡Œä¸šåŠ¡å‡ºé”™ï¼Œæ¶ˆæ¯è¢«æ‹’ç»(basic.reject/ basic.nackï¼‰å¹¶ä¸”requeue=false\nimport com.rabbitmq.client.Channel; import org.springframework.amqp.core.Message; import org.springframework.amqp.rabbit.listener.api.ChannelAwareMessageListener; import org.springframework.stereotype.Component; @Component public class AckListener implements ChannelAwareMessageListener { @Override public void onMessage(Message message, Channel channel) throws Exception { long deliveryTag = message.getMessageProperties().getDeliveryTag(); try { //åˆ¤æ–­é˜Ÿåˆ—ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒé˜Ÿåˆ—ï¼Œæ¥æ‰§è¡Œä¸åŒçš„ä¸šåŠ¡å†…å®¹ if (\u0026#34;topic_queue\u0026#34;.equals(message.getMessageProperties().getConsumerQueue())){ //è½¬æ¢æ¶ˆæ¯ System.out.println(new String(message.getBody())); //å¤„ç†ä¸šåŠ¡ System.out.println(\u0026#34;å¤„ç†ä¸šåŠ¡.........\u0026#34;); //é™¤é›¶å‡ºé”™ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œä¸šåŠ¡å‡ºå·®é”™ int i = 1/0; } //æ‰‹åŠ¨ç¡®è®¤ï¼Œç­¾æ”¶æ¶ˆæ¯ channel.basicAck(deliveryTag,true); } catch (Exception e) { System.out.println(\u0026#34;å‡ºç°å¼‚å¸¸ï¼Œæ‹’ç»ç­¾æ”¶æ¶ˆæ¯\u0026#34;); //æ‹’ç»ç­¾æ”¶æ¶ˆæ¯ï¼Œä¸é‡å›é˜Ÿåˆ—requeue=false channel.basicNack(deliveryTag,true,false); } } } å¯åŠ¨æµ‹è¯•ï¼Œè°ƒç”¨æ¥å£å‘é€æ¶ˆæ¯ï¼ŒæŸ¥çœ‹rabbitmqç®¡ç†é¡µé¢ï¼Œç”±äºæ¶ˆè´¹è€…æ–¹å¤„ç†ä¸šåŠ¡å¤±è´¥äº§ç”Ÿé”™è¯¯ï¼Œæ‹’ç»ç­¾æ”¶æ¶ˆæ¯ï¼Œä¸”ä¸é‡å›é˜Ÿåˆ—ï¼Œåˆ™æ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—\nå»¶è¿Ÿé˜Ÿåˆ— RabbitMQå¾ˆé—æ†¾ä¸æ”¯æŒåŸç”Ÿçš„å»¶è¿Ÿé˜Ÿåˆ—ï¼Œä½†æ˜¯æˆ‘ä»¬ å¯ä»¥æ ¹æ®TTLè¿‡æœŸæ—¶é—´å’Œæ­»ä¿¡é˜Ÿåˆ—ç»„åˆå®ç°å»¶è¿Ÿé˜Ÿåˆ— åŠŸèƒ½\nç”Ÿäº§æ–¹çš„é…ç½®ç±»\npackage com.shishiyi.config; import org.springframework.amqp.core.*; import org.springframework.amqp.rabbit.connection.ConnectionFactory; import org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class RabbitmqConfig { //å£°æ˜æ­£å¸¸é˜Ÿåˆ— @Bean public Queue queue(){ return QueueBuilder.durable(\u0026#34;topic_queue\u0026#34;) .deadLetterExchange(\u0026#34;topic_exchange_delay\u0026#34;) .deadLetterRoutingKey(\u0026#34;time.msg\u0026#34;) //è®¾ç½®é˜Ÿåˆ—è¿‡æœŸæ—¶é—´,å³åˆ°è¾¾æŒ‡å®šæ—¶é—´å‘é€æ¶ˆæ¯ .ttl(5000) .build(); } //å£°æ˜æ­£å¸¸äº¤æ¢æœº @Bean public TopicExchange exchange(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange\u0026#34;).build(); } //æ­£å¸¸çš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding(){ return BindingBuilder.bind(queue()).to(exchange()).with(\u0026#34;yes.#\u0026#34;); } //å£°æ˜å»¶è¿Ÿé˜Ÿåˆ— @Bean public Queue queue_delay(){ return QueueBuilder.durable(\u0026#34;topic_queue_delay\u0026#34;).build(); } //å£°æ˜å»¶è¿Ÿäº¤æ¢æœº @Bean public TopicExchange exchange_delay(){ return ExchangeBuilder.topicExchange(\u0026#34;topic_exchange_delay\u0026#34;).build(); } //å»¶è¿Ÿçš„é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿›è¡Œç»‘å®š @Bean public Binding binding_delay(){ return BindingBuilder.bind(queue_delay()).to(exchange_delay()).with(\u0026#34;time.#\u0026#34;); } } ç¼–å†™æ¥å£\nimport org.springframework.amqp.rabbit.core.RabbitTemplate; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicController { @Autowired private RabbitTemplate rabbitTemplate; @GetMapping(\u0026#34;/send\u0026#34;) public void sendMessage(){ SimpleDateFormat format = new SimpleDateFormat(\u0026#34;HH:mm:ss\u0026#34;); String current_time = format.format(new Date()); rabbitTemplate.convertAndSend(\u0026#34;topic_exchange\u0026#34;,\u0026#34;yes.msg\u0026#34;,\u0026#34;è¿™æ˜¯ä¸€æ¡å»¶æ—¶çš„æ¶ˆæ¯,å‘é€æ—¶é—´ä¸ºï¼š\u0026#34;+current_time); } } ç¼–å†™æ¶ˆè´¹è€…æ–¹\nimport org.springframework.amqp.core.Message; import org.springframework.amqp.rabbit.annotation.RabbitListener; import org.springframework.stereotype.Component; @Component public class DelayReceiver { @RabbitListener(queues = \u0026#34;topic_queue_delay\u0026#34;) public void queue(Message message){ SimpleDateFormat format = new SimpleDateFormat(\u0026#34;HH:mm:ss\u0026#34;); String current_time = format.format(new Date()); System.out.println(\u0026#34;è·å–æ—¶é—´ï¼š\u0026#34;+current_time); System.out.println(\u0026#34;ä»å»¶è¿Ÿé˜Ÿåˆ—æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+new String(message.getBody())); } } å¯åŠ¨æµ‹è¯•ï¼Œè°ƒç”¨æ¥å£å‘é€æ¶ˆæ¯ï¼ŒæŸ¥çœ‹æ¶ˆè´¹è€…æ–¹æ§åˆ¶å°ï¼Œ5ç§’åä¼šæ‰“å°ä¸€æ¡æ¶ˆæ¯\nå»¶è¿Ÿé˜Ÿåˆ—ï¼ˆæ’ä»¶æ–¹å¼ï¼‰ æ³¨ï¼šå‰ææ˜¯é€šè¿‡docker å®‰è£…RabbitMQ-Management\nä¸‹è½½æ’ä»¶\nwget https://github.com/rabbitmq/rabbitmq-delayed-message-exchange/releases/download/3.9.0/rabbitmq_delayed_message_exchange-3.9.0.ez å¤åˆ¶åˆ°dockerå®¹å™¨MQçš„æ’ä»¶ç›®å½•ä¸‹\næ³¨ï¼šdocker cp æ–‡ä»¶ç›®å½• dockerå®¹å™¨id:å®¹å™¨å†…çš„è·¯å¾„\ndocker cp rabbitmq_delayed_message_exchange-3.9.0.ez 724766fbe93a:/opt/rabbitmq/plugins è¿›å…¥åˆ°å®¹å™¨ä¸­\ndocker exec -it 724766fbe93a /bin/sh å¼€å¯æ’ä»¶\nrabbitmq-plugins enable rabbitmq_delayed_message_exchange æŸ¥çœ‹æ’ä»¶æ˜¯å¦å®‰è£…\nrabbitmq-plugins list æ¶ˆè´¹è€…æ–¹ç»‘å®šæ–¹å¼å®ç°å»¶è¿Ÿé˜Ÿåˆ— åˆ›å»ºæ¥æ”¶æ¶ˆæ¯ç±»ï¼Œä½¿ç”¨@RabbitListeneræ³¨è§£ç›‘å¬æ¶ˆæ¯å¹¶åŒæ—¶ç»‘å®šqueueé˜Ÿåˆ—ã€exchangeäº¤æ¢æœºã€routing key\n@Component public class MqReceiver { /** * rabbitmq_delayed_message_exchangeæ’ä»¶ç‰ˆå»¶æ—¶é˜Ÿåˆ— * @param msg * @param message * @param channel */ @RabbitListener(bindings= @QueueBinding(value = @Queue(value = \u0026#34;delay.queue\u0026#34;, durable = \u0026#34;true\u0026#34;), exchange = @Exchange(value = \u0026#34;delay.exchange\u0026#34;,type=ExchangeTypes.DIRECT, arguments=@Argument(name=\u0026#34;x-delayed-type\u0026#34;,value=\u0026#34;direct\u0026#34;),delayed=Exchange.TRUE), key =\u0026#34;delay.key\u0026#34;)) public void receiveDelay(String msg,Message message,Channel channel) { System.out.println(message.toString()); System.out.println(message.getMessageProperties().getReceivedDelay()); System.out.println(\u0026#34;-----------æ”¶åˆ°æ¶ˆæ¯:\u0026#34;+msg+\u0026#34;,å½“å‰æ—¶é—´ï¼š\u0026#34;+new Date()); } } å‘é€æ¶ˆæ¯\n@RestController public class TestContoller { @Autowired private AmqpTemplate amqpTemplate; @GetMapping(value = \u0026#34;/send/{exp}\u0026#34;) public String test(@PathVariable(\u0026#34;exp\u0026#34;) Integer exp) { String msg = \u0026#34;å‘é€æ—¶é—´ï¼š\u0026#34;+new Date(); amqpTemplate.convertAndSend(MQConstants.DELAY_EXCHANGE,MQConstants.THEATRE_DELAY_KEY,msg,message -\u0026gt; { message.getMessageProperties().setDelay(exp);// å•ä½ æ¯«ç§’ return message; }); return \u0026#34;---------sendTime:\u0026#34;+new Date(); } } ç„¶åå¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°rabbitMQæ§åˆ¶å°æ˜¾ç¤ºå‡ºäº†å®šä¹‰çš„exchangeï¼Œæ³¨æ„typeæ˜¾ç¤ºä¸ºx-delayed-message\næ³¨ï¼šæ³¨æ„æ’ä»¶ç‰ˆçš„æ­»ä¿¡é˜Ÿåˆ—Featureså­—æ®µä¸ä¼šæ˜¾ç¤ºDLX\nè°ƒç”¨æ¥å£ï¼Œå®šä¹‰10ç§’çš„å»¶è¿Ÿ\n","permalink":"http://shaoyi.cc/posts/blog/mq/rabbitmq/rabbitmq/","summary":"Docker å®‰è£…RabbitMQ è¿™é‡Œæ³¨æ„è·å–é•œåƒçš„æ—¶å€™è¦è·å–managementç‰ˆæœ¬çš„ï¼Œä¸è¦è·å–lastç‰ˆæœ¬çš„ï¼Œmanagementç‰ˆæœ¬çš„æ‰å¸¦æœ‰ç®¡ç†ç•Œ","title":"æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹RabbitMQ"},{"content":"ActiveMQå®‰è£…ï¼ˆDockerç¯å¢ƒä¸‹ï¼‰ é¦–å…ˆåœ¨dockeræœç´¢ActiveMQï¼Œå‘ç°webcenter/activemq è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨æ˜¯æœ€å¤šçš„\nç„¶åé€‰æ‹©ç‰ˆæœ¬ï¼Œä¸‹è½½activeMQ\næŸ¥çœ‹é•œåƒï¼Œé…ç½®å¥½activemqå®¹å™¨çš„åå°ç«¯å£ï¼ˆ61616ï¼‰å’Œå‰å°ç«¯å£ï¼ˆ8161ï¼‰çš„æ˜ å°„å…³ç³»ï¼Œå¹¶å¯åŠ¨å®ƒ\næµè§ˆå™¨è®¿é—®ï¼Œå¦‚ä¸‹å›¾ï¼Œä¾¿å®‰è£…å®Œæˆ\nJMSå®ç°æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… é˜Ÿåˆ—çš„æ–¹å¼ ç”Ÿäº§è€…ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsProduce { private static final String ACTIVEMQ_URL=\u0026#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\u0026#34;; private static final String QUEUE_NAME=\u0026#34;myQueue\u0026#34;; public static void main(String[] args) throws JMSException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = connectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼ï¼‰ Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageProducer messageProducer = session.createProducer(destination); //ç”Ÿäº§4æ¡æ¶ˆæ¯ for (int i = 1; i \u0026lt; 5; i++) { //åˆ›å»ºæ¶ˆæ¯å†…å®¹ TextMessage message = session.createTextMessage(\u0026#34;ç¬¬\u0026#34; + i + \u0026#34;æ¡æ¶ˆæ¯\u0026#34;); //å‘é€æ¶ˆæ¯ messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€å®Œæˆï¼\u0026#34;); } } æ‰§è¡Œåçš„ç»“æœï¼š\næ¶ˆè´¹è€…ï¼ˆreceive()æ–¹æ³•è·å–ä¿¡æ¯ï¼‰ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsConsumer { private static final String ACTIVEMQ_URL=\u0026#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\u0026#34;; private static final String QUEUE_NAME=\u0026#34;myQueue\u0026#34;; public static void main(String[] args) throws JMSException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = activeMQConnectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°(è¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼) Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageConsumer messageConsumer = session.createConsumer(destination); while (true){ //è¯»å–æ¶ˆæ¯ TextMessage textMessage = (TextMessage)messageConsumer.receive(); if (null !=textMessage){ //è·å–æ¶ˆæ¯å†…å®¹å¹¶æ‰“å° System.out.println(\u0026#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯: \u0026#34;+textMessage.getText()); }else { break; } } //å…³é—­èµ„æº messageConsumer.close(); session.close(); connection.close(); } } æ‰§è¡Œç»“æœï¼š\næ¶ˆè´¹è€…ï¼ˆç›‘å¬å™¨MessageListeneræ–¹å¼è·å–ä¿¡æ¯ï¼‰\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; import java.io.IOException; public class JmsConsumer02 { private static final String ACTIVEMQ_URL=\u0026#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\u0026#34;; private static final String QUEUE_NAME=\u0026#34;myQueue\u0026#34;; public static void main(String[] args) throws JMSException, IOException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = activeMQConnectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°(è¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼) Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageConsumer messageConsumer = session.createConsumer(destination); messageConsumer.setMessageListener((message) -\u0026gt; { if (null != message \u0026amp;\u0026amp; message instanceof TextMessage){ TextMessage textMessage = (TextMessage) message; try { System.out.println(\u0026#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯: \u0026#34;+textMessage.getText()); } catch (JMSException e) { e.printStackTrace(); } } }); System.in.read(); //é˜²æ­¢æ¶ˆæ¯è¿˜æ²¡æœ‰è¯»å–åˆ°å°±å…³é—­èµ„æºäº† //å…³é—­èµ„æº messageConsumer.close(); session.close(); connection.close(); } } æ¶ˆè´¹è€…è·å–æ¶ˆæ¯çš„æ–¹å¼\nreceive() æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯åŒæ­¥é˜»å¡çš„ï¼Œå¦‚æœè°ƒç”¨è€…ï¼ˆé˜Ÿåˆ—æˆ–è€…è®¢é˜…æ–¹ï¼‰æ²¡æœ‰æ¥å—åˆ°æ¶ˆæ¯ï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…\né™¤æ­¤ä¹‹å¤–å®ƒæœ‰ä¸€ä¸ªé‡è½½æ–¹æ³• receive(long timeout) ï¼Œå‚æ•°è¡¨ç¤ºçš„æ˜¯ ç­‰å¾…çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œåœ¨ç­‰å¾…æ—¶é—´å†…æ²¡æœ‰æ¥å—åˆ°æ¶ˆæ¯å°±è‡ªåŠ¨åœæ­¢\nsetMessageListener(MessageListener listener) æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯å¼‚æ­¥éé˜»å¡çš„ï¼Œè€Œæ–¹æ³•å‚æ•°ç±»å‹æ˜¯MessageListeneræ¥å£ï¼Œè¿™ä¸ªæ¥å£é‡Œåªå®šä¹‰äº†ä¸€ä¸ªç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„onMessageæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åªæ¥æ”¶ä¸€ä¸ªMessageå‚æ•°ç›‘å¬å™¨ã€‚å½“æ¶ˆæ¯åˆ°è¾¾ä¹‹åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨onMessageæ–¹æ³•è·å–ä¿¡æ¯\næ¶ˆè´¹è€…çš„ä¸‰ç§æƒ…å†µ\nå…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œç”Ÿäº§æ¶ˆæ¯ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ˜¯å¦å¯ä»¥æ­£å¸¸æ¶ˆè´¹ä¿¡æ¯ ï¼Ÿ\nç­”æ¡ˆï¼šå¯ä»¥çš„ è¿˜æ˜¯å…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œç”Ÿäº§æ¶ˆæ¯ï¼Œå†åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œåä¸€ä¸ªå¯åŠ¨çš„æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°æ¶ˆæ¯å— ï¼Ÿ\nç­”æ¡ˆï¼šå¦ï¼Œåä¸€ä¸ªå¯åŠ¨çš„æ¶ˆè´¹è€…æ˜¯æ¶ˆè´¹ä¸åˆ°çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯éƒ½è¢«å‰ä¸€ä¸ªå¯åŠ¨çš„æ¶ˆæ¯è€…æ¶ˆè´¹å®Œäº† å…ˆå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå†å¯åŠ¨ç”Ÿäº§è€…ç”Ÿäº§6æ¡æ¶ˆæ¯ï¼Œç»“æœå¦‚ä½• ï¼Ÿ\nç­”æ¡ˆï¼šæ¶ˆæ¯è¢«å¹³åˆ†ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…ä¸€äººä¸€åŠï¼Œåˆ†åˆ«æ¶ˆè´¹3æ¡æ¶ˆæ¯ å‘å¸ƒè®¢é˜…æ–¹å¼ ç”Ÿäº§è€…ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsProduce_Topic { private static final String ACTIVEMQ_URL=\u0026#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\u0026#34;; private static final String TOPIC_NAME=\u0026#34;myTopic\u0026#34;; public static void main(String[] args) throws JMSException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = connectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºå‘å¸ƒè®¢é˜…æ–¹å¼ï¼‰ Destination destination = session.createTopic(TOPIC_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageProducer messageProducer = session.createProducer(destination); //ç”Ÿäº§4æ¡æ¶ˆæ¯ for (int i = 1; i \u0026lt; 5; i++) { //åˆ›å»ºæ¶ˆæ¯å†…å®¹ TextMessage message = session.createTextMessage(\u0026#34;ç¬¬\u0026#34; + i + \u0026#34;æ¡æ¶ˆæ¯\u0026#34;); //å‘é€æ¶ˆæ¯ messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€å®Œæˆï¼\u0026#34;); } } â€‹\tå‘å¸ƒè®¢é˜…çš„æ–¹å¼å’Œé˜Ÿåˆ—æ–¹å¼ï¼Œ ä»ç”Ÿäº§è€…çš„ä»£ç å¯ä»¥å‘ç°ï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯ï¼Œåˆ›å»ºç›®çš„åœ°çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œé˜Ÿåˆ—æ˜¯createQueue(String queueName)ï¼Œè€Œå‘å¸ƒè®¢é˜…æ˜¯createTopic(String topicName)ã€‚åŒæ ·çš„ï¼Œæ¶ˆè´¹è€…çš„ä»£ç å’Œé˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€æ ·çš„\næ¶ˆè´¹è€…\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; import java.io.IOException; public class JmsConsumer_Topic { private static final String ACTIVEMQ_URL=\u0026#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\u0026#34;; private static final String TOPIC_NAME=\u0026#34;myTopic\u0026#34;; public static void main(String[] args) throws JMSException, IOException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = activeMQConnectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºå‘å¸ƒè®¢é˜…æ–¹å¼ï¼‰ Destination destination = session.createTopic(TOPIC_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageConsumer messageConsumer = session.createConsumer(destination); //é€šè¿‡ç›‘å¬å™¨ï¼Œæ¥å—æ¶ˆæ¯ messageConsumer.setMessageListener((message) -\u0026gt; { if (null != message \u0026amp;\u0026amp; message instanceof TextMessage) { try { TextMessage textMessage = (TextMessage) message; System.out.println(\u0026#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯: \u0026#34; + textMessage.getText()); } catch (JMSException e) { e.printStackTrace(); } } }); System.in.read();//é˜»å¡ç­‰å¾… //å…³é—­èµ„æº messageConsumer.close(); session.close(); connection.close(); } } â€‹\tä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå‘å¸ƒè®¢é˜…çš„æ¨¡å¼ï¼Œè¦å…ˆå¯ç”¨è®¢é˜…æ–¹ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…æ–¹ï¼Œå†å¯åŠ¨å‘å¸ƒæ–¹ï¼ˆç”Ÿäº§è€…ï¼‰ã€‚å¦åˆ™ï¼Œå°±ç±»ä¼¼å¾®ä¿¡å…¬ä¼—å·ä¸€æ ·ï¼Œæ²¡æœ‰äººè®¢é˜…ï¼Œç”Ÿäº§æ–¹å‘å¸ƒæ¶ˆæ¯æ˜¯æ²¡æœ‰äººæ¥å—çš„åˆ°ï¼Œä¼šè¢«ä¸¢å¼ƒã€‚è¿™ç§åˆ™æ˜¯åºŸæ¶ˆæ¯ã€‚\né˜Ÿåˆ—å’Œå‘å¸ƒè®¢é˜…ä¸¤è€…å¯¹æ¯” æ¯” è¾ƒ é¡¹ ç›® Topic ï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ¨¡å¼ Queue ï¼ˆé˜Ÿåˆ—ï¼‰æ¨¡å¼ å·¥ ä½œ æ¨¡ å¼ â€œè®¢é˜…-å‘å¸ƒâ€æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰è®¢é˜… è€…ï¼Œæ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒï¼Œå¦‚æœæœ‰å¤šä¸ªè®¢é˜… è€…ï¼Œé‚£ä¹ˆè¿™äº›è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ è´Ÿè½½å‡è¡¡ æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¼ƒï¼Œå¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä¸€æ¡æ¶ˆæ¯ ä¹Ÿåªä¼šå‘é€ç»™å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ä¸”è¦æ±‚æ¶ˆè´¹è€…ackä¿¡æ¯ æœ‰ æ—  çŠ¶ æ€ æ— çŠ¶æ€ Queue æ•°æ®é»˜è®¤ä¼šåœ¨ mq æœåŠ¡å™¨ä¸Šä»¥æ–‡ä»¶å½¢å¼ ä¿å­˜ï¼Œæ¯”å¦‚ Active MQ ä¸€èˆ¬ä¿å­˜åœ¨ $AMQ_HOME\\data\\kr-store\\dataä¸‹é¢ï¼Œä¹Ÿå¯ ä»¥é…ç½®æˆDBå­˜å‚¨ ä¼  é€’ å®Œ æ•´ æ€§ å¦‚æœæ²¡æœ‰è®¢é˜…è€…ï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ æ¶ˆæ¯ä¸ä¼šä¸¢å¼ƒ å¤„ ç† æ•ˆ ç‡ ç”±äºæ¶ˆæ¯è¦æŒ‰ç…§è®¢é˜…è€…çš„æ•°é‡è¿›è¡Œå¤ åˆ¶ï¼Œæ‰€ä»¥å¤„ç†æ€§èƒ½ä¼šéšç€è®¢é˜…è€…çš„å¢åŠ  è€Œæ˜æ˜¾é™ä½ï¼Œå¹¶ä¸”è¿˜è¦ç»“åˆä¸åŒæ¶ˆæ¯å è®®è‡ªèº«çš„æ€§èƒ½å·®å¼‚ ç”±äºä¸€æ¡æ¶ˆæ¯åªå‘é€ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥å°±ç®— æ¶ˆè´¹è€…å†å¤šï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾é™ä½ã€‚å½“ç„¶ä¸ åŒæ¶ˆæ¯åè®®çš„å…·ä½“æ€§èƒ½ä¹Ÿæ˜¯æœ‰å·®å¼‚çš„ã€‚ JMS â€‹\tJMSæ˜¯Java EEçš„ä¸€ä¸ªé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„ä¸€å¥—è§„èŒƒï¼Œå…·ä½“éœ€è¦é å‚å•†çš„äº§å“å®ç°\næ¶ˆæ¯çš„ä¸‰ç§éƒ¨åˆ† æ¶ˆæ¯å¤´ åœ¨ç”Ÿäº§è€…æ–¹ï¼Œæ¶ˆæ¯çš„APIçœ‹å‡ºå¯ä»¥é’ˆå¯¹æ¯ä¸€æ¡æ¶ˆæ¯è®¾ç½®ä¸åŒçš„æ¶ˆæ¯å¤´å±æ€§ å¦‚æœä¸æƒ³ä¸ºæ¯ä¸€æ¡æ¶ˆæ¯å•ç‹¬è®¾ç½®æ¶ˆæ¯å¤´å±æ€§ï¼Œå¯ä»¥é€šè¿‡Send()æ–¹æ³•çš„é‡è½½ï¼Œæ‰¹å¤„ç†æ¶ˆæ¯çš„æ¶ˆæ¯å¤´å±æ€§ ä»æ‰¹å¤„ç†æ¶ˆæ¯å¤´å±æ€§å’Œå•ç‹¬è®¾ç½®æ¶ˆæ¯å¤´å±æ€§ä¸¤è€…ç»“åˆæ¥çœ‹ï¼Œä¸»è¦ä»‹ç»äº”ä¸ªæ¶ˆæ¯å¤´å±æ€§ï¼š JMSDestinationï¼š æ¶ˆæ¯å‘é€çš„ç›®çš„åœ°ï¼Œä¸»è¦æ˜¯æŒ‡ Queue å’Œ Topic\nJMSDeliveryModeï¼š æŒä¹…æ¨¡å¼å’ŒéæŒä¹…æ¨¡å¼ï¼Œå¯è®¾ç½®çš„å‚æ•°ä¸ºDeliveryMode.NON_PERSISTENT(éæŒä¹…) å’Œ DeliveryMode.PERSISTENT(æŒä¹…)\nä¸€æ¡æŒä¹…æ€§çš„æ¶ˆæ¯ï¼šåº”è¯¥è¢«ä¼ é€ â€œä¸€æ¬¡ä»…ä»…ä¸€æ¬¡â€ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœJMS æä¾›è€…å‡ºç°æ•…éšœï¼Œè¯¥æ¶ˆæ¯å¹¶ä¸ä¼šä¸¢å¤±ï¼Œå®ƒä¼šåœ¨æœåŠ¡å™¨æ¢å¤ä¹‹åå†æ¬¡ä¼ é€’æ¶ˆæ¯ã€‚ ä¸€æ¡éæŒä¹…çš„æ¶ˆæ¯ï¼šå¤šä¼šä¼ é€ä¸€æ¬¡ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œè¯¥æ¶ˆæ¯å°†æ°¸ä¹…ä¸¢å¤±ã€‚\nJMSPriority ï¼š æ¶ˆæ¯ä¼˜å…ˆçº§ï¼Œä»0 ~ 9 åä¸ªçº§åˆ«ï¼Œ0 ~ 4 æ˜¯æ™®é€šæ¶ˆæ¯ï¼Œ5 ~ 9æ˜¯åŠ æ€¥æ¶ˆæ¯ã€‚\nJMS ä¸è¦æ±‚ MQ ä¸¥æ ¼æŒ‰ç…§è¿™åä¸ªä¼˜å…ˆçº§å‘é€æ¶ˆæ¯ï¼Œä½†å¿…é¡»ä¿è¯åŠ æ€¥æ¶ˆæ¯è¦å…ˆäºæ™®é€šæ¶ˆæ¯åˆ°è¾¾ï¼Œé»˜è®¤æ˜¯4 çº§ã€‚\nJMSExpirationï¼š å¯ä»¥è®¾ç½®æ¶ˆæ¯åœ¨ä¸€å®šæ—¶é—´åè¿‡æœŸï¼Œé»˜è®¤æ˜¯æ°¸ä¸è¿‡æœŸã€‚æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼Œç­‰äºDestinationçš„sendæ–¹æ³•ä¸­çš„timeToLiveå€¼åŠ ä¸Šå‘é€æ—¶åˆ»çš„GMTæ—¶é—´\nå€¼ã€‚ å¦‚æœtimeToLiveå€¼ç­‰äºé›¶ï¼Œåˆ™ JMSExpiration è¢«è®¾ä¸ºé›¶ï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯æ°¸ä¸è¿‡æœŸã€‚å¦‚æœå‘é€åï¼Œåœ¨æ¶ˆæ¯è¿‡æœŸæ—¶é—´ä¹‹åæ¶ˆæ¯è¿˜æ²¡æœ‰è¢«å‘é€åˆ°ç›®çš„åœ°ï¼Œåˆ™è¯¥æ¶ˆæ¯è¢«æ¸…é™¤ã€‚\nJMSMessageID ï¼š å”¯ä¸€è¯†åˆ«æ¯ä¸ªæ¶ˆæ¯çš„æ ‡è¯†ï¼Œç”±MQäº§ç”Ÿã€‚\næ¶ˆæ¯ä½“ å°è£…å…·ä½“çš„æ¶ˆæ¯æ•°æ®ï¼Œå‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯ä½“ç±»å‹å¿…é¡»ä¸€è‡´å¯¹åº”ï¼\näº”ç§æ¶ˆæ¯ä½“æ ¼å¼ï¼š\nTextMessageï¼š æ™®é€šå­—ç¬¦ä¸²æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªString ã€‚\nMapMessageï¼š ä¸€ä¸ªMapç±»å‹çš„æ¶ˆæ¯ï¼Œkeyä¸ºStringç±»å‹ï¼Œè€Œå€¼ä¸ºJavaçš„åŸºæœ¬ç±»å‹ã€‚\nBytesMessage ï¼š äºŒè¿›åˆ¶æ•°ç»„æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªbyte[] ã€‚\nStreamMessage ï¼š Javaæ•°æ®æµæ¶ˆæ¯ï¼Œç”¨æ ‡å‡†æµæ“ä½œæ¥é¡ºåºçš„å¡«å……å’Œè¯»å–ã€‚\nObjectMessage ï¼šå¯¹è±¡æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ Java å¯¹è±¡ã€‚\næ¶ˆæ¯å±æ€§ å¦‚æœéœ€è¦é™¤æ¶ˆæ¯å¤´å­—æ®µä»¥å¤–çš„å€¼ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ¶ˆæ¯å±æ€§ï¼\nè¯†åˆ«ã€å»é‡ã€é‡ç‚¹æ ‡æ³¨ç­‰æ“ä½œéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼\næ¶ˆæ¯å±æ€§æ˜¯ä»¥å±æ€§åå’Œå±æ€§å€¼å¯¹çš„å½¢å¼æŒ‡å®šçš„ã€‚å¯ä»¥å°†å±æ€§æ˜¯ä¸ºæ¶ˆæ¯å¤´çš„æ‰©å±•ï¼Œå±æ€§æŒ‡å®šä¸€äº›æ¶ˆæ¯å¤´æ²¡æœ‰åŒ…æ‹¬çš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚å¯ä»¥åœ¨å±æ€§é‡ŒæŒ‡å®šæ¶ˆæ¯é€‰æ‹©å™¨ã€‚\nä»¥Propertyç»“å°¾ï¼š\næ¶ˆæ¯çš„å¯é æ€§ æŒä¹…æ€§ é˜Ÿåˆ— //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼ï¼‰ Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageProducer messageProducer = session.createProducer(destination); // éæŒä¹…åŒ– ï¼šæœåŠ¡å™¨å®•æœºï¼Œåˆ™æ¶ˆæ¯ä¸èƒ½æ¢å¤ messageProducer.setDeliveryMode(DeliveryMode.NON_PERSISTENT); // æŒä¹…åŒ– ï¼šæœåŠ¡å™¨å®•æœºï¼Œæ¶ˆæ¯å¯ä»¥æ¢å¤ messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT); é˜Ÿåˆ—æ˜¯å¦è®¾ç½®ä¸ºæŒä¹…ï¼Œå¯ä»¥é€šè¿‡setDeliveryMode(int deliveryMode)æ–¹æ³•è®¾ç½®ï¼Œé»˜è®¤ä¸ºæŒä¹…\næŒä¹…æ€§ å‘å¸ƒè®¢é˜… å‘å¸ƒæ–¹ï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œé¡ºåºä¸ä¹‹å‰æœ‰ä¸€ç‚¹ä¸åŒï¼Œéœ€è¦è®¾å®šå…ˆæŒä¹…åŒ–ï¼Œåœ¨å¯åŠ¨è¿æ¥\næµ‹è¯•ä»£ç ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsProduce_Topic_DeliveryMode { private static final String ACTIVEMQ_URL=\u0026#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\u0026#34;; private static final String TOPIC_NAME=\u0026#34;my_topic_persist\u0026#34;; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = connectionFactory.createConnection(); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Topic topic = session.createTopic(TOPIC_NAME); MessageProducer messageProducer = session.createProducer(topic); //è®¾ç½®å‘å¸ƒæ–¹ä¸º æŒä¹… messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT); //è®¾å®šä¸ºæŒä¹…åï¼Œç„¶åè¿æ¥ connection.start(); for (int i = 1; i \u0026lt;=3; i++) { TextMessage message = session.createTextMessage(\u0026#34;ç¬¬\u0026#34; + i + \u0026#34;æ¡æ¶ˆæ¯\u0026#34;); messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€å®Œæˆï¼\u0026#34;); } } è®¢é˜…æ–¹ï¼ˆæ¶ˆè´¹è€…ï¼‰æµ‹è¯•ä»£ç ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsConsumer_Topic_DeliveryMode { private static final String ACTIVEMQ_URL=\u0026#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\u0026#34;; private static final String TOPIC_NAME=\u0026#34;my_topic_persist\u0026#34;; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = connectionFactory.createConnection(); //è®¢é˜…æ–¹çš„id connection.setClientID(\u0026#34;001\u0026#34;); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Topic topic = session.createTopic(TOPIC_NAME); //åˆ›å»ºæŒä¹…çš„è®¢é˜…æ–¹ TopicSubscriber topicSubscriber = session.createDurableSubscriber(topic, \u0026#34;ååä¹™\u0026#34;); //æŒä¹…åŒ–åï¼Œå†è¿›è¡Œè¿æ¥ connection.start(); Message message = topicSubscriber.receive(); while (null != message){ TextMessage textMessage = (TextMessage)message; System.out.println(\u0026#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+textMessage.getText()); message = topicSubscriber.receive(3000L); } topicSubscriber.close(); session.close(); connection.close(); } } å…ˆå¯åŠ¨è®¢é˜…æ–¹ï¼Œå†å¯åŠ¨å‘å¸ƒæ–¹ï¼Œåˆ°ActiveMQå‰å°çš„SubscribersæŸ¥çœ‹\nå¯åŠ¨å‰æƒ…å†µï¼š\nå¯åŠ¨è®¢é˜…æ–¹åæƒ…å†µï¼š\nå¯åŠ¨ç”Ÿäº§æ–¹ åï¼š\nè®¢é˜…æ–¹åœæ­¢åï¼Œä¼šè¢«åˆ— ç¦»çº¿çš„ä¸€æ å»ï¼š\nå¦‚æœè¿™æ—¶ï¼Œå‘å¸ƒè€…å†æ¬¡å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…æ–¹é‡å¯å¯åŠ¨æ˜¯å¦èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯\nå†æ¬¡å¯åŠ¨è®¢é˜…æ–¹(ä¸åœæ­¢)å\nå°ç»“ï¼š\nâ€‹\tç¬¬ä¸€æ¬¡ï¼Œä¸€å®šè¦å…ˆå¯åŠ¨è®¢é˜…æ–¹ï¼Œä¹‹åå¯åŠ¨å‘å¸ƒæ–¹ï¼Œå‘å¸ƒæ¶ˆæ¯ã€‚è¿™æ—¶ä¸è®ºè®¢é˜…æ–¹åœ¨ä¸åœ¨çº¿ï¼Œéƒ½å¯ä»¥æ¥å—åˆ°æ¶ˆæ¯ï¼Œä¸åœ¨çº¿ï¼Œé‡æ–°å¯åŠ¨åä¼šæ¥å—æ²¡æœ‰æ”¶åˆ°è¿‡çš„æ¶ˆæ¯æ¥å—ä¸‹æ¥\näº‹åŠ¡ äº‹åŠ¡åå‘äºç”Ÿäº§è€…ã€ç­¾æ”¶åå‘äºæ¶ˆè´¹è€…\n//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); äº‹åŠ¡åªæœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalse\nç”Ÿäº§è€…ä¸€æ–¹\nå½“å€¼ä¸ºfalseæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨å‘é€åˆ°ç›®çš„åœ°\nå½“å€¼ä¸ºtrueæ—¶ï¼Œéœ€è¦åœ¨è°ƒç”¨send()æ–¹æ³•åï¼Œè°ƒç”¨commit()æ–¹æ³•ï¼Œæ‰‹åŠ¨æäº¤\næ¶ˆè´¹è€…ä¸€æ–¹\nå½“å€¼ä¸ºfalseæ—¶ï¼Œæ¶ˆæ¯åªä¼šè¢«æ¶ˆè´¹ä¸€æ¬¡\nå½“å€¼ä¸ºtrueæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Œä¸”åœ¨ç›®çš„åœ°ä¸­ï¼Œæ¶ˆæ¯ä¸ä¼šå‡ºé˜Ÿçš„ï¼Œå³æœªè¢«æ¶ˆè´¹\næµ‹è¯•ï¼š\n//åˆ›å»ºä¼šè¯ï¼Œå¼€å¯äº‹åŠ¡ Session session = connection.createSession(true, Session.AUTO_ACKNOWLEDGE); try { //OK,å°±æäº¤ session.commit(); } catch (JMSException e) { //error,å°±å›æ»š session.rollback(); }finally { //å…³é—­èµ„æº } ç­¾æ”¶æœºåˆ¶ ç­¾æ”¶é’ˆå¯¹çš„æ˜¯æ¶ˆè´¹è€…ä¸€æ–¹ï¼Œåˆ†ä¸ºä»¥ä¸‹å››ç§\npublic interface Session extends Runnable { static final int AUTO_ACKNOWLEDGE = 1; //è‡ªåŠ¨ç­¾æ”¶ï¼ˆé»˜è®¤ï¼‰ static final int CLIENT_ACKNOWLEDGE = 2;\t//æ‰‹åŠ¨ç­¾æ”¶ï¼Œéœ€è¦è°ƒç”¨ message.acknowledge(); è¿›è¡Œç­¾æ”¶ï¼Œå¦åˆ™ä¹Ÿä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹ static final int DUPS_OK_ACKNOWLEDGE = 3;\t//è‡ªåŠ¨æ‰¹é‡ç¡®è®¤ static final int SESSION_TRANSACTED = 0;\t//è¿™ä¸ªæ˜¯é…åˆäº‹åŠ¡ï¼Œå½“äº‹åŠ¡å¼€å¯åˆ™é€‰æ‹©è¿™ä¸ªï¼Œä¸»è¦æ˜¯ä¸€ä¸ªè¯­æ³•çš„ä¸€ä¸ªè§„èŒƒè€Œå·² å½“äº‹åŠ¡æ²¡æœ‰å¼€å¯æ—¶ ï¼š å³éäº‹åŠ¡ï¼Œæ¶ˆæ¯çš„ç¡®è®¤æƒ…å†µ åˆ™ä»¥ç­¾æ”¶æœºåˆ¶ä¸ºä¸»\nå½“äº‹åŠ¡å¼€å§‹æ—¶ ï¼š å³äº‹åŠ¡æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯çš„ç¡®è®¤ä»¥äº‹åŠ¡ä¸ºä¸»ï¼Œå³æ˜¯å¦commitçš„ä¸ºä¸»ï¼Œä¸ç”¨ç®¡ç­¾æ”¶æœºåˆ¶çš„æƒ…å†µã€‚\næ³¨ï¼šå¸¸ç”¨çš„ç­¾æ”¶æ¨¡å¼ ä¸»è¦ä»¥è‡ªåŠ¨ç­¾æ”¶ï¼ˆAUTO_ACKNOWLEDGEï¼‰å’Œæ‰‹åŠ¨ç­¾æ”¶ï¼ˆCLIENT_ACKNOWLEDGEï¼‰ä¸ºä¸»\nSpringBootç»“åˆACtiveMQ é˜Ÿåˆ—æ¨¡å¼ 1ã€å¯¼å…¥mavenä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!--activemqçš„ä¾èµ–--\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-activemq\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; 2ã€ç¼–å†™application.propertiesé…ç½®æ–‡ä»¶\nserver.port=8888 # é…ç½®activemqçš„é“¾æ¥ï¼Œç”¨æˆ·åå’Œå¯†ç  spring.activemq.broker-url=tcp://æœåŠ¡å™¨å…¬ç½‘ip:ç«¯å£å· spring.activemq.user=admin spring.activemq.password=admin #é…ç½®æ˜¯å¦ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼ #falseä¸ºé˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰ #tureä¸ºå‘å¸ƒè®¢é˜… spring.jms.pub-sub-domain=false #é˜Ÿåˆ—åç§°ï¼ˆè‡ªå®šä¹‰æ ‡ç­¾ï¼‰ myqueue=activemq_springboot_queue 3ã€ç¼–å†™é…ç½®ç±»\npackage com.shishiyi.config; import org.apache.activemq.command.ActiveMQQueue; import org.springframework.beans.factory.annotation.Value; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import javax.jms.Queue; @Configuration public class ActiveMQConfig { //æ³¨å…¥é˜Ÿåˆ—åç§° @Value(\u0026#34;${myqueue}\u0026#34;) private String myQueue_name; //å‘springå®¹å™¨å¯¼å…¥é˜Ÿåˆ—å¯¹è±¡ @Bean public Queue queue(){ return new ActiveMQQueue(myQueue_name); } } 4ã€ç¼–å†™é˜Ÿåˆ—çš„æ¶ˆæ¯ç”Ÿäº§è€…Produce\npackage com.shishiyi.queue; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.Queue; @Component public class QueueProduce { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @Autowired private Queue queue_name; public void produceSend(){ //å‘é€æ¶ˆæ¯ jmsMessagingTemplate.convertAndSend(queue_name,\u0026#34;ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯\u0026#34;); } } 5ã€ç¼–å†™controllerç±»ï¼Œå¹¶è®¿é—®æ¥å£\npackage com.shishiyi.controller; import com.shishiyi.queue.QueueProduce; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class QueueProduceController { @Autowired private QueueProduce queueProduce; @GetMapping(\u0026#34;/queuesend\u0026#34;) public void queueSend(){ queueProduce.produceSend(); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€æˆåŠŸ\u0026#34;); } } æŸ¥çœ‹ActiveMQçš„å‰å°ï¼Œæ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—äº†\n6ã€ç¼–å†™é˜Ÿåˆ—çš„æ¶ˆè´¹è€…\npackage com.shishiyi.queue; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.annotation.JmsListener; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.JMSException; import javax.jms.Message; import javax.jms.TextMessage; @Component public class QueueConsumer { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; //é‡‡ç”¨ç›‘å¬å™¨çš„æ–¹å¼è·å–æ¶ˆæ¯ @JmsListener(destination = \u0026#34;${myqueue}\u0026#34;) public void receive(Message message) throws JMSException { if (null !=message \u0026amp;\u0026amp; message instanceof TextMessage){ TextMessage textMessage = (TextMessage)message; System.out.println(\u0026#34;æ¶ˆè´¹è€…å·²ç»æ¥å—åˆ°äº†\u0026#34;+textMessage.getText()); } } } åˆ é™¤ä¹‹å‰å…¥é˜Ÿçš„ä¿¡æ¯ï¼Œç„¶åé‡æ–°å¯åŠ¨ å¯åŠ¨ç±»ï¼Œå†æ¬¡è®¿é—®æ¥å£ï¼Œå¹¶æŸ¥çœ‹ActiveMQçš„å‰å°å’Œæ‰“å°å°\nè®¢é˜…å‘å¸ƒæ¨¡å¼ 1ã€å¯¼å…¥mavenä¾èµ–\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-activemq\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; 2ã€ç¼–å†™application.propertiesé…ç½®æ–‡ä»¶\nserver.port=7777 # é…ç½®activemqçš„é“¾æ¥ï¼Œç”¨æˆ·åå’Œå¯†ç  spring.activemq.broker-url=tcp://æœåŠ¡å™¨å…¬ç½‘ip:ç«¯å£å· spring.activemq.user=admin spring.activemq.password=admin #é…ç½®æ˜¯å¦ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼ #falseä¸ºé˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰ #tureä¸ºå‘å¸ƒè®¢é˜… spring.jms.pub-sub-domain=true #topicåç§° mytopic=activemq_springboot_topic 3ã€ç¼–å†™é…ç½®ç±»\npackage com.shishiyi.config; import org.apache.activemq.command.ActiveMQTopic; import org.springframework.beans.factory.annotation.Value; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import javax.jms.Topic; @Configuration public class ActiveMQConfig { @Value(\u0026#34;${mytopic}\u0026#34;) private String myTopic; @Bean public Topic topic(){ return new ActiveMQTopic(myTopic); } } 4ã€ç¼–å†™ä¸»é¢˜çš„æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆå‘å¸ƒæ–¹ï¼‰\npackage com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.Topic; @Component public class TopicProduce { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @Autowired private Topic topic; public void topicSend(){ jmsMessagingTemplate.convertAndSend(topic,\u0026#34;å‘å¸ƒæ–¹å‘ä¸»é¢˜å‘å¸ƒçš„æ¶ˆæ¯\u0026#34;); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€æˆåŠŸ\u0026#34;); } } 5ã€ç¼–å†™controllerç±»\npackage com.shishiyi.controller; import com.shishiyi.topic.TopicProduce; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicProduceController { @Autowired private TopicProduce topicProduce; @GetMapping(\u0026#34;/topicSend\u0026#34;) public void topicSend(){ topicProduce.topicSend(); } } 6ã€ç¼–å†™ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼ˆè®¢é˜…æ–¹ï¼‰\npackage com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.annotation.JmsListener; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.*; @Component public class TopicConsumer { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @JmsListener(destination = \u0026#34;${mytopic}\u0026#34;) public void receive(Message message) throws JMSException { if (null != message \u0026amp;\u0026amp; message instanceof TextMessage){ TextMessage textMessage = (TextMessage) message; System.out.println(\u0026#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+textMessage.getText()); } } } 7ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼Œè®¿é—®æ¥å£ï¼Œè®©å‘å¸ƒæ–¹ç”Ÿäº§æ¶ˆæ¯ï¼Œå¹¶æŸ¥çœ‹ActiveMQçš„å‰å°å’Œæ‰“å°å°\nå®šæ—¶çš„è®¢é˜…å‘å¸ƒæ¨¡å¼\nè®©å‘å¸ƒæ–¹æ¯è¿‡5ç§’ï¼Œå‘é€ä¸€æ¬¡æ¶ˆæ¯\n//åˆ›å»ºå®šæ—¶ä»»åŠ¡ package com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.scheduling.annotation.Scheduled; import org.springframework.stereotype.Component; import javax.jms.Topic; @Component public class TopicProduce { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @Autowired private Topic topic; public void topicSend(){ jmsMessagingTemplate.convertAndSend(topic,\u0026#34;å‘å¸ƒæ–¹å‘ä¸»é¢˜å‘å¸ƒçš„æ¶ˆæ¯\u0026#34;); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€æˆåŠŸ\u0026#34;); } //åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”5ç§’å‘å¸ƒæ¶ˆæ¯ @Scheduled(fixedRate = 5000L) public void scheduled(){ topicSend(); } } æ·»åŠ  @EnableScheduling æ³¨è§£ï¼Œå‘ç°å®šæ—¶ä»»åŠ¡è®©å®ƒåå°æ‰§è¡Œ\nä¿®æ”¹ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼ˆè®¢é˜…æ–¹ï¼‰ï¼Œæ·»åŠ LocalDateTime.now()æ–¹æ³•ï¼Œæ–¹ä¾¿åœ¨æ§åˆ¶å°æŸ¥çœ‹\npackage com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.annotation.JmsListener; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.*; import java.time.LocalDateTime; @Component public class TopicConsumer { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @JmsListener(destination = \u0026#34;${mytopic}\u0026#34;) public void receive(Message message) throws JMSException { if (null != message \u0026amp;\u0026amp; message instanceof TextMessage){ TextMessage textMessage = (TextMessage) message; System.out.println(\u0026#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+textMessage.getText()+ \u0026#34;æ—¶é—´ä¸ºï¼š\u0026#34; +LocalDateTime.now()); } } } å¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ‰“å°å†…å®¹ï¼Œä»¥åŠï¼ˆåŒä¸€æ—¶é—´ç‚¹å†…ï¼‰æŸ¥çœ‹ActiveMQçš„å‰å°\nActiveMQä¼ è¾“åè®® åœ¨è¿æ¥activemqæ—¶ï¼Œé»˜è®¤æ˜¯ç”¨TCPè¿æ¥ï¼Œé‚£Activemqæ˜¯å¦è¿˜æ”¯æŒå…¶å®ƒåè®®å—ï¼Ÿ\næŸ¥çœ‹activemqçš„confæ–‡ä»¶å¤¹ä¸‹çš„activemq.xml\nå¯ä»¥çœ‹å‡ºï¼Œé™¤äº†æ”¯æŒé»˜è®¤çš„TCPåè®®ï¼Œè¿˜æ”¯æŒ amqp ï¼Œstompï¼Œmqttï¼Œwsç­‰åè®®ï¼Œè€Œä¸”åè®®å¯¹åº”çš„ç«¯å£å·ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™å°±æ˜¯ç”¨TCPè¿æ¥æ—¶ï¼Œç«¯å£å·æ˜¯61616çš„åŸå› äº†ã€‚\nä»activemqå‰å°ä¹Ÿå¯ä»¥æŸ¥çœ‹å‡ºæ¥\nå¦‚æœæƒ³é…ç½®å…¶å®ƒåè®®ï¼Œå¯ä»¥æŸ¥çœ‹å®˜ç½‘çš„æ–‡æ¡£\nhttp://activemq.apache.org/configuring-version-5-transports\né…ç½®NIOåè®® ä»å®˜ç½‘çš„æ–‡æ¡£å¾—çŸ¥ï¼Œé…ç½®NIOåè®®ï¼Œåªéœ€è¦ä¿®æ”¹activemq.xmlæ–‡ä»¶\n\u0026lt;!--æ·»åŠ ä¸€æ®µå³å¯--\u0026gt; \u0026lt;transportConnectors\u0026gt; \u0026lt;transportConnector name=\u0026#34;nio\u0026#34; uri=\u0026#34;nio://0.0.0.0:61617\u0026#34;/\u0026gt; \u0026lt;/\u0026lt;transportConnectors\u0026gt; é‡å¯activemqï¼ˆé‡å¯å®¹å™¨ï¼‰ï¼ŒæŸ¥çœ‹activemqå‰å°\nä¿®æ”¹ä»£ç çš„è¿æ¥æ–¹å¼ï¼Œå¹¶æµ‹è¯•\n//ç”±äºå®‰è£…çš„activemqæ˜¯dockerå®¹å™¨ï¼Œæ·»åŠ çš„nioåè®®ç«¯å£æ˜¯61617ï¼Œæ‰€ä»¥ç«¯å£è¦æå‰æ˜ å°„å¥½ï¼Œå¦åˆ™ä¼šè¿ä¸ä¸Š private static final String ACTIVEMQ_URL=\u0026#34;nio://47.115.151.184:61617\u0026#34;; private static final String QUEUE_NAME=\u0026#34;myQueue_NIO\u0026#34;; æŸ¥çœ‹å‰å°\nActiveMQæŒä¹…åŒ– æŒä¹…åŒ–ä¸åŒäºä¹‹å‰çš„æŒä¹…æ€§ï¼ŒæŒä¹…åŒ–æ˜¯ä»¥é˜²æœåŠ¡å™¨æœ¬èº«æŒ‚äº†ï¼Œé‡å¯æœåŠ¡å™¨ä¹Ÿå¯ä»¥æ¢å¤æ¶ˆæ¯\nActiveMQç›®å‰é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼æ˜¯KahaDBï¼Œæ­¤å¤–è¿˜æœ‰JDBCï¼Œ LevelDBç­‰ï¼Œä¸è¿‡å®ƒä»¬å¤§ä½“ä¸Šçš„é€»è¾‘æ˜¯ä¸€æ ·ï¼Œæ¶ˆæ¯ä¸­å¿ƒæ¥å—åˆ°æ¶ˆæ¯ã€‚ä¼šæŠŠæ¶ˆæ¯å¤‡ä»½å­˜å‚¨èµ·æ¥ã€‚\nKahaDB(é»˜è®¤) KahaDBï¼šè¿™ä¸ª5.4ç‰ˆæœ¬ä¹‹åå‡ºç°çš„é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ï¼Œ KahaDBçš„æŒä¹…åŒ–æœºåˆ¶æ˜¯åŸºäºæ—¥å¿—æ–‡ä»¶ï¼Œç´¢å¼•å’Œç¼“å­˜ã€‚\nä»activemq.xmlé…ç½®æ–‡ä»¶ä¸­å¯ä»¥å¾—çŸ¥\nå®ƒæ˜¯æŠŠæ•°æ®å­˜å‚¨åœ¨activemqçš„dataç›®å½•ä¸‹çš„kahadbæ–‡ä»¶å¤¹ä¸­\nåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ä¼šæœ‰å››ä¸ªæ–‡ä»¶æ¥å®Œæˆæ¶ˆæ¯æŒä¹…åŒ–\ndb.data å®ƒæ˜¯æ¶ˆæ¯çš„ç´¢å¼•æ–‡ä»¶ï¼Œæœ¬è´¨ä¸Šæ˜¯B-Treeï¼ˆBæ ‘ï¼‰ï¼Œä½¿ç”¨B-Treeä½œä¸ºç´¢å¼•æŒ‡å‘db-*.logé‡Œé¢å­˜å‚¨çš„æ¶ˆæ¯ db.redo ç”¨æ¥è¿›è¡Œæ¶ˆæ¯æ¢å¤ db-*.log å­˜å‚¨æ¶ˆæ¯å†…å®¹ã€‚æ–°çš„æ•°æ®ä»¥APPENDçš„æ–¹å¼è¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶æœ«å°¾ã€‚å±äºé¡ºåºå†™å…¥ï¼Œå› æ­¤æ¶ˆæ¯å­˜å‚¨æ˜¯æ¯”è¾ƒå¿«çš„ã€‚é»˜è®¤æ˜¯32Mï¼Œè¾¾åˆ°é˜€å€¼ä¼šè‡ªåŠ¨é€’å¢æ–‡ ä»¶ï¼Œæ–‡ä»¶åæŒ‰ç…§æ•°å­—è¿›è¡Œç¼–å·ï¼Œå¦‚ db-1.logã€db-2.logã€\u0026hellip;.. lock æ–‡ä»¶ é”ï¼Œå†™å…¥å½“å‰è·å¾—kahadbè¯»å†™æƒé™çš„broker ï¼Œç”¨äºåœ¨é›†ç¾¤ç¯å¢ƒä¸‹çš„ç«äº‰å¤„ç† KahaDBé…ç½®å®˜ç½‘é“¾æ¥ï¼š http://activemq.apache.org/kahadb\nLevelDB è¿™ç§æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»ActiveMQ 5.8 ä¹‹åå¼•è¿›çš„ï¼Œå®ƒå’Œ KahaDB éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºæ–‡ä»¶çš„æœ¬åœ°æ•°æ®åº“å­˜ å‚¨å½¢å¼ï¼Œä½†æ˜¯å®ƒæä¾›æ¯” KahaDBæ›´å¿«çš„æŒä¹…æ€§ã€‚\nä½†å®ƒä¸ä½¿ç”¨è‡ªå®šä¹‰ B-Tree å®ç°æ¥ç´¢å¼•é¢„å†™æ—¥å¿—ï¼Œè€Œæ˜¯ä½¿ç”¨åŸºäºLevelDBçš„ç´¢å¼•ã€‚\nå¯æ˜¯ä¸ºä»€ä¹ˆLeavelDB æ›´å¿«ï¼Œå¹¶ä¸”5.8 ä»¥åå°±æ”¯æŒï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯é»˜è®¤ KahaDB å¼•æ“ï¼Œå› ä¸º activemq å®˜ç½‘æœ¬èº«æ²¡æœ‰å®šè®ºï¼ŒLeavelDB ä¹‹ååˆå‡ºäº†å¯å¤åˆ¶çš„\nLeavelDB æ¯”LeavelDB æ›´æ€§èƒ½æ›´ä¼˜è¶Šï¼Œä½†éœ€è¦åŸºäº ZooKeeper æ‰€ä»¥è¿™äº›å®˜æ–¹è¿˜æ²¡æœ‰å®šè®ºï¼Œä»æ—§ä½¿ç”¨ KahaDBã€‚\né»˜è®¤é…ç½®ï¼š\n\u0026lt;broker brokerName=\u0026#34;broker\u0026#34; ... \u0026gt; ... \u0026lt;persistenceAdapter\u0026gt; \u0026lt;levelDB directory=\u0026#34;activemq-data\u0026#34;/\u0026gt; \u0026lt;/persistenceAdapter\u0026gt; ... \u0026lt;/broker\u0026gt; LevelDBé…ç½®å®˜ç½‘é“¾æ¥ï¼š http://activemq.apache.org/leveldb-store\nJDBC çœ‹åå­—å°±çŸ¥é“å’Œæ•°æ®åº“æœ‰å…³ï¼Œæ‰€ä»¥JDBçš„æŒä¹…åŒ–å°±æ˜¯æŠŠæ¶ˆæ¯å¤‡ä»½åˆ°æ•°æ®åº“ä¸­\nç”±äºç”¨dockeræ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥ç›´æ¥æ”¹ä¸ºwindowsæœ¬åœ°æµ‹è¯•\né¦–å…ˆä¸‹è½½activemqçš„windowsç‰ˆæœ¬ï¼Œhttp://activemq.apache.org/components/classic/download/\nç„¶åä¸‹è½½mysqlçš„é©±åŠ¨åŒ…ï¼Œ\næŠŠmysqlé©±åŠ¨åŒ…ä¸¢åˆ°activemqçš„libä¸‹\næ‰“å¼€activemqçš„confç›®å½•ä¸‹çš„activemq.xmlæ–‡ä»¶ï¼Œé…ç½®å†…å®¹ï¼š\n\u0026lt;!-- Configure message persistence for the broker. The default persistence mechanism is the KahaDB store (identified by the kahaDB tag). For more information, see: http://activemq.apache.org/persistence.html \u0026lt;persistenceAdapter\u0026gt; \u0026lt;kahaDB directory=\u0026#34;${activemq.data}/kahadb\u0026#34;/\u0026gt; \u0026lt;/persistenceAdapter\u0026gt; å±è”½ä¹‹å‰çš„æŒä¹…åŒ– --\u0026gt; \u0026lt;!--æ”¹ç”¨mysqlæ–¹å¼--\u0026gt; \u0026lt;persistenceAdapter\u0026gt; \u0026lt;jdbcPersistenceAdapter dataSource=\u0026#34;#mysqlDataSource\u0026#34; createTablesOnStartup=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;/persistenceAdapter\u0026gt; å‚æ•°è§£é‡Šï¼š\ndataSourceï¼š è¡¨ç¤ºçš„æ˜¯å¼•ç”¨çš„æ•°æ®æºåç§°\ncreateTablesOnStartupï¼š è¡¨ç¤ºå¯åŠ¨çš„æ—¶å€™æ˜¯å¦å»åˆ›å»ºè¡¨ï¼Œä¸€èˆ¬ç¬¬ä¸€æ¬¡ä¸ºtrue,ä¹‹åæ”¹ä¸ºfalse\næ¥ç€ç”±äºæŒ‡å®šäº†æ•°æ®æºï¼Œæ‰€ä»¥éœ€è¦åœ¨activemq.xmlé…ç½®ä¸€ä¸ªæ•°æ®æºï¼Œä¸è¿‡è¦æ³¨æ„ä½ç½®\n\u0026lt;bean id=\u0026#34;mysqlDataSource\u0026#34; class=\u0026#34;org.apache.commons.dbcp.BasicDataSource\u0026#34; destroy-method=\u0026#34;close\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;driverClassName\u0026#34; value=\u0026#34;com.mysql.jdbc.Driver\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;url\u0026#34; value=\u0026#34;jdbc:mysql://localhost:3306/activemq?relaxAutoCommit=true\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;username\u0026#34; value=\u0026#34;root\u0026#34;/\u0026gt; \u0026lt;property name=\u0026#34;password\u0026#34; value=\u0026#34;123\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; ç„¶ååˆ›å»ºå¥½æ•°æ®åº“ï¼Œæ•°æ®åº“åå­—ä¸æ•°æ®æºé“¾æ¥çš„è¦ä¸€è‡´\næµ‹è¯•ï¼š\nQueue\n//ç”Ÿäº§è€… public class JmsProduce { private static final String ACTIVEMQ_URL=\u0026#34;tcp://127.0.0.1:61616\u0026#34;; private static final String QUEUE_NAME=\u0026#34;queue_jdbc_mysql\u0026#34;; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = connectionFactory.createConnection(); connection.start(); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Destination destination = session.createQueue(QUEUE_NAME); MessageProducer messageProducer = session.createProducer(destination); //ä¸€å®šè¦å¼€å¯æŒä¹…åŒ– messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT); for (int i = 1; i \u0026lt; 5; i++) { TextMessage message = session.createTextMessage(\u0026#34;ç¬¬\u0026#34; + i + \u0026#34;æ¡æ¶ˆæ¯\u0026#34;); messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€å®Œæˆï¼\u0026#34;); } } å¯åŠ¨åï¼Œåˆ†åˆ«æŸ¥çœ‹æ•°æ®åº“å’Œå‰å°ï¼š\n//æ¶ˆè´¹è€… public class JmsConsumer { private static final String ACTIVEMQ_URL=\u0026#34;tcp://127.0.0.1:61616\u0026#34;; private static final String QUEUE_NAME=\u0026#34;queue_jdbc_mysql\u0026#34;; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = activeMQConnectionFactory.createConnection(); connection.start(); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Destination destination = session.createQueue(QUEUE_NAME); MessageConsumer messageConsumer = session.createConsumer(destination); while (true){ TextMessage textMessage = (TextMessage)messageConsumer.receive(); if (null !=textMessage){ //è·å–æ¶ˆæ¯å†…å®¹å¹¶æ‰“å° System.out.println(\u0026#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯: \u0026#34;+textMessage.getText()); }else { break; } } //å…³é—­èµ„æº messageConsumer.close(); session.close(); connection.close(); } } å¯åŠ¨æ¶ˆè´¹è€…æŸ¥çœ‹æ•°æ®åº“å’Œå‰å°ï¼š\nQueue å°ç»“ï¼š\nâ€‹\tåœ¨ç‚¹å¯¹ç‚¹ç±»å‹ä¸­ï¼Œå½“DeliveryModeè®¾ç½®ä¸ºNON_PERSISTENCE æ—¶ï¼Œæ¶ˆæ¯è¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼› å½“DeliveryModeè®¾ç½®ä¸ºPERSISTENCE æ—¶ï¼Œæ¶ˆæ¯è¢«ä¿å­˜åœ¨Brokerçš„ç›¸åº”çš„æ–‡ä»¶æˆ–è€…æ•°æ®åº“ä¸­ã€‚è€Œä¸”ç‚¹å¯¹ç‚¹ç±»å‹ä¸­æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¶ˆè´¹å°±ä»Brokerä¸­åˆ é™¤\nTopic\n//å‘å¸ƒæ–¹ public class JmsProduce_Topic { private static final String ACTIVEMQ_URL=\u0026#34;tcp://127.0.0.1:61616\u0026#34;; private static final String TOPIC_NAME=\u0026#34;topic_jdbc_mysql\u0026#34;; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = connectionFactory.createConnection(); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Topic topic = session.createTopic(TOPIC_NAME); MessageProducer messageProducer = session.createProducer(topic); //è®¾ç½®å‘å¸ƒæ–¹ä¸º æŒä¹… messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT); //è®¾å®šä¸ºæŒä¹…åï¼Œç„¶åè¿æ¥ connection.start(); for (int i = 1; i \u0026lt;=3; i++) { TextMessage message = session.createTextMessage(\u0026#34;ç¬¬\u0026#34; + i + \u0026#34;æ¡æ¶ˆæ¯\u0026#34;); messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\u0026#34;æ¶ˆæ¯å‘é€å®Œæˆï¼\u0026#34;); } } //è®¢é˜…æ–¹ public class JmsConsumer_Topic_DeliveryMode { private static final String ACTIVEMQ_URL=\u0026#34;tcp://127.0.0.1:61616\u0026#34;; private static final String TOPIC_NAME=\u0026#34;topic_jdbc_mysql\u0026#34;; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = connectionFactory.createConnection(); //è®¢é˜…æ–¹çš„id connection.setClientID(\u0026#34;001\u0026#34;); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Topic topic = session.createTopic(TOPIC_NAME); //åˆ›å»ºæŒä¹…çš„è®¢é˜…æ–¹ TopicSubscriber topicSubscriber = session.createDurableSubscriber(topic, \u0026#34;ååä¹™\u0026#34;); //æŒä¹…åŒ–åï¼Œå†è¿›è¡Œè¿æ¥ connection.start(); Message message = topicSubscriber.receive(); while (null != message){ TextMessage textMessage = (TextMessage)message; System.out.println(\u0026#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\u0026#34;+textMessage.getText()); message = topicSubscriber.receive(); } topicSubscriber.close(); session.close(); connection.close(); } } å…ˆå¯åŠ¨è®¢é˜…æ–¹ç„¶åå†å¯åŠ¨å‘å¸ƒæ–¹ï¼ŒæŸ¥çœ‹æ•°æ®åº“å’Œå‰å°ï¼š\nTopic å°ç»“ï¼š\nä¸€å®šè¦å…ˆå¯åŠ¨æ¶ˆè´¹è®¢é˜…ç„¶åå†å¯åŠ¨ç”Ÿäº§ï¼Œæ¶ˆæ¯ä¼šè¢«ä¿ç•™åœ¨ activemq_msgsè¡¨ä¸­æ¶ˆè´¹å®Œæ¯•ä¹Ÿä¸ä¼šåˆ é™¤ï¼Œè€Œè®¢é˜…å…³ç³»åœ¨ acks è¡¨ ä¸­ã€‚\n","permalink":"http://shaoyi.cc/posts/blog/mq/activemq/activemq/","summary":"ActiveMQå®‰è£…ï¼ˆDockerç¯å¢ƒä¸‹ï¼‰ é¦–å…ˆåœ¨dockeræœç´¢ActiveMQï¼Œå‘ç°webcenter/activemq è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨æ˜¯æœ€å¤š","title":"æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ"},{"content":"Javaé” ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š\næŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚\nå…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š\nè¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚\nå…¬å¹³é”ï¼š\næ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼æ’é˜Ÿæ‰“é¥­ï¼Œå…ˆæ¥ååˆ°ã€‚\néå…¬å¹³é”ï¼š\næ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”ç°ç”³è¯·çš„çº¿ç¨‹ ä¼˜å…ˆè·å–é”ã€‚ä¸æ–­å°è¯•è·å–é”ï¼Œå¦‚æœå°è¯•å¤±è´¥å°±åƒå…¬å¹³é”ä¸€æ ·ç­‰ç€ã€‚\nReentrantLocké”å¯ä»¥é€šè¿‡åˆ›å»ºæ—¶çš„æ„é€ æ–¹æ³•æ¥æŒ‡å®šä¸ºå…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”\næºç å¦‚ä¸‹ï¼š\nå¯¹äºSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚\nå¯é‡å…¥é”ï¼ˆä¹Ÿå«é€’å½’é”ï¼‰ï¼š\næŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³• è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹å¯ä»¥è¿›å…¥ä»»ä½•ä¸€ä¸ªå®ƒå·²ç»æ‹¥æœ‰çš„é”ï¼Œæ‰€åŒæ­¥ç€çš„ä»£ç å—ã€‚ å°±å¥½æ¯”ï¼Œæ‰“å¼€å®¶çš„å¤§é—¨ï¼Œä¹Ÿå¯ä»¥æ‰“å¼€å®¶é‡Œæˆ¿é—´çš„é—¨ã€‚\nReentrantLockã€Synchronized å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å¯é‡å…¥é”ï¼›\nè‡ªæ—‹é”ï¼ˆspinlockï¼‰ï¼š æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹ æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUã€‚\næ­»é”ï¼š\næ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›å¹² æ¶‰é‚£å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ï¼Œå¦‚æœç³»ç»Ÿèµ„æºå……è¶³ï¼Œè¿›ç¨‹çš„èµ„æºè¯·æ±‚éƒ½èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ï¼Œæ­»é”å‡ºç°çš„å¯èƒ½æ€§ å°±å¾ˆä½ï¼Œå¦è€…å°±ä¼šå› ä¸ºäº‰å¤ºæœ‰é™çš„èµ„æºè€Œé™·å…¥æ­»é”ã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰ä¹è§‚é”ï¼Œæ‚²è§‚é”\nCallable Javaä¸­è·å–å¤šçº¿ç¨‹ é™¤ç»§æ‰¿Threadç±»å’Œå®ç°Runnableæ¥å£ å¤–çš„ï¼Œç¬¬ä¸‰ç§æ–¹å¼\nä¸Runnableä¸åŒä¹‹å¤„ï¼š\nä»æºç å¯ä»¥å‘ç°ï¼Œæ˜¯å¦æœ‰è¿”å›å€¼ï¼Œæ˜¯å¦æŠ›å¼‚å¸¸ï¼Œå®ç°æ–¹æ³•ä¸åŒï¼Œä¸€ä¸ªæ˜¯call()æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯run()æ–¹æ³•\nå¯æ˜¯Threadç±»æ²¡æœ‰å…³äºCallableå‚æ•°çš„æ–¹æ³•ï¼Œè¿™ç‚¹JDKæºç å·²ç»è¡¨æ˜äº†\næ‰€ä»¥éœ€è¦ä¸€ä¸ªä¸­é—´ç±»æ¥å®ç°Callableæ¥å£ä¸Threadç±»çš„å…³ç³»ï¼Œè¿™ä¸ªç±»éœ€è¦å®ç°Runnableæ¥å£ï¼ˆè¿™æ ·æ‰èƒ½æŠŠå¯¹è±¡ä¼ ç»™Threadç±»ï¼‰ï¼Œä¸”æ„é€ æ–¹æ³•å‚æ•°æœ‰Callableæ¥å£ç±»å‹å‚æ•°ï¼ˆè¿™æ ·æ‰èƒ½æŠŠCallableæ¥å£çš„å®ç°ç±»çš„å¯¹è±¡ä¸¢è¿›æ¥ï¼‰ï¼›\næŸ¥çœ‹Jdkæ–‡æ¡£ä»¥åŠæŸ¥çœ‹ä¸­é—´ç±»çš„æºç å¾—çŸ¥ï¼ŒFutureTaskç±»å¯ä»¥åšè¿™ä¸ªä¸­é—´ç±»ï¼Œæ¥å®ŒæˆCallableæ¥å£çš„call()æ–¹æ³•è°ƒç”¨\næµ‹è¯•ä»£ç ï¼š\nimport java.util.concurrent.Callable; import java.util.concurrent.ExecutionException; import java.util.concurrent.FutureTask; import java.util.concurrent.TimeUnit; public class CallableTest { public static void main(String[] args) throws ExecutionException, InterruptedException { Callable callable = new MyCallable(); //æŠŠCallableå®ç°ç±»ä¼ ç»™FutureTaskç±» FutureTask futureTask = new FutureTask\u0026lt;\u0026gt;(callable); //å†æŠŠFutureTaskå¯¹è±¡ä¼ ç»™Threadç±»ï¼Œè°ƒç”¨start()æ–¹æ³•ï¼Œå¯åŠ¨çº¿ç¨‹ new Thread(futureTask,\u0026#34;callableçº¿ç¨‹\u0026#34;).start(); //æƒ³å¾—åˆ°call()æ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼ï¼Œå¯ä»¥è°ƒç”¨FutureTaskç±»çš„get()æ–¹æ³• String o = (String)futureTask.get(); System.out.println(o); } } /** * Callableæ¥å£çš„å®ç°ç±» */ class MyCallable implements Callable\u0026lt;String\u0026gt; { @Override public String call() throws Exception { System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;call()æ–¹æ³•è¢«è°ƒç”¨äº†\u0026#34;); TimeUnit.SECONDS.sleep(3); return \u0026#34;ok\u0026#34;; } } Lock ä¼ ç»Ÿçš„Synchronizedé”å®ç° public class LockTest { public static void main(String[] args) { Token token = new Token(); /** * å¼€å¯äº†ä¸‰ä¸ªçº¿ç¨‹å»å–ç¥¨ */ new Thread(()-\u0026gt;{ for (int i = 1; i \u0026lt;=300 ; i++) { token.sale(); } },\u0026#34;A\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 1; i \u0026lt;=300 ; i++) { token.sale(); } },\u0026#34;B\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 1; i \u0026lt;=300 ; i++) { token.sale(); } },\u0026#34;C\u0026#34;).start(); } } class Token{ //èµ„æºç±» private int ticket=300; //æ€»ç¥¨æ•° public synchronized void sale(){ if (ticket\u0026gt;0){ ticket--; System.out.println(Thread.currentThread().getName()+\u0026#34;å–äº†ä¸€å¼ ç¥¨ï¼Œå½“å‰è¿˜æœ‰\u0026#34;+ ticket + \u0026#34;ç¥¨\u0026#34;); } } } Locké”å®ç° import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; public class LockTest { public static void main(String[] args) { Token token = new Token(); /** * åˆ©ç”¨locké” * å¼€å¯äº†ä¸‰ä¸ªçº¿ç¨‹å»å–ç¥¨ */ new Thread(()-\u0026gt;{ for (int i = 1; i \u0026lt;=300 ; i++) { token.sale(); } },\u0026#34;A\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 1; i \u0026lt;=300 ; i++) { token.sale(); } },\u0026#34;B\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 1; i \u0026lt;=300 ; i++) { token.sale(); } },\u0026#34;C\u0026#34;).start(); } } class Token{ //èµ„æºç±» Lock lock = new ReentrantLock(); private int ticket=300; //æ€»ç¥¨æ•° public void sale(){ try { lock.lock(); if (ticket\u0026gt;0){ ticket--; System.out.println(Thread.currentThread().getName()+\u0026#34;å–äº†ä¸€å¼ ç¥¨ï¼Œå½“å‰è¿˜æœ‰\u0026#34;+ ticket + \u0026#34;ç¥¨\u0026#34;); } } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } } Synchronized å’Œ Lock åŒºåˆ« synchronizedæ˜¯Javaçš„å…³é”®å­—ï¼Œè€ŒLockæ˜¯Javaçš„ä¸€ä¸ªç±» synchronizedæ˜¯è‡ªåŠ¨é‡Šæ”¾é”çš„ï¼ˆçº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œæ¯•ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹æ‰§è¡Œå‡ºç°å¼‚å¸¸ä¹Ÿä¼šé‡Šæ”¾é”ï¼‰ï¼Œè€ŒLockéœ€è¦åœ¨finallyæ‰‹åŠ¨é‡Šæ”¾é”ï¼ˆå³è°ƒç”¨unlock()æ–¹æ³•ï¼‰ï¼Œå¦åˆ™æˆ–é€ æˆæ­»é” ç”¨synchronizedå…³é”®å­—çš„ä¸¤ä¸ªçº¿ç¨‹1å’Œçº¿ç¨‹2ï¼Œå¦‚æœå½“å‰çº¿ç¨‹1è·å¾—é”ï¼Œçº¿ç¨‹2çº¿ç¨‹ç­‰å¾…ã€‚å¦‚æœçº¿ç¨‹1 é˜»å¡ï¼Œçº¿ç¨‹2åˆ™ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè€ŒLocké”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹å»ï¼Œå¦‚æœå°è¯•è·å–ä¸åˆ°é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…å°±ç»“æŸäº†ï¼› synchronizedçš„é”å¯é‡å…¥ã€ä¸å¯ä¸­æ–­ã€éå…¬å¹³ï¼Œè€ŒLocké”å¯é‡å…¥ã€å¯åˆ¤æ–­ã€å¯å…¬å¹³ä¹Ÿå¯éå…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰ Locké”é€‚åˆå¤§é‡åŒæ­¥çš„ä»£ç çš„åŒæ­¥é—®é¢˜ï¼Œsynchronizedé”é€‚åˆä»£ç å°‘é‡çš„åŒæ­¥é—®é¢˜ ç”Ÿäº§è€…æ¶ˆè´¹è€… ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… synchroinzed ç‰ˆ /** * ç°åœ¨å››ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ“ä½œåˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡ * å®ç°ä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ + 1ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ -1 * å®ç°äº¤æ›¿30æ¬¡ */ public class ProducerAndConsumer_syn { public static void main(String[] args) { Data1 data = new Data1(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;30 ; i++) { data.consumer(); } },\u0026#34;A\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;30 ; i++) { data.producer(); } },\u0026#34;B\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;30 ; i++) { data.consumer(); } },\u0026#34;C\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;30 ; i++) { data.producer(); } },\u0026#34;D\u0026#34;).start(); } } class Data1{ private int number = 0; public synchronized void producer(){ // if (number!=0){ //ç”¨ifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ while (number!=0){\t//å¦‚æœä¸º1ï¼Œåˆ™ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ try { this.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } number++; System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;\u0026#34;+number); this.notifyAll(); } public synchronized void consumer(){ // if (number==0){ //ç”¨ifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ while (number==0){\t//å¦‚æœä¸º0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ try { this.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } number--; System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;\u0026#34;+number); this.notifyAll(); } } å…³äºè™šå‡å”¤é†’\nå› ä¸ºifåªä¼šåˆ¤æ–­ä¸€æ¬¡ï¼Œå½“å…¶å®ƒçº¿ç¨‹å”¤é†’ç­‰å¾…çº¿ç¨‹æ—¶ï¼Œåœ¨åœç•™åœ¨ifä½œç”¨åŸŸçš„çº¿ç¨‹è¢«å”¤é†’ï¼Œä¸ä¼šå†æ¬¡åˆ¤æ–­ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™ç§æƒ…å†µä¼šå¼•èµ·è™šå‡å”¤é†’ç°è±¡ï¼Œå³æ²¡æœ‰æ»¡è¶³å”¤é†’æ¡ä»¶ä¹Ÿä¼šè¢«å”¤é†’ï¼Œæ‰€ä»¥æ”¹ç”¨whileå¾ªç¯ï¼Œé‡å¤åˆ¤æ–­ï¼Œä»¥é˜²è„±ç¦»åˆ¤æ–­æ¡ä»¶\næ–°ç‰ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å†™æ³•ï¼ˆLockç‰ˆï¼‰ import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; /** * ç°åœ¨å››ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ“ä½œåˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡ * å®ç°ä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ + 1ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ -1 * å®ç°äº¤æ›¿10æ¬¡ */ public class ProducerAndConsumer_Lock { public static void main(String[] args) { Data2 data = new Data2(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;10 ; i++) { data.consumer(); } },\u0026#34;A\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;10 ; i++) { data.producer(); } },\u0026#34;B\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;10 ; i++) { data.consumer(); } },\u0026#34;C\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt;10 ; i++) { data.producer(); } },\u0026#34;D\u0026#34;).start(); } } class Data2{ private int number = 0; Lock lock =new ReentrantLock(); Condition condition =lock.newCondition(); public void producer(){ lock.lock(); try { while (number!=0){ //å¦‚æœä¸º1ï¼Œåˆ™ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ condition.await();\t//è®©çº¿ç¨‹ç­‰å¾… } number++; System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;\u0026#34;+number); condition.signalAll(); } catch (Exception e) { e.printStackTrace();\t//å”¤é†’å…¶å®ƒçº¿ç¨‹ï¼ˆå³å”¤é†’æ¶ˆè´¹è€…çº¿ç¨‹ï¼‰ } finally { lock.unlock(); } } public void consumer(){ lock.lock(); try { while (number==0){ //å¦‚æœä¸º0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ condition.await();\t//è®©çº¿ç¨‹ç­‰å¾… } number--; System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;\u0026#34;+number); condition.signalAll();\t//å”¤é†’å…¶å®ƒçº¿ç¨‹ï¼ˆå³å”¤é†’ç”Ÿäº§è€…çº¿ç¨‹ï¼‰ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } } LockæŒ‡å®šé€šçŸ¥é¡ºåºå”¤é†’è®¿é—® import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; /** * å¤šçº¿ç¨‹ä¹‹é—´æŒ‰é¡ºåºè°ƒç”¨ï¼Œå®ç° A-\u0026gt;B-\u0026gt;C * ä¸‰ä¸ªçº¿ç¨‹å¯åŠ¨ï¼ŒÂ * A æ‰“å°10æ¬¡ï¼ŒB æ‰“å°10æ¬¡,C æ‰“å°10æ¬¡ï¼Œä¾æ¬¡å¾ªç¯ */ public class Lock_Condition { public static void main(String[] args) { Data3 data3 = new Data3(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt; 10; i++) { data3.A(); } },\u0026#34;AAA\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt; 10; i++) { data3.B(); } },\u0026#34;BBB\u0026#34;).start(); new Thread(()-\u0026gt;{ for (int i = 0; i \u0026lt; 10; i++) { data3.C(); } },\u0026#34;CCC\u0026#34;).start(); } } class Data3{ private int number = 1 ; Lock lock = new ReentrantLock(); Condition condition1 = lock.newCondition(); Condition condition2 = lock.newCondition(); Condition condition3 = lock.newCondition(); public void A() { lock.lock(); try { while (number !=1){\t//å¦‚æœä¸ä¸º1ï¼Œåˆ™çº¿ç¨‹ç­‰å¾… condition1.await(); } number = 2; System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;AAA\u0026#34;); condition2.signal();\t//å”¤é†’Bçº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º2çš„ } catch (InterruptedException e) { e.printStackTrace(); } finally { lock.unlock(); } } public void B(){ lock.lock(); try { while (number != 2){\t//å¦‚æœä¸ä¸º2ï¼Œåˆ™çº¿ç¨‹ç­‰å¾… condition2.await(); } number = 3; System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;BBB\u0026#34;); condition3.signal(); //å”¤é†’Cçº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º3çš„ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } public void C(){ lock.lock(); try { while (number!=3){\t//å¦‚æœä¸ä¸º3ï¼Œåˆ™çº¿ç¨‹ç­‰å¾… condition3.await(); } number = 1; System.out.println(Thread.currentThread().getName()+\u0026#34;===\u0026gt;CCC\u0026#34;); condition1.signal();//å”¤é†’Açº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º1çš„ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } } é›†åˆç±»ä¸å®‰å…¨ List å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\nå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\nimport java.util.*; import java.util.concurrent.CopyOnWriteArrayList; /** * å› ä¸ºå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œlistæ˜¯ä¸å®‰å…¨çš„ * add()æ–¹æ³•æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¼šæŠ›java.util.ConcurrentModificationExceptionå¼‚å¸¸ * è§£å†³æ–¹æ¡ˆï¼Œæ¢ä¸€ä¸ªé›†åˆç±» * 1ã€List\u0026lt;String\u0026gt; list = new Vector\u0026lt;\u0026gt;(); JDK1.0å°±å­˜åœ¨äº† * 2ã€List\u0026lt;String\u0026gt; list = Collections.synchronizedList(new ArrayList\u0026lt;\u0026gt;()); é€šè¿‡é›†åˆå·¥å…·ç±»è½¬æ¢å¾—åˆ°ä¸€ä¸ªå®‰å…¨ç±» * 3ã€List\u0026lt;String\u0026gt; list = new CopyOnWriteArrayList\u0026lt;\u0026gt;(); JUCåŒ…ä¸‹æä¾›çš„ä¸€ä¸ªç±»ï¼Œå†™å…¥æ—¶å¤åˆ¶ */ public class ListTest03 { public static void main(String[] args) { List\u0026lt;String\u0026gt; list = new CopyOnWriteArrayList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; 30; i++) { new Thread(()-\u0026gt;{ list.add(UUID.randomUUID().toString().substring(0,8)); System.out.println(list); }).start(); } } } å†™å…¥æ—¶å¤åˆ¶ï¼ˆCopyOnWriteï¼‰æ€æƒ³\nå†™å…¥æ—¶å¤åˆ¶ï¼ˆCopyOnWriteï¼Œç®€ç§°COWï¼‰æ€æƒ³æ˜¯è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸä¸­çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³ æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…ï¼ˆCallersï¼‰åŒæ—¶è¦æ±‚ç›¸åŒçš„èµ„æºï¼ˆå¦‚å†…å­˜æˆ–è€…æ˜¯ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…± åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è§†å›¾ä¿®æ”¹èµ„æºå†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨ å‰¯æœ¬ï¼ˆprivate copyï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™è¿‡ç¨‹å¯¹å…¶ä»–çš„ è°ƒç”¨è€…éƒ½æ˜¯é€æ˜çš„ï¼ˆtransparentlyï¼‰ã€‚æ­¤åšæ³•ä¸»è¦çš„ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ ï¼ˆprivate copyï¼‰è¢«åˆ›å»ºï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚ è¯»å†™åˆ†ç¦»ï¼Œå†™æ—¶å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå®Œæˆæ’å…¥ã€ä¿®æ”¹æˆ–è€…ç§»é™¤æ“ä½œåå°†æ–°æ•°ç»„èµ‹å€¼ç»™array\nCopyOnWriteArrayListä¸ºä»€ä¹ˆå¹¶å‘å®‰å…¨ä¸”æ€§èƒ½æ¯”Vectorå¥½\næˆ‘çŸ¥é“Vectoræ˜¯å¢åˆ æ”¹æŸ¥æ–¹æ³•éƒ½åŠ äº†synchronizedï¼Œä¿è¯åŒæ­¥ï¼Œä½†æ˜¯æ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™éƒ½è¦å»è·å¾— é”ï¼Œæ€§èƒ½å°±ä¼šå¤§å¤§ä¸‹é™ï¼Œè€ŒCopyOnWriteArrayList åªæ˜¯åœ¨å¢åˆ æ”¹ä¸ŠåŠ é”ï¼Œä½†æ˜¯è¯»ä¸åŠ é”ï¼Œåœ¨è¯»æ–¹é¢çš„æ€§ èƒ½å°±å¥½äºVectorï¼ŒCopyOnWriteArrayListæ”¯æŒè¯»å¤šå†™å°‘çš„å¹¶å‘æƒ…å†µã€‚\nSet å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\n/** * å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œsetæ˜¯ä¸å®‰å…¨çš„ * add()æ–¹æ³•æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¼šæŠ›java.util.ConcurrentModificationExceptionå¼‚å¸¸ * è§£å†³æ–¹æ¡ˆï¼Œæ¢ä¸€ä¸ªé›†åˆç±» * 1ã€Set\u0026lt;String\u0026gt; set = Collections.synchronizedSet(new HashSet\u0026lt;\u0026gt;()); é€šè¿‡é›†åˆå·¥å…·ç±»è½¬æ¢å¾—åˆ°ä¸€ä¸ªå®‰å…¨ç±» * 2ã€Set\u0026lt;String\u0026gt; set = new CopyOnWriteArraySet\u0026lt;\u0026gt;(); JUCåŒ…ä¸‹æä¾›çš„ä¸€ä¸ªç±»ï¼Œå†™å…¥æ—¶å¤åˆ¶ */ public class SetTest02 { public static void main(String[] args) { Set\u0026lt;String\u0026gt; set = new CopyOnWriteArraySet\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; 30; i++) { set.add(UUID.randomUUID().toString().substring(0,8)); System.out.println(set); } } } å¦å¤–è¿˜æœ‰ä¸€ç‚¹ï¼ŒHashSetåº•å±‚å°±æ˜¯HashMapï¼ŒJDKæºç å¦‚ä¸‹ï¼š\né€šè¿‡æºç å¯ä»¥çœ‹å‡ºï¼ŒHashSetåº•å±‚æ˜¯åˆ›å»ºäº†ä¸€ä¸ªHashMapï¼ŒKeyå°±æ˜¯å­˜æ”¾HashSetçš„å€¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡HashMapçš„keyæœºåˆ¶ï¼Œæ¥å»é™¤é‡å¤å€¼çš„ï¼Œè€Œkeyå¯¹åº”çš„valueå°±æ˜¯ä¸€ä¸ªå«PRESENTçš„å¸¸é‡\nMap HashMapåº•å±‚å°±æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ˆJDK1.8å¼€å§‹ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äº8æ—¶ï¼Œé“¾è¡¨è‡ªåŠ¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ˜¯ä¸ºæŸ¥è¯¢å€¼æ—¶åšçš„ä¸€ä¸ªä¼˜åŒ–ï¼‰\nä»JDK1.8æºç å¯ä»¥çœ‹å‡ºï¼Œåœ¨åˆ›å»ºæ—¶HashMapå¯ä»¥æŒ‡å®šå®ƒçš„é•¿åº¦ï¼ˆå³å®¹é‡ï¼‰å’ŒåŠ è½½å› å­ï¼Œå¦åˆ™å°±æ˜¯é»˜è®¤çš„16é•¿åº¦å’Œ0.75åŠ è½½å› å­\rå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\nimport java.util.Map; import java.util.UUID; import java.util.concurrent.ConcurrentHashMap; public class HashMapTest02 { public static void main(String[] args) { /** *å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒmapåŒæ ·æ˜¯ä¸å®‰å…¨çš„ * putæ–¹æ³•å¹¶æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¹ŸæŠ›å‡ºåŒæ ·çš„java.util.ConcurrentModificationExceptionå¼‚å¸¸ * è§£å†³åŠæ³•ï¼Œä¹Ÿæ˜¯æ¢ä¸€ä¸ªé›†åˆç±» * Map\u0026lt;String, String\u0026gt; map = new Hashtable\u0026lt;\u0026gt;(); JDK1.0å°±æœ‰ï¼Œæ•ˆç‡ä¸æ€ä¹ˆï¼Œå› ä¸ºå®ƒæ˜¯é”å…¨éƒ¨ * Map\u0026lt;String, String\u0026gt; map = Collections.synchronizedMap(new HashMap\u0026lt;\u0026gt;()); * Map\u0026lt;String, String\u0026gt; map = new ConcurrentHashMap\u0026lt;\u0026gt;(); */ Map\u0026lt;String, String\u0026gt; map = new ConcurrentHashMap\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; 30; i++) { new Thread(()-\u0026gt;{ map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(0,8)); System.out.println(map); },String.valueOf(i)).start(); } } } è¯»å†™é” å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»åŒä¸€ä¸ªèµ„æºç±»æ—¶ï¼Œæ˜¯ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯å®é™…æƒ…å†µå¾€å¾€æ˜¯è¯»å†™å¹¶å‘çš„ï¼Œä¹Ÿå°±è¯´è¯»å†™èµ„æºç±»æ˜¯åŒæ—¶è¿›è¡Œçš„ã€‚\nå¦‚æœèµ„æºç±»ä¸è¿›è¡ŒåŠ é”çš„è¯ï¼Œä¼šäº§ç”Ÿé”™è¯¯ï¼š\nå‘ç°å†™å…¥æ—¶ï¼Œæœªå®Œæˆå†™å…¥ï¼Œå°±æœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿè¿›è¡Œå†™å…¥ï¼Œè¿™ç§æ˜¯ä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜çš„\nReentrantReadWriteLock(è¯»å†™é”) import java.util.HashMap; import java.util.Map; import java.util.UUID; import java.util.concurrent.locks.ReadWriteLock; import java.util.concurrent.locks.ReentrantReadWriteLock; public class ReentrantReadWriteTest02 { public static void main(String[] args) { MyCacheLock myCacheLock = new MyCacheLock(); //å¼€å¯10ä¸ªçº¿ç¨‹å»å†™ for (int i = 0; i \u0026lt; 10; i++) { final int temp = i; new Thread(()-\u0026gt;{ myCacheLock.put(temp+\u0026#34;\u0026#34;, UUID.randomUUID().toString().substring(0,5)); },\u0026#34;å†™\u0026#34;+i).start(); } //å¼€å¯10ä¸ªçº¿ç¨‹å»è¯» for (int i = 0; i \u0026lt; 10; i++) { final int temp = i; new Thread(()-\u0026gt;{ myCacheLock.get(temp+\u0026#34;\u0026#34;); },\u0026#34;è¯»\u0026#34;+i).start(); } } } class MyCacheLock{ private volatile Map\u0026lt;String, String\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); private ReadWriteLock readWriteLock = new ReentrantReadWriteLock(); //è¯»å†™é” public void put(String key , String value){ readWriteLock.writeLock().lock(); //åŠ å†™é” try { System.out.println(Thread.currentThread().getName()+\u0026#34;å·çº¿ç¨‹==ã€‹Keyå€¼ï¼š\u0026#34;+ key +\u0026#34; å¼€å§‹å†™å…¥\u0026#34;); map.put(key,value); System.out.println(Thread.currentThread().getName()+\u0026#34;å·çº¿ç¨‹==ã€‹å†™å…¥æˆåŠŸ\u0026#34;); } catch (Exception e) { e.printStackTrace(); } finally { readWriteLock.writeLock().unlock(); } } public void get(String key){ readWriteLock.readLock().lock(); //åŠ è¯»é” try { System.out.println(Thread.currentThread().getName()+\u0026#34;å·çº¿ç¨‹å¼€å§‹è¯»å–Keyå€¼å¯¹åº”çš„valueå€¼\u0026#34;); String result = map.get(key); System.out.println(Thread.currentThread().getName()+\u0026#34;è¯»å–ç»“æœï¼š\u0026#34;+result); } catch (Exception e) { e.printStackTrace(); } finally { readWriteLock.readLock().unlock(); } } } çº¿ç¨‹æ±  JDKå®˜æ–¹æä¾›ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³• çº¿ç¨‹æ± ä¸­åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ newSingleThreadExecutor() import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class ThreadPoolTest01 { public static void main(String[] args) { //newSingleThreadExecutoråˆ›å»ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ ExecutorService threadpool = Executors.newSingleThreadExecutor(); try { for (int i = 0; i \u0026lt; 10; i++) { //åªæœ‰ä¸€ä¸ªçº¿ç¨‹å—ç†ï¼Œæ¥æ‰§è¡Œ10ä¸ªä»»åŠ¡ threadpool.execute(()-\u0026gt;{ System.out.println(Thread.currentThread().getName()+\u0026#34;æ‰§è¡Œä¸šåŠ¡\u0026#34;); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadpool.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } çº¿ç¨‹æ± ä¸­åˆ›å»ºå›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newFixedThreadPoolï¼ˆï¼‰ import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class ThreadPoolTest02 { public static void main(String[] args) { //çº¿ç¨‹æ± ä¸­åˆ›å»º5ä¸ªçº¿ç¨‹ ExecutorService threadPool = Executors.newFixedThreadPool(5); try { for (int i = 0; i \u0026lt; 20; i++) { //åªæœ‰äº”ä¸ªçº¿ç¨‹æ¥å—ç†ï¼Œæ¥æ‰§è¡Œ20ä¸ªä»»åŠ¡ threadPool.execute(()-\u0026gt;{ System.out.println(Thread.currentThread().getName()+\u0026#34;æ‰§è¡Œä¸šåŠ¡\u0026#34;); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadPool.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸å›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newCachedThreadPool() import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class ThreadPoolTest03 { public static void main(String[] args) { //åˆ›å»ºçº¿ç¨‹æ± ï¼Œæ± ä¸­çº¿ç¨‹æ•°æ˜¯ä¸å›ºå®šçš„ï¼Œçº¿ç¨‹å…·ä½“æ˜¯ä¼¸ç¼©çš„ ExecutorService threadPool = Executors.newCachedThreadPool(); try { for (int i = 0; i \u0026lt; 20 ; i++) { //æœ‰Nä¸ªçº¿ç¨‹å—ç†ï¼Œæ¥æ‰§è¡Œ20ä¸ªä»»åŠ¡ threadPool.execute(()-\u0026gt;{ System.out.println(Thread.currentThread().getName()+\u0026#34;æ‰§è¡Œä¸šåŠ¡\u0026#34;); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadPool.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } è‡ªå®šä¹‰çº¿ç¨‹æ±  ThreadPoolExecutor() é€šè¿‡æŸ¥çœ‹JDKæºç ï¼Œå‘ç°ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•éƒ½æ˜¯è°ƒç”¨äº†new ThreadPoolExecutor(ä¸ƒä¸ªå‚æ•°)\nä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± æ–¹æ³•æºç å¦‚ä¸‹ï¼š\næŸ¥çœ‹ThreadPoolExecutor()æ–¹æ³•æºç å¦‚ä¸‹ï¼š\rå‘ç°è¯¥æ–¹æ³•æœ‰ä¸ƒä¸ªå‚æ•°\nint corePoolSize ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€‚å½“åˆ›å»ºçº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°æ˜¯ä¸º0çš„ï¼Œå½“æœ‰ä»»åŠ¡è¿›æ¥æ—¶ï¼Œæ‰å¼€å§‹åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè€Œçº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œä¼šç»´æŠ¤ä¸€ä¸ªæœ€å°çº¿ç¨‹æ•°é‡ï¼Œå³ä½¿è¿™äº›çº¿ç¨‹æ•°æ˜¯ç©ºé—²çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šé”€æ¯å®ƒä»¬ï¼Œé™¤éè®¾ç½®äº†allowCoreThreadTimeOutï¼Œè€Œè¿™ä¸ªæœ€å°çº¿ç¨‹æ•°å°±æ˜¯corePoolSize\n**int maximumPoolSize ï¼š**æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚çº¿ç¨‹æ± ä¸ä¼šæ— é™åˆ¶çš„å»åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå®ƒä¼šæœ‰ä¸€ä¸ªæœ€å¤§çº¿ç¨‹æ•°é‡çš„é™åˆ¶ï¼Œè¿™ä¸ªæ•°é‡å³ç”±maximunPoolSizeæ¥æŒ‡å®š\nlong keepAliveTime ï¼šçº¿ç¨‹ä¿ç•™çš„æ—¶é—´ã€‚ä¸€ä¸ªçº¿ç¨‹å¦‚æœå¤„äºç©ºé—²çŠ¶æ€ï¼Œå¹¶ä¸”å½“å‰çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeï¼Œé‚£ä¹ˆåœ¨æŒ‡å®šæ—¶é—´åï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ï¼Œè¿™é‡Œçš„æŒ‡å®šæ—¶é—´ç”±keepAliveTimeæ¥è®¾å®š\n**TimeUnit unit ï¼š ** keepAliveTimeçš„è®¡é‡å•ä½\nTimeUnit.DAYS; //å¤© TimeUnit.HOURS; //å°æ—¶ TimeUnit.MINUTES; //åˆ†é’Ÿ TimeUnit.SECONDS; //ç§’ TimeUnit.MILLISECONDS; //æ¯«ç§’ TimeUnit.MICROSECONDS; //å¾®å¦™ TimeUnit.NANOSECONDS; //çº³ç§’ **BlockingQueue\u0026lt; Runnable \u0026gt; workQueue ï¼š**é˜»å¡é˜Ÿåˆ—ï¼Œå­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚\næ–°ä»»åŠ¡è¢«æäº¤åï¼Œä¼šå…ˆè¿›å…¥åˆ°æ­¤å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡è°ƒåº¦æ—¶å†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ã€‚jdkä¸­æä¾›äº†å››ç§å·¥ä½œé˜Ÿåˆ—ï¼š\nArrayBlockingQueue\nåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºã€‚æ–°ä»»åŠ¡è¿›æ¥åï¼Œä¼šæ”¾åˆ°è¯¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæœ‰ç•Œçš„æ•°ç»„å¯ä»¥é˜²æ­¢èµ„æºè€—å°½é—®é¢˜ã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡è¾¾åˆ°corePoolSizeåï¼Œå†æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œåˆ™ä¼šå°†ä»»åŠ¡æ”¾å…¥è¯¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…è¢«è°ƒåº¦ã€‚å¦‚æœé˜Ÿåˆ—å·²ç»æ˜¯æ»¡çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°maxPoolSizeï¼Œåˆ™ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\nLinkedBlockingQuene\nåŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼ˆå…¶å®æœ€å¤§å®¹é‡ä¸ºInterger.MAXï¼‰ï¼ŒæŒ‰ç…§FIFOæ’åºã€‚ç”±äºè¯¥é˜Ÿåˆ—çš„è¿‘ä¼¼æ— ç•Œæ€§ï¼Œå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡è¾¾åˆ°corePoolSizeåï¼Œå†æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œä¼šä¸€ç›´å­˜å…¥è¯¥é˜Ÿåˆ—ï¼Œè€Œä¸ä¼šå»åˆ›å»ºæ–°çº¿ç¨‹ç›´åˆ°maxPoolSizeï¼Œå› æ­¤ä½¿ç”¨è¯¥å·¥ä½œé˜Ÿåˆ—æ—¶ï¼Œå‚æ•°maxPoolSizeå…¶å®æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚\nSynchronousQuene\nä¸€ä¸ªä¸ç¼“å­˜ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ”¾å…¥ä¸€ä¸ªä»»åŠ¡å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…å–å‡ºè¿™ä¸ªä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´æ–°ä»»åŠ¡è¿›æ¥æ—¶ï¼Œä¸ä¼šç¼“å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¢«è°ƒåº¦æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¾¾åˆ°maxPoolSizeï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\nPriorityBlockingQueue\nå…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é€šè¿‡å‚æ•°Comparatorå®ç°ã€‚\n**ThreadFactory threadFactory ï¼š**çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯ã€‚å¯ä»¥ç”¨æ¥è®¾å®šçº¿ç¨‹åç­‰ç­‰\nRejectedExecutionHandler handler ï¼š æ‹’ç»ç­–ç•¥ï¼Œé˜Ÿåˆ—å·²æ»¡ï¼Œè€Œä¸”ä»»åŠ¡é‡å¤§äºå¤§çº¿ç¨‹çš„å¼‚å¸¸å¤„ç†ç­–ç•¥\nThreadPoolExecutor.AbortPolicy; //ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardPolicyï¼š//ä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardOldestPolicyï¼š//æŠ›å¼ƒè¿›å…¥é˜Ÿåˆ—æœ€æ—©çš„é‚£ä¸ªä»»åŠ¡ï¼Œç„¶åå°è¯•æŠŠè¿™æ¬¡æ‹’ç»çš„ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ ThreadPoolExecutor.CallerRunsPolicyï¼š//ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ ä¸¾ä¾‹è®°å¿† ï¼Œé“¶è¡Œçª—å£åŠç†ä¸šåŠ¡çš„è¿‡ç¨‹éå¸¸é€‚åˆç†è§£è¿™ä¸ƒä¸ªå‚æ•°\næµ‹è¯•ï¼š\nimport java.util.concurrent.*; public class MyThreadPoolTest { public static void main(String[] args) { /** * åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹æ±  */ ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor( 4, 8, 30L, TimeUnit.SECONDS, new LinkedBlockingDeque\u0026lt;\u0026gt;(6), Executors.defaultThreadFactory(), new ThreadPoolExecutor.DiscardOldestPolicy()); try { for (int i = 0; i \u0026lt; 10; i++) { threadPoolExecutor.execute(()-\u0026gt;{ System.out.println(Thread.currentThread().getName()+\u0026#34;æ‰§è¡Œä¸šåŠ¡\u0026#34;); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadPoolExecutor.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } è‡ªå®šä¹‰çº¿ç¨‹æ± æœ€å¤§å®¹é‡ä¸ºï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSize ï¼‰ + é˜»å¡é˜Ÿåˆ—å®¹é‡(workQueue)\nJUCçš„å¸¸ç”¨ç±» Semaphoreç±»ï¼ˆä¿¡å·é‡ï¼‰ import java.util.concurrent.Semaphore; import java.util.concurrent.TimeUnit; public class SemaphoreTest { /** * ä¸‰ä¸ªè½¦ä½ï¼Œä¹ä¸ªäººå»æŠ¢ * æ ¹æ®jucçš„è¾…åŠ©ç±»Semaphoreé™æµå®ç° * @param args */ public static void main(String[] args) { //è§„å®šåªèƒ½è¿›å»ä¸‰ä¸ª Semaphore semaphore = new Semaphore(3); for (int i = 0; i \u0026lt;9 ; i++) { //å¼€å¯ä¹ä¸ªçº¿ç¨‹å»æŠ¢ä¸‰ä¸ªè½¦ä½ new Thread(()-\u0026gt;{ try { semaphore.acquire();//å¾—åˆ° System.out.println(Thread.currentThread().getName()+\u0026#34;å¾—åˆ°åœè½¦ä½\u0026#34;); TimeUnit.SECONDS.sleep(3); //åœäº†ä¸‰ç§’ï¼Œç„¶åç¦»å¼€è½¦ä½ï¼Œç•™ç»™åé¢çš„äººè¿›æ¥ System.out.println(Thread.currentThread().getName()+\u0026#34;ç¦»å¼€åœè½¦ä½\u0026#34;); } catch (InterruptedException e) { e.printStackTrace(); }finally { semaphore.release();//é‡Šæ”¾ } },String.valueOf(i)).start(); } } } åœ¨ä¸Šè¿°æµ‹è¯•ä¸­ï¼Œsemaphoreå®šä¹‰äº†ä¸¤ä¸ªæ“ä½œ\nacquireï¼ˆè·å–ï¼‰\nå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨acquire()æ–¹æ³•æ“ä½œæ—¶\nå½“å‰çº¿ç¨‹è¦ä¹ˆæˆåŠŸè·å–åˆ°ä¿¡å·é‡ï¼ˆå³ä¿¡å·é‡-1ï¼Œè¢«å äº†ä¸€ä¸ªï¼‰ è¦ä¹ˆç­‰å¾…å…¶å®ƒçº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è€…ä¸€ç›´ç­‰å¾…åˆ°è¶…æ—¶ releaseï¼ˆé‡Šæ”¾ï¼‰\nå½“çº¿ç¨‹è°ƒç”¨release()æ–¹æ³•æ—¶ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾ä¿¡å·é‡ï¼ˆå³ä¿¡å·é‡+1ï¼‰ï¼Œä»¥ä¾¿å…¶å®ƒç­‰å¾…çš„çº¿ç¨‹æ‹¿åˆ°ä¿¡å·é‡\nCountDowLathç±»ï¼ˆå€’è®¡æ—¶è®°æ•°å™¨ï¼‰ import java.util.concurrent.CountDownLatch; public class CountDownLatchTest { public static void main(String[] args) throws InterruptedException { CountDownLatch countDownLatch = new CountDownLatch(5); for (int i = 0; i \u0026lt; 6; i++) { new Thread(()-\u0026gt;{ countDownLatch.countDown();//è®¡æ•°å‡ä¸€ System.out.println(Thread.currentThread().getName()+\u0026#34;çº¿ç¨‹æ‰§è¡Œå®Œæˆ\u0026#34;); },String.valueOf(i)).start(); } countDownLatch.await(); //å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…è®¡æ•°å™¨å½’é›¶ System.out.println(Thread.currentThread().getName()+\u0026#34;END\u0026#34;); } } åœ¨ä¸Šè¿°æµ‹è¯•ä¸­ï¼Œcountdowlathç±»æœ‰ä¸¤ä¸ªæ–¹æ³•\ncountDown()\nå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨countDown()æ–¹æ³•æ—¶ï¼Œè®¡æ•°å™¨ä¼šå‡1ï¼Œä¸”çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡\nawait()\nå½“ä¸€ä¸ªçº¿ç¨‹æˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨await()æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’é›¶ï¼Œé˜»å¡çš„çº¿ç¨‹æ‰ä¼šé‡æ–°è¢«å”¤é†’ç»§ç»­å¾€ä¸‹æ‰§è¡Œ\nä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œå…¶å®ƒå­çº¿ç¨‹è°ƒç”¨countDown()å¹¶æ²¡æœ‰è¢«é˜»å¡è€Œæ˜¯ç»§ç»­æ‰§è¡Œç›´è‡³å®Œæ¯•ï¼Œä½†è°ƒç”¨await()æ–¹æ³•çš„mainä¸»çº¿å´è¢«é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’é›¶æ‰é‡æ–°æ‰§è¡Œ\nCyclicBarrierç±» import java.util.concurrent.BrokenBarrierException; import java.util.concurrent.CyclicBarrier; public class CyclicBarrierTest { public static void main(String[] args) { CyclicBarrier cyclicBarrier = new CyclicBarrier(7,()-\u0026gt;{ System.out.println(\u0026#34;å‡ºæ¥å§ï¼ç¥é¾™\u0026#34;); }); for (int i = 1; i \u0026lt;= 7; i++) { final int temp = i; //JDK1.8ä¹‹å‰è¦ç”¨finalä¿®é¥° new Thread(()-\u0026gt;{ System.out.println(Thread.currentThread().getName()+\u0026#34;çº¿ç¨‹==ã€‹å¾—åˆ°äº†ç¬¬\u0026#34;+ temp +\u0026#34;é¢—é¾™ç \u0026#34;); try { cyclicBarrier.await(); //è®©çº¿ç¨‹ç­‰å¾… } catch (InterruptedException e) { e.printStackTrace(); } catch (BrokenBarrierException e) { e.printStackTrace(); } System.out.println(); },String.valueOf(i)).start(); } } } CyclicBarrierä¸ä¸Šé¢è®¡æ•°å™¨(CountDowLath)ä½œç”¨ç›¸åï¼Œå½“ç­‰å¾…çº¿ç¨‹è¾¾åˆ°æŒ‡å®šæ•°ç›®ï¼Œåˆ™é‡Šæ”¾ç­‰å¾…çš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å†…å®¹ï¼Œè­¬å¦‚ä¸Šè¿°æµ‹è¯•ï¼Œé›†é½ä¸ƒé¢—é¾™ç å¬å”¤ç¥é¾™\n","permalink":"http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/","summary":"Javaé” ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚ å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹","title":"Javaå¤šçº¿ç¨‹ç¬”è®°"},{"content":"Explainè¯¦è§£ explainå‡ºæ¥çš„ä¿¡æ¯æœ‰10åˆ—ï¼Œåˆ†åˆ«æ˜¯idã€select_typeã€tableã€typeã€possible_keysã€keyã€key_lenã€refã€rowsã€Extra\nid selcetæŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–æ“ä½œè¡¨çš„é¡ºåºï¼Œå¤§æ¦‚åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š\nidç›¸åŒæ—¶ï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ idä¸åŒæ—¶ï¼Œå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œidçš„åºå·ä¼šé€’å¢ï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ idç›¸åŒåˆä¸ç›¸åŒï¼ŒåŒæ—¶å­˜åœ¨ idå¦‚æœç›¸åŒï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œï¼›åœ¨æ‰€æœ‰ç»„ä¸­ï¼Œidå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ select_type æŸ¥è¯¢çš„ç±»å‹ï¼Œä¸»è¦ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰çš„å¤æ‚æŸ¥è¯¢ï¼Œç±»å‹å¤§æ¦‚ä¸ºï¼š\nSIMPLE\nç®€å•çš„selectæŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥è¯¢è¯­å¥ä¸ä½¿ç”¨UNIONæˆ–å­æŸ¥è¯¢\nPRIMARY\næŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†,æœ€å¤–å±‚çš„selectè¢«æ ‡è®°ä¸ºPRIMARY\nSUBQUERY\nåœ¨selectæˆ–whereåˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢\nDERIVED\nåœ¨fromåˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸ºDERIVED(è¡ç”Ÿè¡¨)ï¼ŒMySQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨é‡Œã€‚\nUNION\nè‹¥ç¬¬äºŒä¸ªselectå‡ºç°åœ¨UNIONä¹‹åï¼Œä¼šè¢«æ ‡è®°ä¸ºUNIONï¼›è‹¥UNIONåŒ…å«åœ¨fromå­å¥çš„å­æŸ¥è¯¢ä¸­ï¼Œå¤–å±‚selectå°†è¢«æ ‡è®°ä¸ºï¼šDERIVED\n**UNION RESULT **\nUNIONçš„ç»“æœ\ntable æ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„ï¼Œæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åå­—,çœ‹åˆ°çš„æ˜¯derivedx(xæ˜¯ä¸ªæ•°å­—,æˆ‘çš„ç†è§£æ˜¯ç¬¬å‡ æ­¥æ‰§è¡Œçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯idæ•°)\nè­¬å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š\nmysql\u0026gt; explain select * from (select * from ( select * from t1 where id=2602) a) b; +----+-------------+------------+--------+-------------------+---------+---------+------+------+-------+ | id | select_type | table | type | possible_keys | key | key_len | ref | rows | Extra | +----+-------------+------------+--------+-------------------+---------+---------+------+------+-------+ | 1 | PRIMARY | \u0026lt;derived2\u0026gt; | system | NULL | NULL | NULL | NULL | 1 | | | 2 | DERIVED | \u0026lt;derived3\u0026gt; | system | NULL | NULL | NULL | NULL | 1 | | | 3 | DERIVED | t1 | const | PRIMARY,idx_t1_id | PRIMARY | 4 | | 1 | | +----+-------------+------------+--------+-------------------+---------+---------+------+------+-------+ type è¡¨ç¤ºMySQLåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ï¼Œåˆç§°â€œè®¿é—®ç±»å‹æ’åˆ—â€ã€‚\nå¸¸ç”¨çš„ç±»å‹æœ‰ï¼š ALL, index, range, ref, eq_ref, const, systemï¼ˆä»å·¦åˆ°å³ï¼Œæ€§èƒ½ä»å·®åˆ°å¥½ï¼‰\nå³ï¼šALL \u0026lt; index \u0026lt; range \u0026lt; ref \u0026lt; eq_ref \u0026lt; const \u0026lt; system\nä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ°ref\nALLï¼š Full Table Scanï¼Œ MySQLå°†éå†å…¨è¡¨ä»¥æ‰¾åˆ°åŒ¹é…çš„è¡Œ\nindexï¼š Full Index Scanï¼Œindexä¸ALLåŒºåˆ«ä¸ºindexç±»å‹åªéå†ç´¢å¼•æ ‘ã€‚è¿™é€šå¸¸æ¯”ALLå¿«ï¼Œå› ä¸ºç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ã€‚\nrangeï¼š åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚keyåˆ—æ˜¾ç¤ºä½¿ç”¨äº†å“ªä¸ªç´¢å¼•ï¼Œä¸€èˆ¬å°±æ˜¯åœ¨ä½ çš„whereè¯­å¥ä¸­å‡ºç°äº†betweenã€\u0026lt;ã€\u0026gt;ã€inç­‰çš„æŸ¥è¯¢ï¼Œè¿™ç§èŒƒå›´æ‰«æç´¢å¼•æ¯”å…¨è¡¨æ‰«æè¦å¥½ï¼Œå› ä¸ºå®ƒåªéœ€è¦å¼€å§‹äºç´¢å¼•çš„æŸä¸€ç‚¹ï¼Œè€Œç»“æŸè¯­å¦ä¸€ç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•\nrefï¼š éå”¯ä¸€æ€§ç´¢å¼•æ‰«æï¼Œè¿”å›åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›æ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œï¼Œå®ƒå¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥å®ƒåº”è¯¥å±äºæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“\neq_refï¼š ç±»ä¼¼refï¼ŒåŒºåˆ«å°±åœ¨ä½¿ç”¨çš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®å€¼ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•åŒ¹é…ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¤šè¡¨è¿æ¥ä¸­ä½¿ç”¨primary keyæˆ–è€… unique keyä½œä¸ºå…³è”æ¡ä»¶\nconstï¼š è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œconstç”¨äºæ¯”è¾ƒprimary keyæˆ–è€…uniqueç´¢å¼•ã€‚å› ä¸ºåªåŒ¹é…åˆ°ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å°±å¾ˆå¿«ã€‚å¦‚å°†ä¸»é”®ç½®äºwhereåˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡\nsystemï¼š æ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œå½“æŸ¥è¯¢çš„è¡¨åªæœ‰ä¸€è¡Œçš„æƒ…å†µä¸‹ï¼Œå¹³æ—¶ä¸ä¼šå‡ºç°ï¼Œè¿™ä¸ªå¯ä»¥å¿½ç•¥ä¸è®¡\npossible_keys æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨\nKey å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€‚æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å’ŒæŸ¥è¯¢çš„selectå­—æ®µé‡å \nkey_len è¡¨ç¤ºç´¢å¼•ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ã€‚\nkey_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„\nref æ˜¾ç¤ºç´¢å¼•å¾—å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼\nrows æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œå¤§è‡´ä¼°ç®—å‡ºæ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°\nExtra åŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯\nUsing filesortï¼š è¯´æ˜mysqlä¼šå¯¹æ•°æ®ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§è¡¨å†…çš„ç´¢å¼•é¡ºåºè¿›è¡Œè¯»å–ã€‚mysqlä¸­æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆçš„æ’åºæ“ä½œç§°ä¸ºâ€œæ–‡ä»¶æ’åºâ€\nUsing temporaryï¼š ä½¿ç”¨äº†ä¸´æ—¶è¡¨ä¿å­˜ä¸­é—´ç»“æœï¼Œmysqlåœ¨å¯¹æŸ¥è¯¢ç»“æœæ’åºæ—¶ä½¿ç”¨ä¸´æ—¶è¡¨ã€‚å¸¸è§äºæ’åºorder by å’Œåˆ†ç»„æŸ¥è¯¢ group by\nUsing index ï¼š è¡¨ç¤ºç›¸åº”çš„selectæ“ä½œä¸­ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰,é¿å…è®¿é—®äº†è¡¨çš„æ•°æ®è¡Œï¼Œæ•ˆç‡ä¸é”™ï¼å¦‚æœåŒæ—¶å‡ºç°using whereï¼Œè¡¨æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡Œç´¢å¼•é”®å€¼çš„æŸ¥æ‰¾ï¼›å¦‚æœæ²¡æœ‰åŒæ—¶å‡ºç°using whereï¼Œè¡¨æ˜ç´¢å¼•ç”¨æ¥è¯»å–æ•°æ®è€Œéæ‰§è¡ŒæŸ¥æ‰¾åŠ¨ä½œã€‚\nUsing whereï¼š è¡¨æ˜ä½¿ç”¨äº†whereè¿‡æ»¤\nUsing join bufferï¼š ä½¿ç”¨äº†è¿æ¥ç¼“å­˜\nimpossible whereï¼š whereå­å¥çš„å€¼æ€»æ˜¯falseï¼Œä¸èƒ½ç”¨æ¥è·å–ä»»ä½•å…ƒç»„\nselect tables optimized awayï¼š\tåœ¨æ²¡æœ‰group by å­å¥çš„æƒ…å†µä¸‹ï¼ŒåŸºäºç´¢å¼•ä¼˜åŒ–min/maxæ“ä½œæˆ–è€…å¯¹äºMyISAM å­˜å‚¨å¼•æ“ä¼˜åŒ–count(*)æ“ä½œï¼Œä¸å¿…ç­‰åˆ°æ‰§è¡Œé˜¶æ®µå†è¿›è¡Œè®¡ç®—ï¼ŒæŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ç”Ÿäº§çš„é˜¶æ®µå³å®Œæˆä¼˜åŒ–\ndistinctï¼š ä¼˜åŒ–distinctæ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼å¾—åŠ¨ä½œ\n","permalink":"http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/mysql/mysql%E4%B9%8Bexplain/","summary":"Explainè¯¦è§£ explainå‡ºæ¥çš„ä¿¡æ¯æœ‰10åˆ—ï¼Œåˆ†åˆ«æ˜¯idã€select_typeã€tableã€typeã€possible_keysã€k","title":"Mysqlä¹‹Explainè¯¦è§£"}]