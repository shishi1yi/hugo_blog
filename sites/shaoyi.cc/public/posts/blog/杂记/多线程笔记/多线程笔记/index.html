<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Javaå¤šçº¿ç¨‹ç¬”è®° | Shaoyi&#39;s Blog</title>
<meta name="keywords" content="Java">
<meta name="description" content="Javaé” ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚ å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹">
<meta name="author" content="
ä½œè€…:&nbsp;shaoyi">
<link rel="canonical" href="http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.37d24beae69e19eaefae17128331e0c742dc95d41a9d6e00dc3901824ec08b75.css" integrity="sha256-N9JL6uaeGervrhcSgzHgx0LcldQanW4A3DkBgk7Ai3U=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://shaoyi.cc/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://shaoyi.cc/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://shaoyi.cc/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://shaoyi.cc/apple-touch-icon.png">
<link rel="mask-icon" href="http://shaoyi.cc/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Javaå¤šçº¿ç¨‹ç¬”è®°" />
<meta property="og:description" content="Javaé” ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚ å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-02T19:18:23&#43;08:00" />
<meta property="article:modified_time" content="2022-07-04T19:18:23&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Javaå¤šçº¿ç¨‹ç¬”è®°"/>
<meta name="twitter:description" content="Javaé” ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚ å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "http://shaoyi.cc/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“•æŠ€æœ¯",
      "item": "http://shaoyi.cc/posts/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Javaå¤šçº¿ç¨‹ç¬”è®°",
      "item": "http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Javaå¤šçº¿ç¨‹ç¬”è®°",
  "name": "Javaå¤šçº¿ç¨‹ç¬”è®°",
  "description": "Javaé” ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚ å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹",
  "keywords": [
    "Java"
  ],
  "articleBody": "Javaé” ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š\næŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚\nå…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š\nè¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚\nå…¬å¹³é”ï¼š\næ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼æ’é˜Ÿæ‰“é¥­ï¼Œå…ˆæ¥ååˆ°ã€‚\néå…¬å¹³é”ï¼š\næ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”ç°ç”³è¯·çš„çº¿ç¨‹ ä¼˜å…ˆè·å–é”ã€‚ä¸æ–­å°è¯•è·å–é”ï¼Œå¦‚æœå°è¯•å¤±è´¥å°±åƒå…¬å¹³é”ä¸€æ ·ç­‰ç€ã€‚\nReentrantLocké”å¯ä»¥é€šè¿‡åˆ›å»ºæ—¶çš„æ„é€ æ–¹æ³•æ¥æŒ‡å®šä¸ºå…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”\næºç å¦‚ä¸‹ï¼š\nå¯¹äºSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚\nå¯é‡å…¥é”ï¼ˆä¹Ÿå«é€’å½’é”ï¼‰ï¼š\næŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³• è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹å¯ä»¥è¿›å…¥ä»»ä½•ä¸€ä¸ªå®ƒå·²ç»æ‹¥æœ‰çš„é”ï¼Œæ‰€åŒæ­¥ç€çš„ä»£ç å—ã€‚ å°±å¥½æ¯”ï¼Œæ‰“å¼€å®¶çš„å¤§é—¨ï¼Œä¹Ÿå¯ä»¥æ‰“å¼€å®¶é‡Œæˆ¿é—´çš„é—¨ã€‚\nReentrantLockã€Synchronized å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å¯é‡å…¥é”ï¼›\nè‡ªæ—‹é”ï¼ˆspinlockï¼‰ï¼š æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹ æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUã€‚\næ­»é”ï¼š\næ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›å¹² æ¶‰é‚£å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ï¼Œå¦‚æœç³»ç»Ÿèµ„æºå……è¶³ï¼Œè¿›ç¨‹çš„èµ„æºè¯·æ±‚éƒ½èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ï¼Œæ­»é”å‡ºç°çš„å¯èƒ½æ€§ å°±å¾ˆä½ï¼Œå¦è€…å°±ä¼šå› ä¸ºäº‰å¤ºæœ‰é™çš„èµ„æºè€Œé™·å…¥æ­»é”ã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰ä¹è§‚é”ï¼Œæ‚²è§‚é”\nCallable Javaä¸­è·å–å¤šçº¿ç¨‹ é™¤ç»§æ‰¿Threadç±»å’Œå®ç°Runnableæ¥å£ å¤–çš„ï¼Œç¬¬ä¸‰ç§æ–¹å¼\nä¸Runnableä¸åŒä¹‹å¤„ï¼š\nä»æºç å¯ä»¥å‘ç°ï¼Œæ˜¯å¦æœ‰è¿”å›å€¼ï¼Œæ˜¯å¦æŠ›å¼‚å¸¸ï¼Œå®ç°æ–¹æ³•ä¸åŒï¼Œä¸€ä¸ªæ˜¯call()æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯run()æ–¹æ³•\nå¯æ˜¯Threadç±»æ²¡æœ‰å…³äºCallableå‚æ•°çš„æ–¹æ³•ï¼Œè¿™ç‚¹JDKæºç å·²ç»è¡¨æ˜äº†\næ‰€ä»¥éœ€è¦ä¸€ä¸ªä¸­é—´ç±»æ¥å®ç°Callableæ¥å£ä¸Threadç±»çš„å…³ç³»ï¼Œè¿™ä¸ªç±»éœ€è¦å®ç°Runnableæ¥å£ï¼ˆè¿™æ ·æ‰èƒ½æŠŠå¯¹è±¡ä¼ ç»™Threadç±»ï¼‰ï¼Œä¸”æ„é€ æ–¹æ³•å‚æ•°æœ‰Callableæ¥å£ç±»å‹å‚æ•°ï¼ˆè¿™æ ·æ‰èƒ½æŠŠCallableæ¥å£çš„å®ç°ç±»çš„å¯¹è±¡ä¸¢è¿›æ¥ï¼‰ï¼›\næŸ¥çœ‹Jdkæ–‡æ¡£ä»¥åŠæŸ¥çœ‹ä¸­é—´ç±»çš„æºç å¾—çŸ¥ï¼ŒFutureTaskç±»å¯ä»¥åšè¿™ä¸ªä¸­é—´ç±»ï¼Œæ¥å®ŒæˆCallableæ¥å£çš„call()æ–¹æ³•è°ƒç”¨\næµ‹è¯•ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 import java.util.concurrent.Callable; import java.util.concurrent.ExecutionException; import java.util.concurrent.FutureTask; import java.util.concurrent.TimeUnit; public class CallableTest { public static void main(String[] args) throws ExecutionException, InterruptedException { Callable callable = new MyCallable(); //æŠŠCallableå®ç°ç±»ä¼ ç»™FutureTaskç±» FutureTask futureTask = new FutureTask\u003c\u003e(callable); //å†æŠŠFutureTaskå¯¹è±¡ä¼ ç»™Threadç±»ï¼Œè°ƒç”¨start()æ–¹æ³•ï¼Œå¯åŠ¨çº¿ç¨‹ new Thread(futureTask,\"callableçº¿ç¨‹\").start(); //æƒ³å¾—åˆ°call()æ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼ï¼Œå¯ä»¥è°ƒç”¨FutureTaskç±»çš„get()æ–¹æ³• String o = (String)futureTask.get(); System.out.println(o); } } /** * Callableæ¥å£çš„å®ç°ç±» */ class MyCallable implements Callable { @Override public String call() throws Exception { System.out.println(Thread.currentThread().getName()+\"===\u003ecall()æ–¹æ³•è¢«è°ƒç”¨äº†\"); TimeUnit.SECONDS.sleep(3); return \"ok\"; } } Lock ä¼ ç»Ÿçš„Synchronizedé”å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 public class LockTest { public static void main(String[] args) { Token token = new Token(); /** * å¼€å¯äº†ä¸‰ä¸ªçº¿ç¨‹å»å–ç¥¨ */ new Thread(()-\u003e{ for (int i = 1; i \u003c=300 ; i++) { token.sale(); } },\"A\").start(); new Thread(()-\u003e{ for (int i = 1; i \u003c=300 ; i++) { token.sale(); } },\"B\").start(); new Thread(()-\u003e{ for (int i = 1; i \u003c=300 ; i++) { token.sale(); } },\"C\").start(); } } class Token{ //èµ„æºç±» private int ticket=300; //æ€»ç¥¨æ•° public synchronized void sale(){ if (ticket\u003e0){ ticket--; System.out.println(Thread.currentThread().getName()+\"å–äº†ä¸€å¼ ç¥¨ï¼Œå½“å‰è¿˜æœ‰\"+ ticket + \"ç¥¨\"); } } } Locké”å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; public class LockTest { public static void main(String[] args) { Token token = new Token(); /** * åˆ©ç”¨locké” * å¼€å¯äº†ä¸‰ä¸ªçº¿ç¨‹å»å–ç¥¨ */ new Thread(()-\u003e{ for (int i = 1; i \u003c=300 ; i++) { token.sale(); } },\"A\").start(); new Thread(()-\u003e{ for (int i = 1; i \u003c=300 ; i++) { token.sale(); } },\"B\").start(); new Thread(()-\u003e{ for (int i = 1; i \u003c=300 ; i++) { token.sale(); } },\"C\").start(); } } class Token{ //èµ„æºç±» Lock lock = new ReentrantLock(); private int ticket=300; //æ€»ç¥¨æ•° public void sale(){ try { lock.lock(); if (ticket\u003e0){ ticket--; System.out.println(Thread.currentThread().getName()+\"å–äº†ä¸€å¼ ç¥¨ï¼Œå½“å‰è¿˜æœ‰\"+ ticket + \"ç¥¨\"); } } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } } Synchronized å’Œ Lock åŒºåˆ« synchronizedæ˜¯Javaçš„å…³é”®å­—ï¼Œè€ŒLockæ˜¯Javaçš„ä¸€ä¸ªç±» synchronizedæ˜¯è‡ªåŠ¨é‡Šæ”¾é”çš„ï¼ˆçº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œæ¯•ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹æ‰§è¡Œå‡ºç°å¼‚å¸¸ä¹Ÿä¼šé‡Šæ”¾é”ï¼‰ï¼Œè€ŒLockéœ€è¦åœ¨finallyæ‰‹åŠ¨é‡Šæ”¾é”ï¼ˆå³è°ƒç”¨unlock()æ–¹æ³•ï¼‰ï¼Œå¦åˆ™æˆ–é€ æˆæ­»é” ç”¨synchronizedå…³é”®å­—çš„ä¸¤ä¸ªçº¿ç¨‹1å’Œçº¿ç¨‹2ï¼Œå¦‚æœå½“å‰çº¿ç¨‹1è·å¾—é”ï¼Œçº¿ç¨‹2çº¿ç¨‹ç­‰å¾…ã€‚å¦‚æœçº¿ç¨‹1 é˜»å¡ï¼Œçº¿ç¨‹2åˆ™ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè€ŒLocké”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹å»ï¼Œå¦‚æœå°è¯•è·å–ä¸åˆ°é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…å°±ç»“æŸäº†ï¼› synchronizedçš„é”å¯é‡å…¥ã€ä¸å¯ä¸­æ–­ã€éå…¬å¹³ï¼Œè€ŒLocké”å¯é‡å…¥ã€å¯åˆ¤æ–­ã€å¯å…¬å¹³ä¹Ÿå¯éå…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰ Locké”é€‚åˆå¤§é‡åŒæ­¥çš„ä»£ç çš„åŒæ­¥é—®é¢˜ï¼Œsynchronizedé”é€‚åˆä»£ç å°‘é‡çš„åŒæ­¥é—®é¢˜ ç”Ÿäº§è€…æ¶ˆè´¹è€… ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… synchroinzed ç‰ˆ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 /** * ç°åœ¨å››ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ“ä½œåˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡ * å®ç°ä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ + 1ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ -1 * å®ç°äº¤æ›¿30æ¬¡ */ public class ProducerAndConsumer_syn { public static void main(String[] args) { Data1 data = new Data1(); new Thread(()-\u003e{ for (int i = 0; i \u003c30 ; i++) { data.consumer(); } },\"A\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c30 ; i++) { data.producer(); } },\"B\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c30 ; i++) { data.consumer(); } },\"C\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c30 ; i++) { data.producer(); } },\"D\").start(); } } class Data1{ private int number = 0; public synchronized void producer(){ // if (number!=0){ //ç”¨ifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ while (number!=0){\t//å¦‚æœä¸º1ï¼Œåˆ™ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ try { this.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } number++; System.out.println(Thread.currentThread().getName()+\"===\u003e\"+number); this.notifyAll(); } public synchronized void consumer(){ // if (number==0){ //ç”¨ifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’ while (number==0){\t//å¦‚æœä¸º0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ try { this.wait(); } catch (InterruptedException e) { e.printStackTrace(); } } number--; System.out.println(Thread.currentThread().getName()+\"===\u003e\"+number); this.notifyAll(); } } å…³äºè™šå‡å”¤é†’\nå› ä¸ºifåªä¼šåˆ¤æ–­ä¸€æ¬¡ï¼Œå½“å…¶å®ƒçº¿ç¨‹å”¤é†’ç­‰å¾…çº¿ç¨‹æ—¶ï¼Œåœ¨åœç•™åœ¨ifä½œç”¨åŸŸçš„çº¿ç¨‹è¢«å”¤é†’ï¼Œä¸ä¼šå†æ¬¡åˆ¤æ–­ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™ç§æƒ…å†µä¼šå¼•èµ·è™šå‡å”¤é†’ç°è±¡ï¼Œå³æ²¡æœ‰æ»¡è¶³å”¤é†’æ¡ä»¶ä¹Ÿä¼šè¢«å”¤é†’ï¼Œæ‰€ä»¥æ”¹ç”¨whileå¾ªç¯ï¼Œé‡å¤åˆ¤æ–­ï¼Œä»¥é˜²è„±ç¦»åˆ¤æ–­æ¡ä»¶\næ–°ç‰ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å†™æ³•ï¼ˆLockç‰ˆï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; /** * ç°åœ¨å››ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ“ä½œåˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡ * å®ç°ä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ + 1ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ -1 * å®ç°äº¤æ›¿10æ¬¡ */ public class ProducerAndConsumer_Lock { public static void main(String[] args) { Data2 data = new Data2(); new Thread(()-\u003e{ for (int i = 0; i \u003c10 ; i++) { data.consumer(); } },\"A\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c10 ; i++) { data.producer(); } },\"B\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c10 ; i++) { data.consumer(); } },\"C\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c10 ; i++) { data.producer(); } },\"D\").start(); } } class Data2{ private int number = 0; Lock lock =new ReentrantLock(); Condition condition =lock.newCondition(); public void producer(){ lock.lock(); try { while (number!=0){ //å¦‚æœä¸º1ï¼Œåˆ™ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ condition.await();\t//è®©çº¿ç¨‹ç­‰å¾… } number++; System.out.println(Thread.currentThread().getName()+\"===\u003e\"+number); condition.signalAll(); } catch (Exception e) { e.printStackTrace();\t//å”¤é†’å…¶å®ƒçº¿ç¨‹ï¼ˆå³å”¤é†’æ¶ˆè´¹è€…çº¿ç¨‹ï¼‰ } finally { lock.unlock(); } } public void consumer(){ lock.lock(); try { while (number==0){ //å¦‚æœä¸º0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’ condition.await();\t//è®©çº¿ç¨‹ç­‰å¾… } number--; System.out.println(Thread.currentThread().getName()+\"===\u003e\"+number); condition.signalAll();\t//å”¤é†’å…¶å®ƒçº¿ç¨‹ï¼ˆå³å”¤é†’ç”Ÿäº§è€…çº¿ç¨‹ï¼‰ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } } LockæŒ‡å®šé€šçŸ¥é¡ºåºå”¤é†’è®¿é—® 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.Lock; import java.util.concurrent.locks.ReentrantLock; /** * å¤šçº¿ç¨‹ä¹‹é—´æŒ‰é¡ºåºè°ƒç”¨ï¼Œå®ç° A-\u003eB-\u003eC * ä¸‰ä¸ªçº¿ç¨‹å¯åŠ¨ï¼ŒÂ * A æ‰“å°10æ¬¡ï¼ŒB æ‰“å°10æ¬¡,C æ‰“å°10æ¬¡ï¼Œä¾æ¬¡å¾ªç¯ */ public class Lock_Condition { public static void main(String[] args) { Data3 data3 = new Data3(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { data3.A(); } },\"AAA\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { data3.B(); } },\"BBB\").start(); new Thread(()-\u003e{ for (int i = 0; i \u003c 10; i++) { data3.C(); } },\"CCC\").start(); } } class Data3{ private int number = 1 ; Lock lock = new ReentrantLock(); Condition condition1 = lock.newCondition(); Condition condition2 = lock.newCondition(); Condition condition3 = lock.newCondition(); public void A() { lock.lock(); try { while (number !=1){\t//å¦‚æœä¸ä¸º1ï¼Œåˆ™çº¿ç¨‹ç­‰å¾… condition1.await(); } number = 2; System.out.println(Thread.currentThread().getName()+\"===\u003eAAA\"); condition2.signal();\t//å”¤é†’Bçº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º2çš„ } catch (InterruptedException e) { e.printStackTrace(); } finally { lock.unlock(); } } public void B(){ lock.lock(); try { while (number != 2){\t//å¦‚æœä¸ä¸º2ï¼Œåˆ™çº¿ç¨‹ç­‰å¾… condition2.await(); } number = 3; System.out.println(Thread.currentThread().getName()+\"===\u003eBBB\"); condition3.signal(); //å”¤é†’Cçº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º3çš„ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } public void C(){ lock.lock(); try { while (number!=3){\t//å¦‚æœä¸ä¸º3ï¼Œåˆ™çº¿ç¨‹ç­‰å¾… condition3.await(); } number = 1; System.out.println(Thread.currentThread().getName()+\"===\u003eCCC\"); condition1.signal();//å”¤é†’Açº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º1çš„ } catch (Exception e) { e.printStackTrace(); } finally { lock.unlock(); } } } é›†åˆç±»ä¸å®‰å…¨ List å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\nå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 import java.util.*; import java.util.concurrent.CopyOnWriteArrayList; /** * å› ä¸ºå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œlistæ˜¯ä¸å®‰å…¨çš„ * add()æ–¹æ³•æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¼šæŠ›java.util.ConcurrentModificationExceptionå¼‚å¸¸ * è§£å†³æ–¹æ¡ˆï¼Œæ¢ä¸€ä¸ªé›†åˆç±» * 1ã€List list = new Vector\u003c\u003e(); JDK1.0å°±å­˜åœ¨äº† * 2ã€List list = Collections.synchronizedList(new ArrayList\u003c\u003e()); é€šè¿‡é›†åˆå·¥å…·ç±»è½¬æ¢å¾—åˆ°ä¸€ä¸ªå®‰å…¨ç±» * 3ã€List list = new CopyOnWriteArrayList\u003c\u003e(); JUCåŒ…ä¸‹æä¾›çš„ä¸€ä¸ªç±»ï¼Œå†™å…¥æ—¶å¤åˆ¶ */ public class ListTest03 { public static void main(String[] args) { List list = new CopyOnWriteArrayList\u003c\u003e(); for (int i = 0; i \u003c 30; i++) { new Thread(()-\u003e{ list.add(UUID.randomUUID().toString().substring(0,8)); System.out.println(list); }).start(); } } } å†™å…¥æ—¶å¤åˆ¶ï¼ˆCopyOnWriteï¼‰æ€æƒ³\nå†™å…¥æ—¶å¤åˆ¶ï¼ˆCopyOnWriteï¼Œç®€ç§°COWï¼‰æ€æƒ³æ˜¯è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸä¸­çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³ æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…ï¼ˆCallersï¼‰åŒæ—¶è¦æ±‚ç›¸åŒçš„èµ„æºï¼ˆå¦‚å†…å­˜æˆ–è€…æ˜¯ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…± åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è§†å›¾ä¿®æ”¹èµ„æºå†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨ å‰¯æœ¬ï¼ˆprivate copyï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™è¿‡ç¨‹å¯¹å…¶ä»–çš„ è°ƒç”¨è€…éƒ½æ˜¯é€æ˜çš„ï¼ˆtransparentlyï¼‰ã€‚æ­¤åšæ³•ä¸»è¦çš„ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ ï¼ˆprivate copyï¼‰è¢«åˆ›å»ºï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚ è¯»å†™åˆ†ç¦»ï¼Œå†™æ—¶å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå®Œæˆæ’å…¥ã€ä¿®æ”¹æˆ–è€…ç§»é™¤æ“ä½œåå°†æ–°æ•°ç»„èµ‹å€¼ç»™array\nCopyOnWriteArrayListä¸ºä»€ä¹ˆå¹¶å‘å®‰å…¨ä¸”æ€§èƒ½æ¯”Vectorå¥½\næˆ‘çŸ¥é“Vectoræ˜¯å¢åˆ æ”¹æŸ¥æ–¹æ³•éƒ½åŠ äº†synchronizedï¼Œä¿è¯åŒæ­¥ï¼Œä½†æ˜¯æ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™éƒ½è¦å»è·å¾— é”ï¼Œæ€§èƒ½å°±ä¼šå¤§å¤§ä¸‹é™ï¼Œè€ŒCopyOnWriteArrayList åªæ˜¯åœ¨å¢åˆ æ”¹ä¸ŠåŠ é”ï¼Œä½†æ˜¯è¯»ä¸åŠ é”ï¼Œåœ¨è¯»æ–¹é¢çš„æ€§ èƒ½å°±å¥½äºVectorï¼ŒCopyOnWriteArrayListæ”¯æŒè¯»å¤šå†™å°‘çš„å¹¶å‘æƒ…å†µã€‚\nSet å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 /** * å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œsetæ˜¯ä¸å®‰å…¨çš„ * add()æ–¹æ³•æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¼šæŠ›java.util.ConcurrentModificationExceptionå¼‚å¸¸ * è§£å†³æ–¹æ¡ˆï¼Œæ¢ä¸€ä¸ªé›†åˆç±» * 1ã€Set set = Collections.synchronizedSet(new HashSet\u003c\u003e()); é€šè¿‡é›†åˆå·¥å…·ç±»è½¬æ¢å¾—åˆ°ä¸€ä¸ªå®‰å…¨ç±» * 2ã€Set set = new CopyOnWriteArraySet\u003c\u003e(); JUCåŒ…ä¸‹æä¾›çš„ä¸€ä¸ªç±»ï¼Œå†™å…¥æ—¶å¤åˆ¶ */ public class SetTest02 { public static void main(String[] args) { Set set = new CopyOnWriteArraySet\u003c\u003e(); for (int i = 0; i \u003c 30; i++) { set.add(UUID.randomUUID().toString().substring(0,8)); System.out.println(set); } } } å¦å¤–è¿˜æœ‰ä¸€ç‚¹ï¼ŒHashSetåº•å±‚å°±æ˜¯HashMapï¼ŒJDKæºç å¦‚ä¸‹ï¼š\né€šè¿‡æºç å¯ä»¥çœ‹å‡ºï¼ŒHashSetåº•å±‚æ˜¯åˆ›å»ºäº†ä¸€ä¸ªHashMapï¼ŒKeyå°±æ˜¯å­˜æ”¾HashSetçš„å€¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡HashMapçš„keyæœºåˆ¶ï¼Œæ¥å»é™¤é‡å¤å€¼çš„ï¼Œè€Œkeyå¯¹åº”çš„valueå°±æ˜¯ä¸€ä¸ªå«PRESENTçš„å¸¸é‡\nMap HashMapåº•å±‚å°±æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼ˆJDK1.8å¼€å§‹ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äº8æ—¶ï¼Œé“¾è¡¨è‡ªåŠ¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ˜¯ä¸ºæŸ¥è¯¢å€¼æ—¶åšçš„ä¸€ä¸ªä¼˜åŒ–ï¼‰\nä»JDK1.8æºç å¯ä»¥çœ‹å‡ºï¼Œåœ¨åˆ›å»ºæ—¶HashMapå¯ä»¥æŒ‡å®šå®ƒçš„é•¿åº¦ï¼ˆå³å®¹é‡ï¼‰å’ŒåŠ è½½å› å­ï¼Œå¦åˆ™å°±æ˜¯é»˜è®¤çš„16é•¿åº¦å’Œ0.75åŠ è½½å› å­\rå¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 import java.util.Map; import java.util.UUID; import java.util.concurrent.ConcurrentHashMap; public class HashMapTest02 { public static void main(String[] args) { /** *å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒmapåŒæ ·æ˜¯ä¸å®‰å…¨çš„ * putæ–¹æ³•å¹¶æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¹ŸæŠ›å‡ºåŒæ ·çš„java.util.ConcurrentModificationExceptionå¼‚å¸¸ * è§£å†³åŠæ³•ï¼Œä¹Ÿæ˜¯æ¢ä¸€ä¸ªé›†åˆç±» * Map map = new Hashtable\u003c\u003e(); JDK1.0å°±æœ‰ï¼Œæ•ˆç‡ä¸æ€ä¹ˆï¼Œå› ä¸ºå®ƒæ˜¯é”å…¨éƒ¨ * Map map = Collections.synchronizedMap(new HashMap\u003c\u003e()); * Map map = new ConcurrentHashMap\u003c\u003e(); */ Map map = new ConcurrentHashMap\u003c\u003e(); for (int i = 0; i \u003c 30; i++) { new Thread(()-\u003e{ map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(0,8)); System.out.println(map); },String.valueOf(i)).start(); } } } è¯»å†™é” å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»åŒä¸€ä¸ªèµ„æºç±»æ—¶ï¼Œæ˜¯ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯å®é™…æƒ…å†µå¾€å¾€æ˜¯è¯»å†™å¹¶å‘çš„ï¼Œä¹Ÿå°±è¯´è¯»å†™èµ„æºç±»æ˜¯åŒæ—¶è¿›è¡Œçš„ã€‚\nå¦‚æœèµ„æºç±»ä¸è¿›è¡ŒåŠ é”çš„è¯ï¼Œä¼šäº§ç”Ÿé”™è¯¯ï¼š\nå‘ç°å†™å…¥æ—¶ï¼Œæœªå®Œæˆå†™å…¥ï¼Œå°±æœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿè¿›è¡Œå†™å…¥ï¼Œè¿™ç§æ˜¯ä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜çš„\nReentrantReadWriteLock(è¯»å†™é”) 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 import java.util.HashMap; import java.util.Map; import java.util.UUID; import java.util.concurrent.locks.ReadWriteLock; import java.util.concurrent.locks.ReentrantReadWriteLock; public class ReentrantReadWriteTest02 { public static void main(String[] args) { MyCacheLock myCacheLock = new MyCacheLock(); //å¼€å¯10ä¸ªçº¿ç¨‹å»å†™ for (int i = 0; i \u003c 10; i++) { final int temp = i; new Thread(()-\u003e{ myCacheLock.put(temp+\"\", UUID.randomUUID().toString().substring(0,5)); },\"å†™\"+i).start(); } //å¼€å¯10ä¸ªçº¿ç¨‹å»è¯» for (int i = 0; i \u003c 10; i++) { final int temp = i; new Thread(()-\u003e{ myCacheLock.get(temp+\"\"); },\"è¯»\"+i).start(); } } } class MyCacheLock{ private volatile Map map = new HashMap\u003c\u003e(); private ReadWriteLock readWriteLock = new ReentrantReadWriteLock(); //è¯»å†™é” public void put(String key , String value){ readWriteLock.writeLock().lock(); //åŠ å†™é” try { System.out.println(Thread.currentThread().getName()+\"å·çº¿ç¨‹==ã€‹Keyå€¼ï¼š\"+ key +\" å¼€å§‹å†™å…¥\"); map.put(key,value); System.out.println(Thread.currentThread().getName()+\"å·çº¿ç¨‹==ã€‹å†™å…¥æˆåŠŸ\"); } catch (Exception e) { e.printStackTrace(); } finally { readWriteLock.writeLock().unlock(); } } public void get(String key){ readWriteLock.readLock().lock(); //åŠ è¯»é” try { System.out.println(Thread.currentThread().getName()+\"å·çº¿ç¨‹å¼€å§‹è¯»å–Keyå€¼å¯¹åº”çš„valueå€¼\"); String result = map.get(key); System.out.println(Thread.currentThread().getName()+\"è¯»å–ç»“æœï¼š\"+result); } catch (Exception e) { e.printStackTrace(); } finally { readWriteLock.readLock().unlock(); } } } çº¿ç¨‹æ±  JDKå®˜æ–¹æä¾›ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³• çº¿ç¨‹æ± ä¸­åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ newSingleThreadExecutor() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class ThreadPoolTest01 { public static void main(String[] args) { //newSingleThreadExecutoråˆ›å»ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ ExecutorService threadpool = Executors.newSingleThreadExecutor(); try { for (int i = 0; i \u003c 10; i++) { //åªæœ‰ä¸€ä¸ªçº¿ç¨‹å—ç†ï¼Œæ¥æ‰§è¡Œ10ä¸ªä»»åŠ¡ threadpool.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ‰§è¡Œä¸šåŠ¡\"); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadpool.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } çº¿ç¨‹æ± ä¸­åˆ›å»ºå›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newFixedThreadPoolï¼ˆï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class ThreadPoolTest02 { public static void main(String[] args) { //çº¿ç¨‹æ± ä¸­åˆ›å»º5ä¸ªçº¿ç¨‹ ExecutorService threadPool = Executors.newFixedThreadPool(5); try { for (int i = 0; i \u003c 20; i++) { //åªæœ‰äº”ä¸ªçº¿ç¨‹æ¥å—ç†ï¼Œæ¥æ‰§è¡Œ20ä¸ªä»»åŠ¡ threadPool.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ‰§è¡Œä¸šåŠ¡\"); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadPool.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸å›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newCachedThreadPool() 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class ThreadPoolTest03 { public static void main(String[] args) { //åˆ›å»ºçº¿ç¨‹æ± ï¼Œæ± ä¸­çº¿ç¨‹æ•°æ˜¯ä¸å›ºå®šçš„ï¼Œçº¿ç¨‹å…·ä½“æ˜¯ä¼¸ç¼©çš„ ExecutorService threadPool = Executors.newCachedThreadPool(); try { for (int i = 0; i \u003c 20 ; i++) { //æœ‰Nä¸ªçº¿ç¨‹å—ç†ï¼Œæ¥æ‰§è¡Œ20ä¸ªä»»åŠ¡ threadPool.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ‰§è¡Œä¸šåŠ¡\"); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadPool.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } è‡ªå®šä¹‰çº¿ç¨‹æ±  ThreadPoolExecutor() é€šè¿‡æŸ¥çœ‹JDKæºç ï¼Œå‘ç°ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•éƒ½æ˜¯è°ƒç”¨äº†new ThreadPoolExecutor(ä¸ƒä¸ªå‚æ•°)\nä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± æ–¹æ³•æºç å¦‚ä¸‹ï¼š\næŸ¥çœ‹ThreadPoolExecutor()æ–¹æ³•æºç å¦‚ä¸‹ï¼š\rå‘ç°è¯¥æ–¹æ³•æœ‰ä¸ƒä¸ªå‚æ•°\nint corePoolSize ï¼šæ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€‚å½“åˆ›å»ºçº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°æ˜¯ä¸º0çš„ï¼Œå½“æœ‰ä»»åŠ¡è¿›æ¥æ—¶ï¼Œæ‰å¼€å§‹åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè€Œçº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œä¼šç»´æŠ¤ä¸€ä¸ªæœ€å°çº¿ç¨‹æ•°é‡ï¼Œå³ä½¿è¿™äº›çº¿ç¨‹æ•°æ˜¯ç©ºé—²çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šé”€æ¯å®ƒä»¬ï¼Œé™¤éè®¾ç½®äº†allowCoreThreadTimeOutï¼Œè€Œè¿™ä¸ªæœ€å°çº¿ç¨‹æ•°å°±æ˜¯corePoolSize\n**int maximumPoolSize ï¼š**æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚çº¿ç¨‹æ± ä¸ä¼šæ— é™åˆ¶çš„å»åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå®ƒä¼šæœ‰ä¸€ä¸ªæœ€å¤§çº¿ç¨‹æ•°é‡çš„é™åˆ¶ï¼Œè¿™ä¸ªæ•°é‡å³ç”±maximunPoolSizeæ¥æŒ‡å®š\nlong keepAliveTime ï¼šçº¿ç¨‹ä¿ç•™çš„æ—¶é—´ã€‚ä¸€ä¸ªçº¿ç¨‹å¦‚æœå¤„äºç©ºé—²çŠ¶æ€ï¼Œå¹¶ä¸”å½“å‰çš„çº¿ç¨‹æ•°é‡å¤§äºcorePoolSizeï¼Œé‚£ä¹ˆåœ¨æŒ‡å®šæ—¶é—´åï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ï¼Œè¿™é‡Œçš„æŒ‡å®šæ—¶é—´ç”±keepAliveTimeæ¥è®¾å®š\n**TimeUnit unit ï¼š ** keepAliveTimeçš„è®¡é‡å•ä½\n1 2 3 4 5 6 7 TimeUnit.DAYS; //å¤© TimeUnit.HOURS; //å°æ—¶ TimeUnit.MINUTES; //åˆ†é’Ÿ TimeUnit.SECONDS; //ç§’ TimeUnit.MILLISECONDS; //æ¯«ç§’ TimeUnit.MICROSECONDS; //å¾®å¦™ TimeUnit.NANOSECONDS; //çº³ç§’ **BlockingQueue\u003c Runnable \u003e workQueue ï¼š**é˜»å¡é˜Ÿåˆ—ï¼Œå­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚\næ–°ä»»åŠ¡è¢«æäº¤åï¼Œä¼šå…ˆè¿›å…¥åˆ°æ­¤å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡è°ƒåº¦æ—¶å†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ã€‚jdkä¸­æä¾›äº†å››ç§å·¥ä½œé˜Ÿåˆ—ï¼š\nArrayBlockingQueue\nåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºã€‚æ–°ä»»åŠ¡è¿›æ¥åï¼Œä¼šæ”¾åˆ°è¯¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæœ‰ç•Œçš„æ•°ç»„å¯ä»¥é˜²æ­¢èµ„æºè€—å°½é—®é¢˜ã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡è¾¾åˆ°corePoolSizeåï¼Œå†æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œåˆ™ä¼šå°†ä»»åŠ¡æ”¾å…¥è¯¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…è¢«è°ƒåº¦ã€‚å¦‚æœé˜Ÿåˆ—å·²ç»æ˜¯æ»¡çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°maxPoolSizeï¼Œåˆ™ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\nLinkedBlockingQuene\nåŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼ˆå…¶å®æœ€å¤§å®¹é‡ä¸ºInterger.MAXï¼‰ï¼ŒæŒ‰ç…§FIFOæ’åºã€‚ç”±äºè¯¥é˜Ÿåˆ—çš„è¿‘ä¼¼æ— ç•Œæ€§ï¼Œå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡è¾¾åˆ°corePoolSizeåï¼Œå†æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œä¼šä¸€ç›´å­˜å…¥è¯¥é˜Ÿåˆ—ï¼Œè€Œä¸ä¼šå»åˆ›å»ºæ–°çº¿ç¨‹ç›´åˆ°maxPoolSizeï¼Œå› æ­¤ä½¿ç”¨è¯¥å·¥ä½œé˜Ÿåˆ—æ—¶ï¼Œå‚æ•°maxPoolSizeå…¶å®æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚\nSynchronousQuene\nä¸€ä¸ªä¸ç¼“å­˜ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ”¾å…¥ä¸€ä¸ªä»»åŠ¡å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…å–å‡ºè¿™ä¸ªä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´æ–°ä»»åŠ¡è¿›æ¥æ—¶ï¼Œä¸ä¼šç¼“å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¢«è°ƒåº¦æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¾¾åˆ°maxPoolSizeï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚\nPriorityBlockingQueue\nå…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é€šè¿‡å‚æ•°Comparatorå®ç°ã€‚\n**ThreadFactory threadFactory ï¼š**çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯ã€‚å¯ä»¥ç”¨æ¥è®¾å®šçº¿ç¨‹åç­‰ç­‰\nRejectedExecutionHandler handler ï¼š æ‹’ç»ç­–ç•¥ï¼Œé˜Ÿåˆ—å·²æ»¡ï¼Œè€Œä¸”ä»»åŠ¡é‡å¤§äºå¤§çº¿ç¨‹çš„å¼‚å¸¸å¤„ç†ç­–ç•¥\n1 2 3 4 ThreadPoolExecutor.AbortPolicy; //ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardPolicyï¼š//ä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardOldestPolicyï¼š//æŠ›å¼ƒè¿›å…¥é˜Ÿåˆ—æœ€æ—©çš„é‚£ä¸ªä»»åŠ¡ï¼Œç„¶åå°è¯•æŠŠè¿™æ¬¡æ‹’ç»çš„ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ ThreadPoolExecutor.CallerRunsPolicyï¼š//ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ ä¸¾ä¾‹è®°å¿† ï¼Œé“¶è¡Œçª—å£åŠç†ä¸šåŠ¡çš„è¿‡ç¨‹éå¸¸é€‚åˆç†è§£è¿™ä¸ƒä¸ªå‚æ•°\næµ‹è¯•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import java.util.concurrent.*; public class MyThreadPoolTest { public static void main(String[] args) { /** * åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹æ±  */ ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor( 4, 8, 30L, TimeUnit.SECONDS, new LinkedBlockingDeque\u003c\u003e(6), Executors.defaultThreadFactory(), new ThreadPoolExecutor.DiscardOldestPolicy()); try { for (int i = 0; i \u003c 10; i++) { threadPoolExecutor.execute(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"æ‰§è¡Œä¸šåŠ¡\"); }); } } catch (Exception e) { e.printStackTrace(); } finally { threadPoolExecutor.shutdown(); //å…³é—­çº¿ç¨‹æ±  } } } è‡ªå®šä¹‰çº¿ç¨‹æ± æœ€å¤§å®¹é‡ä¸ºï¼šæœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSize ï¼‰ + é˜»å¡é˜Ÿåˆ—å®¹é‡(workQueue)\nJUCçš„å¸¸ç”¨ç±» Semaphoreç±»ï¼ˆä¿¡å·é‡ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 import java.util.concurrent.Semaphore; import java.util.concurrent.TimeUnit; public class SemaphoreTest { /** * ä¸‰ä¸ªè½¦ä½ï¼Œä¹ä¸ªäººå»æŠ¢ * æ ¹æ®jucçš„è¾…åŠ©ç±»Semaphoreé™æµå®ç° * @param args */ public static void main(String[] args) { //è§„å®šåªèƒ½è¿›å»ä¸‰ä¸ª Semaphore semaphore = new Semaphore(3); for (int i = 0; i \u003c9 ; i++) { //å¼€å¯ä¹ä¸ªçº¿ç¨‹å»æŠ¢ä¸‰ä¸ªè½¦ä½ new Thread(()-\u003e{ try { semaphore.acquire();//å¾—åˆ° System.out.println(Thread.currentThread().getName()+\"å¾—åˆ°åœè½¦ä½\"); TimeUnit.SECONDS.sleep(3); //åœäº†ä¸‰ç§’ï¼Œç„¶åç¦»å¼€è½¦ä½ï¼Œç•™ç»™åé¢çš„äººè¿›æ¥ System.out.println(Thread.currentThread().getName()+\"ç¦»å¼€åœè½¦ä½\"); } catch (InterruptedException e) { e.printStackTrace(); }finally { semaphore.release();//é‡Šæ”¾ } },String.valueOf(i)).start(); } } } åœ¨ä¸Šè¿°æµ‹è¯•ä¸­ï¼Œsemaphoreå®šä¹‰äº†ä¸¤ä¸ªæ“ä½œ\nacquireï¼ˆè·å–ï¼‰\nå½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨acquire()æ–¹æ³•æ“ä½œæ—¶\nå½“å‰çº¿ç¨‹è¦ä¹ˆæˆåŠŸè·å–åˆ°ä¿¡å·é‡ï¼ˆå³ä¿¡å·é‡-1ï¼Œè¢«å äº†ä¸€ä¸ªï¼‰ è¦ä¹ˆç­‰å¾…å…¶å®ƒçº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è€…ä¸€ç›´ç­‰å¾…åˆ°è¶…æ—¶ releaseï¼ˆé‡Šæ”¾ï¼‰\nå½“çº¿ç¨‹è°ƒç”¨release()æ–¹æ³•æ—¶ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾ä¿¡å·é‡ï¼ˆå³ä¿¡å·é‡+1ï¼‰ï¼Œä»¥ä¾¿å…¶å®ƒç­‰å¾…çš„çº¿ç¨‹æ‹¿åˆ°ä¿¡å·é‡\nCountDowLathç±»ï¼ˆå€’è®¡æ—¶è®°æ•°å™¨ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 import java.util.concurrent.CountDownLatch; public class CountDownLatchTest { public static void main(String[] args) throws InterruptedException { CountDownLatch countDownLatch = new CountDownLatch(5); for (int i = 0; i \u003c 6; i++) { new Thread(()-\u003e{ countDownLatch.countDown();//è®¡æ•°å‡ä¸€ System.out.println(Thread.currentThread().getName()+\"çº¿ç¨‹æ‰§è¡Œå®Œæˆ\"); },String.valueOf(i)).start(); } countDownLatch.await(); //å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…è®¡æ•°å™¨å½’é›¶ System.out.println(Thread.currentThread().getName()+\"END\"); } } åœ¨ä¸Šè¿°æµ‹è¯•ä¸­ï¼Œcountdowlathç±»æœ‰ä¸¤ä¸ªæ–¹æ³•\ncountDown()\nå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨countDown()æ–¹æ³•æ—¶ï¼Œè®¡æ•°å™¨ä¼šå‡1ï¼Œä¸”çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡\nawait()\nå½“ä¸€ä¸ªçº¿ç¨‹æˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨await()æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’é›¶ï¼Œé˜»å¡çš„çº¿ç¨‹æ‰ä¼šé‡æ–°è¢«å”¤é†’ç»§ç»­å¾€ä¸‹æ‰§è¡Œ\nä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œå…¶å®ƒå­çº¿ç¨‹è°ƒç”¨countDown()å¹¶æ²¡æœ‰è¢«é˜»å¡è€Œæ˜¯ç»§ç»­æ‰§è¡Œç›´è‡³å®Œæ¯•ï¼Œä½†è°ƒç”¨await()æ–¹æ³•çš„mainä¸»çº¿å´è¢«é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’é›¶æ‰é‡æ–°æ‰§è¡Œ\nCyclicBarrierç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 import java.util.concurrent.BrokenBarrierException; import java.util.concurrent.CyclicBarrier; public class CyclicBarrierTest { public static void main(String[] args) { CyclicBarrier cyclicBarrier = new CyclicBarrier(7,()-\u003e{ System.out.println(\"å‡ºæ¥å§ï¼ç¥é¾™\"); }); for (int i = 1; i \u003c= 7; i++) { final int temp = i; //JDK1.8ä¹‹å‰è¦ç”¨finalä¿®é¥° new Thread(()-\u003e{ System.out.println(Thread.currentThread().getName()+\"çº¿ç¨‹==ã€‹å¾—åˆ°äº†ç¬¬\"+ temp +\"é¢—é¾™ç \"); try { cyclicBarrier.await(); //è®©çº¿ç¨‹ç­‰å¾… } catch (InterruptedException e) { e.printStackTrace(); } catch (BrokenBarrierException e) { e.printStackTrace(); } System.out.println(); },String.valueOf(i)).start(); } } } CyclicBarrierä¸ä¸Šé¢è®¡æ•°å™¨(CountDowLath)ä½œç”¨ç›¸åï¼Œå½“ç­‰å¾…çº¿ç¨‹è¾¾åˆ°æŒ‡å®šæ•°ç›®ï¼Œåˆ™é‡Šæ”¾ç­‰å¾…çš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å†…å®¹ï¼Œè­¬å¦‚ä¸Šè¿°æµ‹è¯•ï¼Œé›†é½ä¸ƒé¢—é¾™ç å¬å”¤ç¥é¾™\n",
  "wordCount" : "9166",
  "inLanguage": "zh",
  "datePublished": "2020-07-02T19:18:23+08:00",
  "dateModified": "2022-07-04T19:18:23+08:00",
  "author":[{
    "@type": "Person",
    "name": "shaoyi"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Shaoyi's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://shaoyi.cc/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://shaoyi.cc/" accesskey="h" title="Shaoyi&#39;s Blog (Alt + H)">Shaoyi&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://shaoyi.cc/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/tags/" title="ğŸ§©æ ‡ç­¾">
                    <span>ğŸ§©æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://shaoyi.cc/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="http://shaoyi.cc/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="http://shaoyi.cc/posts/blog/">ğŸ“•æŠ€æœ¯</a></div>
    <h1 class="post-title">
      Javaå¤šçº¿ç¨‹ç¬”è®°
    </h1>
    <div class="post-meta">









åˆ›å»º:&nbsp;<span title='2020-07-02 19:18:23 +0800 CST'>2022+08-18</span>&nbsp;Â·&nbsp;æ›´æ–°:&nbsp;4044+08-18&nbsp;Â·&nbsp;å­—æ•°:&nbsp;9166å­—&nbsp;Â·&nbsp;
ä½œè€…:&nbsp;shaoyi

</div>
  </header> <aside id="toc-container" class="toc-container wide">
        <div class="toc">
            <details  open>
                <summary accesskey="c" title="(Alt + C)">
                    <span class="details">ç›®å½•</span>
                </summary>

                <div class="inner"><ul>
                        <li>
                            <a href="#java%e9%94%81" aria-label="Javaé”">Javaé”</a></li>
                        <li>
                            <a href="#callable" aria-label="Callable">Callable</a></li>
                        <li>
                            <a href="#lock" aria-label="Lock">Lock</a><ul>
                                    <ul>
                                    
                        <li>
                            <a href="#%e4%bc%a0%e7%bb%9f%e7%9a%84synchronized%e9%94%81%e5%ae%9e%e7%8e%b0" aria-label="ä¼ ç»Ÿçš„Synchronizedé”å®ç°"><strong>ä¼ ç»Ÿçš„Synchronizedé”å®ç°</strong></a></li>
                        <li>
                            <a href="#lock%e9%94%81%e5%ae%9e%e7%8e%b0" aria-label="Locké”å®ç°"><strong>Locké”å®ç°</strong></a></li>
                        <li>
                            <a href="#synchronized-%e5%92%8c-lock-%e5%8c%ba%e5%88%ab" aria-label="Synchronized å’Œ Lock åŒºåˆ«"><strong>Synchronized å’Œ Lock åŒºåˆ«</strong></a></li></ul>
                                </ul>
                        </li>
                        <li>
                            <a href="#%e7%94%9f%e4%ba%a7%e8%80%85%e6%b6%88%e8%b4%b9%e8%80%85" aria-label="ç”Ÿäº§è€…æ¶ˆè´¹è€…">ç”Ÿäº§è€…æ¶ˆè´¹è€…</a><ul>
                                    <ul>
                                    
                        <li>
                            <a href="#%e7%94%9f%e4%ba%a7%e8%80%85%e5%92%8c%e6%b6%88%e8%b4%b9%e8%80%85-synchroinzed-%e7%89%88" aria-label="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… synchroinzed ç‰ˆ"><strong>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… synchroinzed ç‰ˆ</strong></a></li>
                        <li>
                            <a href="#%e6%96%b0%e7%89%88%e7%94%9f%e4%ba%a7%e8%80%85%e5%92%8c%e6%b6%88%e8%b4%b9%e8%80%85%e5%86%99%e6%b3%95lock%e7%89%88" aria-label="æ–°ç‰ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å†™æ³•ï¼ˆLockç‰ˆï¼‰"><strong>æ–°ç‰ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å†™æ³•ï¼ˆLockç‰ˆï¼‰</strong></a></li>
                        <li>
                            <a href="#lock%e6%8c%87%e5%ae%9a%e9%80%9a%e7%9f%a5%e9%a1%ba%e5%ba%8f%e5%94%a4%e9%86%92%e8%ae%bf%e9%97%ae" aria-label="LockæŒ‡å®šé€šçŸ¥é¡ºåºå”¤é†’è®¿é—®"><strong>LockæŒ‡å®šé€šçŸ¥é¡ºåºå”¤é†’è®¿é—®</strong></a></li></ul>
                                </ul>
                        </li>
                        <li>
                            <a href="#%e9%9b%86%e5%90%88%e7%b1%bb%e4%b8%8d%e5%ae%89%e5%85%a8" aria-label="é›†åˆç±»ä¸å®‰å…¨">é›†åˆç±»ä¸å®‰å…¨</a><ul>
                                    <ul>
                                    
                        <li>
                            <a href="#list" aria-label="List"><strong>List</strong></a></li>
                        <li>
                            <a href="#set" aria-label="Set"><strong>Set</strong></a></li>
                        <li>
                            <a href="#map" aria-label="Map"><strong>Map</strong></a></li></ul>
                                </ul>
                        </li>
                        <li>
                            <a href="#%e8%af%bb%e5%86%99%e9%94%81" aria-label="è¯»å†™é”">è¯»å†™é”</a><ul>
                                    <ul>
                                    
                        <li>
                            <a href="#reentrantreadwritelock%e8%af%bb%e5%86%99%e9%94%81" aria-label="ReentrantReadWriteLock(è¯»å†™é”)">ReentrantReadWriteLock(è¯»å†™é”)</a></li></ul>
                                </ul>
                        </li>
                        <li>
                            <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0" aria-label="çº¿ç¨‹æ± ">çº¿ç¨‹æ± </a><ul>
                                    
                        <li>
                            <a href="#jdk%e5%ae%98%e6%96%b9%e6%8f%90%e4%be%9b%e4%b8%89%e7%a7%8d%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e6%96%b9%e6%b3%95" aria-label="JDKå®˜æ–¹æä¾›ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•">JDKå®˜æ–¹æä¾›ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•</a><ul>
                                    
                        <li>
                            <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%b8%ad%e5%8f%aa%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ba%bf%e7%a8%8b-newsinglethreadexecutor" aria-label="çº¿ç¨‹æ± ä¸­åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ newSingleThreadExecutor()">çº¿ç¨‹æ± ä¸­åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ newSingleThreadExecutor()</a></li>
                        <li>
                            <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%b8%ad%e5%88%9b%e5%bb%ba%e5%9b%ba%e5%ae%9a%e6%95%b0%e7%9b%ae%e7%9a%84%e5%a4%9a%e4%b8%aa%e7%ba%bf%e7%a8%8b-newfixedthreadpool" aria-label="çº¿ç¨‹æ± ä¸­åˆ›å»ºå›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newFixedThreadPoolï¼ˆï¼‰">çº¿ç¨‹æ± ä¸­åˆ›å»ºå›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newFixedThreadPoolï¼ˆï¼‰</a></li>
                        <li>
                            <a href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e4%b8%ad%e5%88%9b%e5%bb%ba%e4%b8%8d%e5%9b%ba%e5%ae%9a%e6%95%b0%e7%9b%ae%e7%9a%84%e5%a4%9a%e4%b8%aa%e7%ba%bf%e7%a8%8b-newcachedthreadpool" aria-label="çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸å›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newCachedThreadPool()">çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸å›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newCachedThreadPool()</a></li></ul>
                        </li>
                        <li>
                            <a href="#%e8%87%aa%e5%ae%9a%e4%b9%89%e7%ba%bf%e7%a8%8b%e6%b1%a0-threadpoolexecutor" aria-label="è‡ªå®šä¹‰çº¿ç¨‹æ±  ThreadPoolExecutor()">è‡ªå®šä¹‰çº¿ç¨‹æ±  ThreadPoolExecutor()</a></li></ul>
                        </li>
                        <li>
                            <a href="#juc%e7%9a%84%e5%b8%b8%e7%94%a8%e7%b1%bb" aria-label="JUCçš„å¸¸ç”¨ç±»">JUCçš„å¸¸ç”¨ç±»</a><ul>
                                    
                        <li>
                            <a href="#semaphore%e7%b1%bb%e4%bf%a1%e5%8f%b7%e9%87%8f" aria-label="Semaphoreç±»ï¼ˆä¿¡å·é‡ï¼‰"><strong>Semaphoreç±»</strong>ï¼ˆä¿¡å·é‡ï¼‰</a></li>
                        <li>
                            <a href="#countdowlath%e7%b1%bb%e5%80%92%e8%ae%a1%e6%97%b6%e8%ae%b0%e6%95%b0%e5%99%a8" aria-label="CountDowLathç±»ï¼ˆå€’è®¡æ—¶è®°æ•°å™¨ï¼‰"><strong>CountDowLathç±»ï¼ˆå€’è®¡æ—¶è®°æ•°å™¨ï¼‰</strong></a></li>
                        <li>
                            <a href="#cyclicbarrier%e7%b1%bb" aria-label="CyclicBarrierç±»">CyclicBarrierç±»</a>
                        </li>
                    </ul>
                    </li>
                    </ul>
                </div>
            </details>
        </div>
    </aside>
    <script>
        let activeElement;
        let elements;
        window.addEventListener('DOMContentLoaded', function (event) {
            checkTocPosition();

            elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }, false);

        window.addEventListener('resize', function (event) {
            checkTocPosition();
        }, false);

        window.addEventListener('scroll', () => {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement) {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }, false);

        const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
        const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
        const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

        function checkTocPosition() {
            const width = document.body.scrollWidth;

            if (width - main - (toc * 2) - (gap * 4) > 0) {
                document.getElementById("toc-container").classList.add("wide");
            } else {
                document.getElementById("toc-container").classList.remove("wide");
            }
        }

        function getOffsetTop(element) {
            if (!element.getClientRects().length) {
                return 0;
            }
            let rect = element.getBoundingClientRect();
            let win = element.ownerDocument.defaultView;
            return rect.top + win.pageYOffset;
        }
    </script>
  <div class="post-content"><h1 id="javaé”">Javaé”<a hidden class="anchor" aria-hidden="true" href="#javaé”">#</a></h1>
<p><strong>ç‹¬å é”ï¼ˆå†™é”ï¼‰ï¼š</strong></p>
<p>æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”æŒæœ‰ã€‚å¯¹äºReentranrLockå’Œ Synchronized è€Œè¨€éƒ½æ˜¯ç‹¬ å é”ã€‚</p>
<p><strong>å…±äº«é”ï¼ˆè¯»é”ï¼‰ï¼š</strong></p>
<p>è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚</p>
<p><strong>å…¬å¹³é”ï¼š</strong></p>
<p>æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œç±»ä¼¼æ’é˜Ÿæ‰“é¥­ï¼Œå…ˆæ¥ååˆ°ã€‚</p>
<p><strong>éå…¬å¹³é”ï¼š</strong></p>
<p>æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”ç°ç”³è¯·çš„çº¿ç¨‹ ä¼˜å…ˆè·å–é”ã€‚ä¸æ–­å°è¯•è·å–é”ï¼Œå¦‚æœå°è¯•å¤±è´¥å°±åƒå…¬å¹³é”ä¸€æ ·ç­‰ç€ã€‚</p>
<p>ReentrantLocké”å¯ä»¥é€šè¿‡åˆ›å»ºæ—¶çš„æ„é€ æ–¹æ³•æ¥æŒ‡å®šä¸ºå…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”</p>
<p>æºç å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wI1lOe.png" alt="wI1lOe.png"  />
</p>
<p>å¯¹äºSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚</p>
<p><strong>å¯é‡å…¥é”ï¼ˆä¹Ÿå«é€’å½’é”ï¼‰ï¼š</strong></p>
<p>æŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹åï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶èƒ½è·å–è¯¥é”çš„ä»£ç ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³• è·å–é”çš„æ—¶å€™ï¼Œåœ¨è¿›å…¥å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹å¯ä»¥è¿›å…¥ä»»ä½•ä¸€ä¸ªå®ƒå·²ç»æ‹¥æœ‰çš„é”ï¼Œæ‰€åŒæ­¥ç€çš„ä»£ç å—ã€‚ å°±å¥½æ¯”ï¼Œæ‰“å¼€å®¶çš„å¤§é—¨ï¼Œä¹Ÿå¯ä»¥æ‰“å¼€å®¶é‡Œæˆ¿é—´çš„é—¨ã€‚</p>
<p>ReentrantLockã€Synchronized å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å¯é‡å…¥é”ï¼›</p>
<p><strong>è‡ªæ—‹é”ï¼ˆspinlockï¼‰ï¼š</strong>
æ˜¯æŒ‡å°è¯•è·å–é”çš„çº¿ç¨‹ä¸ä¼šç«‹å³é˜»å¡ï¼Œè€Œæ˜¯é‡‡ç”¨å¾ªç¯çš„æ–¹å¼å»å°è¯•è·å–é”ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘çº¿ç¨‹ä¸Šä¸‹ æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œç¼ºç‚¹æ˜¯å¾ªç¯ä¼šæ¶ˆè€—CPUã€‚</p>
<p><strong>æ­»é”ï¼š</strong></p>
<p>æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›å¹² æ¶‰é‚£å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ï¼Œå¦‚æœç³»ç»Ÿèµ„æºå……è¶³ï¼Œè¿›ç¨‹çš„èµ„æºè¯·æ±‚éƒ½èƒ½å¤Ÿå¾—åˆ°æ»¡è¶³ï¼Œæ­»é”å‡ºç°çš„å¯èƒ½æ€§ å°±å¾ˆä½ï¼Œå¦è€…å°±ä¼šå› ä¸ºäº‰å¤ºæœ‰é™çš„èµ„æºè€Œé™·å…¥æ­»é”ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰<strong>ä¹è§‚é”</strong>ï¼Œ<strong>æ‚²è§‚é”</strong></p>
<h1 id="callable">Callable<a hidden class="anchor" aria-hidden="true" href="#callable">#</a></h1>
<p>Javaä¸­è·å–å¤šçº¿ç¨‹  é™¤ç»§æ‰¿Threadç±»å’Œå®ç°Runnableæ¥å£ å¤–çš„ï¼Œç¬¬ä¸‰ç§æ–¹å¼</p>
<p>ä¸Runnableä¸åŒä¹‹å¤„ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wI82sU.png" alt="wI82sU.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wI8gMT.png" alt="wI8gMT.png"  />
</p>
<p>ä»æºç å¯ä»¥å‘ç°ï¼Œæ˜¯å¦æœ‰è¿”å›å€¼ï¼Œæ˜¯å¦æŠ›å¼‚å¸¸ï¼Œå®ç°æ–¹æ³•ä¸åŒï¼Œä¸€ä¸ªæ˜¯call()æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯run()æ–¹æ³•</p>
<p><strong>å¯æ˜¯Threadç±»æ²¡æœ‰å…³äºCallableå‚æ•°çš„æ–¹æ³•</strong>ï¼Œè¿™ç‚¹JDKæºç å·²ç»è¡¨æ˜äº†</p>
<img src="https://s1.ax1x.com/2020/09/19/wIGtYR.png" alt="wIGtYR.png"  />
<p>æ‰€ä»¥éœ€è¦ä¸€ä¸ªä¸­é—´ç±»æ¥å®ç°Callableæ¥å£ä¸Threadç±»çš„å…³ç³»ï¼Œè¿™ä¸ªç±»éœ€è¦å®ç°Runnableæ¥å£ï¼ˆè¿™æ ·æ‰èƒ½æŠŠå¯¹è±¡ä¼ ç»™Threadç±»ï¼‰ï¼Œä¸”æ„é€ æ–¹æ³•å‚æ•°æœ‰Callableæ¥å£ç±»å‹å‚æ•°ï¼ˆè¿™æ ·æ‰èƒ½æŠŠCallableæ¥å£çš„å®ç°ç±»çš„å¯¹è±¡ä¸¢è¿›æ¥ï¼‰ï¼›</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIaDnP.png" alt="wIaDnP.png"  />
</p>
<p>æŸ¥çœ‹Jdkæ–‡æ¡£ä»¥åŠæŸ¥çœ‹ä¸­é—´ç±»çš„æºç å¾—çŸ¥ï¼Œ<strong>FutureTaskç±»å¯ä»¥åšè¿™ä¸ªä¸­é—´ç±»</strong>ï¼Œæ¥å®ŒæˆCallableæ¥å£çš„call()æ–¹æ³•è°ƒç”¨</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIa5n0.png" alt="wIa5n0.png"  />
<img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIaHNF.png" alt="wIaHNF.png"  />
<img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIdk3d.png" alt="wIdk3d.png"  />
</p>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Callable;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutionException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.FutureTask;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CallableTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>        Callable callable = <span style="color:#fff;font-weight:bold">new</span> MyCallable();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŠŠCallableå®ç°ç±»ä¼ ç»™FutureTaskç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        FutureTask futureTask = <span style="color:#fff;font-weight:bold">new</span> FutureTask&lt;&gt;(callable);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å†æŠŠFutureTaskå¯¹è±¡ä¼ ç»™Threadç±»ï¼Œè°ƒç”¨start()æ–¹æ³•ï¼Œå¯åŠ¨çº¿ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">new</span> Thread(futureTask,<span style="color:#0ff;font-weight:bold">&#34;callableçº¿ç¨‹&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æƒ³å¾—åˆ°call()æ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼ï¼Œå¯ä»¥è°ƒç”¨FutureTaskç±»çš„get()æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        String o = (String)futureTask.<span style="color:#007f7f">get</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(o);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * Callableæ¥å£çš„å®ç°ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyCallable <span style="color:#fff;font-weight:bold">implements</span> Callable&lt;String&gt; {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> String call() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;call()æ–¹æ³•è¢«è°ƒç”¨äº†&#34;</span>);
</span></span><span style="display:flex;"><span>        TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(3);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;ok&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="lock">Lock<a hidden class="anchor" aria-hidden="true" href="#lock">#</a></h1>
<blockquote>
<h3 id="ä¼ ç»Ÿçš„synchronizedé”å®ç°"><strong>ä¼ ç»Ÿçš„Synchronizedé”å®ç°</strong><a hidden class="anchor" aria-hidden="true" href="#ä¼ ç»Ÿçš„synchronizedé”å®ç°">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LockTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Token token = <span style="color:#fff;font-weight:bold">new</span> Token();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * å¼€å¯äº†ä¸‰ä¸ªçº¿ç¨‹å»å–ç¥¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=300 ; i++) { 
</span></span><span style="display:flex;"><span>                token.<span style="color:#007f7f">sale</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=300 ; i++) { 
</span></span><span style="display:flex;"><span>                token.<span style="color:#007f7f">sale</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=300 ; i++) { 
</span></span><span style="display:flex;"><span>                token.<span style="color:#007f7f">sale</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Token{    <span style="color:#007f7f">//èµ„æºç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> ticket=300; <span style="color:#007f7f">//æ€»ç¥¨æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>     <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">synchronized</span>  <span style="color:#fff;font-weight:bold">void</span> sale(){
</span></span><span style="display:flex;"><span>             <span style="color:#fff;font-weight:bold">if</span> (ticket&gt;0){
</span></span><span style="display:flex;"><span>                 ticket--;
</span></span><span style="display:flex;"><span>                 System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;å–äº†ä¸€å¼ ç¥¨ï¼Œå½“å‰è¿˜æœ‰&#34;</span>+ ticket  + <span style="color:#0ff;font-weight:bold">&#34;ç¥¨&#34;</span>);
</span></span><span style="display:flex;"><span>             }
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h3 id="locké”å®ç°"><strong>Locké”å®ç°</strong><a hidden class="anchor" aria-hidden="true" href="#locké”å®ç°">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.Lock;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.ReentrantLock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> LockTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Token token = <span style="color:#fff;font-weight:bold">new</span> Token();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * åˆ©ç”¨locké”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * å¼€å¯äº†ä¸‰ä¸ªçº¿ç¨‹å»å–ç¥¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=300 ; i++) { 
</span></span><span style="display:flex;"><span>                token.<span style="color:#007f7f">sale</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=300 ; i++) { 
</span></span><span style="display:flex;"><span>                token.<span style="color:#007f7f">sale</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=300 ; i++) { 
</span></span><span style="display:flex;"><span>                token.<span style="color:#007f7f">sale</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Token{    <span style="color:#007f7f">//èµ„æºç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    Lock lock = <span style="color:#fff;font-weight:bold">new</span> ReentrantLock();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> ticket=300; <span style="color:#007f7f">//æ€»ç¥¨æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>     <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> sale(){
</span></span><span style="display:flex;"><span>         <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>             lock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>             <span style="color:#fff;font-weight:bold">if</span> (ticket&gt;0){
</span></span><span style="display:flex;"><span>                 ticket--;
</span></span><span style="display:flex;"><span>                 System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;å–äº†ä¸€å¼ ç¥¨ï¼Œå½“å‰è¿˜æœ‰&#34;</span>+ ticket  + <span style="color:#0ff;font-weight:bold">&#34;ç¥¨&#34;</span>);
</span></span><span style="display:flex;"><span>             }
</span></span><span style="display:flex;"><span>         } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>             e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>         } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>             lock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>     }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h3 id="synchronized-å’Œ-lock-åŒºåˆ«"><strong>Synchronized å’Œ Lock åŒºåˆ«</strong><a hidden class="anchor" aria-hidden="true" href="#synchronized-å’Œ-lock-åŒºåˆ«">#</a></h3>
</blockquote>
<ul>
<li>synchronizedæ˜¯Javaçš„å…³é”®å­—ï¼Œè€ŒLockæ˜¯Javaçš„ä¸€ä¸ªç±»</li>
<li>synchronizedæ˜¯è‡ªåŠ¨é‡Šæ”¾é”çš„ï¼ˆçº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œæ¯•ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹æ‰§è¡Œå‡ºç°å¼‚å¸¸ä¹Ÿä¼šé‡Šæ”¾é”ï¼‰ï¼Œè€ŒLockéœ€è¦åœ¨finallyæ‰‹åŠ¨é‡Šæ”¾é”ï¼ˆå³è°ƒç”¨unlock()æ–¹æ³•ï¼‰ï¼Œå¦åˆ™æˆ–é€ æˆæ­»é”</li>
<li>ç”¨synchronizedå…³é”®å­—çš„ä¸¤ä¸ªçº¿ç¨‹1å’Œçº¿ç¨‹2ï¼Œå¦‚æœå½“å‰çº¿ç¨‹1è·å¾—é”ï¼Œçº¿ç¨‹2çº¿ç¨‹ç­‰å¾…ã€‚å¦‚æœçº¿ç¨‹1 é˜»å¡ï¼Œçº¿ç¨‹2åˆ™ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œè€ŒLocké”å°±ä¸ä¸€å®šä¼šç­‰å¾…ä¸‹å»ï¼Œå¦‚æœå°è¯•è·å–ä¸åˆ°é”ï¼Œçº¿ç¨‹å¯ä»¥ä¸ç”¨ä¸€ç›´ç­‰å¾…å°±ç»“æŸäº†ï¼›</li>
<li>synchronizedçš„é”å¯é‡å…¥ã€ä¸å¯ä¸­æ–­ã€éå…¬å¹³ï¼Œè€ŒLocké”å¯é‡å…¥ã€å¯åˆ¤æ–­ã€å¯å…¬å¹³ä¹Ÿå¯éå…¬å¹³ï¼ˆä¸¤è€…çš†å¯ï¼‰</li>
<li>Locké”é€‚åˆå¤§é‡åŒæ­¥çš„ä»£ç çš„åŒæ­¥é—®é¢˜ï¼Œsynchronizedé”é€‚åˆä»£ç å°‘é‡çš„åŒæ­¥é—®é¢˜</li>
</ul>
<h1 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…">ç”Ÿäº§è€…æ¶ˆè´¹è€…<a hidden class="anchor" aria-hidden="true" href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…">#</a></h1>
<blockquote>
<h3 id="ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…-synchroinzed-ç‰ˆ"><strong>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… synchroinzed ç‰ˆ</strong><a hidden class="anchor" aria-hidden="true" href="#ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…-synchroinzed-ç‰ˆ">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ç°åœ¨å››ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ“ä½œåˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å®ç°ä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ + 1ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ -1 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å®ç°äº¤æ›¿30æ¬¡  Â  Â   
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ProducerAndConsumer_syn {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Data1 data = <span style="color:#fff;font-weight:bold">new</span> Data1();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;30 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">consumer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;30 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">producer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;30 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">consumer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;30 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">producer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;D&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Data1{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span>  <span style="color:#fff;font-weight:bold">int</span> number = 0;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">synchronized</span> <span style="color:#fff;font-weight:bold">void</span> producer(){
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#007f7f">// if (number!=0){  //ç”¨ifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">while</span> (number!=0){	<span style="color:#007f7f">//å¦‚æœä¸º1ï¼Œåˆ™ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">wait</span>();
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        number++;
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;&#34;</span>+number);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">notifyAll</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">synchronized</span> <span style="color:#fff;font-weight:bold">void</span> consumer(){
</span></span><span style="display:flex;"><span>       <span style="color:#007f7f">// if (number==0){     //ç”¨ifåˆ¤æ–­ä¼šå‡ºç°è™šå‡å”¤é†’
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">while</span> (number==0){	 <span style="color:#007f7f">//å¦‚æœä¸º0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">wait</span>();
</span></span><span style="display:flex;"><span>            } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        number--;
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;&#34;</span>+number);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">notifyAll</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å…³äºè™šå‡å”¤é†’</strong></p>
<p>å› ä¸ºifåªä¼šåˆ¤æ–­ä¸€æ¬¡ï¼Œå½“å…¶å®ƒçº¿ç¨‹å”¤é†’ç­‰å¾…çº¿ç¨‹æ—¶ï¼Œåœ¨åœç•™åœ¨ifä½œç”¨åŸŸçš„çº¿ç¨‹è¢«å”¤é†’ï¼Œä¸ä¼šå†æ¬¡åˆ¤æ–­ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™ç§æƒ…å†µä¼šå¼•èµ·<strong>è™šå‡å”¤é†’ç°è±¡ï¼Œå³æ²¡æœ‰æ»¡è¶³å”¤é†’æ¡ä»¶ä¹Ÿä¼šè¢«å”¤é†’</strong>ï¼Œæ‰€ä»¥æ”¹ç”¨whileå¾ªç¯ï¼Œé‡å¤åˆ¤æ–­ï¼Œä»¥é˜²è„±ç¦»åˆ¤æ–­æ¡ä»¶</p>
<blockquote>
<h3 id="æ–°ç‰ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å†™æ³•lockç‰ˆ"><strong>æ–°ç‰ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å†™æ³•ï¼ˆLockç‰ˆï¼‰</strong><a hidden class="anchor" aria-hidden="true" href="#æ–°ç‰ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å†™æ³•lockç‰ˆ">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.Condition;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.Lock;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.ReentrantLock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * ç°åœ¨å››ä¸ªçº¿ç¨‹ï¼Œå¯ä»¥æ“ä½œåˆå§‹å€¼ä¸º0çš„ä¸€ä¸ªå˜é‡ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å®ç°ä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ + 1ï¼Œä¸¤ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡ -1 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å®ç°äº¤æ›¿10æ¬¡  Â  Â   
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ProducerAndConsumer_Lock {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Data2 data = <span style="color:#fff;font-weight:bold">new</span> Data2();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;10 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">consumer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;A&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;10 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">producer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;B&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;10 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">consumer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;C&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;10 ; i++) {
</span></span><span style="display:flex;"><span>                data.<span style="color:#007f7f">producer</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;D&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Data2{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> number = 0;
</span></span><span style="display:flex;"><span>    Lock lock =<span style="color:#fff;font-weight:bold">new</span> ReentrantLock();
</span></span><span style="display:flex;"><span>    Condition condition =lock.<span style="color:#007f7f">newCondition</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> producer(){
</span></span><span style="display:flex;"><span>        lock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">while</span> (number!=0){  <span style="color:#007f7f">//å¦‚æœä¸º1ï¼Œåˆ™ç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                condition.<span style="color:#007f7f">await</span>();	<span style="color:#007f7f">//è®©çº¿ç¨‹ç­‰å¾…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            }
</span></span><span style="display:flex;"><span>            number++;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;&#34;</span>+number);
</span></span><span style="display:flex;"><span>            condition.<span style="color:#007f7f">signalAll</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();	<span style="color:#007f7f">//å”¤é†’å…¶å®ƒçº¿ç¨‹ï¼ˆå³å”¤é†’æ¶ˆè´¹è€…çº¿ç¨‹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            lock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span>  <span style="color:#fff;font-weight:bold">void</span>  consumer(){
</span></span><span style="display:flex;"><span>        lock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">while</span> (number==0){  <span style="color:#007f7f">//å¦‚æœä¸º0ï¼Œåˆ™æ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œå¦åˆ™å”¤é†’
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                condition.<span style="color:#007f7f">await</span>();	<span style="color:#007f7f">//è®©çº¿ç¨‹ç­‰å¾…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            }
</span></span><span style="display:flex;"><span>            number--;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;&#34;</span>+number);
</span></span><span style="display:flex;"><span>            condition.<span style="color:#007f7f">signalAll</span>();	<span style="color:#007f7f">//å”¤é†’å…¶å®ƒçº¿ç¨‹ï¼ˆå³å”¤é†’ç”Ÿäº§è€…çº¿ç¨‹ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            lock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h3 id="lockæŒ‡å®šé€šçŸ¥é¡ºåºå”¤é†’è®¿é—®"><strong>LockæŒ‡å®šé€šçŸ¥é¡ºåºå”¤é†’è®¿é—®</strong><a hidden class="anchor" aria-hidden="true" href="#lockæŒ‡å®šé€šçŸ¥é¡ºåºå”¤é†’è®¿é—®">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">57
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">58
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">59
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">60
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">61
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">62
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">63
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">64
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">65
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">66
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">67
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">68
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">69
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">70
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">71
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">72
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">73
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">74
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">75
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">76
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">77
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">78
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">79
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">80
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">81
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">82
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.Condition;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.Lock;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.ReentrantLock;
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *  å¤šçº¿ç¨‹ä¹‹é—´æŒ‰é¡ºåºè°ƒç”¨ï¼Œå®ç° A-&gt;B-&gt;C Â  Â  Â  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *  ä¸‰ä¸ªçº¿ç¨‹å¯åŠ¨ï¼ŒÂ  Â  Â  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> *  A æ‰“å°10æ¬¡ï¼ŒB æ‰“å°10æ¬¡,C æ‰“å°10æ¬¡ï¼Œä¾æ¬¡å¾ªç¯ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> Lock_Condition {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Data3 data3 = <span style="color:#fff;font-weight:bold">new</span> Data3();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 10; i++) {
</span></span><span style="display:flex;"><span>                data3.<span style="color:#007f7f">A</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;AAA&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 10; i++) {
</span></span><span style="display:flex;"><span>                data3.<span style="color:#007f7f">B</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;BBB&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 10; i++) {
</span></span><span style="display:flex;"><span>                data3.<span style="color:#007f7f">C</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },<span style="color:#0ff;font-weight:bold">&#34;CCC&#34;</span>).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> Data3{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">int</span> number = 1 ;
</span></span><span style="display:flex;"><span>   Lock lock = <span style="color:#fff;font-weight:bold">new</span> ReentrantLock();
</span></span><span style="display:flex;"><span>   Condition condition1 = lock.<span style="color:#007f7f">newCondition</span>();
</span></span><span style="display:flex;"><span>   Condition condition2 = lock.<span style="color:#007f7f">newCondition</span>();
</span></span><span style="display:flex;"><span>   Condition condition3 = lock.<span style="color:#007f7f">newCondition</span>();
</span></span><span style="display:flex;"><span>   <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> A()  {
</span></span><span style="display:flex;"><span>       lock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>       <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>           <span style="color:#fff;font-weight:bold">while</span> (number !=1){	<span style="color:#007f7f">//å¦‚æœä¸ä¸º1ï¼Œåˆ™çº¿ç¨‹ç­‰å¾…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>               condition1.<span style="color:#007f7f">await</span>();
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>           number = 2;
</span></span><span style="display:flex;"><span>           System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;AAA&#34;</span>);
</span></span><span style="display:flex;"><span>           condition2.<span style="color:#007f7f">signal</span>();	<span style="color:#007f7f">//å”¤é†’Bçº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º2çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>       } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>           e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>       } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>           lock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>   <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> B(){
</span></span><span style="display:flex;"><span>       lock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>       <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>           <span style="color:#fff;font-weight:bold">while</span> (number != 2){	<span style="color:#007f7f">//å¦‚æœä¸ä¸º2ï¼Œåˆ™çº¿ç¨‹ç­‰å¾…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>               condition2.<span style="color:#007f7f">await</span>();
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>           number = 3;
</span></span><span style="display:flex;"><span>           System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;BBB&#34;</span>);
</span></span><span style="display:flex;"><span>           condition3.<span style="color:#007f7f">signal</span>(); <span style="color:#007f7f">//å”¤é†’Cçº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º3çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>       } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>           e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>       } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>           lock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> C(){
</span></span><span style="display:flex;"><span>       lock.<span style="color:#007f7f">lock</span>();
</span></span><span style="display:flex;"><span>       <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>           <span style="color:#fff;font-weight:bold">while</span> (number!=3){	<span style="color:#007f7f">//å¦‚æœä¸ä¸º3ï¼Œåˆ™çº¿ç¨‹ç­‰å¾…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>               condition3.<span style="color:#007f7f">await</span>();
</span></span><span style="display:flex;"><span>           }
</span></span><span style="display:flex;"><span>           number = 1;
</span></span><span style="display:flex;"><span>           System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;===&gt;CCC&#34;</span>);
</span></span><span style="display:flex;"><span>           condition1.<span style="color:#007f7f">signal</span>();<span style="color:#007f7f">//å”¤é†’Açº¿ç¨‹ï¼Œå³çº¿ç¨‹ä¸­ å˜é‡numberä¸º1çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>       } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>           e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>       } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>           lock.<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>       }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="é›†åˆç±»ä¸å®‰å…¨">é›†åˆç±»ä¸å®‰å…¨<a hidden class="anchor" aria-hidden="true" href="#é›†åˆç±»ä¸å®‰å…¨">#</a></h1>
<blockquote>
<h3 id="list"><strong>List</strong><a hidden class="anchor" aria-hidden="true" href="#list">#</a></h3>
</blockquote>
<p>å•çº¿ç¨‹ç¯å¢ƒä¸‹ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/18/w45F10.png" alt="w45F10.png"  />
</p>
<p>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/18/w4o7tJ.png" alt="w4o7tJ.png"  />
</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.*;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.CopyOnWriteArrayList;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å› ä¸ºå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œlistæ˜¯ä¸å®‰å…¨çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * add()æ–¹æ³•æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¼šæŠ›java.util.ConcurrentModificationExceptionå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * è§£å†³æ–¹æ¡ˆï¼Œæ¢ä¸€ä¸ªé›†åˆç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1ã€List&lt;String&gt; list = new Vector&lt;&gt;();  JDK1.0å°±å­˜åœ¨äº†
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2ã€List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());      é€šè¿‡é›†åˆå·¥å…·ç±»è½¬æ¢å¾—åˆ°ä¸€ä¸ªå®‰å…¨ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 3ã€List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();   JUCåŒ…ä¸‹æä¾›çš„ä¸€ä¸ªç±»ï¼Œå†™å…¥æ—¶å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ListTest03 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        List&lt;String&gt; list = <span style="color:#fff;font-weight:bold">new</span> CopyOnWriteArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 30; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>                list.<span style="color:#007f7f">add</span>(UUID.<span style="color:#007f7f">randomUUID</span>().<span style="color:#007f7f">toString</span>().<span style="color:#007f7f">substring</span>(0,8));
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(list);
</span></span><span style="display:flex;"><span>            }).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å†™å…¥æ—¶å¤åˆ¶ï¼ˆCopyOnWriteï¼‰æ€æƒ³</strong></p>
<p>å†™å…¥æ—¶å¤åˆ¶ï¼ˆCopyOnWriteï¼Œç®€ç§°COWï¼‰æ€æƒ³æ˜¯è®¡ç®—æœºç¨‹åºè®¾è®¡é¢†åŸŸä¸­çš„ä¸€ç§ä¼˜åŒ–ç­–ç•¥ã€‚å…¶æ ¸å¿ƒæ€æƒ³ æ˜¯ï¼Œå¦‚æœæœ‰å¤šä¸ªè°ƒç”¨è€…ï¼ˆCallersï¼‰åŒæ—¶è¦æ±‚ç›¸åŒçš„èµ„æºï¼ˆå¦‚å†…å­˜æˆ–è€…æ˜¯ç£ç›˜ä¸Šçš„æ•°æ®å­˜å‚¨ï¼‰ï¼Œä»–ä»¬ä¼šå…± åŒè·å–ç›¸åŒçš„æŒ‡é’ˆæŒ‡å‘ç›¸åŒçš„èµ„æºï¼Œç›´åˆ°æŸä¸ªè°ƒç”¨è€…è§†å›¾ä¿®æ”¹èµ„æºå†…å®¹æ—¶ï¼Œç³»ç»Ÿæ‰ä¼šçœŸæ­£å¤åˆ¶ä¸€ä»½ä¸“ç”¨ å‰¯æœ¬ï¼ˆprivate copyï¼‰ç»™è¯¥è°ƒç”¨è€…ï¼Œè€Œå…¶ä»–è°ƒç”¨è€…æ‰€è§åˆ°çš„åˆçš„èµ„æºä»ç„¶ä¿æŒä¸å˜ã€‚è¿™è¿‡ç¨‹å¯¹å…¶ä»–çš„ è°ƒç”¨è€…éƒ½æ˜¯é€æ˜çš„ï¼ˆtransparentlyï¼‰ã€‚æ­¤åšæ³•ä¸»è¦çš„ä¼˜ç‚¹æ˜¯å¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¿®æ”¹èµ„æºï¼Œå°±ä¸ä¼šæœ‰å‰¯æœ¬ ï¼ˆprivate copyï¼‰è¢«åˆ›å»ºï¼Œå› æ­¤å¤šä¸ªè°ƒç”¨è€…åªæ˜¯è¯»å–æ“ä½œæ—¶å¯ä»¥å…±äº«åŒä¸€ä»½èµ„æºã€‚
è¯»å†™åˆ†ç¦»ï¼Œå†™æ—¶å¤åˆ¶å‡ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå®Œæˆæ’å…¥ã€ä¿®æ”¹æˆ–è€…ç§»é™¤æ“ä½œåå°†æ–°æ•°ç»„èµ‹å€¼ç»™array</p>
<p><strong>CopyOnWriteArrayListä¸ºä»€ä¹ˆå¹¶å‘å®‰å…¨ä¸”æ€§èƒ½æ¯”Vectorå¥½</strong></p>
<p>æˆ‘çŸ¥é“Vectoræ˜¯å¢åˆ æ”¹æŸ¥æ–¹æ³•éƒ½åŠ äº†synchronizedï¼Œä¿è¯åŒæ­¥ï¼Œä½†æ˜¯æ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™éƒ½è¦å»è·å¾— é”ï¼Œæ€§èƒ½å°±ä¼šå¤§å¤§ä¸‹é™ï¼Œè€ŒCopyOnWriteArrayList åªæ˜¯åœ¨å¢åˆ æ”¹ä¸ŠåŠ é”ï¼Œä½†æ˜¯è¯»ä¸åŠ é”ï¼Œåœ¨è¯»æ–¹é¢çš„æ€§ èƒ½å°±å¥½äºVectorï¼ŒCopyOnWriteArrayListæ”¯æŒè¯»å¤šå†™å°‘çš„å¹¶å‘æƒ…å†µã€‚</p>
<blockquote>
<h3 id="set"><strong>Set</strong><a hidden class="anchor" aria-hidden="true" href="#set">#</a></h3>
</blockquote>
<p>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/18/w4Ltfg.png" alt="w4Ltfg.png"  />
</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œsetæ˜¯ä¸å®‰å…¨çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * add()æ–¹æ³•æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¼šæŠ›java.util.ConcurrentModificationExceptionå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * è§£å†³æ–¹æ¡ˆï¼Œæ¢ä¸€ä¸ªé›†åˆç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 1ã€Set&lt;String&gt; set = Collections.synchronizedSet(new HashSet&lt;&gt;());   é€šè¿‡é›†åˆå·¥å…·ç±»è½¬æ¢å¾—åˆ°ä¸€ä¸ªå®‰å…¨ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> * 2ã€Set&lt;String&gt; set = new CopyOnWriteArraySet&lt;&gt;();       JUCåŒ…ä¸‹æä¾›çš„ä¸€ä¸ªç±»ï¼Œå†™å…¥æ—¶å¤åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SetTest02 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        Set&lt;String&gt; set = <span style="color:#fff;font-weight:bold">new</span> CopyOnWriteArraySet&lt;&gt;();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 30; i++) {
</span></span><span style="display:flex;"><span>            set.<span style="color:#007f7f">add</span>(UUID.<span style="color:#007f7f">randomUUID</span>().<span style="color:#007f7f">toString</span>().<span style="color:#007f7f">substring</span>(0,8));
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(set);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦å¤–è¿˜æœ‰ä¸€ç‚¹ï¼Œ<strong>HashSetåº•å±‚å°±æ˜¯HashMap</strong>ï¼ŒJDKæºç å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/w50wxs.jpg" alt="w50wxs.jpg"  />
</p>
<p>é€šè¿‡æºç å¯ä»¥çœ‹å‡ºï¼Œ<strong>HashSetåº•å±‚æ˜¯åˆ›å»ºäº†ä¸€ä¸ªHashMapï¼ŒKeyå°±æ˜¯å­˜æ”¾HashSetçš„å€¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡HashMapçš„keyæœºåˆ¶ï¼Œæ¥å»é™¤é‡å¤å€¼çš„ï¼Œè€Œkeyå¯¹åº”çš„valueå°±æ˜¯ä¸€ä¸ªå«PRESENTçš„å¸¸é‡</strong></p>
<blockquote>
<h3 id="map"><strong>Map</strong><a hidden class="anchor" aria-hidden="true" href="#map">#</a></h3>
</blockquote>
<p><strong>HashMapåº•å±‚å°±æ˜¯æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</strong>ï¼ˆJDK1.8å¼€å§‹ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äº8æ—¶ï¼Œé“¾è¡¨è‡ªåŠ¨è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ˜¯ä¸ºæŸ¥è¯¢å€¼æ—¶åšçš„ä¸€ä¸ªä¼˜åŒ–ï¼‰</p>
<p>ä»JDK1.8æºç å¯ä»¥çœ‹å‡ºï¼Œåœ¨åˆ›å»ºæ—¶HashMapå¯ä»¥æŒ‡å®šå®ƒçš„é•¿åº¦ï¼ˆå³å®¹é‡ï¼‰å’ŒåŠ è½½å› å­ï¼Œå¦åˆ™å°±æ˜¯é»˜è®¤çš„16é•¿åº¦å’Œ0.75åŠ è½½å› å­<img loading="lazy" src="https://s1.ax1x.com/2020/09/19/w56kKH.png" alt="w56kKH.png"  />
</p>
<p>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/w56dRU.png" alt="w56dRU.png"  />
</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Map;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.UUID;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ConcurrentHashMap;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> HashMapTest02 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         *å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒmapåŒæ ·æ˜¯ä¸å®‰å…¨çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * putæ–¹æ³•å¹¶æ²¡æœ‰åŠ é”ï¼Œå¯¼è‡´ä¹ŸæŠ›å‡ºåŒæ ·çš„java.util.ConcurrentModificationExceptionå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * è§£å†³åŠæ³•ï¼Œä¹Ÿæ˜¯æ¢ä¸€ä¸ªé›†åˆç±»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * Map&lt;String, String&gt; map = new Hashtable&lt;&gt;();  JDK1.0å°±æœ‰ï¼Œæ•ˆç‡ä¸æ€ä¹ˆï¼Œå› ä¸ºå®ƒæ˜¯é”å…¨éƒ¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * Map&lt;String, String&gt; map = Collections.synchronizedMap(new HashMap&lt;&gt;());
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * Map&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         */</span>
</span></span><span style="display:flex;"><span>        Map&lt;String, String&gt; map = <span style="color:#fff;font-weight:bold">new</span> ConcurrentHashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 30; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>                map.<span style="color:#007f7f">put</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>(), UUID.<span style="color:#007f7f">randomUUID</span>().<span style="color:#007f7f">toString</span>().<span style="color:#007f7f">substring</span>(0,8));
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(map);
</span></span><span style="display:flex;"><span>            },String.<span style="color:#007f7f">valueOf</span>(i)).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="è¯»å†™é”">è¯»å†™é”<a hidden class="anchor" aria-hidden="true" href="#è¯»å†™é”">#</a></h1>
<p>å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»åŒä¸€ä¸ªèµ„æºç±»æ—¶ï¼Œæ˜¯ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯å®é™…æƒ…å†µå¾€å¾€æ˜¯è¯»å†™å¹¶å‘çš„ï¼Œä¹Ÿå°±è¯´è¯»å†™èµ„æºç±»æ˜¯åŒæ—¶è¿›è¡Œçš„ã€‚</p>
<p>å¦‚æœèµ„æºç±»ä¸è¿›è¡ŒåŠ é”çš„è¯ï¼Œä¼šäº§ç”Ÿé”™è¯¯ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/w5TqkF.png" alt="w5TqkF.png"  />
</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/w5TzOx.png" alt="w5TzOx.png"  />
</p>
<p>å‘ç°å†™å…¥æ—¶ï¼Œæœªå®Œæˆå†™å…¥ï¼Œå°±æœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿè¿›è¡Œå†™å…¥ï¼Œè¿™ç§æ˜¯ä¼šäº§ç”Ÿå®‰å…¨é—®é¢˜çš„</p>
<blockquote>
<h3 id="reentrantreadwritelockè¯»å†™é”">ReentrantReadWriteLock(è¯»å†™é”)<a hidden class="anchor" aria-hidden="true" href="#reentrantreadwritelockè¯»å†™é”">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">30
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">31
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">32
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">33
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">34
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">35
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">36
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">37
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">38
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">39
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">40
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">41
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">42
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">43
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">44
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">45
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">46
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">47
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">48
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">49
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">50
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">51
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">52
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">53
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">54
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">55
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">56
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.HashMap;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.Map;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.UUID;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.ReadWriteLock;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ReentrantReadWriteTest02 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        MyCacheLock myCacheLock = <span style="color:#fff;font-weight:bold">new</span> MyCacheLock();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å¼€å¯10ä¸ªçº¿ç¨‹å»å†™
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 10; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> temp = i;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>                myCacheLock.<span style="color:#007f7f">put</span>(temp+<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>, UUID.<span style="color:#007f7f">randomUUID</span>().<span style="color:#007f7f">toString</span>().<span style="color:#007f7f">substring</span>(0,5));
</span></span><span style="display:flex;"><span>            },<span style="color:#0ff;font-weight:bold">&#34;å†™&#34;</span>+i).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å¼€å¯10ä¸ªçº¿ç¨‹å»è¯»
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 10; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> temp = i;
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>                myCacheLock.<span style="color:#007f7f">get</span>(temp+<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>            },<span style="color:#0ff;font-weight:bold">&#34;è¯»&#34;</span>+i).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">class</span> MyCacheLock{
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">volatile</span> Map&lt;String, String&gt; map = <span style="color:#fff;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> ReadWriteLock readWriteLock = <span style="color:#fff;font-weight:bold">new</span> ReentrantReadWriteLock(); <span style="color:#007f7f">//è¯»å†™é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> put(String key , String value){
</span></span><span style="display:flex;"><span>        readWriteLock.<span style="color:#007f7f">writeLock</span>().<span style="color:#007f7f">lock</span>();   <span style="color:#007f7f">//åŠ å†™é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;å·çº¿ç¨‹==ã€‹Keyå€¼ï¼š&#34;</span>+ key +<span style="color:#0ff;font-weight:bold">&#34; å¼€å§‹å†™å…¥&#34;</span>);
</span></span><span style="display:flex;"><span>            map.<span style="color:#007f7f">put</span>(key,value);
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;å·çº¿ç¨‹==ã€‹å†™å…¥æˆåŠŸ&#34;</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            readWriteLock.<span style="color:#007f7f">writeLock</span>().<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> get(String key){
</span></span><span style="display:flex;"><span>        readWriteLock.<span style="color:#007f7f">readLock</span>().<span style="color:#007f7f">lock</span>();    <span style="color:#007f7f">//åŠ è¯»é”
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;å·çº¿ç¨‹å¼€å§‹è¯»å–Keyå€¼å¯¹åº”çš„valueå€¼&#34;</span>);
</span></span><span style="display:flex;"><span>            String result = map.<span style="color:#007f7f">get</span>(key);
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;è¯»å–ç»“æœï¼š&#34;</span>+result);
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            readWriteLock.<span style="color:#007f7f">readLock</span>().<span style="color:#007f7f">unlock</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="çº¿ç¨‹æ± ">çº¿ç¨‹æ± <a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ">#</a></h1>
<h2 id="jdkå®˜æ–¹æä¾›ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•">JDKå®˜æ–¹æä¾›ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•<a hidden class="anchor" aria-hidden="true" href="#jdkå®˜æ–¹æä¾›ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•">#</a></h2>
<blockquote>
<h3 id="çº¿ç¨‹æ± ä¸­åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹-newsinglethreadexecutor">çº¿ç¨‹æ± ä¸­åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ newSingleThreadExecutor()<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ä¸­åªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹-newsinglethreadexecutor">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutorService;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Executors;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolTest01 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//newSingleThreadExecutoråˆ›å»ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ExecutorService threadpool = Executors.<span style="color:#007f7f">newSingleThreadExecutor</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 10; i++) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//åªæœ‰ä¸€ä¸ªçº¿ç¨‹å—ç†ï¼Œæ¥æ‰§è¡Œ10ä¸ªä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                threadpool.<span style="color:#007f7f">execute</span>(()-&gt;{
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;æ‰§è¡Œä¸šåŠ¡&#34;</span>);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            threadpool.<span style="color:#007f7f">shutdown</span>(); <span style="color:#007f7f">//å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h3 id="çº¿ç¨‹æ± ä¸­åˆ›å»ºå›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹-newfixedthreadpool">çº¿ç¨‹æ± ä¸­åˆ›å»ºå›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newFixedThreadPoolï¼ˆï¼‰<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ä¸­åˆ›å»ºå›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹-newfixedthreadpool">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutorService;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Executors;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolTest02 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//çº¿ç¨‹æ± ä¸­åˆ›å»º5ä¸ªçº¿ç¨‹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ExecutorService threadPool = Executors.<span style="color:#007f7f">newFixedThreadPool</span>(5);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 20; i++) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//åªæœ‰äº”ä¸ªçº¿ç¨‹æ¥å—ç†ï¼Œæ¥æ‰§è¡Œ20ä¸ªä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                threadPool.<span style="color:#007f7f">execute</span>(()-&gt;{
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;æ‰§è¡Œä¸šåŠ¡&#34;</span>);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            threadPool.<span style="color:#007f7f">shutdown</span>();  <span style="color:#007f7f">//å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<h3 id="çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸å›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹-newcachedthreadpool">çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸å›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹ newCachedThreadPool()<a hidden class="anchor" aria-hidden="true" href="#çº¿ç¨‹æ± ä¸­åˆ›å»ºä¸å›ºå®šæ•°ç›®çš„å¤šä¸ªçº¿ç¨‹-newcachedthreadpool">#</a></h3>
</blockquote>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.ExecutorService;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Executors;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ThreadPoolTest03 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºçº¿ç¨‹æ± ï¼Œæ± ä¸­çº¿ç¨‹æ•°æ˜¯ä¸å›ºå®šçš„ï¼Œçº¿ç¨‹å…·ä½“æ˜¯ä¼¸ç¼©çš„
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ExecutorService threadPool = Executors.<span style="color:#007f7f">newCachedThreadPool</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 20 ; i++) {
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//æœ‰Nä¸ªçº¿ç¨‹å—ç†ï¼Œæ¥æ‰§è¡Œ20ä¸ªä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                threadPool.<span style="color:#007f7f">execute</span>(()-&gt;{
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;æ‰§è¡Œä¸šåŠ¡&#34;</span>);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            threadPool.<span style="color:#007f7f">shutdown</span>(); <span style="color:#007f7f">//å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è‡ªå®šä¹‰çº¿ç¨‹æ± -threadpoolexecutor">è‡ªå®šä¹‰çº¿ç¨‹æ±  ThreadPoolExecutor()<a hidden class="anchor" aria-hidden="true" href="#è‡ªå®šä¹‰çº¿ç¨‹æ± -threadpoolexecutor">#</a></h2>
<p>é€šè¿‡æŸ¥çœ‹JDKæºç ï¼Œå‘ç°ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹æ³•éƒ½æ˜¯è°ƒç”¨äº†<strong>new ThreadPoolExecutor(ä¸ƒä¸ªå‚æ•°)</strong></p>
<p><strong>ä¸‰ç§åˆ›å»ºçº¿ç¨‹æ± æ–¹æ³•æºç å¦‚ä¸‹ï¼š</strong></p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIFh9A.png" alt="wIFh9A.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIFWhd.png" alt="wIFWhd.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIFRtH.png" alt="wIFRtH.png"  />
</p>
<p><strong>æŸ¥çœ‹ThreadPoolExecutor()æ–¹æ³•æºç å¦‚ä¸‹ï¼š</strong><img loading="lazy" src="https://s1.ax1x.com/2020/09/19/wIAUzR.png" alt="wIAUzR.png"  />
</p>
<p>å‘ç°è¯¥æ–¹æ³•æœ‰ä¸ƒä¸ªå‚æ•°</p>
<p><strong>int corePoolSize ï¼š<strong>æ ¸å¿ƒçº¿ç¨‹æ•°é‡ã€‚å½“åˆ›å»ºçº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°æ˜¯ä¸º0çš„ï¼Œå½“æœ‰ä»»åŠ¡è¿›æ¥æ—¶ï¼Œæ‰å¼€å§‹åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè€Œçº¿ç¨‹æ± ç©ºé—²æ—¶ï¼Œä¼šç»´æŠ¤ä¸€ä¸ªæœ€å°çº¿ç¨‹æ•°é‡ï¼Œå³ä½¿è¿™äº›çº¿ç¨‹æ•°æ˜¯ç©ºé—²çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šé”€æ¯å®ƒä»¬ï¼Œé™¤éè®¾ç½®äº†allowCoreThreadTimeOutï¼Œè€Œè¿™ä¸ªæœ€å°çº¿ç¨‹æ•°å°±æ˜¯</strong>corePoolSize</strong></p>
<p>**int maximumPoolSize ï¼š**æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚çº¿ç¨‹æ± ä¸ä¼šæ— é™åˆ¶çš„å»åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå®ƒä¼šæœ‰ä¸€ä¸ªæœ€å¤§çº¿ç¨‹æ•°é‡çš„é™åˆ¶ï¼Œè¿™ä¸ªæ•°é‡å³ç”±maximunPoolSizeæ¥æŒ‡å®š</p>
<p><strong>long keepAliveTime ï¼š<strong>çº¿ç¨‹ä¿ç•™çš„æ—¶é—´ã€‚ä¸€ä¸ªçº¿ç¨‹å¦‚æœå¤„äºç©ºé—²çŠ¶æ€ï¼Œå¹¶ä¸”å½“å‰çš„çº¿ç¨‹æ•°é‡å¤§äº</strong>corePoolSize</strong>ï¼Œé‚£ä¹ˆåœ¨æŒ‡å®šæ—¶é—´åï¼Œè¿™ä¸ªç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ï¼Œè¿™é‡Œçš„æŒ‡å®šæ—¶é—´ç”±<strong>keepAliveTime</strong>æ¥è®¾å®š</p>
<p>**TimeUnit unit ï¼š **  <strong>keepAliveTime</strong>çš„è®¡é‡å•ä½</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>TimeUnit.<span style="color:#007f7f">DAYS</span>; Â  Â  Â  Â  Â  Â  Â  <span style="color:#007f7f">//å¤© 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>TimeUnit.<span style="color:#007f7f">HOURS</span>; Â  Â  Â  Â  Â  Â  <span style="color:#007f7f">//å°æ—¶ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>TimeUnit.<span style="color:#007f7f">MINUTES</span>; Â  Â  Â  Â  Â  <span style="color:#007f7f">//åˆ†é’Ÿ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>TimeUnit.<span style="color:#007f7f">SECONDS</span>; Â  Â  Â  Â  Â  <span style="color:#007f7f">//ç§’ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>TimeUnit.<span style="color:#007f7f">MILLISECONDS</span>; Â  Â  Â <span style="color:#007f7f">//æ¯«ç§’ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>TimeUnit.<span style="color:#007f7f">MICROSECONDS</span>; Â  Â  Â <span style="color:#007f7f">//å¾®å¦™ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>TimeUnit.<span style="color:#007f7f">NANOSECONDS</span>; Â  Â  Â  <span style="color:#007f7f">//çº³ç§’
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>**BlockingQueue&lt; Runnable &gt; workQueue ï¼š**é˜»å¡é˜Ÿåˆ—ï¼Œå­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
<p>æ–°ä»»åŠ¡è¢«æäº¤åï¼Œä¼šå…ˆè¿›å…¥åˆ°æ­¤å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡è°ƒåº¦æ—¶å†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ã€‚jdkä¸­æä¾›äº†å››ç§å·¥ä½œé˜Ÿåˆ—ï¼š</p>
<p>ArrayBlockingQueue</p>
<p>åŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºã€‚æ–°ä»»åŠ¡è¿›æ¥åï¼Œä¼šæ”¾åˆ°è¯¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œæœ‰ç•Œçš„æ•°ç»„å¯ä»¥é˜²æ­¢èµ„æºè€—å°½é—®é¢˜ã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡è¾¾åˆ°corePoolSizeåï¼Œå†æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œåˆ™ä¼šå°†ä»»åŠ¡æ”¾å…¥è¯¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…è¢«è°ƒåº¦ã€‚å¦‚æœé˜Ÿåˆ—å·²ç»æ˜¯æ»¡çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°maxPoolSizeï¼Œåˆ™ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</p>
<p>LinkedBlockingQuene</p>
<p>åŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼ˆå…¶å®æœ€å¤§å®¹é‡ä¸ºInterger.MAXï¼‰ï¼ŒæŒ‰ç…§FIFOæ’åºã€‚ç”±äºè¯¥é˜Ÿåˆ—çš„è¿‘ä¼¼æ— ç•Œæ€§ï¼Œå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡è¾¾åˆ°corePoolSizeåï¼Œå†æœ‰æ–°ä»»åŠ¡è¿›æ¥ï¼Œä¼šä¸€ç›´å­˜å…¥è¯¥é˜Ÿåˆ—ï¼Œè€Œä¸ä¼šå»åˆ›å»ºæ–°çº¿ç¨‹ç›´åˆ°maxPoolSizeï¼Œå› æ­¤ä½¿ç”¨è¯¥å·¥ä½œé˜Ÿåˆ—æ—¶ï¼Œå‚æ•°maxPoolSizeå…¶å®æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚</p>
<p>SynchronousQuene</p>
<p>ä¸€ä¸ªä¸ç¼“å­˜ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…æ”¾å…¥ä¸€ä¸ªä»»åŠ¡å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…å–å‡ºè¿™ä¸ªä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´æ–°ä»»åŠ¡è¿›æ¥æ—¶ï¼Œä¸ä¼šç¼“å­˜ï¼Œè€Œæ˜¯ç›´æ¥è¢«è°ƒåº¦æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¾¾åˆ°maxPoolSizeï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</p>
<p>PriorityBlockingQueue</p>
<p>å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼Œä¼˜å…ˆçº§é€šè¿‡å‚æ•°Comparatorå®ç°ã€‚</p>
<p>**ThreadFactory threadFactory ï¼š**çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬é»˜è®¤å³å¯ã€‚å¯ä»¥ç”¨æ¥è®¾å®šçº¿ç¨‹åç­‰ç­‰</p>
<p><strong>RejectedExecutionHandler handler ï¼š</strong> æ‹’ç»ç­–ç•¥ï¼Œé˜Ÿåˆ—å·²æ»¡ï¼Œè€Œä¸”ä»»åŠ¡é‡å¤§äºå¤§çº¿ç¨‹çš„å¼‚å¸¸å¤„ç†ç­–ç•¥</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>ThreadPoolExecutor.<span style="color:#007f7f">AbortPolicy</span>; <span style="color:#007f7f">//ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadPoolExecutor.<span style="color:#007f7f">DiscardPolicy</span><span style="color:#f00">ï¼š</span><span style="color:#007f7f">//ä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadPoolExecutor.<span style="color:#007f7f">DiscardOldestPolicy</span><span style="color:#f00">ï¼š</span><span style="color:#007f7f">//æŠ›å¼ƒè¿›å…¥é˜Ÿåˆ—æœ€æ—©çš„é‚£ä¸ªä»»åŠ¡ï¼Œç„¶åå°è¯•æŠŠè¿™æ¬¡æ‹’ç»çš„ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>ThreadPoolExecutor.<span style="color:#007f7f">CallerRunsPolicy</span><span style="color:#f00">ï¼š</span><span style="color:#007f7f">//ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ä¸¾ä¾‹è®°å¿† ï¼Œé“¶è¡Œçª—å£åŠç†ä¸šåŠ¡çš„è¿‡ç¨‹éå¸¸é€‚åˆç†è§£è¿™ä¸ƒä¸ªå‚æ•°</strong></p>
<p>æµ‹è¯•ï¼š</p>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> MyThreadPoolTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         * åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">         */</span>
</span></span><span style="display:flex;"><span>        ThreadPoolExecutor threadPoolExecutor = <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor(
</span></span><span style="display:flex;"><span>                4,
</span></span><span style="display:flex;"><span>                8,
</span></span><span style="display:flex;"><span>                30L,
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#007f7f">SECONDS</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> LinkedBlockingDeque&lt;&gt;(6),
</span></span><span style="display:flex;"><span>                Executors.<span style="color:#007f7f">defaultThreadFactory</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#007f7f">DiscardOldestPolicy</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 10; i++) {
</span></span><span style="display:flex;"><span>                threadPoolExecutor.<span style="color:#007f7f">execute</span>(()-&gt;{
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;æ‰§è¡Œä¸šåŠ¡&#34;</span>);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            threadPoolExecutor.<span style="color:#007f7f">shutdown</span>(); <span style="color:#007f7f">//å…³é—­çº¿ç¨‹æ± 
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡ªå®šä¹‰çº¿ç¨‹æ± æœ€å¤§å®¹é‡ä¸ºï¼š<strong>æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSize ï¼‰ + é˜»å¡é˜Ÿåˆ—å®¹é‡(workQueue)</strong></p>
<h1 id="jucçš„å¸¸ç”¨ç±»">JUCçš„å¸¸ç”¨ç±»<a hidden class="anchor" aria-hidden="true" href="#jucçš„å¸¸ç”¨ç±»">#</a></h1>
<h2 id="semaphoreç±»ä¿¡å·é‡"><strong>Semaphoreç±»</strong>ï¼ˆä¿¡å·é‡ï¼‰<a hidden class="anchor" aria-hidden="true" href="#semaphoreç±»ä¿¡å·é‡">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">25
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">26
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">27
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">28
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.Semaphore;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.TimeUnit;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> SemaphoreTest {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">/**
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * ä¸‰ä¸ªè½¦ä½ï¼Œä¹ä¸ªäººå»æŠ¢
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * æ ¹æ®jucçš„è¾…åŠ©ç±»Semaphoreé™æµå®ç°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     * @param args
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è§„å®šåªèƒ½è¿›å»ä¸‰ä¸ª
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Semaphore semaphore = <span style="color:#fff;font-weight:bold">new</span> Semaphore(3);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt;9 ; i++) {       <span style="color:#007f7f">//å¼€å¯ä¹ä¸ªçº¿ç¨‹å»æŠ¢ä¸‰ä¸ªè½¦ä½
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                    semaphore.<span style="color:#007f7f">acquire</span>();<span style="color:#007f7f">//å¾—åˆ°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;å¾—åˆ°åœè½¦ä½&#34;</span>);
</span></span><span style="display:flex;"><span>                    TimeUnit.<span style="color:#007f7f">SECONDS</span>.<span style="color:#007f7f">sleep</span>(3);      <span style="color:#007f7f">//åœäº†ä¸‰ç§’ï¼Œç„¶åç¦»å¼€è½¦ä½ï¼Œç•™ç»™åé¢çš„äººè¿›æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;ç¦»å¼€åœè½¦ä½&#34;</span>);
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                }<span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>                    semaphore.<span style="color:#007f7f">release</span>();<span style="color:#007f7f">//é‡Šæ”¾
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                }
</span></span><span style="display:flex;"><span>            },String.<span style="color:#007f7f">valueOf</span>(i)).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://s1.ax1x.com/2020/09/18/w4Ntu8.png" alt="w4Ntu8.png"  />
</p>
<p>åœ¨ä¸Šè¿°æµ‹è¯•ä¸­ï¼Œsemaphoreå®šä¹‰äº†ä¸¤ä¸ªæ“ä½œ</p>
<ul>
<li>
<p><strong>acquireï¼ˆè·å–ï¼‰</strong></p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨acquire()æ–¹æ³•æ“ä½œæ—¶</p>
<ul>
<li>å½“å‰çº¿ç¨‹è¦ä¹ˆæˆåŠŸè·å–åˆ°ä¿¡å·é‡ï¼ˆå³ä¿¡å·é‡-1ï¼Œè¢«å äº†ä¸€ä¸ªï¼‰</li>
<li>è¦ä¹ˆç­‰å¾…å…¶å®ƒçº¿ç¨‹é‡Šæ”¾ä¿¡å·é‡ï¼Œæˆ–è€…ä¸€ç›´ç­‰å¾…åˆ°è¶…æ—¶</li>
</ul>
</li>
<li>
<p><strong>releaseï¼ˆé‡Šæ”¾ï¼‰</strong></p>
<p>å½“çº¿ç¨‹è°ƒç”¨release()æ–¹æ³•æ—¶ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šé‡Šæ”¾ä¿¡å·é‡ï¼ˆå³ä¿¡å·é‡+1ï¼‰ï¼Œä»¥ä¾¿å…¶å®ƒç­‰å¾…çš„çº¿ç¨‹æ‹¿åˆ°ä¿¡å·é‡</p>
</li>
</ul>
<h2 id="countdowlathç±»å€’è®¡æ—¶è®°æ•°å™¨"><strong>CountDowLathç±»ï¼ˆå€’è®¡æ—¶è®°æ•°å™¨ï¼‰</strong><a hidden class="anchor" aria-hidden="true" href="#countdowlathç±»å€’è®¡æ—¶è®°æ•°å™¨">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.CountDownLatch;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CountDownLatchTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> InterruptedException {
</span></span><span style="display:flex;"><span>        CountDownLatch countDownLatch = <span style="color:#fff;font-weight:bold">new</span> CountDownLatch(5);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 0; i &lt; 6; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>                countDownLatch.<span style="color:#007f7f">countDown</span>();<span style="color:#007f7f">//è®¡æ•°å‡ä¸€
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;çº¿ç¨‹æ‰§è¡Œå®Œæˆ&#34;</span>);
</span></span><span style="display:flex;"><span>            },String.<span style="color:#007f7f">valueOf</span>(i)).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        countDownLatch.<span style="color:#007f7f">await</span>(); <span style="color:#007f7f">//å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç­‰å¾…è®¡æ•°å™¨å½’é›¶  
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;END&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://s1.ax1x.com/2020/09/18/w4dTvq.png" alt="w4dTvq.png"  />
</p>
<p>åœ¨ä¸Šè¿°æµ‹è¯•ä¸­ï¼Œcountdowlathç±»æœ‰ä¸¤ä¸ªæ–¹æ³•</p>
<ul>
<li>
<p><strong>countDown()</strong></p>
<p>å½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨countDown()æ–¹æ³•æ—¶ï¼Œ<strong>è®¡æ•°å™¨ä¼šå‡1ï¼Œä¸”çº¿ç¨‹ä¸ä¼šè¢«é˜»å¡</strong></p>
</li>
<li>
<p><strong>await()</strong></p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹æˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨await()æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹<strong>ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’é›¶</strong>ï¼Œé˜»å¡çš„çº¿ç¨‹æ‰ä¼šé‡æ–°è¢«å”¤é†’ç»§ç»­å¾€ä¸‹æ‰§è¡Œ</p>
</li>
</ul>
<p>ä»æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œå…¶å®ƒå­çº¿ç¨‹è°ƒç”¨countDown()å¹¶æ²¡æœ‰è¢«é˜»å¡è€Œæ˜¯ç»§ç»­æ‰§è¡Œç›´è‡³å®Œæ¯•ï¼Œä½†è°ƒç”¨await()æ–¹æ³•çš„mainä¸»çº¿å´è¢«é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å½’é›¶æ‰é‡æ–°æ‰§è¡Œ</p>
<h2 id="cyclicbarrierç±»">CyclicBarrierç±»<a hidden class="anchor" aria-hidden="true" href="#cyclicbarrierç±»">#</a></h2>
<div class="highlight"><div style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 7
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 8
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">14
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">15
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">16
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">17
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">23
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#727272">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.BrokenBarrierException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.util.concurrent.CyclicBarrier;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> CyclicBarrierTest {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) {
</span></span><span style="display:flex;"><span>        CyclicBarrier cyclicBarrier = <span style="color:#fff;font-weight:bold">new</span> CyclicBarrier(7,()-&gt;{
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;å‡ºæ¥å§ï¼ç¥é¾™&#34;</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;= 7; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> temp = i;     <span style="color:#007f7f">//JDK1.8ä¹‹å‰è¦ç”¨finalä¿®é¥°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            <span style="color:#fff;font-weight:bold">new</span> Thread(()-&gt;{
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(Thread.<span style="color:#007f7f">currentThread</span>().<span style="color:#007f7f">getName</span>()+<span style="color:#0ff;font-weight:bold">&#34;çº¿ç¨‹==ã€‹å¾—åˆ°äº†ç¬¬&#34;</span>+ temp +<span style="color:#0ff;font-weight:bold">&#34;é¢—é¾™ç &#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                    cyclicBarrier.<span style="color:#007f7f">await</span>();  <span style="color:#007f7f">//è®©çº¿ç¨‹ç­‰å¾…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                } <span style="color:#fff;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>                    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">catch</span> (BrokenBarrierException e) {
</span></span><span style="display:flex;"><span>                    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>();
</span></span><span style="display:flex;"><span>            },String.<span style="color:#007f7f">valueOf</span>(i)).<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p><img loading="lazy" src="https://s1.ax1x.com/2020/09/18/w40bAU.png" alt="w40bAU.png"  />
</p>
<p>CyclicBarrierä¸ä¸Šé¢è®¡æ•°å™¨(CountDowLath)ä½œç”¨ç›¸åï¼Œ<strong>å½“ç­‰å¾…çº¿ç¨‹è¾¾åˆ°æŒ‡å®šæ•°ç›®ï¼Œåˆ™é‡Šæ”¾ç­‰å¾…çš„çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„å†…å®¹</strong>ï¼Œè­¬å¦‚ä¸Šè¿°æµ‹è¯•ï¼Œé›†é½ä¸ƒé¢—é¾™ç å¬å”¤ç¥é¾™</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://shaoyi.cc/tags/java/">Java</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://shaoyi.cc/posts/blog/mq/activemq/activemq/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ</span>
  </a>
  <a class="next" href="http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/mysql/mysql%E4%B9%8Bexplain/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Mysqlä¹‹Explainè¯¦è§£</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://shaoyi.cc/">Shaoyi&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
