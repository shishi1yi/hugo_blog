<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ | ååä¹™çš„åšå®¢</title>
<meta name="keywords" content="ActiveMQ">
<meta name="description" content="ActiveMQçš„åº”ç”¨">
<meta name="author" content="
ä½œè€…:&nbsp;ååä¹™">
<link rel="canonical" href="http://shaoyi.cc/posts/blog/mq/activemq/activemq/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bb3fd15879e1b070bc3f661ad98fef35fef1f31a23b6bec0b04e5cb164937952.css" integrity="sha256-uz/RWHnhsHC8P2Ya2Y/vNf7x8xojtr7AsE5csWSTeVI=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://shaoyi.cc/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://shaoyi.cc/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://shaoyi.cc/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://shaoyi.cc/apple-touch-icon.png">
<link rel="mask-icon" href="http://shaoyi.cc/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ" />
<meta property="og:description" content="ActiveMQçš„åº”ç”¨" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://shaoyi.cc/posts/blog/mq/activemq/activemq/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-03T19:18:23&#43;08:00" />
<meta property="article:modified_time" content="2022-07-04T19:18:23&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ"/>
<meta name="twitter:description" content="ActiveMQçš„åº”ç”¨"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "ğŸ“šæ–‡ç« ",
      "item": "http://shaoyi.cc/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ğŸ“•æŠ€æœ¯",
      "item": "http://shaoyi.cc/posts/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ",
      "item": "http://shaoyi.cc/posts/blog/mq/activemq/activemq/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ",
  "name": "æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ",
  "description": "ActiveMQçš„åº”ç”¨",
  "keywords": [
    "ActiveMQ"
  ],
  "articleBody": "ActiveMQå®‰è£…ï¼ˆDockerç¯å¢ƒä¸‹ï¼‰ é¦–å…ˆåœ¨dockeræœç´¢ActiveMQï¼Œå‘ç°webcenter/activemq è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨æ˜¯æœ€å¤šçš„\nç„¶åé€‰æ‹©ç‰ˆæœ¬ï¼Œä¸‹è½½activeMQ\næŸ¥çœ‹é•œåƒï¼Œé…ç½®å¥½activemqå®¹å™¨çš„åå°ç«¯å£ï¼ˆ61616ï¼‰å’Œå‰å°ç«¯å£ï¼ˆ8161ï¼‰çš„æ˜ å°„å…³ç³»ï¼Œå¹¶å¯åŠ¨å®ƒ\næµè§ˆå™¨è®¿é—®ï¼Œå¦‚ä¸‹å›¾ï¼Œä¾¿å®‰è£…å®Œæˆ\nJMSå®ç°æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… é˜Ÿåˆ—çš„æ–¹å¼ ç”Ÿäº§è€…ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsProduce { private static final String ACTIVEMQ_URL=\"tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\"; private static final String QUEUE_NAME=\"myQueue\"; public static void main(String[] args) throws JMSException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = connectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼ï¼‰ Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageProducer messageProducer = session.createProducer(destination); //ç”Ÿäº§4æ¡æ¶ˆæ¯ for (int i = 1; i \u003c 5; i++) { //åˆ›å»ºæ¶ˆæ¯å†…å®¹ TextMessage message = session.createTextMessage(\"ç¬¬\" + i + \"æ¡æ¶ˆæ¯\"); //å‘é€æ¶ˆæ¯ messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\"æ¶ˆæ¯å‘é€å®Œæˆï¼\"); } } æ‰§è¡Œåçš„ç»“æœï¼š\næ¶ˆè´¹è€…ï¼ˆreceive()æ–¹æ³•è·å–ä¿¡æ¯ï¼‰ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsConsumer { private static final String ACTIVEMQ_URL=\"tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\"; private static final String QUEUE_NAME=\"myQueue\"; public static void main(String[] args) throws JMSException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = activeMQConnectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°(è¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼) Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageConsumer messageConsumer = session.createConsumer(destination); while (true){ //è¯»å–æ¶ˆæ¯ TextMessage textMessage = (TextMessage)messageConsumer.receive(); if (null !=textMessage){ //è·å–æ¶ˆæ¯å†…å®¹å¹¶æ‰“å° System.out.println(\"æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯: \"+textMessage.getText()); }else { break; } } //å…³é—­èµ„æº messageConsumer.close(); session.close(); connection.close(); } } æ‰§è¡Œç»“æœï¼š\næ¶ˆè´¹è€…ï¼ˆç›‘å¬å™¨MessageListeneræ–¹å¼è·å–ä¿¡æ¯ï¼‰\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; import java.io.IOException; public class JmsConsumer02 { private static final String ACTIVEMQ_URL=\"tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\"; private static final String QUEUE_NAME=\"myQueue\"; public static void main(String[] args) throws JMSException, IOException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = activeMQConnectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°(è¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼) Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageConsumer messageConsumer = session.createConsumer(destination); messageConsumer.setMessageListener((message) -\u003e { if (null != message \u0026\u0026 message instanceof TextMessage){ TextMessage textMessage = (TextMessage) message; try { System.out.println(\"æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯: \"+textMessage.getText()); } catch (JMSException e) { e.printStackTrace(); } } }); System.in.read(); //é˜²æ­¢æ¶ˆæ¯è¿˜æ²¡æœ‰è¯»å–åˆ°å°±å…³é—­èµ„æºäº† //å…³é—­èµ„æº messageConsumer.close(); session.close(); connection.close(); } } æ¶ˆè´¹è€…è·å–æ¶ˆæ¯çš„æ–¹å¼\nreceive() æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯åŒæ­¥é˜»å¡çš„ï¼Œå¦‚æœè°ƒç”¨è€…ï¼ˆé˜Ÿåˆ—æˆ–è€…è®¢é˜…æ–¹ï¼‰æ²¡æœ‰æ¥å—åˆ°æ¶ˆæ¯ï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…\né™¤æ­¤ä¹‹å¤–å®ƒæœ‰ä¸€ä¸ªé‡è½½æ–¹æ³• receive(long timeout) ï¼Œå‚æ•°è¡¨ç¤ºçš„æ˜¯ ç­‰å¾…çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œåœ¨ç­‰å¾…æ—¶é—´å†…æ²¡æœ‰æ¥å—åˆ°æ¶ˆæ¯å°±è‡ªåŠ¨åœæ­¢\nsetMessageListener(MessageListener listener) æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯å¼‚æ­¥éé˜»å¡çš„ï¼Œè€Œæ–¹æ³•å‚æ•°ç±»å‹æ˜¯MessageListeneræ¥å£ï¼Œè¿™ä¸ªæ¥å£é‡Œåªå®šä¹‰äº†ä¸€ä¸ªç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„onMessageæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åªæ¥æ”¶ä¸€ä¸ªMessageå‚æ•°ç›‘å¬å™¨ã€‚å½“æ¶ˆæ¯åˆ°è¾¾ä¹‹åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨onMessageæ–¹æ³•è·å–ä¿¡æ¯\næ¶ˆè´¹è€…çš„ä¸‰ç§æƒ…å†µ\nå…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œç”Ÿäº§æ¶ˆæ¯ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ˜¯å¦å¯ä»¥æ­£å¸¸æ¶ˆè´¹ä¿¡æ¯ ï¼Ÿ\nç­”æ¡ˆï¼šå¯ä»¥çš„ è¿˜æ˜¯å…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œç”Ÿäº§æ¶ˆæ¯ï¼Œå†åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œåä¸€ä¸ªå¯åŠ¨çš„æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°æ¶ˆæ¯å— ï¼Ÿ\nç­”æ¡ˆï¼šå¦ï¼Œåä¸€ä¸ªå¯åŠ¨çš„æ¶ˆè´¹è€…æ˜¯æ¶ˆè´¹ä¸åˆ°çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯éƒ½è¢«å‰ä¸€ä¸ªå¯åŠ¨çš„æ¶ˆæ¯è€…æ¶ˆè´¹å®Œäº† å…ˆå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå†å¯åŠ¨ç”Ÿäº§è€…ç”Ÿäº§6æ¡æ¶ˆæ¯ï¼Œç»“æœå¦‚ä½• ï¼Ÿ\nç­”æ¡ˆï¼šæ¶ˆæ¯è¢«å¹³åˆ†ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…ä¸€äººä¸€åŠï¼Œåˆ†åˆ«æ¶ˆè´¹3æ¡æ¶ˆæ¯ å‘å¸ƒè®¢é˜…æ–¹å¼ ç”Ÿäº§è€…ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsProduce_Topic { private static final String ACTIVEMQ_URL=\"tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\"; private static final String TOPIC_NAME=\"myTopic\"; public static void main(String[] args) throws JMSException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = connectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºå‘å¸ƒè®¢é˜…æ–¹å¼ï¼‰ Destination destination = session.createTopic(TOPIC_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageProducer messageProducer = session.createProducer(destination); //ç”Ÿäº§4æ¡æ¶ˆæ¯ for (int i = 1; i \u003c 5; i++) { //åˆ›å»ºæ¶ˆæ¯å†…å®¹ TextMessage message = session.createTextMessage(\"ç¬¬\" + i + \"æ¡æ¶ˆæ¯\"); //å‘é€æ¶ˆæ¯ messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\"æ¶ˆæ¯å‘é€å®Œæˆï¼\"); } } â€‹\tå‘å¸ƒè®¢é˜…çš„æ–¹å¼å’Œé˜Ÿåˆ—æ–¹å¼ï¼Œ ä»ç”Ÿäº§è€…çš„ä»£ç å¯ä»¥å‘ç°ï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯ï¼Œåˆ›å»ºç›®çš„åœ°çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œé˜Ÿåˆ—æ˜¯createQueue(String queueName)ï¼Œè€Œå‘å¸ƒè®¢é˜…æ˜¯createTopic(String topicName)ã€‚åŒæ ·çš„ï¼Œæ¶ˆè´¹è€…çš„ä»£ç å’Œé˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€æ ·çš„\næ¶ˆè´¹è€…\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; import java.io.IOException; public class JmsConsumer_Topic { private static final String ACTIVEMQ_URL=\"tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\"; private static final String TOPIC_NAME=\"myTopic\"; public static void main(String[] args) throws JMSException, IOException { //åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚ ActiveMQConnectionFactory activeMQConnectionFactory = new ActiveMQConnectionFactory(); //åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨ Connection connection = activeMQConnectionFactory.createConnection(); connection.start(); //åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºå‘å¸ƒè®¢é˜…æ–¹å¼ï¼‰ Destination destination = session.createTopic(TOPIC_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageConsumer messageConsumer = session.createConsumer(destination); //é€šè¿‡ç›‘å¬å™¨ï¼Œæ¥å—æ¶ˆæ¯ messageConsumer.setMessageListener((message) -\u003e { if (null != message \u0026\u0026 message instanceof TextMessage) { try { TextMessage textMessage = (TextMessage) message; System.out.println(\"æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯: \" + textMessage.getText()); } catch (JMSException e) { e.printStackTrace(); } } }); System.in.read();//é˜»å¡ç­‰å¾… //å…³é—­èµ„æº messageConsumer.close(); session.close(); connection.close(); } } â€‹\tä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå‘å¸ƒè®¢é˜…çš„æ¨¡å¼ï¼Œè¦å…ˆå¯ç”¨è®¢é˜…æ–¹ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…æ–¹ï¼Œå†å¯åŠ¨å‘å¸ƒæ–¹ï¼ˆç”Ÿäº§è€…ï¼‰ã€‚å¦åˆ™ï¼Œå°±ç±»ä¼¼å¾®ä¿¡å…¬ä¼—å·ä¸€æ ·ï¼Œæ²¡æœ‰äººè®¢é˜…ï¼Œç”Ÿäº§æ–¹å‘å¸ƒæ¶ˆæ¯æ˜¯æ²¡æœ‰äººæ¥å—çš„åˆ°ï¼Œä¼šè¢«ä¸¢å¼ƒã€‚è¿™ç§åˆ™æ˜¯åºŸæ¶ˆæ¯ã€‚\né˜Ÿåˆ—å’Œå‘å¸ƒè®¢é˜…ä¸¤è€…å¯¹æ¯” æ¯” è¾ƒ é¡¹ ç›® Topic ï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ¨¡å¼ Queue ï¼ˆé˜Ÿåˆ—ï¼‰æ¨¡å¼ å·¥ ä½œ æ¨¡ å¼ â€œè®¢é˜…-å‘å¸ƒâ€æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰è®¢é˜… è€…ï¼Œæ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒï¼Œå¦‚æœæœ‰å¤šä¸ªè®¢é˜… è€…ï¼Œé‚£ä¹ˆè¿™äº›è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ è´Ÿè½½å‡è¡¡ æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¼ƒï¼Œå¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä¸€æ¡æ¶ˆæ¯ ä¹Ÿåªä¼šå‘é€ç»™å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ä¸”è¦æ±‚æ¶ˆè´¹è€…ackä¿¡æ¯ æœ‰ æ—  çŠ¶ æ€ æ— çŠ¶æ€ Queue æ•°æ®é»˜è®¤ä¼šåœ¨ mq æœåŠ¡å™¨ä¸Šä»¥æ–‡ä»¶å½¢å¼ ä¿å­˜ï¼Œæ¯”å¦‚ Active MQ ä¸€èˆ¬ä¿å­˜åœ¨ $AMQ_HOME\\data\\kr-store\\dataä¸‹é¢ï¼Œä¹Ÿå¯ ä»¥é…ç½®æˆDBå­˜å‚¨ ä¼  é€’ å®Œ æ•´ æ€§ å¦‚æœæ²¡æœ‰è®¢é˜…è€…ï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ æ¶ˆæ¯ä¸ä¼šä¸¢å¼ƒ å¤„ ç† æ•ˆ ç‡ ç”±äºæ¶ˆæ¯è¦æŒ‰ç…§è®¢é˜…è€…çš„æ•°é‡è¿›è¡Œå¤ åˆ¶ï¼Œæ‰€ä»¥å¤„ç†æ€§èƒ½ä¼šéšç€è®¢é˜…è€…çš„å¢åŠ  è€Œæ˜æ˜¾é™ä½ï¼Œå¹¶ä¸”è¿˜è¦ç»“åˆä¸åŒæ¶ˆæ¯å è®®è‡ªèº«çš„æ€§èƒ½å·®å¼‚ ç”±äºä¸€æ¡æ¶ˆæ¯åªå‘é€ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥å°±ç®— æ¶ˆè´¹è€…å†å¤šï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾é™ä½ã€‚å½“ç„¶ä¸ åŒæ¶ˆæ¯åè®®çš„å…·ä½“æ€§èƒ½ä¹Ÿæ˜¯æœ‰å·®å¼‚çš„ã€‚ JMS â€‹\tJMSæ˜¯Java EEçš„ä¸€ä¸ªé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„ä¸€å¥—è§„èŒƒï¼Œå…·ä½“éœ€è¦é å‚å•†çš„äº§å“å®ç°\næ¶ˆæ¯çš„ä¸‰ç§éƒ¨åˆ† æ¶ˆæ¯å¤´ åœ¨ç”Ÿäº§è€…æ–¹ï¼Œæ¶ˆæ¯çš„APIçœ‹å‡ºå¯ä»¥é’ˆå¯¹æ¯ä¸€æ¡æ¶ˆæ¯è®¾ç½®ä¸åŒçš„æ¶ˆæ¯å¤´å±æ€§ å¦‚æœä¸æƒ³ä¸ºæ¯ä¸€æ¡æ¶ˆæ¯å•ç‹¬è®¾ç½®æ¶ˆæ¯å¤´å±æ€§ï¼Œå¯ä»¥é€šè¿‡Send()æ–¹æ³•çš„é‡è½½ï¼Œæ‰¹å¤„ç†æ¶ˆæ¯çš„æ¶ˆæ¯å¤´å±æ€§ ä»æ‰¹å¤„ç†æ¶ˆæ¯å¤´å±æ€§å’Œå•ç‹¬è®¾ç½®æ¶ˆæ¯å¤´å±æ€§ä¸¤è€…ç»“åˆæ¥çœ‹ï¼Œä¸»è¦ä»‹ç»äº”ä¸ªæ¶ˆæ¯å¤´å±æ€§ï¼š JMSDestinationï¼š æ¶ˆæ¯å‘é€çš„ç›®çš„åœ°ï¼Œä¸»è¦æ˜¯æŒ‡ Queue å’Œ Topic\nJMSDeliveryModeï¼š æŒä¹…æ¨¡å¼å’ŒéæŒä¹…æ¨¡å¼ï¼Œå¯è®¾ç½®çš„å‚æ•°ä¸ºDeliveryMode.NON_PERSISTENT(éæŒä¹…) å’Œ DeliveryMode.PERSISTENT(æŒä¹…)\nä¸€æ¡æŒä¹…æ€§çš„æ¶ˆæ¯ï¼šåº”è¯¥è¢«ä¼ é€ â€œä¸€æ¬¡ä»…ä»…ä¸€æ¬¡â€ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœJMS æä¾›è€…å‡ºç°æ•…éšœï¼Œè¯¥æ¶ˆæ¯å¹¶ä¸ä¼šä¸¢å¤±ï¼Œå®ƒä¼šåœ¨æœåŠ¡å™¨æ¢å¤ä¹‹åå†æ¬¡ä¼ é€’æ¶ˆæ¯ã€‚ ä¸€æ¡éæŒä¹…çš„æ¶ˆæ¯ï¼šå¤šä¼šä¼ é€ä¸€æ¬¡ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œè¯¥æ¶ˆæ¯å°†æ°¸ä¹…ä¸¢å¤±ã€‚\nJMSPriority ï¼š æ¶ˆæ¯ä¼˜å…ˆçº§ï¼Œä»0 ~ 9 åä¸ªçº§åˆ«ï¼Œ0 ~ 4 æ˜¯æ™®é€šæ¶ˆæ¯ï¼Œ5 ~ 9æ˜¯åŠ æ€¥æ¶ˆæ¯ã€‚\nJMS ä¸è¦æ±‚ MQ ä¸¥æ ¼æŒ‰ç…§è¿™åä¸ªä¼˜å…ˆçº§å‘é€æ¶ˆæ¯ï¼Œä½†å¿…é¡»ä¿è¯åŠ æ€¥æ¶ˆæ¯è¦å…ˆäºæ™®é€šæ¶ˆæ¯åˆ°è¾¾ï¼Œé»˜è®¤æ˜¯4 çº§ã€‚\nJMSExpirationï¼š å¯ä»¥è®¾ç½®æ¶ˆæ¯åœ¨ä¸€å®šæ—¶é—´åè¿‡æœŸï¼Œé»˜è®¤æ˜¯æ°¸ä¸è¿‡æœŸã€‚æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼Œç­‰äºDestinationçš„sendæ–¹æ³•ä¸­çš„timeToLiveå€¼åŠ ä¸Šå‘é€æ—¶åˆ»çš„GMTæ—¶é—´\nå€¼ã€‚ å¦‚æœtimeToLiveå€¼ç­‰äºé›¶ï¼Œåˆ™ JMSExpiration è¢«è®¾ä¸ºé›¶ï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯æ°¸ä¸è¿‡æœŸã€‚å¦‚æœå‘é€åï¼Œåœ¨æ¶ˆæ¯è¿‡æœŸæ—¶é—´ä¹‹åæ¶ˆæ¯è¿˜æ²¡æœ‰è¢«å‘é€åˆ°ç›®çš„åœ°ï¼Œåˆ™è¯¥æ¶ˆæ¯è¢«æ¸…é™¤ã€‚\nJMSMessageID ï¼š å”¯ä¸€è¯†åˆ«æ¯ä¸ªæ¶ˆæ¯çš„æ ‡è¯†ï¼Œç”±MQäº§ç”Ÿã€‚\næ¶ˆæ¯ä½“ å°è£…å…·ä½“çš„æ¶ˆæ¯æ•°æ®ï¼Œå‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯ä½“ç±»å‹å¿…é¡»ä¸€è‡´å¯¹åº”ï¼\näº”ç§æ¶ˆæ¯ä½“æ ¼å¼ï¼š\nTextMessageï¼š æ™®é€šå­—ç¬¦ä¸²æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªString ã€‚\nMapMessageï¼š ä¸€ä¸ªMapç±»å‹çš„æ¶ˆæ¯ï¼Œkeyä¸ºStringç±»å‹ï¼Œè€Œå€¼ä¸ºJavaçš„åŸºæœ¬ç±»å‹ã€‚\nBytesMessage ï¼š äºŒè¿›åˆ¶æ•°ç»„æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªbyte[] ã€‚\nStreamMessage ï¼š Javaæ•°æ®æµæ¶ˆæ¯ï¼Œç”¨æ ‡å‡†æµæ“ä½œæ¥é¡ºåºçš„å¡«å……å’Œè¯»å–ã€‚\nObjectMessage ï¼šå¯¹è±¡æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ Java å¯¹è±¡ã€‚\næ¶ˆæ¯å±æ€§ å¦‚æœéœ€è¦é™¤æ¶ˆæ¯å¤´å­—æ®µä»¥å¤–çš„å€¼ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ¶ˆæ¯å±æ€§ï¼\nè¯†åˆ«ã€å»é‡ã€é‡ç‚¹æ ‡æ³¨ç­‰æ“ä½œéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼\næ¶ˆæ¯å±æ€§æ˜¯ä»¥å±æ€§åå’Œå±æ€§å€¼å¯¹çš„å½¢å¼æŒ‡å®šçš„ã€‚å¯ä»¥å°†å±æ€§æ˜¯ä¸ºæ¶ˆæ¯å¤´çš„æ‰©å±•ï¼Œå±æ€§æŒ‡å®šä¸€äº›æ¶ˆæ¯å¤´æ²¡æœ‰åŒ…æ‹¬çš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚å¯ä»¥åœ¨å±æ€§é‡ŒæŒ‡å®šæ¶ˆæ¯é€‰æ‹©å™¨ã€‚\nä»¥Propertyç»“å°¾ï¼š\næ¶ˆæ¯çš„å¯é æ€§ æŒä¹…æ€§ é˜Ÿåˆ— //åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼ï¼‰ Destination destination = session.createQueue(QUEUE_NAME); //åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€… MessageProducer messageProducer = session.createProducer(destination); // éæŒä¹…åŒ– ï¼šæœåŠ¡å™¨å®•æœºï¼Œåˆ™æ¶ˆæ¯ä¸èƒ½æ¢å¤ messageProducer.setDeliveryMode(DeliveryMode.NON_PERSISTENT); // æŒä¹…åŒ– ï¼šæœåŠ¡å™¨å®•æœºï¼Œæ¶ˆæ¯å¯ä»¥æ¢å¤ messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT); é˜Ÿåˆ—æ˜¯å¦è®¾ç½®ä¸ºæŒä¹…ï¼Œå¯ä»¥é€šè¿‡setDeliveryMode(int deliveryMode)æ–¹æ³•è®¾ç½®ï¼Œé»˜è®¤ä¸ºæŒä¹…\næŒä¹…æ€§ å‘å¸ƒè®¢é˜… å‘å¸ƒæ–¹ï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œé¡ºåºä¸ä¹‹å‰æœ‰ä¸€ç‚¹ä¸åŒï¼Œéœ€è¦è®¾å®šå…ˆæŒä¹…åŒ–ï¼Œåœ¨å¯åŠ¨è¿æ¥\næµ‹è¯•ä»£ç ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsProduce_Topic_DeliveryMode { private static final String ACTIVEMQ_URL=\"tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\"; private static final String TOPIC_NAME=\"my_topic_persist\"; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = connectionFactory.createConnection(); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Topic topic = session.createTopic(TOPIC_NAME); MessageProducer messageProducer = session.createProducer(topic); //è®¾ç½®å‘å¸ƒæ–¹ä¸º æŒä¹… messageProducer.setDeliveryMode(DeliveryMode.PERSISTENT); //è®¾å®šä¸ºæŒä¹…åï¼Œç„¶åè¿æ¥ connection.start(); for (int i = 1; i \u003c=3; i++) { TextMessage message = session.createTextMessage(\"ç¬¬\" + i + \"æ¡æ¶ˆæ¯\"); messageProducer.send(message); } //å…³é—­èµ„æº messageProducer.close(); session.close(); connection.close(); System.out.println(\"æ¶ˆæ¯å‘é€å®Œæˆï¼\"); } } è®¢é˜…æ–¹ï¼ˆæ¶ˆè´¹è€…ï¼‰æµ‹è¯•ä»£ç ï¼š\nimport org.apache.activemq.ActiveMQConnectionFactory; import javax.jms.*; public class JmsConsumer_Topic_DeliveryMode { private static final String ACTIVEMQ_URL=\"tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·\"; private static final String TOPIC_NAME=\"my_topic_persist\"; public static void main(String[] args) throws JMSException { ActiveMQConnectionFactory connectionFactory = new ActiveMQConnectionFactory(ACTIVEMQ_URL); Connection connection = connectionFactory.createConnection(); //è®¢é˜…æ–¹çš„id connection.setClientID(\"001\"); Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); Topic topic = session.createTopic(TOPIC_NAME); //åˆ›å»ºæŒä¹…çš„è®¢é˜…æ–¹ TopicSubscriber topicSubscriber = session.createDurableSubscriber(topic, \"ååä¹™\"); //æŒä¹…åŒ–åï¼Œå†è¿›è¡Œè¿æ¥ connection.start(); Message message = topicSubscriber.receive(); while (null != message){ TextMessage textMessage = (TextMessage)message; System.out.println(\"è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\"+textMessage.getText()); message = topicSubscriber.receive(3000L); } topicSubscriber.close(); session.close(); connection.close(); } } å…ˆå¯åŠ¨è®¢é˜…æ–¹ï¼Œå†å¯åŠ¨å‘å¸ƒæ–¹ï¼Œåˆ°ActiveMQå‰å°çš„SubscribersæŸ¥çœ‹\nå¯åŠ¨å‰æƒ…å†µï¼š\nå¯åŠ¨è®¢é˜…æ–¹åæƒ…å†µï¼š\nå¯åŠ¨ç”Ÿäº§æ–¹ åï¼š\nè®¢é˜…æ–¹åœæ­¢åï¼Œä¼šè¢«åˆ— ç¦»çº¿çš„ä¸€æ å»ï¼š\nå¦‚æœè¿™æ—¶ï¼Œå‘å¸ƒè€…å†æ¬¡å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…æ–¹é‡å¯å¯åŠ¨æ˜¯å¦èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯\nå†æ¬¡å¯åŠ¨è®¢é˜…æ–¹(ä¸åœæ­¢)å\nå°ç»“ï¼š\nâ€‹\tç¬¬ä¸€æ¬¡ï¼Œä¸€å®šè¦å…ˆå¯åŠ¨è®¢é˜…æ–¹ï¼Œä¹‹åå¯åŠ¨å‘å¸ƒæ–¹ï¼Œå‘å¸ƒæ¶ˆæ¯ã€‚è¿™æ—¶ä¸è®ºè®¢é˜…æ–¹åœ¨ä¸åœ¨çº¿ï¼Œéƒ½å¯ä»¥æ¥å—åˆ°æ¶ˆæ¯ï¼Œä¸åœ¨çº¿ï¼Œé‡æ–°å¯åŠ¨åä¼šæ¥å—æ²¡æœ‰æ”¶åˆ°è¿‡çš„æ¶ˆæ¯æ¥å—ä¸‹æ¥\näº‹åŠ¡ äº‹åŠ¡åå‘äºç”Ÿäº§è€…ã€ç­¾æ”¶åå‘äºæ¶ˆè´¹è€…\n//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶ Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); äº‹åŠ¡åªæœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalse\nç”Ÿäº§è€…ä¸€æ–¹\nå½“å€¼ä¸ºfalseæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨å‘é€åˆ°ç›®çš„åœ°\nå½“å€¼ä¸ºtrueæ—¶ï¼Œéœ€è¦åœ¨è°ƒç”¨send()æ–¹æ³•åï¼Œè°ƒç”¨commit()æ–¹æ³•ï¼Œæ‰‹åŠ¨æäº¤\næ¶ˆè´¹è€…ä¸€æ–¹\nå½“å€¼ä¸ºfalseæ—¶ï¼Œæ¶ˆæ¯åªä¼šè¢«æ¶ˆè´¹ä¸€æ¬¡\nå½“å€¼ä¸ºtrueæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Œä¸”åœ¨ç›®çš„åœ°ä¸­ï¼Œæ¶ˆæ¯ä¸ä¼šå‡ºé˜Ÿçš„ï¼Œå³æœªè¢«æ¶ˆè´¹\næµ‹è¯•ï¼š\n//åˆ›å»ºä¼šè¯ï¼Œå¼€å¯äº‹åŠ¡ Session session = connection.createSession(true, Session.AUTO_ACKNOWLEDGE); try { //OK,å°±æäº¤ session.commit(); } catch (JMSException e) { //error,å°±å›æ»š session.rollback(); }finally { //å…³é—­èµ„æº } ç­¾æ”¶æœºåˆ¶ ç­¾æ”¶é’ˆå¯¹çš„æ˜¯æ¶ˆè´¹è€…ä¸€æ–¹ï¼Œåˆ†ä¸ºä»¥ä¸‹å››ç§\npublic interface Session extends Runnable { static final int AUTO_ACKNOWLEDGE = 1; //è‡ªåŠ¨ç­¾æ”¶ï¼ˆé»˜è®¤ï¼‰ static final int CLIENT_ACKNOWLEDGE = 2;\t//æ‰‹åŠ¨ç­¾æ”¶ï¼Œéœ€è¦è°ƒç”¨ message.acknowledge(); è¿›è¡Œç­¾æ”¶ï¼Œå¦åˆ™ä¹Ÿä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹ static final int DUPS_OK_ACKNOWLEDGE = 3;\t//è‡ªåŠ¨æ‰¹é‡ç¡®è®¤ static final int SESSION_TRANSACTED = 0;\t//è¿™ä¸ªæ˜¯é…åˆäº‹åŠ¡ï¼Œå½“äº‹åŠ¡å¼€å¯åˆ™é€‰æ‹©è¿™ä¸ªï¼Œä¸»è¦æ˜¯ä¸€ä¸ªè¯­æ³•çš„ä¸€ä¸ªè§„èŒƒè€Œå·² å½“äº‹åŠ¡æ²¡æœ‰å¼€å¯æ—¶ ï¼š å³éäº‹åŠ¡ï¼Œæ¶ˆæ¯çš„ç¡®è®¤æƒ…å†µ åˆ™ä»¥ç­¾æ”¶æœºåˆ¶ä¸ºä¸»\nå½“äº‹åŠ¡å¼€å§‹æ—¶ ï¼š å³äº‹åŠ¡æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯çš„ç¡®è®¤ä»¥äº‹åŠ¡ä¸ºä¸»ï¼Œå³æ˜¯å¦commitçš„ä¸ºä¸»ï¼Œä¸ç”¨ç®¡ç­¾æ”¶æœºåˆ¶çš„æƒ…å†µã€‚\næ³¨ï¼šå¸¸ç”¨çš„ç­¾æ”¶æ¨¡å¼ ä¸»è¦ä»¥è‡ªåŠ¨ç­¾æ”¶ï¼ˆAUTO_ACKNOWLEDGEï¼‰å’Œæ‰‹åŠ¨ç­¾æ”¶ï¼ˆCLIENT_ACKNOWLEDGEï¼‰ä¸ºä¸»\nSpringBootç»“åˆACtiveMQ é˜Ÿåˆ—æ¨¡å¼ 1ã€å¯¼å…¥mavenä¾èµ–\norg.springframework.boot spring-boot-starter-web org.springframework.boot spring-boot-starter-activemq 2ã€ç¼–å†™application.propertiesé…ç½®æ–‡ä»¶\nserver.port=8888 # é…ç½®activemqçš„é“¾æ¥ï¼Œç”¨æˆ·åå’Œå¯†ç  spring.activemq.broker-url=tcp://æœåŠ¡å™¨å…¬ç½‘ip:ç«¯å£å· spring.activemq.user=admin spring.activemq.password=admin #é…ç½®æ˜¯å¦ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼ #falseä¸ºé˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰ #tureä¸ºå‘å¸ƒè®¢é˜… spring.jms.pub-sub-domain=false #é˜Ÿåˆ—åç§°ï¼ˆè‡ªå®šä¹‰æ ‡ç­¾ï¼‰ myqueue=activemq_springboot_queue 3ã€ç¼–å†™é…ç½®ç±»\npackage com.shishiyi.config; import org.apache.activemq.command.ActiveMQQueue; import org.springframework.beans.factory.annotation.Value; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import javax.jms.Queue; @Configuration public class ActiveMQConfig { //æ³¨å…¥é˜Ÿåˆ—åç§° @Value(\"${myqueue}\") private String myQueue_name; //å‘springå®¹å™¨å¯¼å…¥é˜Ÿåˆ—å¯¹è±¡ @Bean public Queue queue(){ return new ActiveMQQueue(myQueue_name); } } 4ã€ç¼–å†™é˜Ÿåˆ—çš„æ¶ˆæ¯ç”Ÿäº§è€…Produce\npackage com.shishiyi.queue; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.Queue; @Component public class QueueProduce { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @Autowired private Queue queue_name; public void produceSend(){ //å‘é€æ¶ˆæ¯ jmsMessagingTemplate.convertAndSend(queue_name,\"ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯\"); } } 5ã€ç¼–å†™controllerç±»ï¼Œå¹¶è®¿é—®æ¥å£\npackage com.shishiyi.controller; import com.shishiyi.queue.QueueProduce; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class QueueProduceController { @Autowired private QueueProduce queueProduce; @GetMapping(\"/queuesend\") public void queueSend(){ queueProduce.produceSend(); System.out.println(\"æ¶ˆæ¯å‘é€æˆåŠŸ\"); } } æŸ¥çœ‹ActiveMQçš„å‰å°ï¼Œæ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—äº†\n6ã€ç¼–å†™é˜Ÿåˆ—çš„æ¶ˆè´¹è€…\npackage com.shishiyi.queue; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.annotation.JmsListener; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.JMSException; import javax.jms.Message; import javax.jms.TextMessage; @Component public class QueueConsumer { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; //é‡‡ç”¨ç›‘å¬å™¨çš„æ–¹å¼è·å–æ¶ˆæ¯ @JmsListener(destination = \"${myqueue}\") public void receive(Message message) throws JMSException { if (null !=message \u0026\u0026 message instanceof TextMessage){ TextMessage textMessage = (TextMessage)message; System.out.println(\"æ¶ˆè´¹è€…å·²ç»æ¥å—åˆ°äº†\"+textMessage.getText()); } } } åˆ é™¤ä¹‹å‰å…¥é˜Ÿçš„ä¿¡æ¯ï¼Œç„¶åé‡æ–°å¯åŠ¨ å¯åŠ¨ç±»ï¼Œå†æ¬¡è®¿é—®æ¥å£ï¼Œå¹¶æŸ¥çœ‹ActiveMQçš„å‰å°å’Œæ‰“å°å°\nè®¢é˜…å‘å¸ƒæ¨¡å¼ 1ã€å¯¼å…¥mavenä¾èµ–\norg.springframework.boot spring-boot-starter-web org.springframework.boot spring-boot-starter-activemq 2ã€ç¼–å†™application.propertiesé…ç½®æ–‡ä»¶\nserver.port=7777 # é…ç½®activemqçš„é“¾æ¥ï¼Œç”¨æˆ·åå’Œå¯†ç  spring.activemq.broker-url=tcp://æœåŠ¡å™¨å…¬ç½‘ip:ç«¯å£å· spring.activemq.user=admin spring.activemq.password=admin #é…ç½®æ˜¯å¦ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼ #falseä¸ºé˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰ #tureä¸ºå‘å¸ƒè®¢é˜… spring.jms.pub-sub-domain=true #topicåç§° mytopic=activemq_springboot_topic 3ã€ç¼–å†™é…ç½®ç±»\npackage com.shishiyi.config; import org.apache.activemq.command.ActiveMQTopic; import org.springframework.beans.factory.annotation.Value; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import javax.jms.Topic; @Configuration public class ActiveMQConfig { @Value(\"${mytopic}\") private String myTopic; @Bean public Topic topic(){ return new ActiveMQTopic(myTopic); } } 4ã€ç¼–å†™ä¸»é¢˜çš„æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆå‘å¸ƒæ–¹ï¼‰\npackage com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.Topic; @Component public class TopicProduce { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @Autowired private Topic topic; public void topicSend(){ jmsMessagingTemplate.convertAndSend(topic,\"å‘å¸ƒæ–¹å‘ä¸»é¢˜å‘å¸ƒçš„æ¶ˆæ¯\"); System.out.println(\"æ¶ˆæ¯å‘é€æˆåŠŸ\"); } } 5ã€ç¼–å†™controllerç±»\npackage com.shishiyi.controller; import com.shishiyi.topic.TopicProduce; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TopicProduceController { @Autowired private TopicProduce topicProduce; @GetMapping(\"/topicSend\") public void topicSend(){ topicProduce.topicSend(); } } 6ã€ç¼–å†™ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼ˆè®¢é˜…æ–¹ï¼‰\npackage com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.annotation.JmsListener; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.*; @Component public class TopicConsumer { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @JmsListener(destination = \"${mytopic}\") public void receive(Message message) throws JMSException { if (null != message \u0026\u0026 message instanceof TextMessage){ TextMessage textMessage = (TextMessage) message; System.out.println(\"è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\"+textMessage.getText()); } } } 7ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼Œè®¿é—®æ¥å£ï¼Œè®©å‘å¸ƒæ–¹ç”Ÿäº§æ¶ˆæ¯ï¼Œå¹¶æŸ¥çœ‹ActiveMQçš„å‰å°å’Œæ‰“å°å°\nå®šæ—¶çš„è®¢é˜…å‘å¸ƒæ¨¡å¼\nè®©å‘å¸ƒæ–¹æ¯è¿‡5ç§’ï¼Œå‘é€ä¸€æ¬¡æ¶ˆæ¯\n//åˆ›å»ºå®šæ—¶ä»»åŠ¡ package com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.scheduling.annotation.Scheduled; import org.springframework.stereotype.Component; import javax.jms.Topic; @Component public class TopicProduce { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @Autowired private Topic topic; public void topicSend(){ jmsMessagingTemplate.convertAndSend(topic,\"å‘å¸ƒæ–¹å‘ä¸»é¢˜å‘å¸ƒçš„æ¶ˆæ¯\"); System.out.println(\"æ¶ˆæ¯å‘é€æˆåŠŸ\"); } //åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”5ç§’å‘å¸ƒæ¶ˆæ¯ @Scheduled(fixedRate = 5000L) public void scheduled(){ topicSend(); } } æ·»åŠ  @EnableScheduling æ³¨è§£ï¼Œå‘ç°å®šæ—¶ä»»åŠ¡è®©å®ƒåå°æ‰§è¡Œ\nä¿®æ”¹ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼ˆè®¢é˜…æ–¹ï¼‰ï¼Œæ·»åŠ LocalDateTime.now()æ–¹æ³•ï¼Œæ–¹ä¾¿åœ¨æ§åˆ¶å°æŸ¥çœ‹\npackage com.shishiyi.topic; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.jms.annotation.JmsListener; import org.springframework.jms.core.JmsMessagingTemplate; import org.springframework.stereotype.Component; import javax.jms.*; import java.time.LocalDateTime; @Component public class TopicConsumer { @Autowired private JmsMessagingTemplate jmsMessagingTemplate; @JmsListener(destination = \"${mytopic}\") public void receive(Message message) throws JMSException { if (null != message \u0026\u0026 message instanceof TextMessage){ TextMessage textMessage = (TextMessage) message; System.out.println(\"è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š\"+textMessage.getText()+ \"æ—¶é—´ä¸ºï¼š\" +LocalDateTime.now()); } } } å¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ‰“å°å†…å®¹ï¼Œä»¥åŠï¼ˆåŒä¸€æ—¶é—´ç‚¹å†…ï¼‰æŸ¥çœ‹ActiveMQçš„å‰å°\nActiveMQä¼ è¾“åè®® åœ¨è¿æ¥activemqæ—¶ï¼Œé»˜è®¤æ˜¯ç”¨TCPè¿æ¥ï¼Œé‚£Activemqæ˜¯å¦è¿˜æ”¯æŒå…¶å®ƒåè®®å—ï¼Ÿ\næŸ¥çœ‹activemqçš„confæ–‡ä»¶å¤¹ä¸‹çš„activemq.xml\nå¯ä»¥çœ‹å‡ºï¼Œé™¤äº†æ”¯æŒé»˜è®¤çš„TCPåè®®ï¼Œè¿˜æ”¯æŒ amqp ï¼Œstompï¼Œmqttï¼Œwsç­‰åè®®ï¼Œè€Œä¸”åè®®å¯¹åº”çš„ç«¯å£å·ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™å°±æ˜¯ç”¨TCPè¿æ¥æ—¶ï¼Œç«¯å£å·æ˜¯61616çš„åŸå› äº†ã€‚\nä»activemqå‰å°ä¹Ÿå¯ä»¥æŸ¥çœ‹å‡ºæ¥\nå¦‚æœæƒ³é…ç½®å…¶å®ƒåè®®ï¼Œå¯ä»¥æŸ¥çœ‹å®˜ç½‘çš„æ–‡æ¡£\nhttp://activemq.apache.org/configuring-version-5-transports\né…ç½®NIOåè®® ä»å®˜ç½‘çš„æ–‡æ¡£å¾—çŸ¥ï¼Œé…ç½®NIOåè®®ï¼Œåªéœ€è¦ä¿®æ”¹activemq.xmlæ–‡ä»¶\n",
  "wordCount" : "9357",
  "inLanguage": "zh",
  "datePublished": "2020-07-03T19:18:23+08:00",
  "dateModified": "2022-07-04T19:18:23+08:00",
  "author":[{
    "@type": "Person",
    "name": "ååä¹™"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://shaoyi.cc/posts/blog/mq/activemq/activemq/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ååä¹™çš„åšå®¢",
    "logo": {
      "@type": "ImageObject",
      "url": "http://shaoyi.cc/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://shaoyi.cc/" accesskey="h" title="ååä¹™çš„åšå®¢ (Alt + H)">ååä¹™çš„åšå®¢</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://shaoyi.cc/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/posts" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                    <span>ğŸ” æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/tags/" title="ğŸ§©æ ‡ç­¾">
                    <span>ğŸ§©æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://shaoyi.cc/about" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://shaoyi.cc/">ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href="http://shaoyi.cc/posts/">ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href="http://shaoyi.cc/posts/blog/">ğŸ“•æŠ€æœ¯</a></div>
    <h1 class="post-title">
      æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹ActiveMQ
    </h1>
    <div class="post-description">
      ActiveMQçš„åº”ç”¨
    </div>
    <div class="post-meta">









åˆ›å»º:&nbsp;<span title='2020-07-03 19:18:23 +0800 CST'>2020-07-03</span>&nbsp;Â·&nbsp;æ›´æ–°:&nbsp;2022-07-04&nbsp;Â·&nbsp;å­—æ•°:&nbsp;9357å­—&nbsp;Â·&nbsp;
ä½œè€…:&nbsp;ååä¹™

</div>
  </header> <aside id="toc-container" class="toc-container wide">
        <div class="toc">
            <details  open>
                <summary accesskey="c" title="(Alt + C)">
                    <span class="details">ç›®å½•</span>
                </summary>

                <div class="inner"><ul>
                        <li>
                            <a href="#activemq%e5%ae%89%e8%a3%85docker%e7%8e%af%e5%a2%83%e4%b8%8b" aria-label="ActiveMQå®‰è£…ï¼ˆDockerç¯å¢ƒä¸‹ï¼‰">ActiveMQå®‰è£…ï¼ˆDockerç¯å¢ƒä¸‹ï¼‰</a></li>
                        <li>
                            <a href="#jms%e5%ae%9e%e7%8e%b0%e6%b6%88%e6%81%af%e7%9a%84%e7%94%9f%e4%ba%a7%e8%80%85%e5%92%8c%e6%b6%88%e8%b4%b9%e8%80%85" aria-label="JMSå®ç°æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…">JMSå®ç°æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</a><ul>
                                    
                        <li>
                            <a href="#%e9%98%9f%e5%88%97%e7%9a%84%e6%96%b9%e5%bc%8f" aria-label="é˜Ÿåˆ—çš„æ–¹å¼">é˜Ÿåˆ—çš„æ–¹å¼</a></li>
                        <li>
                            <a href="#%e5%8f%91%e5%b8%83%e8%ae%a2%e9%98%85%e6%96%b9%e5%bc%8f" aria-label="å‘å¸ƒè®¢é˜…æ–¹å¼">å‘å¸ƒè®¢é˜…æ–¹å¼</a></li>
                        <li>
                            <a href="#%e9%98%9f%e5%88%97%e5%92%8c%e5%8f%91%e5%b8%83%e8%ae%a2%e9%98%85%e4%b8%a4%e8%80%85%e5%af%b9%e6%af%94" aria-label="é˜Ÿåˆ—å’Œå‘å¸ƒè®¢é˜…ä¸¤è€…å¯¹æ¯”">é˜Ÿåˆ—å’Œå‘å¸ƒè®¢é˜…ä¸¤è€…å¯¹æ¯”</a></li></ul>
                        </li>
                        <li>
                            <a href="#jms" aria-label="JMS">JMS</a><ul>
                                    
                        <li>
                            <a href="#%e6%b6%88%e6%81%af%e7%9a%84%e4%b8%89%e7%a7%8d%e9%83%a8%e5%88%86" aria-label="æ¶ˆæ¯çš„ä¸‰ç§éƒ¨åˆ†">æ¶ˆæ¯çš„ä¸‰ç§éƒ¨åˆ†</a><ul>
                                    
                        <li>
                            <a href="#%e6%b6%88%e6%81%af%e5%a4%b4" aria-label="æ¶ˆæ¯å¤´">æ¶ˆæ¯å¤´</a></li>
                        <li>
                            <a href="#%e6%b6%88%e6%81%af%e4%bd%93" aria-label="æ¶ˆæ¯ä½“">æ¶ˆæ¯ä½“</a></li>
                        <li>
                            <a href="#%e6%b6%88%e6%81%af%e5%b1%9e%e6%80%a7" aria-label="æ¶ˆæ¯å±æ€§">æ¶ˆæ¯å±æ€§</a></li></ul>
                        </li>
                        <li>
                            <a href="#%e6%b6%88%e6%81%af%e7%9a%84%e5%8f%af%e9%9d%a0%e6%80%a7" aria-label="æ¶ˆæ¯çš„å¯é æ€§">æ¶ˆæ¯çš„å¯é æ€§</a><ul>
                                    
                        <li>
                            <a href="#%e6%8c%81%e4%b9%85%e6%80%a7-%e9%98%9f%e5%88%97" aria-label="æŒä¹…æ€§ é˜Ÿåˆ—">æŒä¹…æ€§ é˜Ÿåˆ—</a></li>
                        <li>
                            <a href="#%e6%8c%81%e4%b9%85%e6%80%a7--%e5%8f%91%e5%b8%83%e8%ae%a2%e9%98%85" aria-label="æŒä¹…æ€§  å‘å¸ƒè®¢é˜…">æŒä¹…æ€§  å‘å¸ƒè®¢é˜…</a></li>
                        <li>
                            <a href="#%e4%ba%8b%e5%8a%a1" aria-label="äº‹åŠ¡">äº‹åŠ¡</a></li>
                        <li>
                            <a href="#%e7%ad%be%e6%94%b6%e6%9c%ba%e5%88%b6" aria-label="ç­¾æ”¶æœºåˆ¶">ç­¾æ”¶æœºåˆ¶</a></li></ul>
                        </li></ul>
                        </li>
                        <li>
                            <a href="#springboot%e7%bb%93%e5%90%88activemq" aria-label="SpringBootç»“åˆACtiveMQ">SpringBootç»“åˆACtiveMQ</a><ul>
                                    
                        <li>
                            <a href="#%e9%98%9f%e5%88%97%e6%a8%a1%e5%bc%8f" aria-label="é˜Ÿåˆ—æ¨¡å¼">é˜Ÿåˆ—æ¨¡å¼</a></li>
                        <li>
                            <a href="#%e8%ae%a2%e9%98%85%e5%8f%91%e5%b8%83%e6%a8%a1%e5%bc%8f" aria-label="è®¢é˜…å‘å¸ƒæ¨¡å¼">è®¢é˜…å‘å¸ƒæ¨¡å¼</a></li></ul>
                        </li>
                        <li>
                            <a href="#activemq%e4%bc%a0%e8%be%93%e5%8d%8f%e8%ae%ae" aria-label="ActiveMQä¼ è¾“åè®®">ActiveMQä¼ è¾“åè®®</a><ul>
                                    <ul>
                                    
                        <li>
                            <a href="#%e9%85%8d%e7%bd%aenio%e5%8d%8f%e8%ae%ae" aria-label="é…ç½®NIOåè®®">é…ç½®NIOåè®®</a></li></ul>
                                </ul>
                        </li>
                        <li>
                            <a href="#activemq%e6%8c%81%e4%b9%85%e5%8c%96" aria-label="ActiveMQæŒä¹…åŒ–">ActiveMQæŒä¹…åŒ–</a><ul>
                                    
                        <li>
                            <a href="#kahadb%e9%bb%98%e8%ae%a4" aria-label="KahaDB(é»˜è®¤)">KahaDB(é»˜è®¤)</a></li>
                        <li>
                            <a href="#leveldb" aria-label="LevelDB">LevelDB</a></li>
                        <li>
                            <a href="#jdbc" aria-label="JDBC">JDBC</a>
                        </li>
                    </ul>
                    </li>
                    </ul>
                </div>
            </details>
        </div>
    </aside>
    <script>
        let activeElement;
        let elements;
        window.addEventListener('DOMContentLoaded', function (event) {
            checkTocPosition();

            elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
            
            activeElement = elements[0];
            const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
            document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
        }, false);

        window.addEventListener('resize', function (event) {
            checkTocPosition();
        }, false);

        window.addEventListener('scroll', () => {
            
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight / 2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement) {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }, false);

        const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
        const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
        const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

        function checkTocPosition() {
            const width = document.body.scrollWidth;

            if (width - main - (toc * 2) - (gap * 4) > 0) {
                document.getElementById("toc-container").classList.add("wide");
            } else {
                document.getElementById("toc-container").classList.remove("wide");
            }
        }

        function getOffsetTop(element) {
            if (!element.getClientRects().length) {
                return 0;
            }
            let rect = element.getBoundingClientRect();
            let win = element.ownerDocument.defaultView;
            return rect.top + win.pageYOffset;
        }
    </script>
  <div class="post-content"><h1 id="activemqå®‰è£…dockerç¯å¢ƒä¸‹">ActiveMQå®‰è£…ï¼ˆDockerç¯å¢ƒä¸‹ï¼‰<a hidden class="anchor" aria-hidden="true" href="#activemqå®‰è£…dockerç¯å¢ƒä¸‹">#</a></h1>
<p>é¦–å…ˆåœ¨dockeræœç´¢ActiveMQï¼Œå‘ç°<strong>webcenter/activemq</strong>  è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨æ˜¯æœ€å¤šçš„</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/20/wTXzlT.png" alt="wTXzlT.png"  />
</p>
<p>ç„¶åé€‰æ‹©ç‰ˆæœ¬ï¼Œä¸‹è½½activeMQ</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/20/wTj63V.png" alt="wTj63V.png"  />
</p>
<p>æŸ¥çœ‹é•œåƒï¼Œé…ç½®å¥½activemqå®¹å™¨çš„åå°ç«¯å£ï¼ˆ61616ï¼‰å’Œå‰å°ç«¯å£ï¼ˆ8161ï¼‰çš„æ˜ å°„å…³ç³»ï¼Œå¹¶å¯åŠ¨å®ƒ</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/20/wTvBrD.png" alt="wTvBrD.png"  />
</p>
<p>æµè§ˆå™¨è®¿é—®ï¼Œå¦‚ä¸‹å›¾ï¼Œä¾¿å®‰è£…å®Œæˆ</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/20/wTzvE4.png" alt="wTzvE4.png"  />
</p>
<h1 id="jmså®ç°æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…">JMSå®ç°æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…<a hidden class="anchor" aria-hidden="true" href="#jmså®ç°æ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…">#</a></h1>
<h2 id="é˜Ÿåˆ—çš„æ–¹å¼">é˜Ÿåˆ—çš„æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#é˜Ÿåˆ—çš„æ–¹å¼">#</a></h2>
<blockquote>
<p>ç”Ÿäº§è€…ï¼š</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.ActiveMQConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsProduce {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String QUEUE_NAME=<span style="color:#0ff;font-weight:bold">&#34;myQueue&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ActiveMQConnectionFactory connectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Destination destination = session.<span style="color:#007f7f">createQueue</span>(QUEUE_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        MessageProducer messageProducer = session.<span style="color:#007f7f">createProducer</span>(destination);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ç”Ÿäº§4æ¡æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt; 5; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            TextMessage message = session.<span style="color:#007f7f">createTextMessage</span>(<span style="color:#0ff;font-weight:bold">&#34;ç¬¬&#34;</span> + i + <span style="color:#0ff;font-weight:bold">&#34;æ¡æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//å‘é€æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            messageProducer.<span style="color:#007f7f">send</span>(message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€å®Œæˆï¼&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>æ‰§è¡Œåçš„ç»“æœï¼š</strong></p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/20/w79mct.png" alt="w79mct.png"  />
</p>
<blockquote>
<p>æ¶ˆè´¹è€…ï¼ˆreceive()æ–¹æ³•è·å–ä¿¡æ¯ï¼‰ï¼š</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.ActiveMQConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsConsumer {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String QUEUE_NAME=<span style="color:#0ff;font-weight:bold">&#34;myQueue&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ActiveMQConnectionFactory activeMQConnectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Connection connection = activeMQConnectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºç›®çš„åœ°(è¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Destination destination = session.<span style="color:#007f7f">createQueue</span>(QUEUE_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        MessageConsumer messageConsumer = session.<span style="color:#007f7f">createConsumer</span>(destination);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (<span style="color:#fff;font-weight:bold">true</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//è¯»å–æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            TextMessage textMessage = (TextMessage)messageConsumer.<span style="color:#007f7f">receive</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> !=textMessage){
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//è·å–æ¶ˆæ¯å†…å®¹å¹¶æ‰“å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯:  &#34;</span>+textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>            }<span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageConsumer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>æ‰§è¡Œç»“æœï¼š</strong></p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/20/w7CjQ1.png" alt="w7CjQ1.png"  />
</p>
<blockquote>
<p>æ¶ˆè´¹è€…ï¼ˆç›‘å¬å™¨MessageListeneræ–¹å¼è·å–ä¿¡æ¯ï¼‰</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.ActiveMQConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsConsumer02 {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String QUEUE_NAME=<span style="color:#0ff;font-weight:bold">&#34;myQueue&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ActiveMQConnectionFactory activeMQConnectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Connection connection = activeMQConnectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºç›®çš„åœ°(è¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼)
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Destination destination = session.<span style="color:#007f7f">createQueue</span>(QUEUE_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        MessageConsumer messageConsumer = session.<span style="color:#007f7f">createConsumer</span>(destination);
</span></span><span style="display:flex;"><span>        messageConsumer.<span style="color:#007f7f">setMessageListener</span>((message) -&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> != message &amp;&amp; message <span style="color:#fff;font-weight:bold">instanceof</span> TextMessage){
</span></span><span style="display:flex;"><span>                    TextMessage textMessage = (TextMessage) message;
</span></span><span style="display:flex;"><span>                    <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯:  &#34;</span>+textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>                    } <span style="color:#fff;font-weight:bold">catch</span> (JMSException e) {
</span></span><span style="display:flex;"><span>                        e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">in</span>.<span style="color:#007f7f">read</span>();   <span style="color:#007f7f">//é˜²æ­¢æ¶ˆæ¯è¿˜æ²¡æœ‰è¯»å–åˆ°å°±å…³é—­èµ„æºäº†
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageConsumer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>æ¶ˆè´¹è€…è·å–æ¶ˆæ¯çš„æ–¹å¼</p>
</blockquote>
<p><strong>receive() æ–¹æ³•</strong>ï¼šè¯¥æ–¹æ³•æ˜¯åŒæ­¥é˜»å¡çš„ï¼Œå¦‚æœè°ƒç”¨è€…ï¼ˆé˜Ÿåˆ—æˆ–è€…è®¢é˜…æ–¹ï¼‰æ²¡æœ‰æ¥å—åˆ°æ¶ˆæ¯ï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…</p>
<p>é™¤æ­¤ä¹‹å¤–å®ƒæœ‰ä¸€ä¸ªé‡è½½æ–¹æ³• <strong>receive(long timeout)</strong> ï¼Œå‚æ•°è¡¨ç¤ºçš„æ˜¯ ç­‰å¾…çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œåœ¨ç­‰å¾…æ—¶é—´å†…æ²¡æœ‰æ¥å—åˆ°æ¶ˆæ¯å°±è‡ªåŠ¨åœæ­¢</p>
<p><strong>setMessageListener(MessageListener listener) æ–¹æ³•</strong>ï¼šè¯¥æ–¹æ³•æ˜¯å¼‚æ­¥éé˜»å¡çš„ï¼Œè€Œæ–¹æ³•å‚æ•°ç±»å‹æ˜¯MessageListeneræ¥å£ï¼Œè¿™ä¸ªæ¥å£é‡Œåªå®šä¹‰äº†ä¸€ä¸ªç”¨äºå¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„onMessageæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åªæ¥æ”¶ä¸€ä¸ªMessageå‚æ•°ç›‘å¬å™¨ã€‚å½“æ¶ˆæ¯åˆ°è¾¾ä¹‹åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨onMessageæ–¹æ³•è·å–ä¿¡æ¯</p>
<blockquote>
<p>æ¶ˆè´¹è€…çš„ä¸‰ç§æƒ…å†µ</p>
</blockquote>
<ul>
<li>
<p>å…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œç”Ÿäº§æ¶ˆæ¯ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ˜¯å¦å¯ä»¥æ­£å¸¸æ¶ˆè´¹ä¿¡æ¯ ï¼Ÿ</p>
<ul>
<li>ç­”æ¡ˆï¼š<strong>å¯ä»¥çš„</strong></li>
</ul>
</li>
<li>
<p>è¿˜æ˜¯å…ˆå¯åŠ¨ç”Ÿäº§è€…ï¼Œç”Ÿäº§æ¶ˆæ¯ï¼Œå†åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œåä¸€ä¸ªå¯åŠ¨çš„æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°æ¶ˆæ¯å— ï¼Ÿ</p>
<ul>
<li>ç­”æ¡ˆï¼š<strong>å¦ï¼Œåä¸€ä¸ªå¯åŠ¨çš„æ¶ˆè´¹è€…æ˜¯æ¶ˆè´¹ä¸åˆ°çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯éƒ½è¢«å‰ä¸€ä¸ªå¯åŠ¨çš„æ¶ˆæ¯è€…æ¶ˆè´¹å®Œäº†</strong></li>
</ul>
</li>
<li>
<p>å…ˆå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå†å¯åŠ¨ç”Ÿäº§è€…ç”Ÿäº§6æ¡æ¶ˆæ¯ï¼Œç»“æœå¦‚ä½• ï¼Ÿ</p>
<ul>
<li>ç­”æ¡ˆï¼š<strong>æ¶ˆæ¯è¢«å¹³åˆ†ï¼Œä¸¤ä¸ªæ¶ˆè´¹è€…ä¸€äººä¸€åŠï¼Œåˆ†åˆ«æ¶ˆè´¹3æ¡æ¶ˆæ¯</strong></li>
</ul>
</li>
</ul>
<h2 id="å‘å¸ƒè®¢é˜…æ–¹å¼">å‘å¸ƒè®¢é˜…æ–¹å¼<a hidden class="anchor" aria-hidden="true" href="#å‘å¸ƒè®¢é˜…æ–¹å¼">#</a></h2>
<blockquote>
<p>ç”Ÿäº§è€…ï¼š</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.ActiveMQConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsProduce_Topic {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String TOPIC_NAME=<span style="color:#0ff;font-weight:bold">&#34;myTopic&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ActiveMQConnectionFactory connectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºå‘å¸ƒè®¢é˜…æ–¹å¼ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Destination destination = session.<span style="color:#007f7f">createTopic</span>(TOPIC_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        MessageProducer messageProducer = session.<span style="color:#007f7f">createProducer</span>(destination);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ç”Ÿäº§4æ¡æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt; 5; i++) {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯å†…å®¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            TextMessage message = session.<span style="color:#007f7f">createTextMessage</span>(<span style="color:#0ff;font-weight:bold">&#34;ç¬¬&#34;</span> + i + <span style="color:#0ff;font-weight:bold">&#34;æ¡æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//å‘é€æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            messageProducer.<span style="color:#007f7f">send</span>(message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€å®Œæˆï¼&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>â€‹		å‘å¸ƒè®¢é˜…çš„æ–¹å¼å’Œé˜Ÿåˆ—æ–¹å¼ï¼Œ ä»ç”Ÿäº§è€…çš„ä»£ç å¯ä»¥å‘ç°ï¼Œä¸¤è€…æ˜¯ä¸€æ ·çš„ï¼Œ<strong>å”¯ä¸€ä¸åŒçš„å°±æ˜¯ï¼Œåˆ›å»ºç›®çš„åœ°çš„æ–¹æ³•ä¸ä¸€æ ·ï¼Œé˜Ÿåˆ—æ˜¯createQueue(String queueName)ï¼Œè€Œå‘å¸ƒè®¢é˜…æ˜¯createTopic(String topicName)ã€‚åŒæ ·çš„ï¼Œæ¶ˆè´¹è€…çš„ä»£ç å’Œé˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€æ ·çš„</strong></p>
<blockquote>
<p>æ¶ˆè´¹è€…</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.ActiveMQConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.io.IOException;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsConsumer_Topic {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span>  <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String TOPIC_NAME=<span style="color:#0ff;font-weight:bold">&#34;myTopic&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException, IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºè¿æ¥å·¥å‚ï¼ŒæŒ‡å®šactiveçš„urlé“¾æ¥ï¼Œä¸æŒ‡å®šç”¨æˆ·åå’Œå¯†ç å°±æ˜¯é»˜è®¤çš„ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        ActiveMQConnectionFactory activeMQConnectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºå·¥å‚åè·å–é“¾æ¥ï¼Œå¹¶å¯åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Connection connection = activeMQConnectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºå‘å¸ƒè®¢é˜…æ–¹å¼ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Destination destination = session.<span style="color:#007f7f">createTopic</span>(TOPIC_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        MessageConsumer messageConsumer = session.<span style="color:#007f7f">createConsumer</span>(destination);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//é€šè¿‡ç›‘å¬å™¨ï¼Œæ¥å—æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageConsumer.<span style="color:#007f7f">setMessageListener</span>((message) -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> != message &amp;&amp; message <span style="color:#fff;font-weight:bold">instanceof</span> TextMessage) {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>                    TextMessage textMessage = (TextMessage) message;
</span></span><span style="display:flex;"><span>                    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯:  &#34;</span> + textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>                } <span style="color:#fff;font-weight:bold">catch</span> (JMSException e) {
</span></span><span style="display:flex;"><span>                    e.<span style="color:#007f7f">printStackTrace</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">in</span>.<span style="color:#007f7f">read</span>();<span style="color:#007f7f">//é˜»å¡ç­‰å¾…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageConsumer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>â€‹		ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>å‘å¸ƒè®¢é˜…çš„æ¨¡å¼ï¼Œè¦å…ˆå¯ç”¨è®¢é˜…æ–¹ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹è€…æ–¹ï¼Œå†å¯åŠ¨å‘å¸ƒæ–¹ï¼ˆç”Ÿäº§è€…ï¼‰</strong>ã€‚å¦åˆ™ï¼Œå°±ç±»ä¼¼å¾®ä¿¡å…¬ä¼—å·ä¸€æ ·ï¼Œæ²¡æœ‰äººè®¢é˜…ï¼Œç”Ÿäº§æ–¹å‘å¸ƒæ¶ˆæ¯æ˜¯æ²¡æœ‰äººæ¥å—çš„åˆ°ï¼Œä¼šè¢«ä¸¢å¼ƒã€‚è¿™ç§åˆ™æ˜¯åºŸæ¶ˆæ¯ã€‚</p>
<h2 id="é˜Ÿåˆ—å’Œå‘å¸ƒè®¢é˜…ä¸¤è€…å¯¹æ¯”">é˜Ÿåˆ—å’Œå‘å¸ƒè®¢é˜…ä¸¤è€…å¯¹æ¯”<a hidden class="anchor" aria-hidden="true" href="#é˜Ÿåˆ—å’Œå‘å¸ƒè®¢é˜…ä¸¤è€…å¯¹æ¯”">#</a></h2>
<table>
<thead>
<tr>
<th>æ¯” è¾ƒ é¡¹ ç›®</th>
<th>Topic ï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ¨¡å¼</th>
<th>Queue ï¼ˆé˜Ÿåˆ—ï¼‰æ¨¡å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>å·¥ ä½œ æ¨¡ å¼</td>
<td>â€œè®¢é˜…-å‘å¸ƒâ€æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰è®¢é˜… è€…ï¼Œæ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒï¼Œå¦‚æœæœ‰å¤šä¸ªè®¢é˜… è€…ï¼Œé‚£ä¹ˆè¿™äº›è®¢é˜…è€…éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚</td>
<td>è´Ÿè½½å‡è¡¡ æ¨¡å¼ï¼Œå¦‚æœå½“å‰æ²¡æœ‰æ¶ˆè´¹è€…ï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¼ƒï¼Œå¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œé‚£ä¹ˆä¸€æ¡æ¶ˆæ¯ ä¹Ÿåªä¼šå‘é€ç»™å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶ä¸”è¦æ±‚æ¶ˆè´¹è€…ackä¿¡æ¯</td>
</tr>
<tr>
<td>æœ‰ æ—  çŠ¶ æ€</td>
<td>æ— çŠ¶æ€</td>
<td>Queue æ•°æ®é»˜è®¤ä¼šåœ¨ mq æœåŠ¡å™¨ä¸Šä»¥æ–‡ä»¶å½¢å¼ ä¿å­˜ï¼Œæ¯”å¦‚ Active MQ ä¸€èˆ¬ä¿å­˜åœ¨ $AMQ_HOME\data\kr-store\dataä¸‹é¢ï¼Œä¹Ÿå¯ ä»¥é…ç½®æˆDBå­˜å‚¨</td>
</tr>
<tr>
<td>ä¼  é€’ å®Œ æ•´ æ€§</td>
<td>å¦‚æœæ²¡æœ‰è®¢é˜…è€…ï¼Œæ¶ˆæ¯ä¼šè¢«ä¸¢å¼ƒ</td>
<td>æ¶ˆæ¯ä¸ä¼šä¸¢å¼ƒ</td>
</tr>
<tr>
<td>å¤„ ç† æ•ˆ ç‡</td>
<td>ç”±äºæ¶ˆæ¯è¦æŒ‰ç…§è®¢é˜…è€…çš„æ•°é‡è¿›è¡Œå¤ åˆ¶ï¼Œæ‰€ä»¥å¤„ç†æ€§èƒ½ä¼šéšç€è®¢é˜…è€…çš„å¢åŠ  è€Œæ˜æ˜¾é™ä½ï¼Œå¹¶ä¸”è¿˜è¦ç»“åˆä¸åŒæ¶ˆæ¯å è®®è‡ªèº«çš„æ€§èƒ½å·®å¼‚</td>
<td>ç”±äºä¸€æ¡æ¶ˆæ¯åªå‘é€ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ‰€ä»¥å°±ç®— æ¶ˆè´¹è€…å†å¤šï¼Œæ€§èƒ½ä¹Ÿä¸ä¼šæœ‰æ˜æ˜¾é™ä½ã€‚å½“ç„¶ä¸ åŒæ¶ˆæ¯åè®®çš„å…·ä½“æ€§èƒ½ä¹Ÿæ˜¯æœ‰å·®å¼‚çš„ã€‚</td>
</tr>
</tbody>
</table>
<h1 id="jms">JMS<a hidden class="anchor" aria-hidden="true" href="#jms">#</a></h1>
<p>â€‹		JMSæ˜¯Java EEçš„ä¸€ä¸ªé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶çš„ä¸€å¥—è§„èŒƒï¼Œå…·ä½“éœ€è¦é å‚å•†çš„äº§å“å®ç°</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/22/wLZGvT.png" alt="wLZGvT.png"  />
</p>
<h2 id="æ¶ˆæ¯çš„ä¸‰ç§éƒ¨åˆ†">æ¶ˆæ¯çš„ä¸‰ç§éƒ¨åˆ†<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯çš„ä¸‰ç§éƒ¨åˆ†">#</a></h2>
<h3 id="æ¶ˆæ¯å¤´">æ¶ˆæ¯å¤´<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯å¤´">#</a></h3>
<ul>
<li>åœ¨ç”Ÿäº§è€…æ–¹ï¼Œæ¶ˆæ¯çš„APIçœ‹å‡ºå¯ä»¥é’ˆå¯¹æ¯ä¸€æ¡æ¶ˆæ¯è®¾ç½®ä¸åŒçš„æ¶ˆæ¯å¤´å±æ€§</li>
</ul>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHNZE6.png" alt="wHNZE6.png"  />
</p>
<ul>
<li>å¦‚æœä¸æƒ³ä¸ºæ¯ä¸€æ¡æ¶ˆæ¯å•ç‹¬è®¾ç½®æ¶ˆæ¯å¤´å±æ€§ï¼Œå¯ä»¥é€šè¿‡Send()æ–¹æ³•çš„é‡è½½ï¼Œæ‰¹å¤„ç†æ¶ˆæ¯çš„æ¶ˆæ¯å¤´å±æ€§</li>
</ul>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHNEHx.png" alt="wHNEHx.png"  />
</p>
<ul>
<li>ä»æ‰¹å¤„ç†æ¶ˆæ¯å¤´å±æ€§å’Œå•ç‹¬è®¾ç½®æ¶ˆæ¯å¤´å±æ€§ä¸¤è€…ç»“åˆæ¥çœ‹ï¼Œä¸»è¦ä»‹ç»äº”ä¸ªæ¶ˆæ¯å¤´å±æ€§ï¼š</li>
</ul>
<p><strong>JMSDestinationï¼š</strong>  æ¶ˆæ¯å‘é€çš„ç›®çš„åœ°ï¼Œä¸»è¦æ˜¯æŒ‡ Queue å’Œ Topic</p>
<p><strong>JMSDeliveryModeï¼š</strong>  æŒä¹…æ¨¡å¼å’ŒéæŒä¹…æ¨¡å¼ï¼Œå¯è®¾ç½®çš„å‚æ•°ä¸º<strong>DeliveryMode.NON_PERSISTENT(éæŒä¹…)</strong>  å’Œ  <strong>DeliveryMode.PERSISTENT(æŒä¹…)</strong></p>
<p>ä¸€æ¡æŒä¹…æ€§çš„æ¶ˆæ¯ï¼šåº”è¯¥è¢«ä¼ é€ â€œä¸€æ¬¡ä»…ä»…ä¸€æ¬¡â€ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœJMS æä¾›è€…å‡ºç°æ•…éšœï¼Œè¯¥æ¶ˆæ¯å¹¶ä¸ä¼šä¸¢å¤±ï¼Œå®ƒä¼šåœ¨æœåŠ¡å™¨æ¢å¤ä¹‹åå†æ¬¡ä¼ é€’æ¶ˆæ¯ã€‚
ä¸€æ¡éæŒä¹…çš„æ¶ˆæ¯ï¼šå¤šä¼šä¼ é€ä¸€æ¬¡ï¼Œè¿™æ„å‘³ç€æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œè¯¥æ¶ˆæ¯å°†æ°¸ä¹…ä¸¢å¤±ã€‚</p>
<p><strong>JMSPriority ï¼š</strong>  æ¶ˆæ¯ä¼˜å…ˆçº§ï¼Œä»0 ~ 9 åä¸ªçº§åˆ«ï¼Œ0 ~ 4 æ˜¯æ™®é€šæ¶ˆæ¯ï¼Œ5 ~ 9æ˜¯åŠ æ€¥æ¶ˆæ¯ã€‚</p>
<p>JMS ä¸è¦æ±‚ MQ ä¸¥æ ¼æŒ‰ç…§è¿™åä¸ªä¼˜å…ˆçº§å‘é€æ¶ˆæ¯ï¼Œä½†å¿…é¡»ä¿è¯åŠ æ€¥æ¶ˆæ¯è¦å…ˆäºæ™®é€šæ¶ˆæ¯åˆ°è¾¾ï¼Œé»˜è®¤æ˜¯4 çº§ã€‚</p>
<p><strong>JMSExpirationï¼š</strong>  å¯ä»¥è®¾ç½®æ¶ˆæ¯åœ¨ä¸€å®šæ—¶é—´åè¿‡æœŸï¼Œé»˜è®¤æ˜¯æ°¸ä¸è¿‡æœŸã€‚æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼Œç­‰äºDestinationçš„sendæ–¹æ³•ä¸­çš„timeToLiveå€¼åŠ ä¸Šå‘é€æ—¶åˆ»çš„GMTæ—¶é—´</p>
<p>å€¼ã€‚ å¦‚æœtimeToLiveå€¼ç­‰äºé›¶ï¼Œåˆ™ JMSExpiration è¢«è®¾ä¸ºé›¶ï¼Œè¡¨ç¤ºè¯¥æ¶ˆæ¯æ°¸ä¸è¿‡æœŸã€‚å¦‚æœå‘é€åï¼Œåœ¨æ¶ˆæ¯è¿‡æœŸæ—¶é—´ä¹‹åæ¶ˆæ¯è¿˜æ²¡æœ‰è¢«å‘é€åˆ°ç›®çš„åœ°ï¼Œåˆ™è¯¥æ¶ˆæ¯è¢«æ¸…é™¤ã€‚</p>
<p><strong>JMSMessageID ï¼š</strong>  å”¯ä¸€è¯†åˆ«æ¯ä¸ªæ¶ˆæ¯çš„æ ‡è¯†ï¼Œç”±MQäº§ç”Ÿã€‚</p>
<h3 id="æ¶ˆæ¯ä½“">æ¶ˆæ¯ä½“<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯ä½“">#</a></h3>
<p>å°è£…å…·ä½“çš„æ¶ˆæ¯æ•°æ®ï¼Œå‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯ä½“ç±»å‹å¿…é¡»ä¸€è‡´å¯¹åº”ï¼</p>
<p>äº”ç§æ¶ˆæ¯ä½“æ ¼å¼ï¼š</p>
<p><strong>TextMessageï¼š</strong> æ™®é€šå­—ç¬¦ä¸²æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªString ã€‚</p>
<p><strong>MapMessageï¼š</strong> ä¸€ä¸ªMapç±»å‹çš„æ¶ˆæ¯ï¼Œkeyä¸ºStringç±»å‹ï¼Œè€Œå€¼ä¸ºJavaçš„åŸºæœ¬ç±»å‹ã€‚</p>
<p>BytesMessage  ï¼š äºŒè¿›åˆ¶æ•°ç»„æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªbyte[] ã€‚</p>
<p>StreamMessage ï¼š Javaæ•°æ®æµæ¶ˆæ¯ï¼Œç”¨æ ‡å‡†æµæ“ä½œæ¥é¡ºåºçš„å¡«å……å’Œè¯»å–ã€‚</p>
<p>ObjectMessage ï¼šå¯¹è±¡æ¶ˆæ¯ï¼ŒåŒ…å«ä¸€ä¸ªå¯åºåˆ—åŒ–çš„ Java å¯¹è±¡ã€‚</p>
<h3 id="æ¶ˆæ¯å±æ€§">æ¶ˆæ¯å±æ€§<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯å±æ€§">#</a></h3>
<p>å¦‚æœéœ€è¦é™¤æ¶ˆæ¯å¤´å­—æ®µä»¥å¤–çš„å€¼ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨æ¶ˆæ¯å±æ€§ï¼</p>
<p>è¯†åˆ«ã€å»é‡ã€é‡ç‚¹æ ‡æ³¨ç­‰æ“ä½œéå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼</p>
<p>æ¶ˆæ¯å±æ€§æ˜¯ä»¥å±æ€§åå’Œå±æ€§å€¼å¯¹çš„å½¢å¼æŒ‡å®šçš„ã€‚å¯ä»¥å°†å±æ€§æ˜¯ä¸ºæ¶ˆæ¯å¤´çš„æ‰©å±•ï¼Œå±æ€§æŒ‡å®šä¸€äº›æ¶ˆæ¯å¤´æ²¡æœ‰åŒ…æ‹¬çš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚å¯ä»¥åœ¨å±æ€§é‡ŒæŒ‡å®šæ¶ˆæ¯é€‰æ‹©å™¨ã€‚</p>
<p>ä»¥Propertyç»“å°¾ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHsArF.png" alt="wHsArF.png"  />
</p>
<h2 id="æ¶ˆæ¯çš„å¯é æ€§">æ¶ˆæ¯çš„å¯é æ€§<a hidden class="anchor" aria-hidden="true" href="#æ¶ˆæ¯çš„å¯é æ€§">#</a></h2>
<h3 id="æŒä¹…æ€§-é˜Ÿåˆ—">æŒä¹…æ€§ é˜Ÿåˆ—<a hidden class="anchor" aria-hidden="true" href="#æŒä¹…æ€§-é˜Ÿåˆ—">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#007f7f">//åˆ›å»ºç›®çš„åœ°ï¼ˆè¿™é‡Œä¸ºé˜Ÿåˆ—æ–¹å¼ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span> Destination destination = session.<span style="color:#007f7f">createQueue</span>(QUEUE_NAME);
</span></span><span style="display:flex;"><span> <span style="color:#007f7f">//åˆ›å»ºæ¶ˆæ¯çš„ç”Ÿäº§è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span> MessageProducer messageProducer = session.<span style="color:#007f7f">createProducer</span>(destination);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// éæŒä¹…åŒ– ï¼šæœåŠ¡å™¨å®•æœºï¼Œåˆ™æ¶ˆæ¯ä¸èƒ½æ¢å¤
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span> messageProducer.<span style="color:#007f7f">setDeliveryMode</span>(DeliveryMode.<span style="color:#007f7f">NON_PERSISTENT</span>);
</span></span><span style="display:flex;"><span><span style="color:#007f7f">// æŒä¹…åŒ– ï¼šæœåŠ¡å™¨å®•æœºï¼Œæ¶ˆæ¯å¯ä»¥æ¢å¤
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span> messageProducer.<span style="color:#007f7f">setDeliveryMode</span>(DeliveryMode.<span style="color:#007f7f">PERSISTENT</span>);
</span></span></code></pre></div><p>é˜Ÿåˆ—æ˜¯å¦è®¾ç½®ä¸ºæŒä¹…ï¼Œå¯ä»¥é€šè¿‡setDeliveryMode(int deliveryMode)æ–¹æ³•è®¾ç½®ï¼Œ<strong>é»˜è®¤ä¸ºæŒä¹…</strong></p>
<h3 id="æŒä¹…æ€§--å‘å¸ƒè®¢é˜…">æŒä¹…æ€§  å‘å¸ƒè®¢é˜…<a hidden class="anchor" aria-hidden="true" href="#æŒä¹…æ€§--å‘å¸ƒè®¢é˜…">#</a></h3>
<blockquote>
<p>å‘å¸ƒæ–¹ï¼ˆç”Ÿäº§è€…ï¼‰ï¼Œé¡ºåºä¸ä¹‹å‰æœ‰ä¸€ç‚¹ä¸åŒï¼Œéœ€è¦è®¾å®šå…ˆæŒä¹…åŒ–ï¼Œåœ¨å¯åŠ¨è¿æ¥</p>
</blockquote>
<p>æµ‹è¯•ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.ActiveMQConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsProduce_Topic_DeliveryMode {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String TOPIC_NAME=<span style="color:#0ff;font-weight:bold">&#34;my_topic_persist&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        ActiveMQConnectionFactory connectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        Topic topic = session.<span style="color:#007f7f">createTopic</span>(TOPIC_NAME);
</span></span><span style="display:flex;"><span>        MessageProducer messageProducer = session.<span style="color:#007f7f">createProducer</span>(topic);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è®¾ç½®å‘å¸ƒæ–¹ä¸º æŒä¹…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">setDeliveryMode</span>(DeliveryMode.<span style="color:#007f7f">PERSISTENT</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è®¾å®šä¸ºæŒä¹…åï¼Œç„¶åè¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=3; i++) {
</span></span><span style="display:flex;"><span>            TextMessage message = session.<span style="color:#007f7f">createTextMessage</span>(<span style="color:#0ff;font-weight:bold">&#34;ç¬¬&#34;</span> + i + <span style="color:#0ff;font-weight:bold">&#34;æ¡æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>            messageProducer.<span style="color:#007f7f">send</span>(message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€å®Œæˆï¼&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>è®¢é˜…æ–¹ï¼ˆæ¶ˆè´¹è€…ï¼‰æµ‹è¯•ä»£ç ï¼š</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.ActiveMQConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsConsumer_Topic_DeliveryMode {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://æœåŠ¡å™¨å…¬ç½‘ip:åå°æ˜ å°„ç«¯å£å·&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String TOPIC_NAME=<span style="color:#0ff;font-weight:bold">&#34;my_topic_persist&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        ActiveMQConnectionFactory connectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è®¢é˜…æ–¹çš„id
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        connection.<span style="color:#007f7f">setClientID</span>(<span style="color:#0ff;font-weight:bold">&#34;001&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        Topic topic = session.<span style="color:#007f7f">createTopic</span>(TOPIC_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæŒä¹…çš„è®¢é˜…æ–¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        TopicSubscriber topicSubscriber = session.<span style="color:#007f7f">createDurableSubscriber</span>(topic, <span style="color:#0ff;font-weight:bold">&#34;ååä¹™&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŒä¹…åŒ–åï¼Œå†è¿›è¡Œè¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        Message message = topicSubscriber.<span style="color:#007f7f">receive</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (<span style="color:#fff;font-weight:bold">null</span> != message){
</span></span><span style="display:flex;"><span>            TextMessage textMessage = (TextMessage)message;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&#34;</span>+textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>            message = topicSubscriber.<span style="color:#007f7f">receive</span>(3000L);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        topicSubscriber.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>å…ˆå¯åŠ¨è®¢é˜…æ–¹ï¼Œå†å¯åŠ¨å‘å¸ƒæ–¹</strong>ï¼Œåˆ°ActiveMQå‰å°çš„<strong>Subscribers</strong>æŸ¥çœ‹</p>
<blockquote>
<p>å¯åŠ¨å‰æƒ…å†µï¼š</p>
</blockquote>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHIUiT.png" alt="wHIUiT.png"  />
</p>
<blockquote>
<p>å¯åŠ¨è®¢é˜…æ–¹åæƒ…å†µï¼š</p>
</blockquote>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHITeI.png" alt="wHITeI.png"  />
</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHo9wq.png" alt="wHo9wq.png"  />
</p>
<blockquote>
<p>å¯åŠ¨ç”Ÿäº§æ–¹ åï¼š</p>
</blockquote>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHo0tf.png" alt="wHo0tf.png"  />
</p>
<blockquote>
<p>è®¢é˜…æ–¹åœæ­¢åï¼Œä¼šè¢«åˆ— ç¦»çº¿çš„ä¸€æ å»ï¼š</p>
</blockquote>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHo4hT.png" alt="wHo4hT.png"  />
</p>
<blockquote>
<p>å¦‚æœè¿™æ—¶ï¼Œå‘å¸ƒè€…å†æ¬¡å‘å¸ƒæ¶ˆæ¯ï¼Œè®¢é˜…æ–¹é‡å¯å¯åŠ¨æ˜¯å¦èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯</p>
</blockquote>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHTuvQ.png" alt="wHTuvQ.png"  />
</p>
<blockquote>
<p>å†æ¬¡å¯åŠ¨è®¢é˜…æ–¹(ä¸åœæ­¢)å</p>
</blockquote>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHT7Pf.png" alt="wHT7Pf.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wHTHG8.png" alt="wHTHG8.png"  />
</p>
<blockquote>
<p>å°ç»“ï¼š</p>
</blockquote>
<p>â€‹		<strong>ç¬¬ä¸€æ¬¡ï¼Œä¸€å®šè¦å…ˆå¯åŠ¨è®¢é˜…æ–¹ï¼Œä¹‹åå¯åŠ¨å‘å¸ƒæ–¹ï¼Œå‘å¸ƒæ¶ˆæ¯ã€‚è¿™æ—¶ä¸è®ºè®¢é˜…æ–¹åœ¨ä¸åœ¨çº¿ï¼Œéƒ½å¯ä»¥æ¥å—åˆ°æ¶ˆæ¯ï¼Œä¸åœ¨çº¿ï¼Œé‡æ–°å¯åŠ¨åä¼šæ¥å—æ²¡æœ‰æ”¶åˆ°è¿‡çš„æ¶ˆæ¯æ¥å—ä¸‹æ¥</strong></p>
<h3 id="äº‹åŠ¡">äº‹åŠ¡<a hidden class="anchor" aria-hidden="true" href="#äº‹åŠ¡">#</a></h3>
<p><strong>äº‹åŠ¡åå‘äºç”Ÿäº§è€…ã€ç­¾æ”¶åå‘äºæ¶ˆè´¹è€…</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//åˆ›å»ºä¼šè¯ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯äº‹åŠ¡å’Œç­¾æ”¶æœºåˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span></code></pre></div><p>äº‹åŠ¡åªæœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalse</p>
<blockquote>
<p>ç”Ÿäº§è€…ä¸€æ–¹</p>
</blockquote>
<p>å½“å€¼ä¸ºfalseæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨å‘é€åˆ°ç›®çš„åœ°</p>
<p>å½“å€¼ä¸ºtrueæ—¶ï¼Œéœ€è¦åœ¨è°ƒç”¨send()æ–¹æ³•åï¼Œè°ƒç”¨commit()æ–¹æ³•ï¼Œæ‰‹åŠ¨æäº¤</p>
<blockquote>
<p>æ¶ˆè´¹è€…ä¸€æ–¹</p>
</blockquote>
<p>å½“å€¼ä¸ºfalseæ—¶ï¼Œæ¶ˆæ¯åªä¼šè¢«æ¶ˆè´¹ä¸€æ¬¡</p>
<p>å½“å€¼ä¸ºtrueæ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«é‡å¤æ¶ˆè´¹ï¼Œä¸”åœ¨ç›®çš„åœ°ä¸­ï¼Œæ¶ˆæ¯ä¸ä¼šå‡ºé˜Ÿçš„ï¼Œå³æœªè¢«æ¶ˆè´¹</p>
<p>æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºä¼šè¯ï¼Œå¼€å¯äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">true</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//OK,å°±æäº¤
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            session.<span style="color:#007f7f">commit</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#fff;font-weight:bold">catch</span> (JMSException e) {
</span></span><span style="display:flex;"><span>           <span style="color:#007f7f">//error,å°±å›æ»š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            session.<span style="color:#007f7f">rollback</span>();
</span></span><span style="display:flex;"><span>        }<span style="color:#fff;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>            
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h3 id="ç­¾æ”¶æœºåˆ¶">ç­¾æ”¶æœºåˆ¶<a hidden class="anchor" aria-hidden="true" href="#ç­¾æ”¶æœºåˆ¶">#</a></h3>
<p><strong>ç­¾æ”¶é’ˆå¯¹çš„æ˜¯æ¶ˆè´¹è€…ä¸€æ–¹ï¼Œåˆ†ä¸ºä»¥ä¸‹å››ç§</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">interface</span> Session <span style="color:#fff;font-weight:bold">extends</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> AUTO_ACKNOWLEDGE = 1;   <span style="color:#007f7f">//è‡ªåŠ¨ç­¾æ”¶ï¼ˆé»˜è®¤ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> CLIENT_ACKNOWLEDGE = 2;	<span style="color:#007f7f">//æ‰‹åŠ¨ç­¾æ”¶ï¼Œéœ€è¦è°ƒç”¨ message.acknowledge(); è¿›è¡Œç­¾æ”¶ï¼Œå¦åˆ™ä¹Ÿä¼šå¯¼è‡´é‡å¤æ¶ˆè´¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span> 
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> DUPS_OK_ACKNOWLEDGE = 3;	<span style="color:#007f7f">//è‡ªåŠ¨æ‰¹é‡ç¡®è®¤
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> <span style="color:#fff;font-weight:bold">int</span> SESSION_TRANSACTED = 0;	<span style="color:#007f7f">//è¿™ä¸ªæ˜¯é…åˆäº‹åŠ¡ï¼Œå½“äº‹åŠ¡å¼€å¯åˆ™é€‰æ‹©è¿™ä¸ªï¼Œä¸»è¦æ˜¯ä¸€ä¸ªè¯­æ³•çš„ä¸€ä¸ªè§„èŒƒè€Œå·²
</span></span></span></code></pre></div><p><strong>å½“äº‹åŠ¡æ²¡æœ‰å¼€å¯æ—¶ ï¼š</strong>  å³éäº‹åŠ¡ï¼Œæ¶ˆæ¯çš„ç¡®è®¤æƒ…å†µ åˆ™ä»¥ç­¾æ”¶æœºåˆ¶ä¸ºä¸»</p>
<p><strong>å½“äº‹åŠ¡å¼€å§‹æ—¶ ï¼š</strong>  å³äº‹åŠ¡æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯çš„ç¡®è®¤ä»¥äº‹åŠ¡ä¸ºä¸»ï¼Œå³æ˜¯å¦commitçš„ä¸ºä¸»ï¼Œä¸ç”¨ç®¡ç­¾æ”¶æœºåˆ¶çš„æƒ…å†µã€‚</p>
<p><strong>æ³¨ï¼šå¸¸ç”¨çš„ç­¾æ”¶æ¨¡å¼ ä¸»è¦ä»¥è‡ªåŠ¨ç­¾æ”¶ï¼ˆAUTO_ACKNOWLEDGEï¼‰å’Œæ‰‹åŠ¨ç­¾æ”¶ï¼ˆCLIENT_ACKNOWLEDGEï¼‰ä¸ºä¸»</strong></p>
<h1 id="springbootç»“åˆactivemq">SpringBootç»“åˆACtiveMQ<a hidden class="anchor" aria-hidden="true" href="#springbootç»“åˆactivemq">#</a></h1>
<h2 id="é˜Ÿåˆ—æ¨¡å¼">é˜Ÿåˆ—æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#é˜Ÿåˆ—æ¨¡å¼">#</a></h2>
<p>1ã€å¯¼å…¥mavenä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">&lt;!--activemqçš„ä¾èµ–--&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-activemq<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2ã€ç¼–å†™application.propertiesé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server.port=8888
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># é…ç½®activemqçš„é“¾æ¥ï¼Œç”¨æˆ·åå’Œå¯†ç 
</span></span><span style="display:flex;"><span>spring.activemq.broker-url=tcp://æœåŠ¡å™¨å…¬ç½‘ip:ç«¯å£å·
</span></span><span style="display:flex;"><span>spring.activemq.user=admin
</span></span><span style="display:flex;"><span>spring.activemq.password=admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#é…ç½®æ˜¯å¦ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼
</span></span><span style="display:flex;"><span>#falseä¸ºé˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰
</span></span><span style="display:flex;"><span>#tureä¸ºå‘å¸ƒè®¢é˜…
</span></span><span style="display:flex;"><span>spring.jms.pub-sub-domain=false
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#é˜Ÿåˆ—åç§°ï¼ˆè‡ªå®šä¹‰æ ‡ç­¾ï¼‰
</span></span><span style="display:flex;"><span>myqueue=activemq_springboot_queue
</span></span></code></pre></div><p>3ã€ç¼–å†™é…ç½®ç±»</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.command.ActiveMQQueue;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Value;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.Queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ActiveMQConfig {
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//æ³¨å…¥é˜Ÿåˆ—åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${myqueue}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String myQueue_name;
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//å‘springå®¹å™¨å¯¼å…¥é˜Ÿåˆ—å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Queue queue(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ActiveMQQueue(myQueue_name);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>4ã€ç¼–å†™é˜Ÿåˆ—çš„æ¶ˆæ¯ç”Ÿäº§è€…Produce</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.core.JmsMessagingTemplate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.Queue;
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> QueueProduce {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JmsMessagingTemplate jmsMessagingTemplate;
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Queue queue_name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> produceSend(){
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å‘é€æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        jmsMessagingTemplate.<span style="color:#007f7f">convertAndSend</span>(queue_name,<span style="color:#0ff;font-weight:bold">&#34;ç”Ÿäº§è€…ç”Ÿäº§æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>5ã€ç¼–å†™controllerç±»ï¼Œå¹¶è®¿é—®æ¥å£</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.shishiyi.queue.QueueProduce;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> QueueProduceController {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> QueueProduce queueProduce;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/queuesend&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> queueSend(){
</span></span><span style="display:flex;"><span>        queueProduce.<span style="color:#007f7f">produceSend</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€æˆåŠŸ&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æŸ¥çœ‹ActiveMQçš„å‰å°ï¼Œæ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—äº†</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wqCXuR.png" alt="wqCXuR.png"  />
</p>
<p>6ã€ç¼–å†™é˜Ÿåˆ—çš„æ¶ˆè´¹è€…</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.queue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.annotation.JmsListener;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.core.JmsMessagingTemplate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.JMSException;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.Message;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.TextMessage;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> QueueConsumer {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JmsMessagingTemplate jmsMessagingTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">//é‡‡ç”¨ç›‘å¬å™¨çš„æ–¹å¼è·å–æ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @JmsListener(destination = <span style="color:#0ff;font-weight:bold">&#34;${myqueue}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> receive(Message message) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> !=message &amp;&amp; message <span style="color:#fff;font-weight:bold">instanceof</span> TextMessage){
</span></span><span style="display:flex;"><span>            TextMessage textMessage = (TextMessage)message;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆè´¹è€…å·²ç»æ¥å—åˆ°äº†&#34;</span>+textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åˆ é™¤ä¹‹å‰å…¥é˜Ÿçš„ä¿¡æ¯ï¼Œç„¶åé‡æ–°å¯åŠ¨ å¯åŠ¨ç±»ï¼Œå†æ¬¡è®¿é—®æ¥å£ï¼Œå¹¶æŸ¥çœ‹ActiveMQçš„å‰å°å’Œæ‰“å°å°</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wqkFv4.png" alt="wqkFv4.png"  />
<img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wqkfRU.png" alt="wqkfRU.png"  />
</p>
<h2 id="è®¢é˜…å‘å¸ƒæ¨¡å¼">è®¢é˜…å‘å¸ƒæ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#è®¢é˜…å‘å¸ƒæ¨¡å¼">#</a></h2>
<p>1ã€å¯¼å…¥mavenä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-activemq<span style="font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2ã€ç¼–å†™application.propertiesé…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>server.port=7777
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span># é…ç½®activemqçš„é“¾æ¥ï¼Œç”¨æˆ·åå’Œå¯†ç 
</span></span><span style="display:flex;"><span>spring.activemq.broker-url=tcp://æœåŠ¡å™¨å…¬ç½‘ip:ç«¯å£å·
</span></span><span style="display:flex;"><span>spring.activemq.user=admin
</span></span><span style="display:flex;"><span>spring.activemq.password=admin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#é…ç½®æ˜¯å¦ä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼
</span></span><span style="display:flex;"><span>#falseä¸ºé˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰
</span></span><span style="display:flex;"><span>#tureä¸ºå‘å¸ƒè®¢é˜…
</span></span><span style="display:flex;"><span>spring.jms.pub-sub-domain=true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#topicåç§°
</span></span><span style="display:flex;"><span>mytopic=activemq_springboot_topic
</span></span></code></pre></div><p>3ã€ç¼–å†™é…ç½®ç±»</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.config;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.apache.activemq.command.ActiveMQTopic;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Value;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.context.annotation.Configuration;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.Topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> ActiveMQConfig {
</span></span><span style="display:flex;"><span>    @Value(<span style="color:#0ff;font-weight:bold">&#34;${mytopic}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> String myTopic;
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> Topic topic(){
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">new</span> ActiveMQTopic(myTopic);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>4ã€ç¼–å†™ä¸»é¢˜çš„æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆå‘å¸ƒæ–¹ï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.core.JmsMessagingTemplate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.Topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TopicProduce {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JmsMessagingTemplate jmsMessagingTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Topic topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> topicSend(){
</span></span><span style="display:flex;"><span>        jmsMessagingTemplate.<span style="color:#007f7f">convertAndSend</span>(topic,<span style="color:#0ff;font-weight:bold">&#34;å‘å¸ƒæ–¹å‘ä¸»é¢˜å‘å¸ƒçš„æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€æˆåŠŸ&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>5ã€ç¼–å†™controllerç±»</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> com.shishiyi.topic.TopicProduce;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.GetMapping;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.web.bind.annotation.RestController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TopicProduceController {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> TopicProduce topicProduce;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#0ff;font-weight:bold">&#34;/topicSend&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> topicSend(){
</span></span><span style="display:flex;"><span>        topicProduce.<span style="color:#007f7f">topicSend</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>6ã€ç¼–å†™ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼ˆè®¢é˜…æ–¹ï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.annotation.JmsListener;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.core.JmsMessagingTemplate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TopicConsumer {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JmsMessagingTemplate jmsMessagingTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @JmsListener(destination = <span style="color:#0ff;font-weight:bold">&#34;${mytopic}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> receive(Message message) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> != message &amp;&amp; message <span style="color:#fff;font-weight:bold">instanceof</span> TextMessage){
</span></span><span style="display:flex;"><span>            TextMessage textMessage = (TextMessage) message;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&#34;</span>+textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>7ã€å¯åŠ¨ä¸»å¯åŠ¨ç±»ï¼Œè®¿é—®æ¥å£ï¼Œè®©å‘å¸ƒæ–¹ç”Ÿäº§æ¶ˆæ¯ï¼Œå¹¶æŸ¥çœ‹ActiveMQçš„å‰å°å’Œæ‰“å°å°</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wqeLvT.png" alt="wqeLvT.png"  />
<img loading="lazy" src="https://s1.ax1x.com/2020/09/21/wqevb4.png" alt="wqevb4.png"  />
</p>
<blockquote>
<p>å®šæ—¶çš„è®¢é˜…å‘å¸ƒæ¨¡å¼</p>
</blockquote>
<p>è®©å‘å¸ƒæ–¹æ¯è¿‡5ç§’ï¼Œå‘é€ä¸€æ¬¡æ¶ˆæ¯</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#007f7f">//åˆ›å»ºå®šæ—¶ä»»åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.core.JmsMessagingTemplate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.scheduling.annotation.Scheduled;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.Topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TopicProduce {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JmsMessagingTemplate jmsMessagingTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> Topic topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> topicSend(){
</span></span><span style="display:flex;"><span>        jmsMessagingTemplate.<span style="color:#007f7f">convertAndSend</span>(topic,<span style="color:#0ff;font-weight:bold">&#34;å‘å¸ƒæ–¹å‘ä¸»é¢˜å‘å¸ƒçš„æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€æˆåŠŸ&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>	<span style="color:#007f7f">//åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”5ç§’å‘å¸ƒæ¶ˆæ¯
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>    @Scheduled(fixedRate = 5000L)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> scheduled(){
</span></span><span style="display:flex;"><span>        topicSend();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ·»åŠ  @EnableScheduling æ³¨è§£ï¼Œå‘ç°å®šæ—¶ä»»åŠ¡è®©å®ƒåå°æ‰§è¡Œ</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/22/wLkdpT.png" alt="wLkdpT.png"  />
</p>
<p>ä¿®æ”¹ä¸»é¢˜çš„æ¶ˆè´¹è€…ï¼ˆè®¢é˜…æ–¹ï¼‰ï¼Œæ·»åŠ LocalDateTime.now()æ–¹æ³•ï¼Œæ–¹ä¾¿åœ¨æ§åˆ¶å°æŸ¥çœ‹</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">package</span> com.shishiyi.topic;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.annotation.JmsListener;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.jms.core.JmsMessagingTemplate;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> javax.jms.*;
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">import</span> java.time.LocalDateTime;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Component
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> TopicConsumer {
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> JmsMessagingTemplate jmsMessagingTemplate;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @JmsListener(destination = <span style="color:#0ff;font-weight:bold">&#34;${mytopic}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">void</span> receive(Message message) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> != message &amp;&amp; message <span style="color:#fff;font-weight:bold">instanceof</span> TextMessage){
</span></span><span style="display:flex;"><span>            TextMessage textMessage = (TextMessage) message;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&#34;</span>+textMessage.<span style="color:#007f7f">getText</span>()+ <span style="color:#0ff;font-weight:bold">&#34;æ—¶é—´ä¸ºï¼š&#34;</span> +LocalDateTime.<span style="color:#007f7f">now</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å¯åŠ¨ç¨‹åºï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ‰“å°å†…å®¹ï¼Œä»¥åŠï¼ˆåŒä¸€æ—¶é—´ç‚¹å†…ï¼‰æŸ¥çœ‹ActiveMQçš„å‰å°</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/22/wLVl6O.png" alt="wLVl6O.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/22/wLVQ1K.png" alt="wLVQ1K.png"  />
</p>
<h1 id="activemqä¼ è¾“åè®®">ActiveMQä¼ è¾“åè®®<a hidden class="anchor" aria-hidden="true" href="#activemqä¼ è¾“åè®®">#</a></h1>
<p>åœ¨è¿æ¥activemqæ—¶ï¼Œé»˜è®¤æ˜¯ç”¨TCPè¿æ¥ï¼Œé‚£Activemqæ˜¯å¦è¿˜æ”¯æŒå…¶å®ƒåè®®å—ï¼Ÿ</p>
<p>æŸ¥çœ‹activemqçš„confæ–‡ä»¶å¤¹ä¸‹çš„<strong>activemq.xml</strong></p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wjwPQx.png" alt="wjwPQx.png"  />
</p>
<p>å¯ä»¥çœ‹å‡ºï¼Œé™¤äº†æ”¯æŒé»˜è®¤çš„TCPåè®®ï¼Œè¿˜æ”¯æŒ amqp ï¼Œstompï¼Œmqttï¼Œwsç­‰åè®®ï¼Œè€Œä¸”åè®®å¯¹åº”çš„ç«¯å£å·ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™å°±æ˜¯ç”¨TCPè¿æ¥æ—¶ï¼Œç«¯å£å·æ˜¯61616çš„åŸå› äº†ã€‚</p>
<p>ä»activemqå‰å°ä¹Ÿå¯ä»¥æŸ¥çœ‹å‡ºæ¥</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wj03g1.png" alt="wj03g1.png"  />
</p>
<p>å¦‚æœæƒ³é…ç½®å…¶å®ƒåè®®ï¼Œå¯ä»¥æŸ¥çœ‹å®˜ç½‘çš„æ–‡æ¡£</p>
<p><a href="http://activemq.apache.org/configuring-version-5-transports">http://activemq.apache.org/configuring-version-5-transports</a></p>
<blockquote>
<h3 id="é…ç½®nioåè®®">é…ç½®NIOåè®®<a hidden class="anchor" aria-hidden="true" href="#é…ç½®nioåè®®">#</a></h3>
</blockquote>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wjySYD.png" alt="wjySYD.png"  />
</p>
<p>ä»å®˜ç½‘çš„æ–‡æ¡£å¾—çŸ¥ï¼Œé…ç½®NIOåè®®ï¼Œåªéœ€è¦ä¿®æ”¹<strong>activemq.xml</strong>æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#007f7f">&lt;!--æ·»åŠ ä¸€æ®µå³å¯--&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;transportConnectors&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;transportConnector</span> <span style="color:#007f7f">name=</span><span style="color:#0ff;font-weight:bold">&#34;nio&#34;</span> <span style="color:#007f7f">uri=</span><span style="color:#0ff;font-weight:bold">&#34;nio://0.0.0.0:61617&#34;</span><span style="font-weight:bold">/&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#f00">&lt;</span>/<span style="font-weight:bold">&lt;transportConnectors&gt;</span>
</span></span></code></pre></div><p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wj59Ej.png" alt="wj59Ej.png"  />
</p>
<p>é‡å¯activemqï¼ˆé‡å¯å®¹å™¨ï¼‰ï¼ŒæŸ¥çœ‹activemqå‰å°</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wj5Raj.png" alt="wj5Raj.png"  />
</p>
<p>ä¿®æ”¹ä»£ç çš„è¿æ¥æ–¹å¼ï¼Œå¹¶æµ‹è¯•</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#007f7f">//ç”±äºå®‰è£…çš„activemqæ˜¯dockerå®¹å™¨ï¼Œæ·»åŠ çš„nioåè®®ç«¯å£æ˜¯61617ï¼Œæ‰€ä»¥ç«¯å£è¦æå‰æ˜ å°„å¥½ï¼Œå¦åˆ™ä¼šè¿ä¸ä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>	<span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;nio://47.115.151.184:61617&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String QUEUE_NAME=<span style="color:#0ff;font-weight:bold">&#34;myQueue_NIO&#34;</span>;
</span></span></code></pre></div><p>æŸ¥çœ‹å‰å°</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wjbZKx.png" alt="wjbZKx.png"  />
</p>
<h1 id="activemqæŒä¹…åŒ–">ActiveMQæŒä¹…åŒ–<a hidden class="anchor" aria-hidden="true" href="#activemqæŒä¹…åŒ–">#</a></h1>
<p>æŒä¹…åŒ–ä¸åŒäºä¹‹å‰çš„æŒä¹…æ€§ï¼ŒæŒä¹…åŒ–æ˜¯ä»¥é˜²æœåŠ¡å™¨æœ¬èº«æŒ‚äº†ï¼Œé‡å¯æœåŠ¡å™¨ä¹Ÿå¯ä»¥æ¢å¤æ¶ˆæ¯</p>
<p>ActiveMQç›®å‰é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼æ˜¯KahaDBï¼Œæ­¤å¤–è¿˜æœ‰JDBCï¼Œ LevelDBç­‰ï¼Œä¸è¿‡å®ƒä»¬å¤§ä½“ä¸Šçš„é€»è¾‘æ˜¯ä¸€æ ·ï¼Œæ¶ˆæ¯ä¸­å¿ƒæ¥å—åˆ°æ¶ˆæ¯ã€‚ä¼šæŠŠæ¶ˆæ¯å¤‡ä»½å­˜å‚¨èµ·æ¥ã€‚</p>
<h2 id="kahadbé»˜è®¤">KahaDB(é»˜è®¤)<a hidden class="anchor" aria-hidden="true" href="#kahadbé»˜è®¤">#</a></h2>
<p><strong>KahaDBï¼šè¿™ä¸ª5.4ç‰ˆæœ¬ä¹‹åå‡ºç°çš„é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ï¼Œ</strong> KahaDBçš„æŒä¹…åŒ–æœºåˆ¶æ˜¯åŸºäºæ—¥å¿—æ–‡ä»¶ï¼Œç´¢å¼•å’Œç¼“å­˜ã€‚</p>
<p>ä»<strong>activemq.xml</strong>é…ç½®æ–‡ä»¶ä¸­å¯ä»¥å¾—çŸ¥</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wjxVYT.png" alt="wjxVYT.png"  />
</p>
<p>å®ƒæ˜¯æŠŠæ•°æ®å­˜å‚¨åœ¨activemqçš„dataç›®å½•ä¸‹çš„kahadbæ–‡ä»¶å¤¹ä¸­</p>
<p>åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ä¼šæœ‰å››ä¸ªæ–‡ä»¶æ¥å®Œæˆæ¶ˆæ¯æŒä¹…åŒ–</p>
<ul>
<li><strong>db.data</strong> å®ƒæ˜¯æ¶ˆæ¯çš„ç´¢å¼•æ–‡ä»¶ï¼Œæœ¬è´¨ä¸Šæ˜¯B-Treeï¼ˆBæ ‘ï¼‰ï¼Œä½¿ç”¨B-Treeä½œä¸ºç´¢å¼•æŒ‡å‘<strong>db-*.log</strong>é‡Œé¢å­˜å‚¨çš„æ¶ˆæ¯</li>
<li><strong>db.redo</strong> ç”¨æ¥è¿›è¡Œæ¶ˆæ¯æ¢å¤</li>
<li><strong>db-*.log</strong> å­˜å‚¨æ¶ˆæ¯å†…å®¹ã€‚æ–°çš„æ•°æ®ä»¥APPENDçš„æ–¹å¼è¿½åŠ åˆ°æ—¥å¿—æ–‡ä»¶æœ«å°¾ã€‚å±äºé¡ºåºå†™å…¥ï¼Œå› æ­¤æ¶ˆæ¯å­˜å‚¨æ˜¯æ¯”è¾ƒå¿«çš„ã€‚é»˜è®¤æ˜¯32Mï¼Œè¾¾åˆ°é˜€å€¼ä¼šè‡ªåŠ¨é€’å¢æ–‡ ä»¶ï¼Œæ–‡ä»¶åæŒ‰ç…§æ•°å­—è¿›è¡Œç¼–å·ï¼Œå¦‚ db-1.logã€db-2.logã€&hellip;..</li>
<li><strong>lock</strong> æ–‡ä»¶ é”ï¼Œå†™å…¥å½“å‰è·å¾—kahadbè¯»å†™æƒé™çš„broker ï¼Œç”¨äºåœ¨é›†ç¾¤ç¯å¢ƒä¸‹çš„ç«äº‰å¤„ç†</li>
</ul>
<p><strong>KahaDBé…ç½®å®˜ç½‘é“¾æ¥ï¼š</strong>  <a href="http://activemq.apache.org/kahadb">http://activemq.apache.org/kahadb</a></p>
<h2 id="leveldb">LevelDB<a hidden class="anchor" aria-hidden="true" href="#leveldb">#</a></h2>
<p>è¿™ç§æ–‡ä»¶ç³»ç»Ÿæ˜¯ä»ActiveMQ 5.8 ä¹‹åå¼•è¿›çš„ï¼Œå®ƒå’Œ KahaDB éå¸¸ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯åŸºäºæ–‡ä»¶çš„æœ¬åœ°æ•°æ®åº“å­˜ å‚¨å½¢å¼ï¼Œä½†æ˜¯å®ƒæä¾›æ¯” KahaDBæ›´å¿«çš„æŒä¹…æ€§ã€‚</p>
<p>ä½†å®ƒä¸ä½¿ç”¨è‡ªå®šä¹‰ B-Tree å®ç°æ¥ç´¢å¼•é¢„å†™æ—¥å¿—ï¼Œè€Œæ˜¯ä½¿ç”¨åŸºäºLevelDBçš„ç´¢å¼•ã€‚</p>
<p>å¯æ˜¯ä¸ºä»€ä¹ˆLeavelDB æ›´å¿«ï¼Œå¹¶ä¸”5.8 ä»¥åå°±æ”¯æŒï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯é»˜è®¤ KahaDB å¼•æ“ï¼Œå› ä¸º activemq å®˜ç½‘æœ¬èº«æ²¡æœ‰å®šè®ºï¼ŒLeavelDB ä¹‹ååˆå‡ºäº†å¯å¤åˆ¶çš„</p>
<p>LeavelDB æ¯”LeavelDB æ›´æ€§èƒ½æ›´ä¼˜è¶Šï¼Œä½†éœ€è¦åŸºäº ZooKeeper æ‰€ä»¥è¿™äº›å®˜æ–¹è¿˜æ²¡æœ‰å®šè®ºï¼Œä»æ—§ä½¿ç”¨ KahaDBã€‚</p>
<p>é»˜è®¤é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;broker</span> <span style="color:#007f7f">brokerName=</span><span style="color:#0ff;font-weight:bold">&#34;broker&#34;</span> <span style="color:#f00">...</span> <span style="font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;persistenceAdapter&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="font-weight:bold">&lt;levelDB</span> <span style="color:#007f7f">directory=</span><span style="color:#0ff;font-weight:bold">&#34;activemq-data&#34;</span><span style="font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;/persistenceAdapter&gt;</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">&lt;/broker&gt;</span>
</span></span></code></pre></div><p><strong>LevelDBé…ç½®å®˜ç½‘é“¾æ¥ï¼š</strong>  <a href="http://activemq.apache.org/leveldb-store">http://activemq.apache.org/leveldb-store</a></p>
<h2 id="jdbc">JDBC<a hidden class="anchor" aria-hidden="true" href="#jdbc">#</a></h2>
<p>çœ‹åå­—å°±çŸ¥é“å’Œæ•°æ®åº“æœ‰å…³ï¼Œæ‰€ä»¥JDBçš„æŒä¹…åŒ–å°±æ˜¯æŠŠæ¶ˆæ¯å¤‡ä»½åˆ°æ•°æ®åº“ä¸­</p>
<p>ç”±äºç”¨dockeræ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥ç›´æ¥æ”¹ä¸ºwindowsæœ¬åœ°æµ‹è¯•</p>
<p>é¦–å…ˆä¸‹è½½activemqçš„windowsç‰ˆæœ¬ï¼Œhttp://activemq.apache.org/components/classic/download/</p>
<p>ç„¶åä¸‹è½½mysqlçš„é©±åŠ¨åŒ…ï¼Œ</p>
<p>æŠŠmysqlé©±åŠ¨åŒ…ä¸¢åˆ°activemqçš„libä¸‹</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wv9hxU.png" alt="wv9hxU.png"  />
</p>
<p>æ‰“å¼€activemqçš„<strong>confç›®å½•ä¸‹çš„activemq.xmlæ–‡ä»¶</strong>ï¼Œé…ç½®å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>		<span style="color:#007f7f">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">            Configure message persistence for the broker. The default persistence
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">            mechanism is the KahaDB store (identified by the kahaDB tag).
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">            For more information, see:
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">            http://activemq.apache.org/persistence.html
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">        
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">        &lt;persistenceAdapter&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">            &lt;kahaDB directory=&#34;${activemq.data}/kahadb&#34;/&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">        &lt;/persistenceAdapter&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">		å±è”½ä¹‹å‰çš„æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f">        --&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#007f7f">&lt;!--æ”¹ç”¨mysqlæ–¹å¼--&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold">&lt;persistenceAdapter&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="font-weight:bold">&lt;jdbcPersistenceAdapter</span> <span style="color:#007f7f">dataSource=</span><span style="color:#0ff;font-weight:bold">&#34;#mysqlDataSource&#34;</span> <span style="color:#007f7f">createTablesOnStartup=</span><span style="color:#0ff;font-weight:bold">&#34;true&#34;</span><span style="font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="font-weight:bold">&lt;/persistenceAdapter&gt;</span>
</span></span></code></pre></div><p>å‚æ•°è§£é‡Šï¼š</p>
<p><strong>dataSourceï¼š</strong>   è¡¨ç¤ºçš„æ˜¯å¼•ç”¨çš„æ•°æ®æºåç§°</p>
<p><strong>createTablesOnStartupï¼š</strong>   è¡¨ç¤ºå¯åŠ¨çš„æ—¶å€™æ˜¯å¦å»åˆ›å»ºè¡¨ï¼Œä¸€èˆ¬ç¬¬ä¸€æ¬¡ä¸ºtrue,ä¹‹åæ”¹ä¸ºfalse</p>
<p>æ¥ç€ç”±äºæŒ‡å®šäº†æ•°æ®æºï¼Œæ‰€ä»¥éœ€è¦åœ¨<strong>activemq.xml</strong>é…ç½®ä¸€ä¸ªæ•°æ®æºï¼Œä¸è¿‡è¦æ³¨æ„ä½ç½®</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;bean</span> <span style="color:#007f7f">id=</span><span style="color:#0ff;font-weight:bold">&#34;mysqlDataSource&#34;</span> <span style="color:#007f7f">class=</span><span style="color:#0ff;font-weight:bold">&#34;org.apache.commons.dbcp.BasicDataSource&#34;</span> <span style="color:#007f7f">destroy-method=</span><span style="color:#0ff;font-weight:bold">&#34;close&#34;</span><span style="font-weight:bold">&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;property</span> <span style="color:#007f7f">name=</span><span style="color:#0ff;font-weight:bold">&#34;driverClassName&#34;</span> <span style="color:#007f7f">value=</span><span style="color:#0ff;font-weight:bold">&#34;com.mysql.jdbc.Driver&#34;</span><span style="font-weight:bold">/&gt;</span>      
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;property</span> <span style="color:#007f7f">name=</span><span style="color:#0ff;font-weight:bold">&#34;url&#34;</span> <span style="color:#007f7f">value=</span><span style="color:#0ff;font-weight:bold">&#34;jdbc:mysql://localhost:3306/activemq?relaxAutoCommit=true&#34;</span><span style="font-weight:bold">/&gt;</span>      
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;property</span> <span style="color:#007f7f">name=</span><span style="color:#0ff;font-weight:bold">&#34;username&#34;</span> <span style="color:#007f7f">value=</span><span style="color:#0ff;font-weight:bold">&#34;root&#34;</span><span style="font-weight:bold">/&gt;</span>     
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">&lt;property</span> <span style="color:#007f7f">name=</span><span style="color:#0ff;font-weight:bold">&#34;password&#34;</span> <span style="color:#007f7f">value=</span><span style="color:#0ff;font-weight:bold">&#34;123&#34;</span><span style="font-weight:bold">/&gt;</span>   
</span></span><span style="display:flex;"><span><span style="font-weight:bold">&lt;/bean&gt;</span>
</span></span></code></pre></div><p><strong>ç„¶ååˆ›å»ºå¥½æ•°æ®åº“ï¼Œæ•°æ®åº“åå­—ä¸æ•°æ®æºé“¾æ¥çš„è¦ä¸€è‡´</strong></p>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<blockquote>
<p>Queue</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//ç”Ÿäº§è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsProduce {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://127.0.0.1:61616&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String QUEUE_NAME=<span style="color:#0ff;font-weight:bold">&#34;queue_jdbc_mysql&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        ActiveMQConnectionFactory connectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);     
</span></span><span style="display:flex;"><span>        Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        Destination destination = session.<span style="color:#007f7f">createQueue</span>(QUEUE_NAME);
</span></span><span style="display:flex;"><span>        MessageProducer messageProducer = session.<span style="color:#007f7f">createProducer</span>(destination);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//ä¸€å®šè¦å¼€å¯æŒä¹…åŒ–
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">setDeliveryMode</span>(DeliveryMode.<span style="color:#007f7f">PERSISTENT</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt; 5; i++) {
</span></span><span style="display:flex;"><span>            TextMessage message = session.<span style="color:#007f7f">createTextMessage</span>(<span style="color:#0ff;font-weight:bold">&#34;ç¬¬&#34;</span> + i + <span style="color:#0ff;font-weight:bold">&#34;æ¡æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>            messageProducer.<span style="color:#007f7f">send</span>(message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€å®Œæˆï¼&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å¯åŠ¨åï¼Œåˆ†åˆ«æŸ¥çœ‹æ•°æ®åº“å’Œå‰å°ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wvZeVU.png" alt="wvZeVU.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wvZmaF.png" alt="wvZmaF.png"  />
</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//æ¶ˆè´¹è€…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsConsumer {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://127.0.0.1:61616&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String QUEUE_NAME=<span style="color:#0ff;font-weight:bold">&#34;queue_jdbc_mysql&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        ActiveMQConnectionFactory activeMQConnectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        Connection connection = activeMQConnectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        Destination destination = session.<span style="color:#007f7f">createQueue</span>(QUEUE_NAME);
</span></span><span style="display:flex;"><span>        MessageConsumer messageConsumer = session.<span style="color:#007f7f">createConsumer</span>(destination);
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (<span style="color:#fff;font-weight:bold">true</span>){
</span></span><span style="display:flex;"><span>            TextMessage textMessage = (TextMessage)messageConsumer.<span style="color:#007f7f">receive</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#fff;font-weight:bold">if</span> (<span style="color:#fff;font-weight:bold">null</span> !=textMessage){
</span></span><span style="display:flex;"><span>                <span style="color:#007f7f">//è·å–æ¶ˆæ¯å†…å®¹å¹¶æ‰“å°
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>                System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆè´¹è€…æ¥å—çš„æ¶ˆæ¯:  &#34;</span>+textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>            }<span style="color:#fff;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#fff;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageConsumer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å¯åŠ¨æ¶ˆè´¹è€…æŸ¥çœ‹æ•°æ®åº“å’Œå‰å°ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wve3Wj.png" alt="wve3Wj.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wveGSs.png" alt="wveGSs.png"  />
</p>
<blockquote>
<p>Queue å°ç»“ï¼š</p>
</blockquote>
<p>â€‹		åœ¨ç‚¹å¯¹ç‚¹ç±»å‹ä¸­ï¼Œå½“<strong>DeliveryMode</strong>è®¾ç½®ä¸º<strong>NON_PERSISTENCE</strong> æ—¶ï¼Œæ¶ˆæ¯è¢«ä¿å­˜åœ¨å†…å­˜ä¸­ï¼› å½“<strong>DeliveryMode</strong>è®¾ç½®ä¸º<strong>PERSISTENCE</strong> æ—¶ï¼Œæ¶ˆæ¯è¢«ä¿å­˜åœ¨Brokerçš„ç›¸åº”çš„æ–‡ä»¶æˆ–è€…æ•°æ®åº“ä¸­ã€‚è€Œä¸”ç‚¹å¯¹ç‚¹ç±»å‹ä¸­æ¶ˆæ¯ä¸€æ—¦è¢«Consumeræ¶ˆè´¹å°±ä»Brokerä¸­åˆ é™¤</p>
<blockquote>
<p>Topic</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//å‘å¸ƒæ–¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsProduce_Topic {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://127.0.0.1:61616&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String TOPIC_NAME=<span style="color:#0ff;font-weight:bold">&#34;topic_jdbc_mysql&#34;</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        ActiveMQConnectionFactory connectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        Topic topic = session.<span style="color:#007f7f">createTopic</span>(TOPIC_NAME);
</span></span><span style="display:flex;"><span>        MessageProducer messageProducer = session.<span style="color:#007f7f">createProducer</span>(topic);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è®¾ç½®å‘å¸ƒæ–¹ä¸º æŒä¹…
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">setDeliveryMode</span>(DeliveryMode.<span style="color:#007f7f">PERSISTENT</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è®¾å®šä¸ºæŒä¹…åï¼Œç„¶åè¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">for</span> (<span style="color:#fff;font-weight:bold">int</span> i = 1; i &lt;=3; i++) {
</span></span><span style="display:flex;"><span>            TextMessage message = session.<span style="color:#007f7f">createTextMessage</span>(<span style="color:#0ff;font-weight:bold">&#34;ç¬¬&#34;</span> + i + <span style="color:#0ff;font-weight:bold">&#34;æ¡æ¶ˆæ¯&#34;</span>);
</span></span><span style="display:flex;"><span>            messageProducer.<span style="color:#007f7f">send</span>(message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//å…³é—­èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        messageProducer.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;æ¶ˆæ¯å‘é€å®Œæˆï¼&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#007f7f">//è®¢é˜…æ–¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>
</span></span><span style="display:flex;"><span><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">class</span> JmsConsumer_Topic_DeliveryMode {
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String ACTIVEMQ_URL=<span style="color:#0ff;font-weight:bold">&#34;tcp://127.0.0.1:61616&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">private</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">final</span> String TOPIC_NAME=<span style="color:#0ff;font-weight:bold">&#34;topic_jdbc_mysql&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> <span style="color:#fff;font-weight:bold">void</span> main(String[] args) <span style="color:#fff;font-weight:bold">throws</span> JMSException {
</span></span><span style="display:flex;"><span>        ActiveMQConnectionFactory connectionFactory = <span style="color:#fff;font-weight:bold">new</span> ActiveMQConnectionFactory(ACTIVEMQ_URL);
</span></span><span style="display:flex;"><span>        Connection connection = connectionFactory.<span style="color:#007f7f">createConnection</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//è®¢é˜…æ–¹çš„id
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        connection.<span style="color:#007f7f">setClientID</span>(<span style="color:#0ff;font-weight:bold">&#34;001&#34;</span>);
</span></span><span style="display:flex;"><span>        Session session = connection.<span style="color:#007f7f">createSession</span>(<span style="color:#fff;font-weight:bold">false</span>, Session.<span style="color:#007f7f">AUTO_ACKNOWLEDGE</span>);
</span></span><span style="display:flex;"><span>        Topic topic = session.<span style="color:#007f7f">createTopic</span>(TOPIC_NAME);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//åˆ›å»ºæŒä¹…çš„è®¢é˜…æ–¹
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        TopicSubscriber topicSubscriber = session.<span style="color:#007f7f">createDurableSubscriber</span>(topic, <span style="color:#0ff;font-weight:bold">&#34;ååä¹™&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#007f7f">//æŒä¹…åŒ–åï¼Œå†è¿›è¡Œè¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#007f7f"></span>        connection.<span style="color:#007f7f">start</span>();
</span></span><span style="display:flex;"><span>        Message message = topicSubscriber.<span style="color:#007f7f">receive</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#fff;font-weight:bold">while</span> (<span style="color:#fff;font-weight:bold">null</span> != message){
</span></span><span style="display:flex;"><span>            TextMessage textMessage = (TextMessage)message;
</span></span><span style="display:flex;"><span>            System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;è®¢é˜…æ–¹æ”¶åˆ°çš„æ¶ˆæ¯ï¼š&#34;</span>+textMessage.<span style="color:#007f7f">getText</span>());
</span></span><span style="display:flex;"><span>            message = topicSubscriber.<span style="color:#007f7f">receive</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        topicSubscriber.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        session.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>        connection.<span style="color:#007f7f">close</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å…ˆå¯åŠ¨è®¢é˜…æ–¹ç„¶åå†å¯åŠ¨å‘å¸ƒæ–¹ï¼ŒæŸ¥çœ‹æ•°æ®åº“å’Œå‰å°ï¼š</p>
<p><img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wvKJ4U.png" alt="wvKJ4U.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wvKGNT.png" alt="wvKGNT.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wvK1H0.png" alt="wvK1H0.png"  />

<img loading="lazy" src="https://s1.ax1x.com/2020/09/23/wvKKjs.png" alt="wvKKjs.png"  />
</p>
<blockquote>
<p>Topic å°ç»“ï¼š</p>
</blockquote>
<p>ä¸€å®šè¦å…ˆå¯åŠ¨æ¶ˆè´¹è®¢é˜…ç„¶åå†å¯åŠ¨ç”Ÿäº§ï¼Œæ¶ˆæ¯ä¼šè¢«ä¿ç•™åœ¨ activemq_msgsè¡¨ä¸­æ¶ˆè´¹å®Œæ¯•ä¹Ÿä¸ä¼šåˆ é™¤ï¼Œè€Œè®¢é˜…å…³ç³»åœ¨ acks è¡¨ ä¸­ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://shaoyi.cc/tags/activemq/">ActiveMQ</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://shaoyi.cc/posts/blog/mq/rabbitmq/rabbitmq/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>æ¶ˆæ¯ä¸­é—´ä»¶ä¹‹RabbitMQ</span>
  </a>
  <a class="next" href="http://shaoyi.cc/posts/blog/%E6%9D%82%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Javaå¤šçº¿ç¨‹ç¬”è®°</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="http://shaoyi.cc/">ååä¹™çš„åšå®¢</a></span>
    <span>All Rights Reserved</span>
    <span>
        
        
        <a href="https://beian.miit.gov.cn/" rel="noopener noreferrer" target="_blank">é„‚ICPå¤‡2022008682å·-1</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script></body>

</html>
